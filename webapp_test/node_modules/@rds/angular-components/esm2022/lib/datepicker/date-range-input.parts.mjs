import { booleanAttribute, Directive, EventEmitter, HostBinding, HostListener, inject, InjectionToken, Injector, Input, Output, } from '@angular/core';
import { FormGroupDirective, NG_VALIDATORS, NG_VALUE_ACCESSOR, NgControl, NgForm, Validators, } from '@angular/forms';
import { BACKSPACE } from '@angular/cdk/keycodes';
import { RdsDatepickerInputBaseDirective, } from './datepicker-input.base';
import { DateRange } from './date-selection.model';
import { Subject } from 'rxjs';
import { ErrorStateMatcher } from '../core';
import { updateErrorState } from '../utils';
import * as i0 from "@angular/core";
export const RDS_DATE_RANGE_INPUT_PARENT = new InjectionToken('RDS_DATE_RANGE_INPUT_PARENT');
class RdsDateRangeInputPartBaseDirective extends RdsDatepickerInputBaseDirective {
    constructor() {
        super(...arguments);
        this.rangeInput = inject(RDS_DATE_RANGE_INPUT_PARENT);
        this.defaultErrorStateMatcher = inject(ErrorStateMatcher);
        this.injector = inject(Injector);
        this.parentForm = inject(NgForm, { optional: true });
        this.parentFormGroup = inject(FormGroupDirective, {
            optional: true,
        });
        this.errorStateMatcher = null;
        this.errorState = false;
    }
    ngOnInit() {
        try {
            const ngControl = this.injector.get(NgControl, null, { self: true });
            if (ngControl) {
                this.ngControl = ngControl;
            }
        }
        catch (e) {
            //do nothing
        }
    }
    ngDoCheck() {
        if (this.ngControl) {
            const oldState = this.errorState;
            this.errorState = updateErrorState(this.errorState, this.parentFormGroup, this.parentForm, this.ngControl?.control ?? null, this.errorStateMatcher || this.defaultErrorStateMatcher);
            if (this.errorState !== oldState) {
                this.stateChanges.next();
            }
        }
    }
    isEmpty() {
        return this.elementRef.nativeElement.value.length === 0;
    }
    _getPlaceholder() {
        return this.elementRef.nativeElement.placeholder;
    }
    focus() {
        this.elementRef.nativeElement.focus();
    }
    _onInput(value) {
        super._onInput(value);
        this.rangeInput._handleChildValueChange();
    }
    _openPopup() {
        this.rangeInput._openDatepicker();
    }
    _getMinDate() {
        return this.rangeInput.min;
    }
    _getMaxDate() {
        return this.rangeInput.max;
    }
    _getDateFilter() {
        return this.rangeInput.dateFilter;
    }
    _parentDisabled() {
        return this.rangeInput._groupDisabled;
    }
    _shouldHandleChangeEvent({ source, }) {
        return (source !== this.rangeInput._startInput &&
            source !== this.rangeInput._endInput);
    }
    _assignValueProgrammatically(value) {
        super._assignValueProgrammatically(value);
        const opposite = (this === this.rangeInput._startInput
            ? this.rangeInput._endInput
            : this.rangeInput._startInput);
        opposite?._validatorOnChange();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDateRangeInputPartBaseDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.1", type: RdsDateRangeInputPartBaseDirective, usesInheritance: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDateRangeInputPartBaseDirective, decorators: [{
            type: Directive
        }] });
export class RdsStartDateDirective extends RdsDateRangeInputPartBaseDirective {
    get isDisabled() {
        return this.disabled ? true : null;
    }
    get id() {
        return `${this.rangeInput.id}-start`;
    }
    get hasPopup() {
        return this.rangeInput.rangePicker ? 'dialog' : null;
    }
    get ariaOwns() {
        return ((this.rangeInput.rangePicker?.opened && this.rangeInput.rangePicker.id) ||
            null);
    }
    get min() {
        return this._getMinDate()
            ? this.dateAdapter.toIso8601(this._getMinDate())
            : null;
    }
    get max() {
        return this._getMaxDate()
            ? this.dateAdapter.toIso8601(this._getMaxDate())
            : null;
    }
    get attrRequired() {
        return (this._required ??
            this.ngControl?.control?.hasValidator(Validators.required) ??
            null);
    }
    set required(value) {
        const isRequired = booleanAttribute(value);
        if (isRequired !== this._required) {
            this._required = isRequired;
            this.stateChanges.next();
        }
    }
    get required() {
        return this.attrRequired ?? false;
    }
    onBlur() {
        this._onBlur();
    }
    onChange() {
        this._onChange();
    }
    onKeydown($event) {
        this._onInput($event.target.value);
    }
    onInput($event) {
        this._onKeydown($event);
    }
    constructor() {
        super();
        this._validator = null;
        this.stateChanges = new Subject();
        this.errorStateMatcher = null;
        this.dateChange = new EventEmitter();
        this.dateInput = new EventEmitter();
        this.class = 'rds-start-date rds-date-range-input-inner';
        this.type = 'text';
        this._startValidator = (control) => {
            const start = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(control.value));
            const end = this._model ? this._model.selection?.end : null;
            return !start ||
                !end ||
                (this.dateAdapter && this.dateAdapter.compareDate(start, end) <= 0)
                ? null
                : { rdsStartDateInvalid: { end: end, actual: start } };
        };
        this._validator = Validators.compose([
            ...super._getValidators(),
            this._startValidator,
        ]);
    }
    ngOnInit() {
        super.ngOnInit();
    }
    ngDoCheck() {
        super.ngDoCheck();
    }
    _getValueFromModel(modelValue) {
        return modelValue.start;
    }
    _shouldHandleChangeEvent(change) {
        if (!super._shouldHandleChangeEvent(change)) {
            return false;
        }
        else {
            return !change.oldValue?.start
                ? !!change.selection.start
                : !change.selection.start ||
                    !!this.dateAdapter.compareDate(change.oldValue.start, change.selection.start);
        }
    }
    _assignValueToModel(value) {
        if (this._model) {
            const range = new DateRange(value, this._model.selection?.end);
            this._model.updateSelection(range, this);
        }
    }
    _formatValue(value) {
        super._formatValue(value);
        // Any time the input value is reformatted we need to tell the parent.
        this.rangeInput._handleChildValueChange();
    }
    /** Gets the value that should be used when mirroring the input's size. */
    getMirrorValue() {
        const element = this.elementRef.nativeElement;
        const value = element.value;
        return value.length > 0 ? value : element.placeholder;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsStartDateDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.1", type: RdsStartDateDirective, selector: "input[rdsStartDate], input[rds-start-date]", inputs: { errorStateMatcher: "errorStateMatcher", required: "required" }, outputs: { dateChange: "dateChange", dateInput: "dateInput" }, host: { listeners: { "blur": "onBlur()", "change": "onChange()", "input": "onKeydown($event)", "keydown": "onInput($event)" }, properties: { "class": "this.class", "attr.type": "this.type", "disabled": "this.isDisabled", "attr.id": "this.id", "attr.aria-haspopup": "this.hasPopup", "attr.aria-owns": "this.ariaOwns", "attr.min": "this.min", "attr.max": "this.max", "attr.required": "this.attrRequired" } }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: RdsStartDateDirective,
                multi: true,
            },
            { provide: NG_VALIDATORS, useExisting: RdsStartDateDirective, multi: true },
        ], usesInheritance: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsStartDateDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'input[rdsStartDate], input[rds-start-date]',
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: RdsStartDateDirective,
                            multi: true,
                        },
                        { provide: NG_VALIDATORS, useExisting: RdsStartDateDirective, multi: true },
                    ],
                }]
        }], ctorParameters: () => [], propDecorators: { errorStateMatcher: [{
                type: Input
            }], dateChange: [{
                type: Output
            }], dateInput: [{
                type: Output
            }], class: [{
                type: HostBinding,
                args: ['class']
            }], type: [{
                type: HostBinding,
                args: ['attr.type']
            }], isDisabled: [{
                type: HostBinding,
                args: ['disabled']
            }], id: [{
                type: HostBinding,
                args: ['attr.id']
            }], hasPopup: [{
                type: HostBinding,
                args: ['attr.aria-haspopup']
            }], ariaOwns: [{
                type: HostBinding,
                args: ['attr.aria-owns']
            }], min: [{
                type: HostBinding,
                args: ['attr.min']
            }], max: [{
                type: HostBinding,
                args: ['attr.max']
            }], attrRequired: [{
                type: HostBinding,
                args: ['attr.required']
            }], required: [{
                type: Input
            }], onBlur: [{
                type: HostListener,
                args: ['blur']
            }], onChange: [{
                type: HostListener,
                args: ['change']
            }], onKeydown: [{
                type: HostListener,
                args: ['input', ['$event']]
            }], onInput: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }] } });
export class RdsEndDateDirective extends RdsDateRangeInputPartBaseDirective {
    constructor() {
        super(...arguments);
        this.stateChanges = new Subject();
        this.errorStateMatcher = null;
        this.dateChange = new EventEmitter();
        this.dateInput = new EventEmitter();
        this.class = 'rds-end-date rds-date-range-input-inner';
        this.type = 'text';
        this._endValidator = (control) => {
            const end = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(control.value));
            const start = this._model ? this._model.selection?.start : null;
            return !end || !start || this.dateAdapter.compareDate(end, start) >= 0
                ? null
                : { rdsEndDateInvalid: { start: start, actual: end } };
        };
        this._validator = Validators.compose([
            ...super._getValidators(),
            this._endValidator,
        ]);
    }
    get isDisabled() {
        return this.disabled ? true : null;
    }
    get id() {
        return `${this.rangeInput.id}-end`;
    }
    get hasPopup() {
        return this.rangeInput.rangePicker ? 'dialog' : null;
    }
    get ariaOwns() {
        return ((this.rangeInput.rangePicker?.opened && this.rangeInput.rangePicker.id) ||
            null);
    }
    get min() {
        return this._getMinDate()
            ? this.dateAdapter.toIso8601(this._getMinDate())
            : null;
    }
    get max() {
        return this._getMaxDate()
            ? this.dateAdapter.toIso8601(this._getMaxDate())
            : null;
    }
    get attrRequired() {
        return (this._required ??
            this.ngControl?.control?.hasValidator(Validators.required) ??
            null);
    }
    set required(value) {
        const isRequired = booleanAttribute(value);
        if (isRequired !== this._required) {
            this._required = isRequired;
            this.stateChanges.next();
        }
    }
    get required() {
        return this.attrRequired ?? false;
    }
    onBlur() {
        this._onBlur();
    }
    onChange() {
        this._onChange();
    }
    onKeydown($event) {
        this._onInput($event.target.value);
    }
    onInput($event) {
        this._onKeydown($event);
    }
    ngOnInit() {
        super.ngOnInit();
    }
    ngDoCheck() {
        super.ngDoCheck();
    }
    _getValueFromModel(modelValue) {
        return modelValue.end;
    }
    _shouldHandleChangeEvent(change) {
        if (!super._shouldHandleChangeEvent(change)) {
            return false;
        }
        else {
            return !change.oldValue?.end
                ? !!change.selection.end
                : !change.selection.end ||
                    !!this.dateAdapter.compareDate(change.oldValue.end, change.selection.end);
        }
    }
    _assignValueToModel(value) {
        if (this._model) {
            const range = new DateRange(this._model.selection?.start, value);
            this._model.updateSelection(range, this);
        }
    }
    _onKeydown(event) {
        // If the user is pressing backspace on an empty end input, move focus back to the start.
        if (event.keyCode === BACKSPACE && !this.elementRef.nativeElement.value) {
            this.rangeInput._startInput.focus();
        }
        super._onKeydown(event);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsEndDateDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.1", type: RdsEndDateDirective, selector: "input[rdsEndDate], input[rds-end-date]", inputs: { errorStateMatcher: "errorStateMatcher", required: "required" }, outputs: { dateChange: "dateChange", dateInput: "dateInput" }, host: { listeners: { "blur": "onBlur()", "change": "onChange()", "input": "onKeydown($event)", "keydown": "onInput($event)" }, properties: { "class": "this.class", "attr.type": "this.type", "disabled": "this.isDisabled", "attr.id": "this.id", "attr.aria-haspopup": "this.hasPopup", "attr.aria-owns": "this.ariaOwns", "attr.min": "this.min", "attr.max": "this.max", "attr.required": "this.attrRequired" } }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: RdsEndDateDirective,
                multi: true,
            },
            { provide: NG_VALIDATORS, useExisting: RdsEndDateDirective, multi: true },
        ], usesInheritance: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsEndDateDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'input[rdsEndDate], input[rds-end-date]',
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: RdsEndDateDirective,
                            multi: true,
                        },
                        { provide: NG_VALIDATORS, useExisting: RdsEndDateDirective, multi: true },
                    ],
                }]
        }], propDecorators: { errorStateMatcher: [{
                type: Input
            }], dateChange: [{
                type: Output
            }], dateInput: [{
                type: Output
            }], class: [{
                type: HostBinding,
                args: ['class']
            }], type: [{
                type: HostBinding,
                args: ['attr.type']
            }], isDisabled: [{
                type: HostBinding,
                args: ['disabled']
            }], id: [{
                type: HostBinding,
                args: ['attr.id']
            }], hasPopup: [{
                type: HostBinding,
                args: ['attr.aria-haspopup']
            }], ariaOwns: [{
                type: HostBinding,
                args: ['attr.aria-owns']
            }], min: [{
                type: HostBinding,
                args: ['attr.min']
            }], max: [{
                type: HostBinding,
                args: ['attr.max']
            }], attrRequired: [{
                type: HostBinding,
                args: ['attr.required']
            }], required: [{
                type: Input
            }], onBlur: [{
                type: HostListener,
                args: ['blur']
            }], onChange: [{
                type: HostListener,
                args: ['change']
            }], onKeydown: [{
                type: HostListener,
                args: ['input', ['$event']]
            }], onInput: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1pbnB1dC5wYXJ0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvZGF0ZXBpY2tlci9kYXRlLXJhbmdlLWlucHV0LnBhcnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixjQUFjLEVBQ2QsUUFBUSxFQUNSLEtBQUssRUFFTCxNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUVMLGtCQUFrQixFQUNsQixhQUFhLEVBQ2IsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxNQUFNLEVBR04sVUFBVSxHQUNYLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFFTCwrQkFBK0IsR0FFaEMsTUFBTSx5QkFBeUIsQ0FBQztBQUNqQyxPQUFPLEVBQUUsU0FBUyxFQUE0QixNQUFNLHdCQUF3QixDQUFDO0FBQzdFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7QUFvQjVDLE1BQU0sQ0FBQyxNQUFNLDJCQUEyQixHQUFHLElBQUksY0FBYyxDQUUzRCw2QkFBNkIsQ0FBQyxDQUFDO0FBRWpDLE1BQ2Usa0NBQ2IsU0FBUSwrQkFBNkM7SUFGdkQ7O1FBS3FCLGVBQVUsR0FBRyxNQUFNLENBQ3BDLDJCQUEyQixDQUM1QixDQUFDO1FBQ2lCLDZCQUF3QixHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3JELGFBQVEsR0FBRyxNQUFNLENBQUMs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TixZQUFZO3VCQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIERpcmVjdGl2ZSxcbiAgRG9DaGVjayxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBpbmplY3QsXG4gIEluamVjdGlvblRva2VuLFxuICBJbmplY3RvcixcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFic3RyYWN0Q29udHJvbCxcbiAgRm9ybUdyb3VwRGlyZWN0aXZlLFxuICBOR19WQUxJREFUT1JTLFxuICBOR19WQUxVRV9BQ0NFU1NPUixcbiAgTmdDb250cm9sLFxuICBOZ0Zvcm0sXG4gIFZhbGlkYXRpb25FcnJvcnMsXG4gIFZhbGlkYXRvckZuLFxuICBWYWxpZGF0b3JzLFxufSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBCb29sZWFuSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgQkFDS1NQQUNFIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7XG4gIERhdGVGaWx0ZXJGbixcbiAgUmRzRGF0ZXBpY2tlcklucHV0QmFzZURpcmVjdGl2ZSxcbiAgUmRzRGF0ZXBpY2tlcklucHV0RXZlbnQsXG59IGZyb20gJy4vZGF0ZXBpY2tlci1pbnB1dC5iYXNlJztcbmltcG9ydCB7IERhdGVSYW5nZSwgRGF0ZVNlbGVjdGlvbk1vZGVsQ2hhbmdlIH0gZnJvbSAnLi9kYXRlLXNlbGVjdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBFcnJvclN0YXRlTWF0Y2hlciB9IGZyb20gJy4uL2NvcmUnO1xuaW1wb3J0IHsgdXBkYXRlRXJyb3JTdGF0ZSB9IGZyb20gJy4uL3V0aWxzJztcblxuZXhwb3J0IGludGVyZmFjZSBSZHNEYXRlUmFuZ2VJbnB1dFBhcmVudDxEPiB7XG4gIGlkOiBzdHJpbmc7XG4gIG1pbjogRCB8IG51bGw7XG4gIG1heDogRCB8IG51bGw7XG4gIGRhdGVGaWx0ZXI6IERhdGVGaWx0ZXJGbjxEPjtcbiAgcmFuZ2VQaWNrZXI6IHtcbiAgICBvcGVuZWQ6IGJvb2xlYW47XG4gICAgaWQ6IHN0cmluZztcbiAgfTtcbiAgX3N0YXJ0SW5wdXQ6IFJkc0RhdGVSYW5nZUlucHV0UGFydEJhc2VEaXJlY3RpdmU8RD47XG4gIF9lbmRJbnB1dDogUmRzRGF0ZVJhbmdlSW5wdXRQYXJ0QmFzZURpcmVjdGl2ZTxEPjtcbiAgX2dyb3VwRGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgX2hhbmRsZUNoaWxkVmFsdWVDaGFuZ2UoKTogdm9pZDtcblxuICBfb3BlbkRhdGVwaWNrZXIoKTogdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IFJEU19EQVRFX1JBTkdFX0lOUFVUX1BBUkVOVCA9IG5ldyBJbmplY3Rpb25Ub2tlbjxcbiAgUmRzRGF0ZVJhbmdlSW5wdXRQYXJlbnQ8dW5rbm93bj5cbj4oJ1JEU19EQVRFX1JBTkdFX0lOUFVUX1BBUkVOVCcpO1xuXG5ARGlyZWN0aXZlKClcbmFic3RyYWN0IGNsYXNzIFJkc0RhdGVSYW5nZUlucHV0UGFydEJhc2VEaXJlY3RpdmU8RD5cbiAgZXh0ZW5kcyBSZHNEYXRlcGlja2VySW5wdXRCYXNlRGlyZWN0aXZlPERhdGVSYW5nZTxEPj5cbiAgaW1wbGVtZW50cyBPbkluaXQsIERvQ2hlY2tcbntcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHJhbmdlSW5wdXQgPSBpbmplY3Q8UmRzRGF0ZVJhbmdlSW5wdXRQYXJlbnQ8RD4+KFxuICAgIFJEU19EQVRFX1JBTkdFX0lOUFVUX1BBUkVOVCxcbiAgKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGRlZmF1bHRFcnJvclN0YXRlTWF0Y2hlciA9IGluamVjdChFcnJvclN0YXRlTWF0Y2hlcik7XG4gIHByb3RlY3RlZCByZWFkb25seSBpbmplY3RvciA9IGluamVjdChJbmplY3Rvcik7XG4gIHByb3RlY3RlZCByZWFkb25seSBwYXJlbnRGb3JtID0gaW5qZWN0KE5nRm9ybSwgeyBvcHRpb25hbDogdHJ1ZSB9KTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHBhcmVudEZvcm1Hcm91cCA9IGluamVjdChGb3JtR3JvdXBEaXJlY3RpdmUsIHtcbiAgICBvcHRpb25hbDogdHJ1ZSxcbiAgfSk7XG5cbiAgZXJyb3JTdGF0ZU1hdGNoZXI6IEVycm9yU3RhdGVNYXRjaGVyIHwgbnVsbCA9IG51bGw7XG4gIGVycm9yU3RhdGUgPSBmYWxzZTtcblxuICBuZ0NvbnRyb2w6IE5nQ29udHJvbDtcblxuICBwcm90ZWN0ZWQgYWJzdHJhY3Qgb3ZlcnJpZGUgX3ZhbGlkYXRvcjogVmFsaWRhdG9yRm4gfCBudWxsO1xuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBvdmVycmlkZSBfYXNzaWduVmFsdWVUb01vZGVsKHZhbHVlOiBEIHwgbnVsbCk6IHZvaWQ7XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IG92ZXJyaWRlIF9nZXRWYWx1ZUZyb21Nb2RlbChcbiAgICBtb2RlbFZhbHVlOiBEYXRlUmFuZ2U8RD4sXG4gICk6IEQgfCBudWxsO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBuZ0NvbnRyb2wgPSB0aGlzLmluamVjdG9yLmdldChOZ0NvbnRyb2wsIG51bGwsIHsgc2VsZjogdHJ1ZSB9KTtcblxuICAgICAgaWYgKG5nQ29udHJvbCkge1xuICAgICAgICB0aGlzLm5nQ29udHJvbCA9IG5nQ29udHJvbDtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvL2RvIG5vdGhpbmdcbiAgICB9XG4gIH1cblxuICBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubmdDb250cm9sKSB7XG4gICAgICBjb25zdCBvbGRTdGF0ZSA9IHRoaXMuZXJyb3JTdGF0ZTtcbiAgICAgIHRoaXMuZXJyb3JTdGF0ZSA9IHVwZGF0ZUVycm9yU3RhdGUoXG4gICAgICAgIHRoaXMuZXJyb3JTdGF0ZSxcbiAgICAgICAgdGhpcy5wYXJlbnRGb3JtR3JvdXAsXG4gICAgICAgIHRoaXMucGFyZW50Rm9ybSxcbiAgICAgICAgdGhpcy5uZ0NvbnRyb2w/LmNvbnRyb2wgPz8gbnVsbCxcbiAgICAgICAgdGhpcy5lcnJvclN0YXRlTWF0Y2hlciB8fCB0aGlzLmRlZmF1bHRFcnJvclN0YXRlTWF0Y2hlcixcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmVycm9yU3RhdGUgIT09IG9sZFN0YXRlKSB7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZS5sZW5ndGggPT09IDA7XG4gIH1cblxuICBfZ2V0UGxhY2Vob2xkZXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucGxhY2Vob2xkZXI7XG4gIH1cblxuICBmb2N1cygpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG5cbiAgb3ZlcnJpZGUgX29uSW5wdXQodmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHN1cGVyLl9vbklucHV0KHZhbHVlKTtcbiAgICB0aGlzLnJhbmdlSW5wdXQuX2hhbmRsZUNoaWxkVmFsdWVDaGFuZ2UoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfb3BlblBvcHVwKCk6IHZvaWQge1xuICAgIHRoaXMucmFuZ2VJbnB1dC5fb3BlbkRhdGVwaWNrZXIoKTtcbiAgfVxuXG4gIF9nZXRNaW5EYXRlKCk6IEQge1xuICAgIHJldHVybiB0aGlzLnJhbmdlSW5wdXQubWluIGFzIEQ7XG4gIH1cblxuICBfZ2V0TWF4RGF0ZSgpOiBEIHtcbiAgICByZXR1cm4gdGhpcy5yYW5nZUlucHV0Lm1heCBhcyBEO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9nZXREYXRlRmlsdGVyKCk6IERhdGVGaWx0ZXJGbjxEPiB7XG4gICAgcmV0dXJuIHRoaXMucmFuZ2VJbnB1dC5kYXRlRmlsdGVyO1xuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIF9wYXJlbnREaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yYW5nZUlucHV0Ll9ncm91cERpc2FibGVkO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9zaG91bGRIYW5kbGVDaGFuZ2VFdmVudCh7XG4gICAgc291cmNlLFxuICB9OiBEYXRlU2VsZWN0aW9uTW9kZWxDaGFuZ2U8RGF0ZVJhbmdlPEQ+Pik6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICBzb3VyY2UgIT09IHRoaXMucmFuZ2VJbnB1dC5fc3RhcnRJbnB1dCAmJlxuICAgICAgc291cmNlICE9PSB0aGlzLnJhbmdlSW5wdXQuX2VuZElucHV0XG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvdmVycmlkZSBfYXNzaWduVmFsdWVQcm9ncmFtbWF0aWNhbGx5KHZhbHVlOiBEIHwgbnVsbCk6IHZvaWQge1xuICAgIHN1cGVyLl9hc3NpZ25WYWx1ZVByb2dyYW1tYXRpY2FsbHkodmFsdWUpO1xuICAgIGNvbnN0IG9wcG9zaXRlID0gKFxuICAgICAgdGhpcyA9PT0gdGhpcy5yYW5nZUlucHV0Ll9zdGFydElucHV0XG4gICAgICAgID8gdGhpcy5yYW5nZUlucHV0Ll9lbmRJbnB1dFxuICAgICAgICA6IHRoaXMucmFuZ2VJbnB1dC5fc3RhcnRJbnB1dFxuICAgICkgYXMgUmRzRGF0ZVJhbmdlSW5wdXRQYXJ0QmFzZURpcmVjdGl2ZTxEPiB8IHVuZGVmaW5lZDtcbiAgICBvcHBvc2l0ZT8uX3ZhbGlkYXRvck9uQ2hhbmdlKCk7XG4gIH1cbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnaW5wdXRbcmRzU3RhcnREYXRlXSwgaW5wdXRbcmRzLXN0YXJ0LWRhdGVdJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogUmRzU3RhcnREYXRlRGlyZWN0aXZlLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgfSxcbiAgICB7IHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsIHVzZUV4aXN0aW5nOiBSZHNTdGFydERhdGVEaXJlY3RpdmUsIG11bHRpOiB0cnVlIH0sXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFJkc1N0YXJ0RGF0ZURpcmVjdGl2ZTxEPlxuICBleHRlbmRzIFJkc0RhdGVSYW5nZUlucHV0UGFydEJhc2VEaXJlY3RpdmU8RD5cbiAgaW1wbGVtZW50cyBEb0NoZWNrLCBPbkluaXRcbntcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIF92YWxpZGF0b3I6IFZhbGlkYXRvckZuIHwgbnVsbCA9IG51bGw7XG5cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgc3RhdGVDaGFuZ2VzID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICBASW5wdXQoKVxuICBvdmVycmlkZSBlcnJvclN0YXRlTWF0Y2hlcjogRXJyb3JTdGF0ZU1hdGNoZXIgfCBudWxsID0gbnVsbDtcblxuICBAT3V0cHV0KCkgb3ZlcnJpZGUgcmVhZG9ubHkgZGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgUmRzRGF0ZXBpY2tlcklucHV0RXZlbnQ8RCwgRGF0ZVJhbmdlPEQ+PlxuICA+KCk7XG5cbiAgQE91dHB1dCgpIG92ZXJyaWRlIHJlYWRvbmx5IGRhdGVJbnB1dCA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgUmRzRGF0ZXBpY2tlcklucHV0RXZlbnQ8RCwgRGF0ZVJhbmdlPEQ+PlxuICA+KCk7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGNsYXNzID0gJ3Jkcy1zdGFydC1kYXRlIHJkcy1kYXRlLXJhbmdlLWlucHV0LWlubmVyJztcbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSB0eXBlID0gJ3RleHQnO1xuXG4gIEBIb3N0QmluZGluZygnZGlzYWJsZWQnKSBnZXQgaXNEaXNhYmxlZCgpOiBib29sZWFuIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgPyB0cnVlIDogbnVsbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpIGdldCBpZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHt0aGlzLnJhbmdlSW5wdXQuaWR9LXN0YXJ0YDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWhhc3BvcHVwJykgZ2V0IGhhc1BvcHVwKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnJhbmdlSW5wdXQucmFuZ2VQaWNrZXIgPyAnZGlhbG9nJyA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1vd25zJykgZ2V0IGFyaWFPd25zKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiAoXG4gICAgICAodGhpcy5yYW5nZUlucHV0LnJhbmdlUGlja2VyPy5vcGVuZWQgJiYgdGhpcy5yYW5nZUlucHV0LnJhbmdlUGlja2VyLmlkKSB8fFxuICAgICAgbnVsbFxuICAgICk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIubWluJykgZ2V0IG1pbigpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5fZ2V0TWluRGF0ZSgpXG4gICAgICA/IHRoaXMuZGF0ZUFkYXB0ZXIudG9Jc284NjAxKHRoaXMuX2dldE1pbkRhdGUoKSlcbiAgICAgIDogbnVsbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5tYXgnKSBnZXQgbWF4KCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9nZXRNYXhEYXRlKClcbiAgICAgID8gdGhpcy5kYXRlQWRhcHRlci50b0lzbzg2MDEodGhpcy5fZ2V0TWF4RGF0ZSgpKVxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnJlcXVpcmVkJylcbiAgZ2V0IGF0dHJSZXF1aXJlZCgpOiBib29sZWFuIHwgbnVsbCB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuX3JlcXVpcmVkID8/XG4gICAgICB0aGlzLm5nQ29udHJvbD8uY29udHJvbD8uaGFzVmFsaWRhdG9yKFZhbGlkYXRvcnMucmVxdWlyZWQpID8/XG4gICAgICBudWxsXG4gICAgKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCByZXF1aXJlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgY29uc3QgaXNSZXF1aXJlZCA9IGJvb2xlYW5BdHRyaWJ1dGUodmFsdWUpO1xuXG4gICAgaWYgKGlzUmVxdWlyZWQgIT09IHRoaXMuX3JlcXVpcmVkKSB7XG4gICAgICB0aGlzLl9yZXF1aXJlZCA9IGlzUmVxdWlyZWQ7XG4gICAgICB0aGlzLnN0YXRlQ2hhbmdlcy5uZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJlcXVpcmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmF0dHJSZXF1aXJlZCA/PyBmYWxzZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfcmVxdWlyZWQ6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBfc3RhcnRWYWxpZGF0b3I6IFZhbGlkYXRvckZuID0gKFxuICAgIGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCxcbiAgKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5kYXRlQWRhcHRlci5nZXRWYWxpZERhdGVPck51bGwoXG4gICAgICB0aGlzLmRhdGVBZGFwdGVyLmRlc2VyaWFsaXplKGNvbnRyb2wudmFsdWUpLFxuICAgICk7XG4gICAgY29uc3QgZW5kID0gdGhpcy5fbW9kZWwgPyB0aGlzLl9tb2RlbC5zZWxlY3Rpb24/LmVuZCA6IG51bGw7XG5cbiAgICByZXR1cm4gIXN0YXJ0IHx8XG4gICAgICAhZW5kIHx8XG4gICAgICAodGhpcy5kYXRlQWRhcHRlciAmJiB0aGlzLmRhdGVBZGFwdGVyLmNvbXBhcmVEYXRlKHN0YXJ0LCBlbmQpIDw9IDApXG4gICAgICA/IG51bGxcbiAgICAgIDogeyByZHNTdGFydERhdGVJbnZhbGlkOiB7IGVuZDogZW5kLCBhY3R1YWw6IHN0YXJ0IH0gfTtcbiAgfTtcblxuICBASG9zdExpc3RlbmVyKCdibHVyJylcbiAgb25CbHVyKCk6IHZvaWQge1xuICAgIHRoaXMuX29uQmx1cigpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2hhbmdlJylcbiAgb25DaGFuZ2UoKTogdm9pZCB7XG4gICAgdGhpcy5fb25DaGFuZ2UoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2lucHV0JywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKCRldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLl9vbklucHV0KCgkZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvbklucHV0KCRldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMuX29uS2V5ZG93bigkZXZlbnQpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl92YWxpZGF0b3IgPSBWYWxpZGF0b3JzLmNvbXBvc2UoW1xuICAgICAgLi4uc3VwZXIuX2dldFZhbGlkYXRvcnMoKSxcbiAgICAgIHRoaXMuX3N0YXJ0VmFsaWRhdG9yLFxuICAgIF0pO1xuICB9XG5cbiAgb3ZlcnJpZGUgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgfVxuXG4gIG92ZXJyaWRlIG5nRG9DaGVjaygpOiB2b2lkIHtcbiAgICBzdXBlci5uZ0RvQ2hlY2soKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfZ2V0VmFsdWVGcm9tTW9kZWwobW9kZWxWYWx1ZTogRGF0ZVJhbmdlPEQ+KTogRCB8IG51bGwge1xuICAgIHJldHVybiBtb2RlbFZhbHVlLnN0YXJ0O1xuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIF9zaG91bGRIYW5kbGVDaGFuZ2VFdmVudChcbiAgICBjaGFuZ2U6IERhdGVTZWxlY3Rpb25Nb2RlbENoYW5nZTxEYXRlUmFuZ2U8RD4+LFxuICApOiBib29sZWFuIHtcbiAgICBpZiAoIXN1cGVyLl9zaG91bGRIYW5kbGVDaGFuZ2VFdmVudChjaGFuZ2UpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAhY2hhbmdlLm9sZFZhbHVlPy5zdGFydFxuICAgICAgICA/ICEhY2hhbmdlLnNlbGVjdGlvbi5zdGFydFxuICAgICAgICA6ICFjaGFuZ2Uuc2VsZWN0aW9uLnN0YXJ0IHx8XG4gICAgICAgICAgICAhIXRoaXMuZGF0ZUFkYXB0ZXIuY29tcGFyZURhdGUoXG4gICAgICAgICAgICAgIGNoYW5nZS5vbGRWYWx1ZS5zdGFydCxcbiAgICAgICAgICAgICAgY2hhbmdlLnNlbGVjdGlvbi5zdGFydCxcbiAgICAgICAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9hc3NpZ25WYWx1ZVRvTW9kZWwodmFsdWU6IEQgfCBudWxsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX21vZGVsKSB7XG4gICAgICBjb25zdCByYW5nZSA9IG5ldyBEYXRlUmFuZ2UodmFsdWUsIHRoaXMuX21vZGVsLnNlbGVjdGlvbj8uZW5kKTtcbiAgICAgIHRoaXMuX21vZGVsLnVwZGF0ZVNlbGVjdGlvbihyYW5nZSBhcyBEYXRlUmFuZ2U8RD4sIHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBvdmVycmlkZSBfZm9ybWF0VmFsdWUodmFsdWU6IEQgfCBudWxsKTogdm9pZCB7XG4gICAgc3VwZXIuX2Zvcm1hdFZhbHVlKHZhbHVlKTtcblxuICAgIC8vIEFueSB0aW1lIHRoZSBpbnB1dCB2YWx1ZSBpcyByZWZvcm1hdHRlZCB3ZSBuZWVkIHRvIHRlbGwgdGhlIHBhcmVudC5cbiAgICB0aGlzLnJhbmdlSW5wdXQuX2hhbmRsZUNoaWxkVmFsdWVDaGFuZ2UoKTtcbiAgfVxuXG4gIC8qKiBHZXRzIHRoZSB2YWx1ZSB0aGF0IHNob3VsZCBiZSB1c2VkIHdoZW4gbWlycm9yaW5nIHRoZSBpbnB1dCdzIHNpemUuICovXG4gIGdldE1pcnJvclZhbHVlKCk6IHN0cmluZyB7XG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudC52YWx1ZTtcblxuICAgIHJldHVybiB2YWx1ZS5sZW5ndGggPiAwID8gdmFsdWUgOiBlbGVtZW50LnBsYWNlaG9sZGVyO1xuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ2lucHV0W3Jkc0VuZERhdGVdLCBpbnB1dFtyZHMtZW5kLWRhdGVdJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogUmRzRW5kRGF0ZURpcmVjdGl2ZSxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgIH0sXG4gICAgeyBwcm92aWRlOiBOR19WQUxJREFUT1JTLCB1c2VFeGlzdGluZzogUmRzRW5kRGF0ZURpcmVjdGl2ZSwgbXVsdGk6IHRydWUgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUmRzRW5kRGF0ZURpcmVjdGl2ZTxEPlxuICBleHRlbmRzIFJkc0RhdGVSYW5nZUlucHV0UGFydEJhc2VEaXJlY3RpdmU8RD5cbiAgaW1wbGVtZW50cyBEb0NoZWNrLCBPbkluaXRcbntcbiAgb3ZlcnJpZGUgcmVhZG9ubHkgc3RhdGVDaGFuZ2VzID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICBASW5wdXQoKVxuICBvdmVycmlkZSBlcnJvclN0YXRlTWF0Y2hlcjogRXJyb3JTdGF0ZU1hdGNoZXIgfCBudWxsID0gbnVsbDtcblxuICBAT3V0cHV0KCkgb3ZlcnJpZGUgcmVhZG9ubHkgZGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgUmRzRGF0ZXBpY2tlcklucHV0RXZlbnQ8RCwgRGF0ZVJhbmdlPEQ+PlxuICA+KCk7XG5cbiAgQE91dHB1dCgpIG92ZXJyaWRlIHJlYWRvbmx5IGRhdGVJbnB1dCA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgUmRzRGF0ZXBpY2tlcklucHV0RXZlbnQ8RCwgRGF0ZVJhbmdlPEQ+PlxuICA+KCk7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGNsYXNzID0gJ3Jkcy1lbmQtZGF0ZSByZHMtZGF0ZS1yYW5nZS1pbnB1dC1pbm5lcic7XG4gIEBIb3N0QmluZGluZygnYXR0ci50eXBlJykgdHlwZSA9ICd0ZXh0JztcblxuICBASG9zdEJpbmRpbmcoJ2Rpc2FibGVkJykgZ2V0IGlzRGlzYWJsZWQoKTogYm9vbGVhbiB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmRpc2FibGVkID8gdHJ1ZSA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKSBnZXQgaWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7dGhpcy5yYW5nZUlucHV0LmlkfS1lbmRgO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtaGFzcG9wdXAnKSBnZXQgaGFzUG9wdXAoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMucmFuZ2VJbnB1dC5yYW5nZVBpY2tlciA/ICdkaWFsb2cnIDogbnVsbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLW93bnMnKSBnZXQgYXJpYU93bnMoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIChcbiAgICAgICh0aGlzLnJhbmdlSW5wdXQucmFuZ2VQaWNrZXI/Lm9wZW5lZCAmJiB0aGlzLnJhbmdlSW5wdXQucmFuZ2VQaWNrZXIuaWQpIHx8XG4gICAgICBudWxsXG4gICAgKTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5taW4nKSBnZXQgbWluKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9nZXRNaW5EYXRlKClcbiAgICAgID8gdGhpcy5kYXRlQWRhcHRlci50b0lzbzg2MDEodGhpcy5fZ2V0TWluRGF0ZSgpKVxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLm1heCcpIGdldCBtYXgoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuX2dldE1heERhdGUoKVxuICAgICAgPyB0aGlzLmRhdGVBZGFwdGVyLnRvSXNvODYwMSh0aGlzLl9nZXRNYXhEYXRlKCkpXG4gICAgICA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIucmVxdWlyZWQnKVxuICBnZXQgYXR0clJlcXVpcmVkKCk6IGJvb2xlYW4gfCBudWxsIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5fcmVxdWlyZWQgPz9cbiAgICAgIHRoaXMubmdDb250cm9sPy5jb250cm9sPy5oYXNWYWxpZGF0b3IoVmFsaWRhdG9ycy5yZXF1aXJlZCkgPz9cbiAgICAgIG51bGxcbiAgICApO1xuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IHJlcXVpcmVkKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICBjb25zdCBpc1JlcXVpcmVkID0gYm9vbGVhbkF0dHJpYnV0ZSh2YWx1ZSk7XG5cbiAgICBpZiAoaXNSZXF1aXJlZCAhPT0gdGhpcy5fcmVxdWlyZWQpIHtcbiAgICAgIHRoaXMuX3JlcXVpcmVkID0gaXNSZXF1aXJlZDtcbiAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQoKTtcbiAgICB9XG4gIH1cbiAgZ2V0IHJlcXVpcmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmF0dHJSZXF1aXJlZCA/PyBmYWxzZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfcmVxdWlyZWQ6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG5cbiAgcHJpdmF0ZSBfZW5kVmFsaWRhdG9yOiBWYWxpZGF0b3JGbiA9IChcbiAgICBjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXG4gICk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICBjb25zdCBlbmQgPSB0aGlzLmRhdGVBZGFwdGVyLmdldFZhbGlkRGF0ZU9yTnVsbChcbiAgICAgIHRoaXMuZGF0ZUFkYXB0ZXIuZGVzZXJpYWxpemUoY29udHJvbC52YWx1ZSksXG4gICAgKTtcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuX21vZGVsID8gdGhpcy5fbW9kZWwuc2VsZWN0aW9uPy5zdGFydCA6IG51bGw7XG5cbiAgICByZXR1cm4gIWVuZCB8fCAhc3RhcnQgfHwgdGhpcy5kYXRlQWRhcHRlci5jb21wYXJlRGF0ZShlbmQsIHN0YXJ0KSA+PSAwXG4gICAgICA/IG51bGxcbiAgICAgIDogeyByZHNFbmREYXRlSW52YWxpZDogeyBzdGFydDogc3RhcnQsIGFjdHVhbDogZW5kIH0gfTtcbiAgfTtcblxuICBwcm90ZWN0ZWQgX3ZhbGlkYXRvciA9IFZhbGlkYXRvcnMuY29tcG9zZShbXG4gICAgLi4uc3VwZXIuX2dldFZhbGlkYXRvcnMoKSxcbiAgICB0aGlzLl9lbmRWYWxpZGF0b3IsXG4gIF0pO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ2JsdXInKVxuICBvbkJsdXIoKTogdm9pZCB7XG4gICAgdGhpcy5fb25CbHVyKCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdjaGFuZ2UnKVxuICBvbkNoYW5nZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9vbkNoYW5nZSgpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignaW5wdXQnLCBbJyRldmVudCddKVxuICBvbktleWRvd24oJGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIHRoaXMuX29uSW5wdXQoKCRldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uSW5wdXQoJGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5fb25LZXlkb3duKCRldmVudCk7XG4gIH1cblxuICBvdmVycmlkZSBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgbmdEb0NoZWNrKCk6IHZvaWQge1xuICAgIHN1cGVyLm5nRG9DaGVjaygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9nZXRWYWx1ZUZyb21Nb2RlbChtb2RlbFZhbHVlOiBEYXRlUmFuZ2U8RD4pOiBEIHwgbnVsbCB7XG4gICAgcmV0dXJuIG1vZGVsVmFsdWUuZW5kO1xuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIF9zaG91bGRIYW5kbGVDaGFuZ2VFdmVudChcbiAgICBjaGFuZ2U6IERhdGVTZWxlY3Rpb25Nb2RlbENoYW5nZTxEYXRlUmFuZ2U8RD4+LFxuICApOiBib29sZWFuIHtcbiAgICBpZiAoIXN1cGVyLl9zaG91bGRIYW5kbGVDaGFuZ2VFdmVudChjaGFuZ2UpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAhY2hhbmdlLm9sZFZhbHVlPy5lbmRcbiAgICAgICAgPyAhIWNoYW5nZS5zZWxlY3Rpb24uZW5kXG4gICAgICAgIDogIWNoYW5nZS5zZWxlY3Rpb24uZW5kIHx8XG4gICAgICAgICAgICAhIXRoaXMuZGF0ZUFkYXB0ZXIuY29tcGFyZURhdGUoXG4gICAgICAgICAgICAgIGNoYW5nZS5vbGRWYWx1ZS5lbmQsXG4gICAgICAgICAgICAgIGNoYW5nZS5zZWxlY3Rpb24uZW5kLFxuICAgICAgICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2Fzc2lnblZhbHVlVG9Nb2RlbCh2YWx1ZTogRCB8IG51bGwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fbW9kZWwpIHtcbiAgICAgIGNvbnN0IHJhbmdlID0gbmV3IERhdGVSYW5nZSh0aGlzLl9tb2RlbC5zZWxlY3Rpb24/LnN0YXJ0LCB2YWx1ZSk7XG4gICAgICB0aGlzLl9tb2RlbC51cGRhdGVTZWxlY3Rpb24ocmFuZ2UgYXMgRGF0ZVJhbmdlPEQ+LCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBfb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgLy8gSWYgdGhlIHVzZXIgaXMgcHJlc3NpbmcgYmFja3NwYWNlIG9uIGFuIGVtcHR5IGVuZCBpbnB1dCwgbW92ZSBmb2N1cyBiYWNrIHRvIHRoZSBzdGFydC5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gQkFDS1NQQUNFICYmICF0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZSkge1xuICAgICAgdGhpcy5yYW5nZUlucHV0Ll9zdGFydElucHV0LmZvY3VzKCk7XG4gICAgfVxuXG4gICAgc3VwZXIuX29uS2V5ZG93bihldmVudCk7XG4gIH1cbn1cbiJdfQ==