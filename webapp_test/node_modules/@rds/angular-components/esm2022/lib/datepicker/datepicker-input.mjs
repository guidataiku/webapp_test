import { DestroyRef, Directive, forwardRef, HostBinding, HostListener, inject, InjectionToken, Input, Renderer2, } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR, Validators } from '@angular/forms';
import { merge, Subject } from 'rxjs';
import { RdsDatepickerInputBaseDirective, } from './datepicker-input.base';
import { RDS_FORM_FIELD } from '../form-field';
import { takeUntil } from 'rxjs/operators';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
export const RDS_DATEPICKER_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => RdsDatepickerInputDirective),
    multi: true,
};
export const RDS_DATEPICKER_VALIDATORS = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(() => RdsDatepickerInputDirective),
    multi: true,
};
export const RDS_INPUT_VALUE_ACCESSOR = new InjectionToken('RDS_INPUT_VALUE_ACCESSOR');
export class RdsDatepickerInputDirective extends RdsDatepickerInputBaseDirective {
    constructor() {
        super(...arguments);
        this.renderer = inject(Renderer2);
        this.destroyRef = inject(DestroyRef);
        this.formField = inject(RDS_FORM_FIELD, { optional: true });
        this._destroyDatepickerSubscriptions$ = new Subject();
        this.class = 'rds-datepicker-input';
        this._min = null;
        this._max = null;
        this._validator = Validators.compose(super._getValidators());
    }
    get ariaHasPopup() {
        return this._datepicker ? 'dialog' : null;
    }
    get ariaOwns() {
        return (this._datepicker?.opened && this._datepicker.id) || null;
    }
    get attrMin() {
        return this.min ? this.dateAdapter.toIso8601(this.min) : null;
    }
    get attrMax() {
        return this.max ? this.dateAdapter.toIso8601(this.max) : null;
    }
    get attrDataRdsCalendar() {
        return this._datepicker ? this._datepicker.id : null;
    }
    get attrDisabled() {
        return this.disabled ? true : null;
    }
    set rdsDatepicker(datepicker) {
        this._destroyDatepickerSubscriptions$.next();
        if (datepicker) {
            this._datepicker = datepicker;
            this._datepicker.closedStream
                .pipe(takeUntil(this._destroyDatepickerSubscriptions$), takeUntilDestroyed(this.destroyRef))
                .subscribe(() => this._onTouched());
            this._registerModel(datepicker.registerInput(this));
            merge(this._datepicker.stateChanges, this.dateAdapter.localeChanges)
                .pipe(takeUntil(this._destroyDatepickerSubscriptions$), takeUntilDestroyed(this.destroyRef))
                .subscribe(() => {
                this._setDefaultPlaceholder();
                this._formatValue(this.value);
            });
        }
    }
    get min() {
        return this._min;
    }
    set min(value) {
        const validValue = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(value));
        if (!this.dateAdapter.sameDate(validValue, this._min)) {
            this._min = validValue;
            this._validatorOnChange();
        }
    }
    get max() {
        return this._max;
    }
    set max(value) {
        const validValue = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(value));
        if (!this.dateAdapter.sameDate(validValue, this._max)) {
            this._max = validValue;
            this._validatorOnChange();
        }
    }
    get dateFilter() {
        return this._dateFilter;
    }
    set dateFilter(value) {
        const wasMatchingValue = this._matchesFilter(this.value);
        this._dateFilter = value;
        if (this._matchesFilter(this.value) !== wasMatchingValue) {
            this._validatorOnChange();
        }
    }
    onInput($event) {
        this._onInput($event.target.value);
    }
    _onChange() {
        super._onChange();
    }
    _onBlur() {
        super._onBlur();
    }
    _onKeydown($event) {
        super._onKeydown($event);
    }
    getConnectedOverlayOrigin() {
        return this.formField
            ? this.formField.getConnectedOverlayOrigin()
            : this.elementRef;
    }
    getStartValue() {
        return this.value;
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this._setDefaultPlaceholder();
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this._destroyDatepickerSubscriptions$.complete();
    }
    _formatValue(value) {
        this.elementRef.nativeElement.value = value
            ? this.dateAdapter.format(value, this.dateFormats.display.dateInput, this._datepicker?.availableViews)
            : '';
    }
    _openPopup() {
        if (this._datepicker) {
            this._datepicker.open();
        }
    }
    _getValueFromModel(modelValue) {
        return modelValue;
    }
    _assignValueToModel(value) {
        if (this._model) {
            this._model.updateSelection(value, this);
        }
    }
    _getMinDate() {
        return this._min;
    }
    _getMaxDate() {
        return this._max;
    }
    _getDateFilter() {
        return this._dateFilter;
    }
    _shouldHandleChangeEvent(event) {
        return event.source !== this;
    }
    _setDefaultPlaceholder() {
        if (this.elementRef && this.elementRef.nativeElement) {
            this.renderer.setAttribute(this.elementRef.nativeElement, 'date-placeholder', this._calculateDefaultPlaceholder());
        }
    }
    _calculateDefaultPlaceholder() {
        return this.dateAdapter.placeholderFormat(this.dateFormats.display.dateInput, this._datepicker?.availableViews);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDatepickerInputDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.1", type: RdsDatepickerInputDirective, selector: "input[rdsDatepicker], input[rds-datepicker]", inputs: { rdsDatepicker: "rdsDatepicker", min: "min", max: "max", dateFilter: ["rdsDatepickerFilter", "dateFilter"] }, host: { listeners: { "input": "onInput($event)", "change": "_onChange()", "blur": "_onBlur()", "keydown": "_onKeydown($event)" }, properties: { "class": "this.class", "attr.aria-haspopup": "this.ariaHasPopup", "attr.aria-owns": "this.ariaOwns", "attr.min": "this.attrMin", "attr.max": "this.attrMax", "attr.data-rds-calendar": "this.attrDataRdsCalendar", "disabled": "this.attrDisabled" } }, providers: [
            RDS_DATEPICKER_VALUE_ACCESSOR,
            RDS_DATEPICKER_VALIDATORS,
            {
                provide: RDS_INPUT_VALUE_ACCESSOR,
                useExisting: RdsDatepickerInputDirective,
            },
        ], exportAs: ["rdsDatepickerInput"], usesInheritance: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDatepickerInputDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'input[rdsDatepicker], input[rds-datepicker]',
                    providers: [
                        RDS_DATEPICKER_VALUE_ACCESSOR,
                        RDS_DATEPICKER_VALIDATORS,
                        {
                            provide: RDS_INPUT_VALUE_ACCESSOR,
                            useExisting: RdsDatepickerInputDirective,
                        },
                    ],
                    exportAs: 'rdsDatepickerInput',
                }]
        }], propDecorators: { class: [{
                type: HostBinding,
                args: ['class']
            }], ariaHasPopup: [{
                type: HostBinding,
                args: ['attr.aria-haspopup']
            }], ariaOwns: [{
                type: HostBinding,
                args: ['attr.aria-owns']
            }], attrMin: [{
                type: HostBinding,
                args: ['attr.min']
            }], attrMax: [{
                type: HostBinding,
                args: ['attr.max']
            }], attrDataRdsCalendar: [{
                type: HostBinding,
                args: ['attr.data-rds-calendar']
            }], attrDisabled: [{
                type: HostBinding,
                args: ['disabled']
            }], rdsDatepicker: [{
                type: Input
            }], min: [{
                type: Input
            }], max: [{
                type: Input
            }], dateFilter: [{
                type: Input,
                args: ['rdsDatepickerFilter']
            }], onInput: [{
                type: HostListener,
                args: ['input', ['$event']]
            }], _onChange: [{
                type: HostListener,
                args: ['change']
            }], _onBlur: [{
                type: HostListener,
                args: ['blur']
            }], _onKeydown: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci1pbnB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvZGF0ZXBpY2tlci9kYXRlcGlja2VyLWlucHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxVQUFVLEVBQ1YsU0FBUyxFQUVULFVBQVUsRUFDVixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixjQUFjLEVBQ2QsS0FBSyxFQUdMLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFFTCwrQkFBK0IsR0FDaEMsTUFBTSx5QkFBeUIsQ0FBQztBQUdqQyxPQUFPLEVBQUUsY0FBYyxFQUF5QixNQUFNLGVBQWUsQ0FBQztBQUN0RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7O0FBRWhFLE1BQU0sQ0FBQyxNQUFNLDZCQUE2QixHQUFhO0lBQ3JELE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQywyQkFBMkIsQ0FBQztJQUMxRCxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSx5QkFBeUIsR0FBYTtJQUNqRCxPQUFPLEVBQUUsYUFBYTtJQUN0QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLDJCQUEyQixDQUFDO0lBQzFELEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHLElB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QkFNYixPQUFPO3NCQURmLFlBQVk7dUJBQUMsTUFBTTtnQkFNWCxVQUFVO3NCQURsQixZQUFZO3VCQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIERlc3Ryb3lSZWYsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgZm9yd2FyZFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgaW5qZWN0LFxuICBJbmplY3Rpb25Ub2tlbixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgUHJvdmlkZXIsXG4gIFJlbmRlcmVyMixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IG1lcmdlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBEYXRlRmlsdGVyRm4sXG4gIFJkc0RhdGVwaWNrZXJJbnB1dEJhc2VEaXJlY3RpdmUsXG59IGZyb20gJy4vZGF0ZXBpY2tlci1pbnB1dC5iYXNlJztcbmltcG9ydCB7IFJkc0RhdGVwaWNrZXJDb250cm9sLCBSZHNEYXRlcGlja2VyUGFuZWwgfSBmcm9tICcuL2RhdGVwaWNrZXItYmFzZSc7XG5pbXBvcnQgeyBEYXRlU2VsZWN0aW9uTW9kZWxDaGFuZ2UgfSBmcm9tICcuL2RhdGUtc2VsZWN0aW9uLm1vZGVsJztcbmltcG9ydCB7IFJEU19GT1JNX0ZJRUxELCBSZHNGb3JtRmllbGRDb21wb25lbnQgfSBmcm9tICcuLi9mb3JtLWZpZWxkJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IHRha2VVbnRpbERlc3Ryb3llZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcblxuZXhwb3J0IGNvbnN0IFJEU19EQVRFUElDS0VSX1ZBTFVFX0FDQ0VTU09SOiBQcm92aWRlciA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFJkc0RhdGVwaWNrZXJJbnB1dERpcmVjdGl2ZSksXG4gIG11bHRpOiB0cnVlLFxufTtcblxuZXhwb3J0IGNvbnN0IFJEU19EQVRFUElDS0VSX1ZBTElEQVRPUlM6IFByb3ZpZGVyID0ge1xuICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBSZHNEYXRlcGlja2VySW5wdXREaXJlY3RpdmUpLFxuICBtdWx0aTogdHJ1ZSxcbn07XG5cbmV4cG9ydCBjb25zdCBSRFNfSU5QVVRfVkFMVUVfQUNDRVNTT1IgPSBuZXcgSW5qZWN0aW9uVG9rZW48eyB2YWx1ZTogdW5rbm93biB9PihcbiAgJ1JEU19JTlBVVF9WQUxVRV9BQ0NFU1NPUicsXG4pO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdpbnB1dFtyZHNEYXRlcGlja2VyXSwgaW5wdXRbcmRzLWRhdGVwaWNrZXJdJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgUkRTX0RBVEVQSUNLRVJfVkFMVUVfQUNDRVNTT1IsXG4gICAgUkRTX0RBVEVQSUNLRVJfVkFMSURBVE9SUyxcbiAgICB7XG4gICAgICBwcm92aWRlOiBSRFNfSU5QVVRfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogUmRzRGF0ZXBpY2tlcklucHV0RGlyZWN0aXZlLFxuICAgIH0sXG4gIF0sXG4gIGV4cG9ydEFzOiAncmRzRGF0ZXBpY2tlcklucHV0Jyxcbn0pXG5leHBvcnQgY2xhc3MgUmRzRGF0ZXBpY2tlcklucHV0RGlyZWN0aXZlPEQ+XG4gIGV4dGVuZHMgUmRzRGF0ZXBpY2tlcklucHV0QmFzZURpcmVjdGl2ZTxEIHwgbnVsbCwgRD5cbiAgaW1wbGVtZW50cyBSZHNEYXRlcGlja2VyQ29udHJvbDxEIHwgbnVsbD4sIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveVxue1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcmVuZGVyZXIgPSBpbmplY3QoUmVuZGVyZXIyKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGRlc3Ryb3lSZWYgPSBpbmplY3QoRGVzdHJveVJlZik7XG4gIHByb3RlY3RlZCByZWFkb25seSBmb3JtRmllbGQgPSBpbmplY3Q8UmRzRm9ybUZpZWxkQ29tcG9uZW50PEQ+PihcbiAgICBSRFNfRk9STV9GSUVMRCxcbiAgICB7IG9wdGlvbmFsOiB0cnVlIH0sXG4gICkgYXMgUmRzRm9ybUZpZWxkQ29tcG9uZW50PEQ+O1xuXG4gIHByaXZhdGUgX2Rlc3Ryb3lEYXRlcGlja2VyU3Vic2NyaXB0aW9ucyQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbGFzcyA9ICdyZHMtZGF0ZXBpY2tlci1pbnB1dCc7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtaGFzcG9wdXAnKSBnZXQgYXJpYUhhc1BvcHVwKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9kYXRlcGlja2VyID8gJ2RpYWxvZycgOiBudWxsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtb3ducycpIGdldCBhcmlhT3ducygpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gKHRoaXMuX2RhdGVwaWNrZXI/Lm9wZW5lZCAmJiB0aGlzLl9kYXRlcGlja2VyLmlkKSB8fCBudWxsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLm1pbicpIGdldCBhdHRyTWluKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLm1pbiA/IHRoaXMuZGF0ZUFkYXB0ZXIudG9Jc284NjAxKHRoaXMubWluKSA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIubWF4JykgZ2V0IGF0dHJNYXgoKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMubWF4ID8gdGhpcy5kYXRlQWRhcHRlci50b0lzbzg2MDEodGhpcy5tYXgpIDogbnVsbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5kYXRhLXJkcy1jYWxlbmRhcicpIGdldCBhdHRyRGF0YVJkc0NhbGVuZGFyKCk6XG4gICAgfCBzdHJpbmdcbiAgICB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9kYXRlcGlja2VyID8gdGhpcy5fZGF0ZXBpY2tlci5pZCA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2Rpc2FibGVkJykgZ2V0IGF0dHJEaXNhYmxlZCgpOiBib29sZWFuIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgPyB0cnVlIDogbnVsbDtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCByZHNEYXRlcGlja2VyKFxuICAgIGRhdGVwaWNrZXI6IFJkc0RhdGVwaWNrZXJQYW5lbDxSZHNEYXRlcGlja2VyQ29udHJvbDxEPiwgRCB8IG51bGwsIEQ+LFxuICApIHtcbiAgICB0aGlzLl9kZXN0cm95RGF0ZXBpY2tlclN1YnNjcmlwdGlvbnMkLm5leHQoKTtcblxuICAgIGlmIChkYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLl9kYXRlcGlja2VyID0gZGF0ZXBpY2tlcjtcbiAgICAgIHRoaXMuX2RhdGVwaWNrZXIuY2xvc2VkU3RyZWFtXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95RGF0ZXBpY2tlclN1YnNjcmlwdGlvbnMkKSxcbiAgICAgICAgICB0YWtlVW50aWxEZXN0cm95ZWQodGhpcy5kZXN0cm95UmVmKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuX29uVG91Y2hlZCgpKTtcbiAgICAgIHRoaXMuX3JlZ2lzdGVyTW9kZWwoZGF0ZXBpY2tlci5yZWdpc3RlcklucHV0KHRoaXMpKTtcbiAgICAgIG1lcmdlKHRoaXMuX2RhdGVwaWNrZXIuc3RhdGVDaGFuZ2VzLCB0aGlzLmRhdGVBZGFwdGVyLmxvY2FsZUNoYW5nZXMpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95RGF0ZXBpY2tlclN1YnNjcmlwdGlvbnMkKSxcbiAgICAgICAgICB0YWtlVW50aWxEZXN0cm95ZWQodGhpcy5kZXN0cm95UmVmKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0UGxhY2Vob2xkZXIoKTtcbiAgICAgICAgICB0aGlzLl9mb3JtYXRWYWx1ZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgX2RhdGVwaWNrZXI/OiBSZHNEYXRlcGlja2VyUGFuZWw8UmRzRGF0ZXBpY2tlckNvbnRyb2w8RD4sIEQgfCBudWxsLCBEPjtcblxuICBASW5wdXQoKVxuICBnZXQgbWluKCk6IEQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5fbWluO1xuICB9XG5cbiAgc2V0IG1pbih2YWx1ZTogRCB8IG51bGwpIHtcbiAgICBjb25zdCB2YWxpZFZhbHVlID0gdGhpcy5kYXRlQWRhcHRlci5nZXRWYWxpZERhdGVPck51bGwoXG4gICAgICB0aGlzLmRhdGVBZGFwdGVyLmRlc2VyaWFsaXplKHZhbHVlKSxcbiAgICApO1xuXG4gICAgaWYgKCF0aGlzLmRhdGVBZGFwdGVyLnNhbWVEYXRlKHZhbGlkVmFsdWUsIHRoaXMuX21pbikpIHtcbiAgICAgIHRoaXMuX21pbiA9IHZhbGlkVmFsdWU7XG4gICAgICB0aGlzLl92YWxpZGF0b3JPbkNoYW5nZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX21pbjogRCB8IG51bGwgPSBudWxsO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBtYXgoKTogRCB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9tYXg7XG4gIH1cblxuICBzZXQgbWF4KHZhbHVlOiBEIHwgbnVsbCkge1xuICAgIGNvbnN0IHZhbGlkVmFsdWUgPSB0aGlzLmRhdGVBZGFwdGVyLmdldFZhbGlkRGF0ZU9yTnVsbChcbiAgICAgIHRoaXMuZGF0ZUFkYXB0ZXIuZGVzZXJpYWxpemUodmFsdWUpLFxuICAgICk7XG5cbiAgICBpZiAoIXRoaXMuZGF0ZUFkYXB0ZXIuc2FtZURhdGUodmFsaWRWYWx1ZSwgdGhpcy5fbWF4KSkge1xuICAgICAgdGhpcy5fbWF4ID0gdmFsaWRWYWx1ZTtcbiAgICAgIHRoaXMuX3ZhbGlkYXRvck9uQ2hhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfbWF4OiBEIHwgbnVsbCA9IG51bGw7XG5cbiAgQElucHV0KCdyZHNEYXRlcGlja2VyRmlsdGVyJylcbiAgZ2V0IGRhdGVGaWx0ZXIoKTogRGF0ZUZpbHRlckZuPEQgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGVGaWx0ZXIgYXMgRGF0ZUZpbHRlckZuPEQgfCBudWxsPjtcbiAgfVxuXG4gIHNldCBkYXRlRmlsdGVyKHZhbHVlOiBEYXRlRmlsdGVyRm48RCB8IG51bGw+KSB7XG4gICAgY29uc3Qgd2FzTWF0Y2hpbmdWYWx1ZSA9IHRoaXMuX21hdGNoZXNGaWx0ZXIodGhpcy52YWx1ZSk7XG4gICAgdGhpcy5fZGF0ZUZpbHRlciA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuX21hdGNoZXNGaWx0ZXIodGhpcy52YWx1ZSkgIT09IHdhc01hdGNoaW5nVmFsdWUpIHtcbiAgICAgIHRoaXMuX3ZhbGlkYXRvck9uQ2hhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfZGF0ZUZpbHRlcj86IERhdGVGaWx0ZXJGbjxEIHwgbnVsbD47XG5cbiAgcHJvdGVjdGVkIF92YWxpZGF0b3IgPSBWYWxpZGF0b3JzLmNvbXBvc2Uoc3VwZXIuX2dldFZhbGlkYXRvcnMoKSk7XG5cbiAgQEhvc3RMaXN0ZW5lcignaW5wdXQnLCBbJyRldmVudCddKVxuICBvbklucHV0KCRldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLl9vbklucHV0KCgkZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2NoYW5nZScpXG4gIG92ZXJyaWRlIF9vbkNoYW5nZSgpOiB2b2lkIHtcbiAgICBzdXBlci5fb25DaGFuZ2UoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2JsdXInKVxuICBvdmVycmlkZSBfb25CbHVyKCk6IHZvaWQge1xuICAgIHN1cGVyLl9vbkJsdXIoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvdmVycmlkZSBfb25LZXlkb3duKCRldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIHN1cGVyLl9vbktleWRvd24oJGV2ZW50KTtcbiAgfVxuXG4gIGdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybUZpZWxkXG4gICAgICA/IHRoaXMuZm9ybUZpZWxkLmdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKVxuICAgICAgOiB0aGlzLmVsZW1lbnRSZWY7XG4gIH1cblxuICBnZXRTdGFydFZhbHVlKCk6IEQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfVxuXG4gIG92ZXJyaWRlIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcbiAgICB0aGlzLl9zZXREZWZhdWx0UGxhY2Vob2xkZXIoKTtcbiAgfVxuXG4gIG92ZXJyaWRlIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHN1cGVyLm5nT25EZXN0cm95KCk7XG4gICAgdGhpcy5fZGVzdHJveURhdGVwaWNrZXJTdWJzY3JpcHRpb25zJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIF9mb3JtYXRWYWx1ZSh2YWx1ZTogRCB8IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZSA9IHZhbHVlXG4gICAgICA/IHRoaXMuZGF0ZUFkYXB0ZXIuZm9ybWF0KFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIHRoaXMuZGF0ZUZvcm1hdHMuZGlzcGxheS5kYXRlSW5wdXQsXG4gICAgICAgICAgdGhpcy5fZGF0ZXBpY2tlcj8uYXZhaWxhYmxlVmlld3MsXG4gICAgICAgIClcbiAgICAgIDogJyc7XG4gIH1cblxuICBwcm90ZWN0ZWQgX29wZW5Qb3B1cCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5fZGF0ZXBpY2tlci5vcGVuKCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9nZXRWYWx1ZUZyb21Nb2RlbChtb2RlbFZhbHVlOiBEIHwgbnVsbCk6IEQgfCBudWxsIHtcbiAgICByZXR1cm4gbW9kZWxWYWx1ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfYXNzaWduVmFsdWVUb01vZGVsKHZhbHVlOiBEIHwgbnVsbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9tb2RlbCkge1xuICAgICAgdGhpcy5fbW9kZWwudXBkYXRlU2VsZWN0aW9uKHZhbHVlLCB0aGlzKTtcbiAgICB9XG4gIH1cblxuICBfZ2V0TWluRGF0ZSgpOiBEIHtcbiAgICByZXR1cm4gdGhpcy5fbWluIGFzIEQ7XG4gIH1cblxuICBfZ2V0TWF4RGF0ZSgpOiBEIHtcbiAgICByZXR1cm4gdGhpcy5fbWF4IGFzIEQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgX2dldERhdGVGaWx0ZXIoKTogRGF0ZUZpbHRlckZuPEQgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGVGaWx0ZXIgYXMgRGF0ZUZpbHRlckZuPEQgfCBudWxsPjtcbiAgfVxuXG4gIHByb3RlY3RlZCBfc2hvdWxkSGFuZGxlQ2hhbmdlRXZlbnQoXG4gICAgZXZlbnQ6IERhdGVTZWxlY3Rpb25Nb2RlbENoYW5nZTxEPixcbiAgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGV2ZW50LnNvdXJjZSAhPT0gdGhpcztcbiAgfVxuXG4gIHByb3RlY3RlZCBfc2V0RGVmYXVsdFBsYWNlaG9sZGVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmVsZW1lbnRSZWYgJiYgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKFxuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgICAgJ2RhdGUtcGxhY2Vob2xkZXInLFxuICAgICAgICB0aGlzLl9jYWxjdWxhdGVEZWZhdWx0UGxhY2Vob2xkZXIoKSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9jYWxjdWxhdGVEZWZhdWx0UGxhY2Vob2xkZXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5kYXRlQWRhcHRlci5wbGFjZWhvbGRlckZvcm1hdChcbiAgICAgIHRoaXMuZGF0ZUZvcm1hdHMuZGlzcGxheS5kYXRlSW5wdXQsXG4gICAgICB0aGlzLl9kYXRlcGlja2VyPy5hdmFpbGFibGVWaWV3cyxcbiAgICApO1xuICB9XG59XG4iXX0=