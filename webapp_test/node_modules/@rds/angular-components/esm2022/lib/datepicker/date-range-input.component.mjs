import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ElementRef, HostBinding, inject, Input, isDevMode, ViewEncapsulation, } from '@angular/core';
import { DateAdapter } from './adapter';
import { Validators } from '@angular/forms';
import { merge, Subscription } from 'rxjs';
import { createMissingDateImplError } from './datepicker-errors';
import { dateInputsHaveChanged } from './datepicker-input.base';
import { RDS_DATE_RANGE_INPUT_PARENT, RdsEndDateDirective, RdsStartDateDirective, } from './date-range-input.parts';
import { RDS_FORM_FIELD } from '../form-field';
import { RdsAbstractFormFieldControl } from '../form-field';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
let nextUniqueId = 0;
export class RdsDateRangeInputComponent extends RdsAbstractFormFieldControl {
    get classes() {
        const classes = ['rds-date-range-input'];
        if (this._shouldHidePlaceholders()) {
            classes.push('rds-date-range-input-hide-placeholders');
        }
        if (this.required) {
            classes.push('rds-date-range-input-required');
        }
        if (this.disabled) {
            classes.push('rds-date-range-input-disabled');
        }
        return classes;
    }
    get _ariaLabelledby() {
        return this._getAriaLabelledby();
    }
    get dataRdsCalendar() {
        return this.rangePicker ? this.rangePicker.id : null;
    }
    get value() {
        return this._model?.selection;
    }
    get shouldLabelFloat() {
        return this.focused || !this.empty;
    }
    get placeholder() {
        const start = this._startInput?._getPlaceholder() || '';
        const end = this._endInput?._getPlaceholder() || '';
        return start || end ? `${start} ${this.separator} ${end}` : '';
    }
    get rangePicker() {
        return this._rangePicker;
    }
    set rangePicker(rangePicker) {
        if (rangePicker) {
            this._model = rangePicker.registerInput(this);
            this._rangePicker = rangePicker;
            this._closedSubscription.unsubscribe();
            this._closedSubscription = rangePicker.closedStream.subscribe(() => {
                this._startInput?._onTouched();
                this._endInput?._onTouched();
            });
            if (this._model) {
                this._registerModel(this._model);
            }
        }
    }
    get attrRequired() {
        if (this.isBoolean(this._required) && this._required) {
            this.stateChanges.next();
            return this._required;
        }
        else if (this.ngControl?.control) {
            this.stateChanges.next();
            return this.ngControl?.control?.hasValidator(Validators.required);
        }
        else if (this._startInput &&
            this._endInput &&
            this.isBoolean(this._startInput.attrRequired) &&
            this.isBoolean(this._endInput.attrRequired) &&
            (this._startInput.attrRequired || this._endInput.attrRequired)) {
            this.stateChanges.next();
            return this._startInput.attrRequired || this._endInput.attrRequired;
        }
        else {
            return null;
        }
    }
    set required(value) {
        const isRequired = booleanAttribute(value);
        if (isRequired !== this._required) {
            this._required = isRequired;
            this.stateChanges.next();
        }
    }
    get required() {
        return this.attrRequired ?? false;
    }
    get dateFilter() {
        return this._dateFilter;
    }
    set dateFilter(value) {
        const start = this._startInput;
        const end = this._endInput;
        const wasMatchingStart = start && start._matchesFilter(start.value);
        const wasMatchingEnd = end && end._matchesFilter(start.value);
        this._dateFilter = value;
        if (start && start._matchesFilter(start.value) !== wasMatchingStart) {
            start._validatorOnChange();
        }
        if (end && end._matchesFilter(end.value) !== wasMatchingEnd) {
            end._validatorOnChange();
        }
    }
    get min() {
        return this._min;
    }
    set min(value) {
        const validValue = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(value));
        if (!this.dateAdapter.sameDate(validValue, this._min)) {
            this._min = validValue;
            this._revalidate();
        }
    }
    get max() {
        return this._max;
    }
    set max(value) {
        const validValue = this.dateAdapter.getValidDateOrNull(this.dateAdapter.deserialize(value));
        if (!this.dateAdapter.sameDate(validValue, this._max)) {
            this._max = validValue;
            this._revalidate();
        }
    }
    get disabled() {
        return this._startInput && this._endInput
            ? this._startInput.disabled && this._endInput.disabled
            : this._groupDisabled;
    }
    set disabled(value) {
        const newValue = booleanAttribute(value);
        if (newValue !== this._groupDisabled) {
            this._groupDisabled = newValue;
            this.stateChanges.next();
        }
    }
    get errorState() {
        if (this._startInput && this._endInput) {
            return this._startInput.errorState || this._endInput.errorState;
        }
        return false;
    }
    get empty() {
        const startEmpty = this._startInput ? this._startInput.isEmpty() : false;
        const endEmpty = this._endInput ? this._endInput.isEmpty() : false;
        return startEmpty && endEmpty;
    }
    constructor() {
        super();
        this.cdr = inject(ChangeDetectorRef);
        this.elementRef = inject(ElementRef);
        this.dateAdapter = inject(DateAdapter, {
            optional: true,
        });
        this.formField = inject(RDS_FORM_FIELD, {
            optional: true,
        });
        this._closedSubscription = Subscription.EMPTY;
        this._id = `rds-date-range-input-${nextUniqueId++}`;
        this.idAttr = null;
        this.role = 'group';
        this.controlType = 'date-range';
        this._dateFilter = null;
        this._min = null;
        this._max = null;
        this._rangePicker = null;
        this._groupDisabled = false;
        this._ariaDescribedBy = null;
        this.separator = '–';
        this.comparisonStart = null;
        this.comparisonEnd = null;
        if (!this.dateAdapter && isDevMode()) {
            throw createMissingDateImplError('DateAdapter');
        }
    }
    setDescribedByIds(ids) {
        this._ariaDescribedBy = ids.length ? ids.join(' ') : null;
    }
    onContainerClick() {
        if (!this.focused && !this.disabled) {
            if (!this._model || !this._model.selection?.start) {
                this._startInput?.focus();
            }
            else {
                this._endInput?.focus();
            }
        }
    }
    ngAfterContentInit() {
        if (!this._startInput) {
            throw Error('rds-date-range-input must contain a rdsStartDate input');
        }
        if (!this._endInput) {
            throw Error('rds-date-range-input must contain a rdsEndDate input');
        }
        if (this._model) {
            this._registerModel(this._model);
        }
        merge(this._startInput.stateChanges, this._endInput.stateChanges).subscribe(() => {
            this.stateChanges.next(undefined);
        });
    }
    ngOnChanges(changes) {
        if (this.dateAdapter && dateInputsHaveChanged(changes, this.dateAdapter)) {
            this.stateChanges.next(undefined);
        }
    }
    ngOnDestroy() {
        this._closedSubscription.unsubscribe();
        this.stateChanges.complete();
    }
    getStartValue() {
        return this.value ? this.value.start : null;
    }
    getConnectedOverlayOrigin() {
        return this.formField
            ? this.formField.getConnectedOverlayOrigin()
            : this.elementRef;
    }
    _getInputMirrorValue() {
        return this._startInput ? this._startInput.getMirrorValue() : '';
    }
    _shouldHidePlaceholders() {
        if (this.formField?.labelPosition !== 'floating') {
            return false;
        }
        return this._startInput
            ? !this.focused && this._startInput.isEmpty()
            : !this.focused;
    }
    _handleChildValueChange() {
        this.stateChanges.next(undefined);
        this.cdr.markForCheck();
    }
    _openDatepicker() {
        if (this._rangePicker) {
            this._rangePicker.open();
        }
    }
    _shouldHideSeparator() {
        return !this.focused && this.empty;
    }
    _getAriaLabelledby() {
        return this.formField?.labelId;
    }
    _updateFocus(origin) {
        this._focused = origin !== null;
        this.stateChanges.next();
    }
    _revalidate() {
        if (this._startInput) {
            this._startInput._validatorOnChange();
        }
        if (this._endInput) {
            this._endInput._validatorOnChange();
        }
    }
    _registerModel(model) {
        if (this._startInput) {
            this._startInput._registerModel(model);
        }
        if (this._endInput) {
            this._endInput._registerModel(model);
        }
    }
    isBoolean(value) {
        return value === true || value === false;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDateRangeInputComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.1", type: RdsDateRangeInputComponent, selector: "rds-date-range-input", inputs: { rangePicker: "rangePicker", required: "required", dateFilter: "dateFilter", min: "min", max: "max", disabled: "disabled", separator: "separator", comparisonStart: "comparisonStart", comparisonEnd: "comparisonEnd" }, host: { properties: { "class": "this.classes", "attr.id": "this.idAttr", "attr.role": "this.role", "attr.aria-labelledby": "this._ariaLabelledby", "attr.data-rds-calendar": "this.dataRdsCalendar", "attr.required": "this.attrRequired", "attr.aria-describedby": "this._ariaDescribedBy" } }, providers: [
            {
                provide: RdsAbstractFormFieldControl,
                useExisting: RdsDateRangeInputComponent,
            },
            {
                provide: RDS_DATE_RANGE_INPUT_PARENT,
                useExisting: RdsDateRangeInputComponent,
            },
        ], queries: [{ propertyName: "_startInput", first: true, predicate: RdsStartDateDirective, descendants: true }, { propertyName: "_endInput", first: true, predicate: RdsEndDateDirective, descendants: true }], exportAs: ["rdsDateRangeInput"], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<div\n  class=\"rds-date-range-input-container\"\n  cdkMonitorSubtreeFocus\n  (cdkFocusChange)=\"_updateFocus($event)\"\n>\n  <div class=\"rds-date-range-input-start-wrapper\">\n    <ng-content select=\"input[rdsStartDate]\" />\n    <span class=\"rds-date-range-input-mirror\" aria-hidden=\"true\">{{\n      _getInputMirrorValue()\n    }}</span>\n  </div>\n\n  <span\n    class=\"rds-date-range-input-separator\"\n    [class.rds-date-range-input-separator-hidden]=\"_shouldHideSeparator()\"\n    >{{ separator }}</span\n  >\n\n  <div class=\"rds-date-range-input-end-wrapper\">\n    <ng-content select=\"input[rdsEndDate]\" />\n  </div>\n</div>\n", styles: [".rds-date-range-input{position:relative;display:flex;margin-top:16px;border:none;background:transparent;outline:none;color:var(--rds-color-high-contrast);width:100%}.rds-form-field--static-label .rds-date-range-input,.rds-form-field--no-label .rds-date-range-input{margin-top:0;display:flex}.rds-date-range-input-container{display:flex;align-items:center}.rds-date-range-input-separator{transition:opacity .4s .1333333333333s cubic-bezier(.25,.8,.25,1);margin:0 4px;color:var(--rds-color-high-contrast)}.rds-date-range-input-disabled .rds-date-range-input-separator{color:var(--rds-color-disabled)}.rds-date-range-input-inner{font:inherit;background:transparent;color:var(--rds-color-high-contrast);border:none;outline:none;padding:0;margin:0;vertical-align:bottom;text-align:inherit;-webkit-appearance:none;width:100%}.rds-date-range-input-inner::-ms-clear,.rds-date-range-input-inner::-ms-reveal{display:none}.rds-date-range-input-inner:-moz-ui-invalid{box-shadow:none}.rds-date-range-input-inner::placeholder{transition:color .4s .1333333333333s cubic-bezier(.25,.8,.25,1)}.rds-form-field-hide-placeholder .rds-date-range-input-inner::placeholder,.rds-date-range-input-hide-placeholders .rds-date-range-input-inner::placeholder{-webkit-user-select:none;user-select:none;color:transparent!important;-webkit-text-fill-color:transparent;transition:none}.rds-date-range-input-inner[disabled]{color:var(--rds-color-disabled)}.rds-date-range-input-mirror{visibility:hidden;white-space:nowrap;display:inline-block;min-width:2px}.rds-date-range-input-start-wrapper{position:relative;overflow:hidden;max-width:calc(50% - 4px);text-align:left}.rds-date-range-input-start-wrapper .rds-date-range-input-inner{position:absolute;top:0;left:0}.rds-date-range-input-end-wrapper{text-align:left;flex-grow:1;max-width:calc(50% - 4px)}.rds-form-field-type-rds-date-range-input .rds-form-field-infix{width:200px}.rds-form-field--floating-label .rds-date-range-input-separator-hidden{opacity:0;transition:none}\n"], dependencies: [{ kind: "directive", type: i1.CdkMonitorFocus, selector: "[cdkMonitorElementFocus], [cdkMonitorSubtreeFocus]", outputs: ["cdkFocusChange"], exportAs: ["cdkMonitorFocus"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDateRangeInputComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-date-range-input', exportAs: 'rdsDateRangeInput', changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, providers: [
                        {
                            provide: RdsAbstractFormFieldControl,
                            useExisting: RdsDateRangeInputComponent,
                        },
                        {
                            provide: RDS_DATE_RANGE_INPUT_PARENT,
                            useExisting: RdsDateRangeInputComponent,
                        },
                    ], template: "<div\n  class=\"rds-date-range-input-container\"\n  cdkMonitorSubtreeFocus\n  (cdkFocusChange)=\"_updateFocus($event)\"\n>\n  <div class=\"rds-date-range-input-start-wrapper\">\n    <ng-content select=\"input[rdsStartDate]\" />\n    <span class=\"rds-date-range-input-mirror\" aria-hidden=\"true\">{{\n      _getInputMirrorValue()\n    }}</span>\n  </div>\n\n  <span\n    class=\"rds-date-range-input-separator\"\n    [class.rds-date-range-input-separator-hidden]=\"_shouldHideSeparator()\"\n    >{{ separator }}</span\n  >\n\n  <div class=\"rds-date-range-input-end-wrapper\">\n    <ng-content select=\"input[rdsEndDate]\" />\n  </div>\n</div>\n", styles: [".rds-date-range-input{position:relative;display:flex;margin-top:16px;border:none;background:transparent;outline:none;color:var(--rds-color-high-contrast);width:100%}.rds-form-field--static-label .rds-date-range-input,.rds-form-field--no-label .rds-date-range-input{margin-top:0;display:flex}.rds-date-range-input-container{display:flex;align-items:center}.rds-date-range-input-separator{transition:opacity .4s .1333333333333s cubic-bezier(.25,.8,.25,1);margin:0 4px;color:var(--rds-color-high-contrast)}.rds-date-range-input-disabled .rds-date-range-input-separator{color:var(--rds-color-disabled)}.rds-date-range-input-inner{font:inherit;background:transparent;color:var(--rds-color-high-contrast);border:none;outline:none;padding:0;margin:0;vertical-align:bottom;text-align:inherit;-webkit-appearance:none;width:100%}.rds-date-range-input-inner::-ms-clear,.rds-date-range-input-inner::-ms-reveal{display:none}.rds-date-range-input-inner:-moz-ui-invalid{box-shadow:none}.rds-date-range-input-inner::placeholder{transition:color .4s .1333333333333s cubic-bezier(.25,.8,.25,1)}.rds-form-field-hide-placeholder .rds-date-range-input-inner::placeholder,.rds-date-range-input-hide-placeholders .rds-date-range-input-inner::placeholder{-webkit-user-select:none;user-select:none;color:transparent!important;-webkit-text-fill-color:transparent;transition:none}.rds-date-range-input-inner[disabled]{color:var(--rds-color-disabled)}.rds-date-range-input-mirror{visibility:hidden;white-space:nowrap;display:inline-block;min-width:2px}.rds-date-range-input-start-wrapper{position:relative;overflow:hidden;max-width:calc(50% - 4px);text-align:left}.rds-date-range-input-start-wrapper .rds-date-range-input-inner{position:absolute;top:0;left:0}.rds-date-range-input-end-wrapper{text-align:left;flex-grow:1;max-width:calc(50% - 4px)}.rds-form-field-type-rds-date-range-input .rds-form-field-infix{width:200px}.rds-form-field--floating-label .rds-date-range-input-separator-hidden{opacity:0;transition:none}\n"] }]
        }], ctorParameters: () => [], propDecorators: { classes: [{
                type: HostBinding,
                args: ['class']
            }], idAttr: [{
                type: HostBinding,
                args: ['attr.id']
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }], _ariaLabelledby: [{
                type: HostBinding,
                args: ['attr.aria-labelledby']
            }], dataRdsCalendar: [{
                type: HostBinding,
                args: ['attr.data-rds-calendar']
            }], rangePicker: [{
                type: Input
            }], attrRequired: [{
                type: HostBinding,
                args: ['attr.required']
            }], required: [{
                type: Input
            }], dateFilter: [{
                type: Input
            }], min: [{
                type: Input
            }], max: [{
                type: Input
            }], disabled: [{
                type: Input
            }], _ariaDescribedBy: [{
                type: HostBinding,
                args: ['attr.aria-describedby']
            }], separator: [{
                type: Input
            }], comparisonStart: [{
                type: Input
            }], comparisonEnd: [{
                type: Input
            }], _startInput: [{
                type: ContentChild,
                args: [RdsStartDateDirective]
            }], _endInput: [{
                type: ContentChild,
                args: [RdsEndDateDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2RhdGVwaWNrZXIvZGF0ZS1yYW5nZS1pbnB1dC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2RhdGVwaWNrZXIvZGF0ZS1yYW5nZS1pbnB1dC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLE1BQU0sRUFDTixLQUFLLEVBQ0wsU0FBUyxFQUlULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUczQyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRSxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFOUUsT0FBTyxFQUNMLDJCQUEyQixFQUUzQixtQkFBbUIsRUFDbkIscUJBQXFCLEdBQ3RCLE1BQU0sMEJBQTBCLENBQUM7QUFFbEMsT0FBTyxFQUFFLGNBQWMsRUFBeUIsTUFBTSxlQUFlLENBQUM7QUFDdEUsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFJNUQsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0FBb0JyQixNQUFNLE9BQU8sMEJBQ1gsU0FBUSwyQkFBeUM7SUFxQmpE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VTtzQkFEYixLQUFLO2dCQXVCRixHQUFHO3NCQUROLEtBQUs7Z0JBaUJGLEdBQUc7c0JBRE4sS0FBSztnQkFpQk8sUUFBUTtzQkFEcEIsS0FBSztnQkFrQ04sZ0JBQWdCO3NCQURmLFdBQVc7dUJBQUMsdUJBQXVCO2dCQUkzQixTQUFTO3NCQUFqQixLQUFLO2dCQUNHLGVBQWU7c0JBQXZCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFFK0IsV0FBVztzQkFBL0MsWUFBWTt1QkFBQyxxQkFBcUI7Z0JBQ0EsU0FBUztzQkFBM0MsWUFBWTt1QkFBQyxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBib29sZWFuQXR0cmlidXRlLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBFbGVtZW50UmVmLFxuICBIb3N0QmluZGluZyxcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgaXNEZXZNb2RlLFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGF0ZUFkYXB0ZXIgfSBmcm9tICcuL2FkYXB0ZXInO1xuaW1wb3J0IHsgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IG1lcmdlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEZvY3VzT3JpZ2luIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IGNyZWF0ZU1pc3NpbmdEYXRlSW1wbEVycm9yIH0gZnJvbSAnLi9kYXRlcGlja2VyLWVycm9ycyc7XG5pbXBvcnQgeyBEYXRlRmlsdGVyRm4sIGRhdGVJbnB1dHNIYXZlQ2hhbmdlZCB9IGZyb20gJy4vZGF0ZXBpY2tlci1pbnB1dC5iYXNlJztcbmltcG9ydCB7IERhdGVSYW5nZSwgUmRzRGF0ZVNlbGVjdGlvbk1vZGVsIH0gZnJvbSAnLi9kYXRlLXNlbGVjdGlvbi5tb2RlbCc7XG5pbXBvcnQge1xuICBSRFNfREFURV9SQU5HRV9JTlBVVF9QQVJFTlQsXG4gIFJkc0RhdGVSYW5nZUlucHV0UGFyZW50LFxuICBSZHNFbmREYXRlRGlyZWN0aXZlLFxuICBSZHNTdGFydERhdGVEaXJlY3RpdmUsXG59IGZyb20gJy4vZGF0ZS1yYW5nZS1pbnB1dC5wYXJ0cyc7XG5pbXBvcnQgeyBSZHNEYXRlcGlja2VyQ29udHJvbCwgUmRzRGF0ZXBpY2tlclBhbmVsIH0gZnJvbSAnLi9kYXRlcGlja2VyLWJhc2UnO1xuaW1wb3J0IHsgUkRTX0ZPUk1fRklFTEQsIFJkc0Zvcm1GaWVsZENvbXBvbmVudCB9IGZyb20gJy4uL2Zvcm0tZmllbGQnO1xuaW1wb3J0IHsgUmRzQWJzdHJhY3RGb3JtRmllbGRDb250cm9sIH0gZnJvbSAnLi4vZm9ybS1maWVsZCc7XG5pbXBvcnQgeyBSZHNDb250cm9sVHlwZSB9IGZyb20gJy4uL2Zvcm0tZmllbGQvY29udHJvbC50eXBlJztcbmltcG9ydCB7IFJkc0RhdGVSYW5nZVBpY2tlcklucHV0IH0gZnJvbSAnLi9kYXRlLXJhbmdlLXBpY2tlci5jb21wb25lbnQnO1xuXG5sZXQgbmV4dFVuaXF1ZUlkID0gMDtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncmRzLWRhdGUtcmFuZ2UtaW5wdXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZGF0ZS1yYW5nZS1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2RhdGUtcmFuZ2UtaW5wdXQuY29tcG9uZW50LnNjc3MnXSxcbiAgZXhwb3J0QXM6ICdyZHNEYXRlUmFuZ2VJbnB1dCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBSZHNBYnN0cmFjdEZvcm1GaWVsZENvbnRyb2wsXG4gICAgICB1c2VFeGlzdGluZzogUmRzRGF0ZVJhbmdlSW5wdXRDb21wb25lbnQsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBSRFNfREFURV9SQU5HRV9JTlBVVF9QQVJFTlQsXG4gICAgICB1c2VFeGlzdGluZzogUmRzRGF0ZVJhbmdlSW5wdXRDb21wb25lbnQsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUmRzRGF0ZVJhbmdlSW5wdXRDb21wb25lbnQ8RD5cbiAgZXh0ZW5kcyBSZHNBYnN0cmFjdEZvcm1GaWVsZENvbnRyb2w8RGF0ZVJhbmdlPEQ+PlxuICBpbXBsZW1lbnRzXG4gICAgUmRzRGF0ZXBpY2tlckNvbnRyb2w8RD4sXG4gICAgUmRzRGF0ZVJhbmdlSW5wdXRQYXJlbnQ8RD4sXG4gICAgUmRzRGF0ZVJhbmdlUGlja2VySW5wdXQ8RD4sXG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT25EZXN0cm95XG57XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmID0gaW5qZWN0PEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+PihFbGVtZW50UmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkYXRlQWRhcHRlciA9IGluamVjdChEYXRlQWRhcHRlciwge1xuICAgIG9wdGlvbmFsOiB0cnVlLFxuICB9KSBhcyBEYXRlQWRhcHRlcjxEPjtcbiAgcHJpdmF0ZSByZWFkb25seSBmb3JtRmllbGQgPSBpbmplY3QoUkRTX0ZPUk1fRklFTEQsIHtcbiAgICBvcHRpb25hbDogdHJ1ZSxcbiAgfSkgYXMgUmRzRm9ybUZpZWxkQ29tcG9uZW50PERhdGVSYW5nZTxEPj47XG5cbiAgcHJpdmF0ZSBfY2xvc2VkU3Vic2NyaXB0aW9uID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgX2lkID0gYHJkcy1kYXRlLXJhbmdlLWlucHV0LSR7bmV4dFVuaXF1ZUlkKyt9YDtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgZ2V0IGNsYXNzZXMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSBbJ3Jkcy1kYXRlLXJhbmdlLWlucHV0J107XG5cbiAgICBpZiAodGhpcy5fc2hvdWxkSGlkZVBsYWNlaG9sZGVycygpKSB7XG4gICAgICBjbGFzc2VzLnB1c2goJ3Jkcy1kYXRlLXJhbmdlLWlucHV0LWhpZGUtcGxhY2Vob2xkZXJzJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVxdWlyZWQpIHtcbiAgICAgIGNsYXNzZXMucHVzaCgncmRzLWRhdGUtcmFuZ2UtaW5wdXQtcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgY2xhc3Nlcy5wdXNoKCdyZHMtZGF0ZS1yYW5nZS1pbnB1dC1kaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiBjbGFzc2VzO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmlkJykgaWRBdHRyID0gbnVsbDtcbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnJvbGUnKSByb2xlID0gJ2dyb3VwJztcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1sYWJlbGxlZGJ5JykgZ2V0IF9hcmlhTGFiZWxsZWRieSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9nZXRBcmlhTGFiZWxsZWRieSgpO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmRhdGEtcmRzLWNhbGVuZGFyJykgZ2V0IGRhdGFSZHNDYWxlbmRhcigpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5yYW5nZVBpY2tlciA/IHRoaXMucmFuZ2VQaWNrZXIuaWQgOiBudWxsO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0IHZhbHVlKCk6IERhdGVSYW5nZTxEPiB7XG4gICAgcmV0dXJuIHRoaXMuX21vZGVsPy5zZWxlY3Rpb24gYXMgRGF0ZVJhbmdlPEQ+O1xuICB9XG5cbiAgY29udHJvbFR5cGU6IFJkc0NvbnRyb2xUeXBlID0gJ2RhdGUtcmFuZ2UnO1xuXG4gIHByaXZhdGUgX2RhdGVGaWx0ZXI6IERhdGVGaWx0ZXJGbjxEPiB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIF9taW46IEQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBfbWF4OiBEIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgX3JhbmdlUGlja2VyOiBSZHNEYXRlcGlja2VyUGFuZWw8XG4gICAgUmRzRGF0ZXBpY2tlckNvbnRyb2w8RD4sXG4gICAgRGF0ZVJhbmdlPEQ+LFxuICAgIERcbiAgPiB8IG51bGwgPSBudWxsO1xuXG4gIGdldCBzaG91bGRMYWJlbEZsb2F0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmZvY3VzZWQgfHwgIXRoaXMuZW1wdHk7XG4gIH1cblxuICBnZXQgcGxhY2Vob2xkZXIoKTogc3RyaW5nIHtcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuX3N0YXJ0SW5wdXQ/Ll9nZXRQbGFjZWhvbGRlcigpIHx8ICcnO1xuICAgIGNvbnN0IGVuZCA9IHRoaXMuX2VuZElucHV0Py5fZ2V0UGxhY2Vob2xkZXIoKSB8fCAnJztcblxuICAgIHJldHVybiBzdGFydCB8fCBlbmQgPyBgJHtzdGFydH0gJHt0aGlzLnNlcGFyYXRvcn0gJHtlbmR9YCA6ICcnO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHJhbmdlUGlja2VyKCk6IFJkc0RhdGVwaWNrZXJQYW5lbDxcbiAgICBSZHNEYXRlcGlja2VyQ29udHJvbDxEPixcbiAgICBEYXRlUmFuZ2U8RD4sXG4gICAgRFxuICA+IHtcbiAgICByZXR1cm4gdGhpcy5fcmFuZ2VQaWNrZXIgYXMgUmRzRGF0ZXBpY2tlclBhbmVsPFxuICAgICAgUmRzRGF0ZXBpY2tlckNvbnRyb2w8RD4sXG4gICAgICBEYXRlUmFuZ2U8RD4sXG4gICAgICBEXG4gICAgPjtcbiAgfVxuXG4gIHNldCByYW5nZVBpY2tlcihcbiAgICByYW5nZVBpY2tlcjogUmRzRGF0ZXBpY2tlclBhbmVsPFJkc0RhdGVwaWNrZXJDb250cm9sPEQ+LCBEYXRlUmFuZ2U8RD4sIEQ+LFxuICApIHtcbiAgICBpZiAocmFuZ2VQaWNrZXIpIHtcbiAgICAgIHRoaXMuX21vZGVsID0gcmFuZ2VQaWNrZXIucmVnaXN0ZXJJbnB1dCh0aGlzKTtcbiAgICAgIHRoaXMuX3JhbmdlUGlja2VyID0gcmFuZ2VQaWNrZXI7XG4gICAgICB0aGlzLl9jbG9zZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuX2Nsb3NlZFN1YnNjcmlwdGlvbiA9IHJhbmdlUGlja2VyLmNsb3NlZFN0cmVhbS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9zdGFydElucHV0Py5fb25Ub3VjaGVkKCk7XG4gICAgICAgIHRoaXMuX2VuZElucHV0Py5fb25Ub3VjaGVkKCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMuX21vZGVsKSB7XG4gICAgICAgIHRoaXMuX3JlZ2lzdGVyTW9kZWwodGhpcy5fbW9kZWwpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5yZXF1aXJlZCcpXG4gIGdldCBhdHRyUmVxdWlyZWQoKTogYm9vbGVhbiB8IG51bGwge1xuICAgIGlmICh0aGlzLmlzQm9vbGVhbih0aGlzLl9yZXF1aXJlZCkgJiYgdGhpcy5fcmVxdWlyZWQpIHtcbiAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQoKTtcblxuICAgICAgcmV0dXJuIHRoaXMuX3JlcXVpcmVkO1xuICAgIH0gZWxzZSBpZiAodGhpcy5uZ0NvbnRyb2w/LmNvbnRyb2wpIHtcbiAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQoKTtcblxuICAgICAgcmV0dXJuIHRoaXMubmdDb250cm9sPy5jb250cm9sPy5oYXNWYWxpZGF0b3IoVmFsaWRhdG9ycy5yZXF1aXJlZCk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuX3N0YXJ0SW5wdXQgJiZcbiAgICAgIHRoaXMuX2VuZElucHV0ICYmXG4gICAgICB0aGlzLmlzQm9vbGVhbih0aGlzLl9zdGFydElucHV0LmF0dHJSZXF1aXJlZCkgJiZcbiAgICAgIHRoaXMuaXNCb29sZWFuKHRoaXMuX2VuZElucHV0LmF0dHJSZXF1aXJlZCkgJiZcbiAgICAgICh0aGlzLl9zdGFydElucHV0LmF0dHJSZXF1aXJlZCB8fCB0aGlzLl9lbmRJbnB1dC5hdHRyUmVxdWlyZWQpXG4gICAgKSB7XG4gICAgICB0aGlzLnN0YXRlQ2hhbmdlcy5uZXh0KCk7XG5cbiAgICAgIHJldHVybiB0aGlzLl9zdGFydElucHV0LmF0dHJSZXF1aXJlZCB8fCB0aGlzLl9lbmRJbnB1dC5hdHRyUmVxdWlyZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpXG4gIG92ZXJyaWRlIHNldCByZXF1aXJlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgY29uc3QgaXNSZXF1aXJlZCA9IGJvb2xlYW5BdHRyaWJ1dGUodmFsdWUpO1xuXG4gICAgaWYgKGlzUmVxdWlyZWQgIT09IHRoaXMuX3JlcXVpcmVkKSB7XG4gICAgICB0aGlzLl9yZXF1aXJlZCA9IGlzUmVxdWlyZWQ7XG4gICAgICB0aGlzLnN0YXRlQ2hhbmdlcy5uZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0IHJlcXVpcmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmF0dHJSZXF1aXJlZCA/PyBmYWxzZTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBkYXRlRmlsdGVyKCk6IERhdGVGaWx0ZXJGbjxEPiB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGVGaWx0ZXIgYXMgRGF0ZUZpbHRlckZuPEQ+O1xuICB9XG5cbiAgc2V0IGRhdGVGaWx0ZXIodmFsdWU6IERhdGVGaWx0ZXJGbjxEPikge1xuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5fc3RhcnRJbnB1dDtcbiAgICBjb25zdCBlbmQgPSB0aGlzLl9lbmRJbnB1dDtcbiAgICBjb25zdCB3YXNNYXRjaGluZ1N0YXJ0ID0gc3RhcnQgJiYgc3RhcnQuX21hdGNoZXNGaWx0ZXIoc3RhcnQudmFsdWUpO1xuICAgIGNvbnN0IHdhc01hdGNoaW5nRW5kID1cbiAgICAgIGVuZCAmJiBlbmQuX21hdGNoZXNGaWx0ZXIoKHN0YXJ0IGFzIFJkc1N0YXJ0RGF0ZURpcmVjdGl2ZTxEPikudmFsdWUpO1xuICAgIHRoaXMuX2RhdGVGaWx0ZXIgPSB2YWx1ZTtcblxuICAgIGlmIChzdGFydCAmJiBzdGFydC5fbWF0Y2hlc0ZpbHRlcihzdGFydC52YWx1ZSkgIT09IHdhc01hdGNoaW5nU3RhcnQpIHtcbiAgICAgIHN0YXJ0Ll92YWxpZGF0b3JPbkNoYW5nZSgpO1xuICAgIH1cblxuICAgIGlmIChlbmQgJiYgZW5kLl9tYXRjaGVzRmlsdGVyKGVuZC52YWx1ZSkgIT09IHdhc01hdGNoaW5nRW5kKSB7XG4gICAgICBlbmQuX3ZhbGlkYXRvck9uQ2hhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IG1pbigpOiBEIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuX21pbjtcbiAgfVxuXG4gIHNldCBtaW4odmFsdWU6IEQgfCBudWxsKSB7XG4gICAgY29uc3QgdmFsaWRWYWx1ZSA9IHRoaXMuZGF0ZUFkYXB0ZXIuZ2V0VmFsaWREYXRlT3JOdWxsKFxuICAgICAgdGhpcy5kYXRlQWRhcHRlci5kZXNlcmlhbGl6ZSh2YWx1ZSksXG4gICAgKTtcblxuICAgIGlmICghdGhpcy5kYXRlQWRhcHRlci5zYW1lRGF0ZSh2YWxpZFZhbHVlLCB0aGlzLl9taW4pKSB7XG4gICAgICB0aGlzLl9taW4gPSB2YWxpZFZhbHVlO1xuICAgICAgdGhpcy5fcmV2YWxpZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBtYXgoKTogRCB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9tYXg7XG4gIH1cblxuICBzZXQgbWF4KHZhbHVlOiBEIHwgbnVsbCkge1xuICAgIGNvbnN0IHZhbGlkVmFsdWUgPSB0aGlzLmRhdGVBZGFwdGVyLmdldFZhbGlkRGF0ZU9yTnVsbChcbiAgICAgIHRoaXMuZGF0ZUFkYXB0ZXIuZGVzZXJpYWxpemUodmFsdWUpLFxuICAgICk7XG5cbiAgICBpZiAoIXRoaXMuZGF0ZUFkYXB0ZXIuc2FtZURhdGUodmFsaWRWYWx1ZSwgdGhpcy5fbWF4KSkge1xuICAgICAgdGhpcy5fbWF4ID0gdmFsaWRWYWx1ZTtcbiAgICAgIHRoaXMuX3JldmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBvdmVycmlkZSBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXJ0SW5wdXQgJiYgdGhpcy5fZW5kSW5wdXRcbiAgICAgID8gdGhpcy5fc3RhcnRJbnB1dC5kaXNhYmxlZCAmJiB0aGlzLl9lbmRJbnB1dC5kaXNhYmxlZFxuICAgICAgOiB0aGlzLl9ncm91cERpc2FibGVkO1xuICB9XG5cbiAgb3ZlcnJpZGUgc2V0IGRpc2FibGVkKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGJvb2xlYW5BdHRyaWJ1dGUodmFsdWUpO1xuXG4gICAgaWYgKG5ld1ZhbHVlICE9PSB0aGlzLl9ncm91cERpc2FibGVkKSB7XG4gICAgICB0aGlzLl9ncm91cERpc2FibGVkID0gbmV3VmFsdWU7XG4gICAgICB0aGlzLnN0YXRlQ2hhbmdlcy5uZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgX2dyb3VwRGlzYWJsZWQgPSBmYWxzZTtcblxuICBnZXQgZXJyb3JTdGF0ZSgpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5fc3RhcnRJbnB1dCAmJiB0aGlzLl9lbmRJbnB1dCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0SW5wdXQuZXJyb3JTdGF0ZSB8fCB0aGlzLl9lbmRJbnB1dC5lcnJvclN0YXRlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldCBlbXB0eSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzdGFydEVtcHR5ID0gdGhpcy5fc3RhcnRJbnB1dCA/IHRoaXMuX3N0YXJ0SW5wdXQuaXNFbXB0eSgpIDogZmFsc2U7XG4gICAgY29uc3QgZW5kRW1wdHkgPSB0aGlzLl9lbmRJbnB1dCA/IHRoaXMuX2VuZElucHV0LmlzRW1wdHkoKSA6IGZhbHNlO1xuXG4gICAgcmV0dXJuIHN0YXJ0RW1wdHkgJiYgZW5kRW1wdHk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1kZXNjcmliZWRieScpXG4gIF9hcmlhRGVzY3JpYmVkQnk6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIF9tb2RlbD86IFJkc0RhdGVTZWxlY3Rpb25Nb2RlbDxEYXRlUmFuZ2U8RD4+O1xuXG4gIEBJbnB1dCgpIHNlcGFyYXRvciA9ICfigJMnO1xuICBASW5wdXQoKSBjb21wYXJpc29uU3RhcnQ6IEQgfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCkgY29tcGFyaXNvbkVuZDogRCB8IG51bGwgPSBudWxsO1xuXG4gIEBDb250ZW50Q2hpbGQoUmRzU3RhcnREYXRlRGlyZWN0aXZlKSBfc3RhcnRJbnB1dDogUmRzU3RhcnREYXRlRGlyZWN0aXZlPEQ+O1xuICBAQ29udGVudENoaWxkKFJkc0VuZERhdGVEaXJlY3RpdmUpIF9lbmRJbnB1dDogUmRzRW5kRGF0ZURpcmVjdGl2ZTxEPjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgaWYgKCF0aGlzLmRhdGVBZGFwdGVyICYmIGlzRGV2TW9kZSgpKSB7XG4gICAgICB0aHJvdyBjcmVhdGVNaXNzaW5nRGF0ZUltcGxFcnJvcignRGF0ZUFkYXB0ZXInKTtcbiAgICB9XG4gIH1cblxuICBzZXREZXNjcmliZWRCeUlkcyhpZHM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgdGhpcy5fYXJpYURlc2NyaWJlZEJ5ID0gaWRzLmxlbmd0aCA/IGlkcy5qb2luKCcgJykgOiBudWxsO1xuICB9XG5cbiAgb25Db250YWluZXJDbGljaygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZm9jdXNlZCAmJiAhdGhpcy5kaXNhYmxlZCkge1xuICAgICAgaWYgKCF0aGlzLl9tb2RlbCB8fCAhdGhpcy5fbW9kZWwuc2VsZWN0aW9uPy5zdGFydCkge1xuICAgICAgICB0aGlzLl9zdGFydElucHV0Py5mb2N1cygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fZW5kSW5wdXQ/LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5fc3RhcnRJbnB1dCkge1xuICAgICAgdGhyb3cgRXJyb3IoJ3Jkcy1kYXRlLXJhbmdlLWlucHV0IG11c3QgY29udGFpbiBhIHJkc1N0YXJ0RGF0ZSBpbnB1dCcpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5fZW5kSW5wdXQpIHtcbiAgICAgIHRocm93IEVycm9yKCdyZHMtZGF0ZS1yYW5nZS1pbnB1dCBtdXN0IGNvbnRhaW4gYSByZHNFbmREYXRlIGlucHV0Jyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX21vZGVsKSB7XG4gICAgICB0aGlzLl9yZWdpc3Rlck1vZGVsKHRoaXMuX21vZGVsKTtcbiAgICB9XG5cbiAgICBtZXJnZSh0aGlzLl9zdGFydElucHV0LnN0YXRlQ2hhbmdlcywgdGhpcy5fZW5kSW5wdXQuc3RhdGVDaGFuZ2VzKS5zdWJzY3JpYmUoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQodW5kZWZpbmVkKTtcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kYXRlQWRhcHRlciAmJiBkYXRlSW5wdXRzSGF2ZUNoYW5nZWQoY2hhbmdlcywgdGhpcy5kYXRlQWRhcHRlcikpIHtcbiAgICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQodW5kZWZpbmVkKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLl9jbG9zZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnN0YXRlQ2hhbmdlcy5jb21wbGV0ZSgpO1xuICB9XG5cbiAgZ2V0U3RhcnRWYWx1ZSgpOiBEIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0aGlzLnZhbHVlLnN0YXJ0IDogbnVsbDtcbiAgfVxuXG4gIGdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybUZpZWxkXG4gICAgICA/IHRoaXMuZm9ybUZpZWxkLmdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKVxuICAgICAgOiB0aGlzLmVsZW1lbnRSZWY7XG4gIH1cblxuICBfZ2V0SW5wdXRNaXJyb3JWYWx1ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9zdGFydElucHV0ID8gdGhpcy5fc3RhcnRJbnB1dC5nZXRNaXJyb3JWYWx1ZSgpIDogJyc7XG4gIH1cblxuICBfc2hvdWxkSGlkZVBsYWNlaG9sZGVycygpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5mb3JtRmllbGQ/LmxhYmVsUG9zaXRpb24gIT09ICdmbG9hdGluZycpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fc3RhcnRJbnB1dFxuICAgICAgPyAhdGhpcy5mb2N1c2VkICYmIHRoaXMuX3N0YXJ0SW5wdXQuaXNFbXB0eSgpXG4gICAgICA6ICF0aGlzLmZvY3VzZWQ7XG4gIH1cblxuICBfaGFuZGxlQ2hpbGRWYWx1ZUNoYW5nZSgpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlQ2hhbmdlcy5uZXh0KHVuZGVmaW5lZCk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBfb3BlbkRhdGVwaWNrZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3JhbmdlUGlja2VyKSB7XG4gICAgICB0aGlzLl9yYW5nZVBpY2tlci5vcGVuKCk7XG4gICAgfVxuICB9XG5cbiAgX3Nob3VsZEhpZGVTZXBhcmF0b3IoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmZvY3VzZWQgJiYgdGhpcy5lbXB0eTtcbiAgfVxuXG4gIF9nZXRBcmlhTGFiZWxsZWRieSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmZvcm1GaWVsZD8ubGFiZWxJZCBhcyBzdHJpbmc7XG4gIH1cblxuICBfdXBkYXRlRm9jdXMob3JpZ2luOiBGb2N1c09yaWdpbik6IHZvaWQge1xuICAgIHRoaXMuX2ZvY3VzZWQgPSBvcmlnaW4gIT09IG51bGw7XG4gICAgdGhpcy5zdGF0ZUNoYW5nZXMubmV4dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfcmV2YWxpZGF0ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fc3RhcnRJbnB1dCkge1xuICAgICAgdGhpcy5fc3RhcnRJbnB1dC5fdmFsaWRhdG9yT25DaGFuZ2UoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZW5kSW5wdXQpIHtcbiAgICAgIHRoaXMuX2VuZElucHV0Ll92YWxpZGF0b3JPbkNoYW5nZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3JlZ2lzdGVyTW9kZWwobW9kZWw6IFJkc0RhdGVTZWxlY3Rpb25Nb2RlbDxEYXRlUmFuZ2U8RD4+KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3N0YXJ0SW5wdXQpIHtcbiAgICAgIHRoaXMuX3N0YXJ0SW5wdXQuX3JlZ2lzdGVyTW9kZWwobW9kZWwpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9lbmRJbnB1dCkge1xuICAgICAgdGhpcy5fZW5kSW5wdXQuX3JlZ2lzdGVyTW9kZWwobW9kZWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNCb29sZWFuKHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkIHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gZmFsc2U7XG4gIH1cbn1cbiIsIjxkaXZcbiAgY2xhc3M9XCJyZHMtZGF0ZS1yYW5nZS1pbnB1dC1jb250YWluZXJcIlxuICBjZGtNb25pdG9yU3VidHJlZUZvY3VzXG4gIChjZGtGb2N1c0NoYW5nZSk9XCJfdXBkYXRlRm9jdXMoJGV2ZW50KVwiXG4+XG4gIDxkaXYgY2xhc3M9XCJyZHMtZGF0ZS1yYW5nZS1pbnB1dC1zdGFydC13cmFwcGVyXCI+XG4gICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiaW5wdXRbcmRzU3RhcnREYXRlXVwiIC8+XG4gICAgPHNwYW4gY2xhc3M9XCJyZHMtZGF0ZS1yYW5nZS1pbnB1dC1taXJyb3JcIiBhcmlhLWhpZGRlbj1cInRydWVcIj57e1xuICAgICAgX2dldElucHV0TWlycm9yVmFsdWUoKVxuICAgIH19PC9zcGFuPlxuICA8L2Rpdj5cblxuICA8c3BhblxuICAgIGNsYXNzPVwicmRzLWRhdGUtcmFuZ2UtaW5wdXQtc2VwYXJhdG9yXCJcbiAgICBbY2xhc3MucmRzLWRhdGUtcmFuZ2UtaW5wdXQtc2VwYXJhdG9yLWhpZGRlbl09XCJfc2hvdWxkSGlkZVNlcGFyYXRvcigpXCJcbiAgICA+e3sgc2VwYXJhdG9yIH19PC9zcGFuXG4gID5cblxuICA8ZGl2IGNsYXNzPVwicmRzLWRhdGUtcmFuZ2UtaW5wdXQtZW5kLXdyYXBwZXJcIj5cbiAgICA8bmctY29udGVudCBzZWxlY3Q9XCJpbnB1dFtyZHNFbmREYXRlXVwiIC8+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=