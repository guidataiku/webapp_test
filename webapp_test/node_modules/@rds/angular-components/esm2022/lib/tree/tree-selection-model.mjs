import { SelectionModel } from '@angular/cdk/collections';
export class RdsTreeSelectionModel extends SelectionModel {
    constructor(treeControl, getLevel, selectionModelOptions) {
        super(true, selectionModelOptions?.initiallySelectedValues, selectionModelOptions?._emitChanges, selectionModelOptions?.compareWith);
        this.treeControl = treeControl;
        this.getLevel = (node) => node.level;
        if (getLevel) {
            this.getLevel = getLevel;
        }
    }
    descendantsAllSelected(node) {
        const descendants = this.treeControl.getDescendants(node);
        return (descendants.length > 0 &&
            descendants.every((child) => {
                return this.isSelected(child);
            }));
    }
    /**
     * @returns false when all or none selected, otherwise true
     */
    descendantsPartiallySelected(node) {
        return (this.descendantsAnySelected(node) && !this.descendantsAllSelected(node));
    }
    /**
     * @returns true when at least one descendant is selected, otherwise false
     */
    descendantsAnySelected(node) {
        const descendants = this.treeControl.getDescendants(node);
        return descendants.some((child) => this.isSelected(child));
    }
    itemSelectionToggle(node) {
        this.toggle(node);
        const descendants = this.treeControl.getDescendants(node);
        this.isSelected(node)
            ? this.select(...descendants)
            : this.deselect(...descendants);
        // Force update for the parent
        descendants.forEach((child) => this.isSelected(child));
        this.checkAllParentsSelection(node);
    }
    leafItemSelectionToggle(node) {
        this.toggle(node);
        this.checkAllParentsSelection(node);
    }
    checkAllParentsSelection(node) {
        let parent = this.getParentNode(node);
        while (parent) {
            this.checkRootNodeSelection(parent);
            parent = this.getParentNode(parent);
        }
    }
    checkRootNodeSelection(node) {
        const nodeSelected = this.isSelected(node);
        const descendants = this.treeControl.getDescendants(node);
        const descAllSelected = descendants.length > 0 &&
            descendants.every((child) => {
                return this.isSelected(child);
            });
        if (nodeSelected && !descAllSelected) {
            this.deselect(node);
        }
        else if (!nodeSelected && descAllSelected) {
            this.select(node);
        }
    }
    getParentNode(node) {
        const currentLevel = this.getLevel(node);
        if (currentLevel < 1) {
            return null;
        }
        const startIndex = this.treeControl.dataNodes.indexOf(node) - 1;
        for (let i = startIndex; i >= 0; i--) {
            const currentNode = this.treeControl.dataNodes[i];
            if (this.getLevel(currentNode) < currentLevel) {
                return currentNode;
            }
        }
        return null;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1zZWxlY3Rpb24tbW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3RyZWUvdHJlZS1zZWxlY3Rpb24tbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBVTFELE1BQU0sT0FBTyxxQkFHWCxTQUFRLGNBQWlCO0lBQ3pCLFlBQ1UsV0FBaUMsRUFDekMsUUFBdUMsRUFDdkMscUJBQWdEO1FBRWhELEtBQUssQ0FDSCxJQUFJLEVBQ0oscUJBQXFCLEVBQUUsdUJBQXVCLEVBQzlDLHFCQUFxQixFQUFFLFlBQVksRUFDbkMscUJBQXFCLEVBQUUsV0FBVyxDQUNuQyxDQUFDO1FBVE0sZ0JBQVcsR0FBWCxXQUFXLENBQXNCO1FBdUYzQyxhQUFRLEdBQUcsQ0FBQyxJQUFPLEVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUE1RXpDLElBQUksUUFBUSxFQUFFLENBQUM7WUFDYixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUMzQixDQUFDO0lBQ0gsQ0FBQztJQUVELHNCQUFzQixDQUFDLElBQU87UUFDNUIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFMUQsT0FBTyxDQUNMLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUN0QixXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQzFCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoQyxDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsNEJBQTRCLENBQUMsSUFBTztRQUNsQyxPQUFPLENBQ0wsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElB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RUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDckMsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFbEQsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLFlBQVksRUFBRSxDQUFDO2dCQUM5QyxPQUFPLFdBQVcsQ0FBQztZQUNyQixDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmRzVHJlZUNvbnRyb2wgfSBmcm9tICcuL2RhdGEtc291cmNlL3RyZWUtY29udHJvbCc7XG5pbXBvcnQgeyBTZWxlY3Rpb25Nb2RlbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XG5pbXBvcnQgeyBSZHNGbGF0VHJlZU5vZGUgfSBmcm9tICcuL3RyZWUudHlwZXMnO1xuXG5pbnRlcmZhY2UgU2VsZWN0aW9uTW9kZWxPcHRpb25zPFQ+IHtcbiAgLy8gX211bHRpcGxlPzogYm9vbGVhbiBpcyBvbWl0dGVkIG9uIHB1cnBvc2UgYXMgaXQgaGFzIHRvIGJlIHNldCB0byB0cnVlIGFueXdheVxuICBpbml0aWFsbHlTZWxlY3RlZFZhbHVlcz86IFRbXTtcbiAgX2VtaXRDaGFuZ2VzPzogYm9vbGVhbjtcbiAgY29tcGFyZVdpdGg/OiAobzE6IFQsIG8yOiBUKSA9PiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgUmRzVHJlZVNlbGVjdGlvbk1vZGVsPFxuICBUIGV4dGVuZHMgeyBsZXZlbDogbnVtYmVyIH0gPSBSZHNGbGF0VHJlZU5vZGUsXG4gIEsgPSBULFxuPiBleHRlbmRzIFNlbGVjdGlvbk1vZGVsPFQ+IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0cmVlQ29udHJvbDogUmRzVHJlZUNvbnRyb2w8VCwgSz4sXG4gICAgZ2V0TGV2ZWw/OiAoKG5vZGU6IFQpID0+IG51bWJlcikgfCBudWxsLFxuICAgIHNlbGVjdGlvbk1vZGVsT3B0aW9ucz86IFNlbGVjdGlvbk1vZGVsT3B0aW9uczxUPixcbiAgKSB7XG4gICAgc3VwZXIoXG4gICAgICB0cnVlLFxuICAgICAgc2VsZWN0aW9uTW9kZWxPcHRpb25zPy5pbml0aWFsbHlTZWxlY3RlZFZhbHVlcyxcbiAgICAgIHNlbGVjdGlvbk1vZGVsT3B0aW9ucz8uX2VtaXRDaGFuZ2VzLFxuICAgICAgc2VsZWN0aW9uTW9kZWxPcHRpb25zPy5jb21wYXJlV2l0aCxcbiAgICApO1xuXG4gICAgaWYgKGdldExldmVsKSB7XG4gICAgICB0aGlzLmdldExldmVsID0gZ2V0TGV2ZWw7XG4gICAgfVxuICB9XG5cbiAgZGVzY2VuZGFudHNBbGxTZWxlY3RlZChub2RlOiBUKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGVzY2VuZGFudHMgPSB0aGlzLnRyZWVDb250cm9sLmdldERlc2NlbmRhbnRzKG5vZGUpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIGRlc2NlbmRhbnRzLmxlbmd0aCA+IDAgJiZcbiAgICAgIGRlc2NlbmRhbnRzLmV2ZXJ5KChjaGlsZCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1NlbGVjdGVkKGNoaWxkKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyBmYWxzZSB3aGVuIGFsbCBvciBub25lIHNlbGVjdGVkLCBvdGhlcndpc2UgdHJ1ZVxuICAgKi9cbiAgZGVzY2VuZGFudHNQYXJ0aWFsbHlTZWxlY3RlZChub2RlOiBUKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuZGVzY2VuZGFudHNBbnlTZWxlY3RlZChub2RlKSAmJiAhdGhpcy5kZXNjZW5kYW50c0FsbFNlbGVjdGVkKG5vZGUpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyB0cnVlIHdoZW4gYXQgbGVhc3Qgb25lIGRlc2NlbmRhbnQgaXMgc2VsZWN0ZWQsIG90aGVyd2lzZSBmYWxzZVxuICAgKi9cbiAgZGVzY2VuZGFudHNBbnlTZWxlY3RlZChub2RlOiBUKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGVzY2VuZGFudHMgPSB0aGlzLnRyZWVDb250cm9sLmdldERlc2NlbmRhbnRzKG5vZGUpO1xuXG4gICAgcmV0dXJuIGRlc2NlbmRhbnRzLnNvbWUoKGNoaWxkKSA9PiB0aGlzLmlzU2VsZWN0ZWQoY2hpbGQpKTtcbiAgfVxuXG4gIGl0ZW1TZWxlY3Rpb25Ub2dnbGUobm9kZTogVCk6IHZvaWQge1xuICAgIHRoaXMudG9nZ2xlKG5vZGUpO1xuICAgIGNvbnN0IGRlc2NlbmRhbnRzID0gdGhpcy50cmVlQ29udHJvbC5nZXREZXNjZW5kYW50cyhub2RlKTtcbiAgICB0aGlzLmlzU2VsZWN0ZWQobm9kZSlcbiAgICAgID8gdGhpcy5zZWxlY3QoLi4uZGVzY2VuZGFudHMpXG4gICAgICA6IHRoaXMuZGVzZWxlY3QoLi4uZGVzY2VuZGFudHMpO1xuXG4gICAgLy8gRm9yY2UgdXBkYXRlIGZvciB0aGUgcGFyZW50XG4gICAgZGVzY2VuZGFudHMuZm9yRWFjaCgoY2hpbGQpID0+IHRoaXMuaXNTZWxlY3RlZChjaGlsZCkpO1xuICAgIHRoaXMuY2hlY2tBbGxQYXJlbnRzU2VsZWN0aW9uKG5vZGUpO1xuICB9XG5cbiAgbGVhZkl0ZW1TZWxlY3Rpb25Ub2dnbGUobm9kZTogVCk6IHZvaWQge1xuICAgIHRoaXMudG9nZ2xlKG5vZGUpO1xuICAgIHRoaXMuY2hlY2tBbGxQYXJlbnRzU2VsZWN0aW9uKG5vZGUpO1xuICB9XG5cbiAgY2hlY2tBbGxQYXJlbnRzU2VsZWN0aW9uKG5vZGU6IFQpOiB2b2lkIHtcbiAgICBsZXQgcGFyZW50ID0gdGhpcy5nZXRQYXJlbnROb2RlKG5vZGUpO1xuXG4gICAgd2hpbGUgKHBhcmVudCkge1xuICAgICAgdGhpcy5jaGVja1Jvb3ROb2RlU2VsZWN0aW9uKHBhcmVudCk7XG4gICAgICBwYXJlbnQgPSB0aGlzLmdldFBhcmVudE5vZGUocGFyZW50KTtcbiAgICB9XG4gIH1cblxuICBjaGVja1Jvb3ROb2RlU2VsZWN0aW9uKG5vZGU6IFQpOiB2b2lkIHtcbiAgICBjb25zdCBub2RlU2VsZWN0ZWQgPSB0aGlzLmlzU2VsZWN0ZWQobm9kZSk7XG4gICAgY29uc3QgZGVzY2VuZGFudHMgPSB0aGlzLnRyZWVDb250cm9sLmdldERlc2NlbmRhbnRzKG5vZGUpO1xuICAgIGNvbnN0IGRlc2NBbGxTZWxlY3RlZCA9XG4gICAgICBkZXNjZW5kYW50cy5sZW5ndGggPiAwICYmXG4gICAgICBkZXNjZW5kYW50cy5ldmVyeSgoY2hpbGQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTZWxlY3RlZChjaGlsZCk7XG4gICAgICB9KTtcblxuICAgIGlmIChub2RlU2VsZWN0ZWQgJiYgIWRlc2NBbGxTZWxlY3RlZCkge1xuICAgICAgdGhpcy5kZXNlbGVjdChub2RlKTtcbiAgICB9IGVsc2UgaWYgKCFub2RlU2VsZWN0ZWQgJiYgZGVzY0FsbFNlbGVjdGVkKSB7XG4gICAgICB0aGlzLnNlbGVjdChub2RlKTtcbiAgICB9XG4gIH1cblxuICBnZXRMZXZlbCA9IChub2RlOiBUKTogbnVtYmVyID0+IG5vZGUubGV2ZWw7XG5cbiAgZ2V0UGFyZW50Tm9kZShub2RlOiBUKTogVCB8IG51bGwge1xuICAgIGNvbnN0IGN1cnJlbnRMZXZlbCA9IHRoaXMuZ2V0TGV2ZWwobm9kZSk7XG5cbiAgICBpZiAoY3VycmVudExldmVsIDwgMSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IHRoaXMudHJlZUNvbnRyb2wuZGF0YU5vZGVzLmluZGV4T2Yobm9kZSkgLSAxO1xuXG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBjdXJyZW50Tm9kZSA9IHRoaXMudHJlZUNvbnRyb2wuZGF0YU5vZGVzW2ldO1xuXG4gICAgICBpZiAodGhpcy5nZXRMZXZlbChjdXJyZW50Tm9kZSkgPCBjdXJyZW50TGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXX0=