import { booleanAttribute, ChangeDetectionStrategy, Component, EventEmitter, inject, Input, numberAttribute, Output, } from '@angular/core';
import { RdsPaginatorIntl } from '../paginator-intl';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../../icons/icon.component";
import * as i3 from "../../tooltip/tooltip.directive";
import * as i4 from "../../button/icon-button.component";
export class RdsPaginatorBasicComponent {
    constructor() {
        this.intl = inject(RdsPaginatorIntl);
        this.disabled = false;
        this.showButtons = true;
        this.page = 1;
        this.pageChange = new EventEmitter();
        this.pageCount = 0;
        this.pages = [];
    }
    hasPrevious() {
        return this.page > 1;
    }
    hasNext() {
        return this.page < this.pageCount;
    }
    selectFirstPage() {
        this._updatePages(1);
    }
    selectPreviousPage() {
        if (!this.isPreviousDisabled()) {
            this._updatePages(this.page - 1);
        }
    }
    selectPage(pageNumber) {
        this._updatePages(pageNumber);
    }
    selectNextPage() {
        if (!this.isNextDisabled()) {
            this._updatePages(this.page + 1);
        }
    }
    selectLastPage() {
        this._updatePages(this.pageCount);
    }
    ngOnChanges() {
        this._updatePages(this.page);
    }
    isNextDisabled() {
        return !this.hasNext() || this.disabled;
    }
    isPreviousDisabled() {
        return !this.hasPrevious() || this.disabled;
    }
    isEllipsis(pageNumber) {
        return pageNumber === -1;
    }
    _applyEllipses(start, end) {
        if (start > 0) {
            if (start > 2) {
                this.pages.unshift(-1);
            }
            else if (start === 2) {
                this.pages.unshift(2);
            }
            this.pages.unshift(1);
        }
        if (end < this.pageCount) {
            if (end < this.pageCount - 2) {
                this.pages.push(-1);
            }
            else if (end === this.pageCount - 2) {
                this.pages.push(this.pageCount - 1);
            }
            this.pages.push(this.pageCount);
        }
    }
    _setPageInRange(newPageNo) {
        const prevPageNo = this.page;
        this.page = this._getValueInRange(newPageNo, this.pageCount, 1);
        if (this.page !== prevPageNo && this._isNumber(this.collectionSize)) {
            this.pageChange.emit({
                previousPageIndex: prevPageNo - 1,
                pageIndex: this.page - 1,
            });
        }
    }
    _updatePages(newPage) {
        this.pageCount = Math.ceil(this.collectionSize / this.pageSize);
        if (!this._isNumber(this.pageCount)) {
            this.pageCount = 0;
        }
        this.pages = [];
        for (let i = 1; i <= this.pageCount; i++) {
            this.pages.push(i);
        }
        this._setPageInRange(newPage);
        if (this.maxSize > 0 && this.pageCount > this.maxSize) {
            const [start, end] = this._applyRotation();
            this.pages = this.pages.slice(start, end);
            this._applyEllipses(start, end);
        }
    }
    _getValueInRange(value, max, min = 0) {
        return Math.max(Math.min(value, max), min);
    }
    _applyRotation() {
        let start = 0;
        let end = this.pageCount;
        const leftOffset = Math.floor(this.maxSize / 2);
        const rightOffset = this.maxSize % 2 === 0 ? leftOffset - 1 : leftOffset;
        if (this.page <= leftOffset) {
            end = this.maxSize;
        }
        else if (this.pageCount - this.page < leftOffset) {
            start = this.pageCount - this.maxSize;
        }
        else {
            start = this.page - leftOffset - 1;
            end = this.page + rightOffset;
        }
        return [start, end];
    }
    _isNumber(value) {
        return !isNaN(this._toInteger(value));
    }
    _toInteger(value) {
        return parseInt(`${value}`, 10);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsPaginatorBasicComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsPaginatorBasicComponent, selector: "rds-paginator-basic", inputs: { disabled: ["disabled", "disabled", booleanAttribute], showButtons: ["showButtons", "showButtons", booleanAttribute], collectionSize: ["collectionSize", "collectionSize", numberAttribute], maxSize: ["maxSize", "maxSize", numberAttribute], page: ["page", "page", numberAttribute], pageSize: ["pageSize", "pageSize", numberAttribute] }, outputs: { pageChange: "pageChange" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"rds-basic-paginator\">\n  @if (showButtons) {\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isPreviousDisabled(),\n        icon: 'first_page',\n        btnClass: 'rds-paginator-navigation-first',\n        tooltipText: intl.firstPageLabel,\n        click: selectFirstPage.bind(this)\n      }\"\n    />\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isPreviousDisabled(),\n        icon: 'chevron_left',\n        btnClass: 'rds-paginator-navigation-previous',\n        tooltipText: intl.previousPageLabel,\n        click: selectPreviousPage.bind(this)\n      }\"\n    />\n  }\n  @for (pageNumber of pages; track pageNumber) {\n    <div\n      class=\"rds-page-item\"\n      [class.active]=\"pageNumber === page\"\n      [class.disabled]=\"isEllipsis(pageNumber) || disabled\"\n      [attr.aria-current]=\"pageNumber === page ? 'page' : null\"\n    >\n      @if (!isEllipsis(pageNumber)) {\n        <div\n          class=\"rds-page-link\"\n          [attr.tabindex]=\"disabled ? '-1' : null\"\n          [attr.aria-disabled]=\"disabled ? 'true' : null\"\n          (click)=\"selectPage(pageNumber); $event.preventDefault()\"\n        >\n          <button\n            type=\"button\"\n            class=\"rds-paginator-page-button rds-button--text\"\n          >\n            {{ pageNumber }}\n          </button>\n        </div>\n      } @else {\n        <div\n          class=\"rds-page-link rds-paginator-ellipsis\"\n          tabindex=\"-1\"\n          aria-disabled=\"true\"\n        >\n          ...\n        </div>\n      }\n    </div>\n  }\n  @if (showButtons) {\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isNextDisabled(),\n        icon: 'chevron_right',\n        btnClass: 'rds-paginator-navigation-next',\n        tooltipText: intl.nextPageLabel,\n        click: selectNextPage.bind(this)\n      }\"\n    />\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isNextDisabled(),\n        icon: 'last_page',\n        btnClass: 'rds-paginator-navigation-last',\n        tooltipText: intl.lastPageLabel,\n        click: selectLastPage.bind(this)\n      }\"\n    />\n  }\n</div>\n\n<ng-template\n  #arrow\n  let-disabled=\"disabled\"\n  let-icon=\"icon\"\n  let-btnClass=\"btnClass\"\n  let-tooltipText=\"tooltipText\"\n  let-click=\"click\"\n>\n  <div class=\"rds-page-item\" [class.disabled]=\"disabled\">\n    <div\n      class=\"rds-page-link\"\n      [attr.tabindex]=\"disabled ? '-1' : null\"\n      [attr.aria-disabled]=\"disabled ? 'true' : null\"\n    >\n      <button\n        rds-icon-button\n        type=\"button\"\n        size=\"m\"\n        [class]=\"btnClass\"\n        [attr.aria-label]=\"tooltipText\"\n        [rdsTooltip]=\"tooltipText\"\n        [rdsTooltipDisabled]=\"disabled\"\n        rdsTooltipPosition=\"top-center\"\n        [rdsTooltipShowDelay]=\"500\"\n        rdsTooltipHideArrow\n        [disabled]=\"disabled\"\n        (click)=\"click(); $event.preventDefault()\"\n      >\n        <rds-icon [icon]=\"icon\" namespace=\"outlined\" />\n      </button>\n    </div>\n  </div>\n</ng-template>\n", styles: [".rds-basic-paginator{display:flex;gap:8px}.rds-page-item{display:flex;align-items:center;justify-content:center}.rds-page-item .rds-paginator-page-button{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;cursor:pointer;color:var(--rds-color-high-contrast);background:none;border:none;height:40px;min-width:40px;border-radius:2px}.rds-page-item .rds-paginator-page-button:hover{background-color:var(--rds-color-bg-transparent-hover-select)}.rds-page-item .rds-paginator-page-button:focus-visible{outline:2px solid var(--rds-color-stroke-active-focus)}.rds-page-item .rds-paginator-page-button:active{background-color:var(--rds-color-bg-transparent-pressed)}.rds-page-item.active .rds-paginator-page-button{color:var(--rds-color-bg-base-1);background:var(--rds-color-bg-informative-hover)}.rds-page-item .rds-paginator-navigation-first,.rds-page-item .rds-paginator-navigation-previous,.rds-page-item .rds-paginator-navigation-next,.rds-page-item .rds-paginator-navigation-last{height:40px;min-width:40px}.rds-page-link{display:flex}.rds-page-link.rds-paginator-ellipsis.rds-paginator-ellipsis{justify-content:space-around;align-items:center;height:40px;min-width:40px}.rds-page-link .rds-paginator-page-button:before,.rds-page-link .rds-paginator-page-button:after{inset:1px -6px -6px 2px;height:40px;width:40px}.rds-page-link .rds-button.rds-button--icon.rds-button-m:before,.rds-page-link .rds-button.rds-button--icon.rds-button-m:after{inset:0 -6px -6px 0;height:40px;width:40px}\n"], dependencies: [{ kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i2.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "directive", type: i3.RdsTooltipDirective, selector: "[rdsTooltip], [rds-tooltip]", inputs: ["rdsTooltipAriaDescription", "rdsTooltipShowDelay", "rdsTooltipHideDelay", "rdsTooltipHideArrow", "rdsTooltipTouchGestures", "rdsTooltipPosition", "rdsTooltipDisabled", "rdsTooltip", "rdsTooltipClass"], exportAs: ["rdsTooltip"] }, { kind: "component", type: i4.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsPaginatorBasicComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-paginator-basic', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"rds-basic-paginator\">\n  @if (showButtons) {\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isPreviousDisabled(),\n        icon: 'first_page',\n        btnClass: 'rds-paginator-navigation-first',\n        tooltipText: intl.firstPageLabel,\n        click: selectFirstPage.bind(this)\n      }\"\n    />\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isPreviousDisabled(),\n        icon: 'chevron_left',\n        btnClass: 'rds-paginator-navigation-previous',\n        tooltipText: intl.previousPageLabel,\n        click: selectPreviousPage.bind(this)\n      }\"\n    />\n  }\n  @for (pageNumber of pages; track pageNumber) {\n    <div\n      class=\"rds-page-item\"\n      [class.active]=\"pageNumber === page\"\n      [class.disabled]=\"isEllipsis(pageNumber) || disabled\"\n      [attr.aria-current]=\"pageNumber === page ? 'page' : null\"\n    >\n      @if (!isEllipsis(pageNumber)) {\n        <div\n          class=\"rds-page-link\"\n          [attr.tabindex]=\"disabled ? '-1' : null\"\n          [attr.aria-disabled]=\"disabled ? 'true' : null\"\n          (click)=\"selectPage(pageNumber); $event.preventDefault()\"\n        >\n          <button\n            type=\"button\"\n            class=\"rds-paginator-page-button rds-button--text\"\n          >\n            {{ pageNumber }}\n          </button>\n        </div>\n      } @else {\n        <div\n          class=\"rds-page-link rds-paginator-ellipsis\"\n          tabindex=\"-1\"\n          aria-disabled=\"true\"\n        >\n          ...\n        </div>\n      }\n    </div>\n  }\n  @if (showButtons) {\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isNextDisabled(),\n        icon: 'chevron_right',\n        btnClass: 'rds-paginator-navigation-next',\n        tooltipText: intl.nextPageLabel,\n        click: selectNextPage.bind(this)\n      }\"\n    />\n    <ng-container\n      [ngTemplateOutlet]=\"arrow\"\n      [ngTemplateOutletContext]=\"{\n        disabled: isNextDisabled(),\n        icon: 'last_page',\n        btnClass: 'rds-paginator-navigation-last',\n        tooltipText: intl.lastPageLabel,\n        click: selectLastPage.bind(this)\n      }\"\n    />\n  }\n</div>\n\n<ng-template\n  #arrow\n  let-disabled=\"disabled\"\n  let-icon=\"icon\"\n  let-btnClass=\"btnClass\"\n  let-tooltipText=\"tooltipText\"\n  let-click=\"click\"\n>\n  <div class=\"rds-page-item\" [class.disabled]=\"disabled\">\n    <div\n      class=\"rds-page-link\"\n      [attr.tabindex]=\"disabled ? '-1' : null\"\n      [attr.aria-disabled]=\"disabled ? 'true' : null\"\n    >\n      <button\n        rds-icon-button\n        type=\"button\"\n        size=\"m\"\n        [class]=\"btnClass\"\n        [attr.aria-label]=\"tooltipText\"\n        [rdsTooltip]=\"tooltipText\"\n        [rdsTooltipDisabled]=\"disabled\"\n        rdsTooltipPosition=\"top-center\"\n        [rdsTooltipShowDelay]=\"500\"\n        rdsTooltipHideArrow\n        [disabled]=\"disabled\"\n        (click)=\"click(); $event.preventDefault()\"\n      >\n        <rds-icon [icon]=\"icon\" namespace=\"outlined\" />\n      </button>\n    </div>\n  </div>\n</ng-template>\n", styles: [".rds-basic-paginator{display:flex;gap:8px}.rds-page-item{display:flex;align-items:center;justify-content:center}.rds-page-item .rds-paginator-page-button{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;cursor:pointer;color:var(--rds-color-high-contrast);background:none;border:none;height:40px;min-width:40px;border-radius:2px}.rds-page-item .rds-paginator-page-button:hover{background-color:var(--rds-color-bg-transparent-hover-select)}.rds-page-item .rds-paginator-page-button:focus-visible{outline:2px solid var(--rds-color-stroke-active-focus)}.rds-page-item .rds-paginator-page-button:active{background-color:var(--rds-color-bg-transparent-pressed)}.rds-page-item.active .rds-paginator-page-button{color:var(--rds-color-bg-base-1);background:var(--rds-color-bg-informative-hover)}.rds-page-item .rds-paginator-navigation-first,.rds-page-item .rds-paginator-navigation-previous,.rds-page-item .rds-paginator-navigation-next,.rds-page-item .rds-paginator-navigation-last{height:40px;min-width:40px}.rds-page-link{display:flex}.rds-page-link.rds-paginator-ellipsis.rds-paginator-ellipsis{justify-content:space-around;align-items:center;height:40px;min-width:40px}.rds-page-link .rds-paginator-page-button:before,.rds-page-link .rds-paginator-page-button:after{inset:1px -6px -6px 2px;height:40px;width:40px}.rds-page-link .rds-button.rds-button--icon.rds-button-m:before,.rds-page-link .rds-button.rds-button--icon.rds-button-m:after{inset:0 -6px -6px 0;height:40px;width:40px}\n"] }]
        }], propDecorators: { disabled: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], showButtons: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], collectionSize: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], maxSize: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], page: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], pageSize: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], pageChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdG9yLWJhc2ljLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvcGFnaW5hdG9yL3BhZ2luYXRvci1iYXNpYy9wYWdpbmF0b3ItYmFzaWMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLWNvbXBvbmVudHMvc3JjL2xpYi9wYWdpbmF0b3IvcGFnaW5hdG9yLWJhc2ljL3BhZ2luYXRvci1iYXNpYy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBQ0wsZUFBZSxFQUVmLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7O0FBYXJELE1BQU0sT0FBTywwQkFBMEI7SUFOdkM7UUFPcUIsU0FBSSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRVgsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUdwQixTQUFJLEdBQUcsQ0FBQyxDQUFDO1FBR3RDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBc0IsQ0FBQztRQUVwRCxjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsVUFBSyxHQUFhLEVBQUUsQ0FBQztLQXVJaEM7SUFySUMsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVELE9BQU87UUFDTCxPQUFPLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsZUFBZTtRQUNiLElBQUksQ0FBQyxZQUFZLENB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QUUsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7OEdBbkpVLDBCQUEwQjtrR0FBMUIsMEJBQTBCLGdGQUdqQixnQkFBZ0IsK0NBQ2hCLGdCQUFnQix3REFDaEIsZUFBZSxtQ0FDZixlQUFlLDBCQUNmLGVBQWUsc0NBQ2YsZUFBZSx5RkNoQ3JDLG11R0FnSEE7OzJGRHhGYSwwQkFBMEI7a0JBTnRDLFNBQVM7K0JBQ0UscUJBQXFCLG1CQUNkLHVCQUF1QixDQUFDLE1BQU07OEJBT1AsUUFBUTtzQkFBL0MsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFDRSxXQUFXO3NCQUFsRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUNDLGNBQWM7c0JBQXBELEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO2dCQUNFLE9BQU87c0JBQTdDLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO2dCQUNFLElBQUk7c0JBQTFDLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO2dCQUNFLFFBQVE7c0JBQTlDLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO2dCQUUzQixVQUFVO3NCQUFuQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgYm9vbGVhbkF0dHJpYnV0ZSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBpbmplY3QsXG4gIElucHV0LFxuICBudW1iZXJBdHRyaWJ1dGUsXG4gIE9uQ2hhbmdlcyxcbiAgT3V0cHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJkc1BhZ2luYXRvckludGwgfSBmcm9tICcuLi9wYWdpbmF0b3ItaW50bCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmRzUGFnZUNoYW5nZUV2ZW50IHtcbiAgcHJldmlvdXNQYWdlSW5kZXg6IG51bWJlcjtcbiAgcGFnZUluZGV4OiBudW1iZXI7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1wYWdpbmF0b3ItYmFzaWMnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgdGVtcGxhdGVVcmw6ICcuL3BhZ2luYXRvci1iYXNpYy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3BhZ2luYXRvci1iYXNpYy5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNQYWdpbmF0b3JCYXNpY0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIHByb3RlY3RlZCByZWFkb25seSBpbnRsID0gaW5qZWN0KFJkc1BhZ2luYXRvckludGwpO1xuXG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBkaXNhYmxlZCA9IGZhbHNlO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSkgc2hvd0J1dHRvbnMgPSB0cnVlO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KSBjb2xsZWN0aW9uU2l6ZTogbnVtYmVyO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KSBtYXhTaXplOiBudW1iZXI7XG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogbnVtYmVyQXR0cmlidXRlIH0pIHBhZ2UgPSAxO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KSBwYWdlU2l6ZTogbnVtYmVyO1xuXG4gIEBPdXRwdXQoKSBwYWdlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxSZHNQYWdlQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgcHJvdGVjdGVkIHBhZ2VDb3VudCA9IDA7XG4gIHByb3RlY3RlZCBwYWdlczogbnVtYmVyW10gPSBbXTtcblxuICBoYXNQcmV2aW91cygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wYWdlID4gMTtcbiAgfVxuXG4gIGhhc05leHQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGFnZSA8IHRoaXMucGFnZUNvdW50O1xuICB9XG5cbiAgc2VsZWN0Rmlyc3RQYWdlKCk6IHZvaWQge1xuICAgIHRoaXMuX3VwZGF0ZVBhZ2VzKDEpO1xuICB9XG5cbiAgc2VsZWN0UHJldmlvdXNQYWdlKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc1ByZXZpb3VzRGlzYWJsZWQoKSkge1xuICAgICAgdGhpcy5fdXBkYXRlUGFnZXModGhpcy5wYWdlIC0gMSk7XG4gICAgfVxuICB9XG5cbiAgc2VsZWN0UGFnZShwYWdlTnVtYmVyOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLl91cGRhdGVQYWdlcyhwYWdlTnVtYmVyKTtcbiAgfVxuXG4gIHNlbGVjdE5leHRQYWdlKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc05leHREaXNhYmxlZCgpKSB7XG4gICAgICB0aGlzLl91cGRhdGVQYWdlcyh0aGlzLnBhZ2UgKyAxKTtcbiAgICB9XG4gIH1cblxuICBzZWxlY3RMYXN0UGFnZSgpOiB2b2lkIHtcbiAgICB0aGlzLl91cGRhdGVQYWdlcyh0aGlzLnBhZ2VDb3VudCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLl91cGRhdGVQYWdlcyh0aGlzLnBhZ2UpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGlzTmV4dERpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5oYXNOZXh0KCkgfHwgdGhpcy5kaXNhYmxlZDtcbiAgfVxuXG4gIHByb3RlY3RlZCBpc1ByZXZpb3VzRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmhhc1ByZXZpb3VzKCkgfHwgdGhpcy5kaXNhYmxlZDtcbiAgfVxuXG4gIHByb3RlY3RlZCBpc0VsbGlwc2lzKHBhZ2VOdW1iZXI6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBwYWdlTnVtYmVyID09PSAtMTtcbiAgfVxuXG4gIHByaXZhdGUgX2FwcGx5RWxsaXBzZXMoc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoc3RhcnQgPiAwKSB7XG4gICAgICBpZiAoc3RhcnQgPiAyKSB7XG4gICAgICAgIHRoaXMucGFnZXMudW5zaGlmdCgtMSk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXJ0ID09PSAyKSB7XG4gICAgICAgIHRoaXMucGFnZXMudW5zaGlmdCgyKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wYWdlcy51bnNoaWZ0KDEpO1xuICAgIH1cblxuICAgIGlmIChlbmQgPCB0aGlzLnBhZ2VDb3VudCkge1xuICAgICAgaWYgKGVuZCA8IHRoaXMucGFnZUNvdW50IC0gMikge1xuICAgICAgICB0aGlzLnBhZ2VzLnB1c2goLTEpO1xuICAgICAgfSBlbHNlIGlmIChlbmQgPT09IHRoaXMucGFnZUNvdW50IC0gMikge1xuICAgICAgICB0aGlzLnBhZ2VzLnB1c2godGhpcy5wYWdlQ291bnQgLSAxKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wYWdlcy5wdXNoKHRoaXMucGFnZUNvdW50KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9zZXRQYWdlSW5SYW5nZShuZXdQYWdlTm86IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHByZXZQYWdlTm8gPSB0aGlzLnBhZ2U7XG4gICAgdGhpcy5wYWdlID0gdGhpcy5fZ2V0VmFsdWVJblJhbmdlKG5ld1BhZ2VObywgdGhpcy5wYWdlQ291bnQsIDEpO1xuXG4gICAgaWYgKHRoaXMucGFnZSAhPT0gcHJldlBhZ2VObyAmJiB0aGlzLl9pc051bWJlcih0aGlzLmNvbGxlY3Rpb25TaXplKSkge1xuICAgICAgdGhpcy5wYWdlQ2hhbmdlLmVtaXQoe1xuICAgICAgICBwcmV2aW91c1BhZ2VJbmRleDogcHJldlBhZ2VObyAtIDEsXG4gICAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlIC0gMSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZVBhZ2VzKG5ld1BhZ2U6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMucGFnZUNvdW50ID0gTWF0aC5jZWlsKHRoaXMuY29sbGVjdGlvblNpemUgLyB0aGlzLnBhZ2VTaXplKTtcblxuICAgIGlmICghdGhpcy5faXNOdW1iZXIodGhpcy5wYWdlQ291bnQpKSB7XG4gICAgICB0aGlzLnBhZ2VDb3VudCA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5wYWdlcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5wYWdlQ291bnQ7IGkrKykge1xuICAgICAgdGhpcy5wYWdlcy5wdXNoKGkpO1xuICAgIH1cblxuICAgIHRoaXMuX3NldFBhZ2VJblJhbmdlKG5ld1BhZ2UpO1xuXG4gICAgaWYgKHRoaXMubWF4U2l6ZSA+IDAgJiYgdGhpcy5wYWdlQ291bnQgPiB0aGlzLm1heFNpemUpIHtcbiAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHRoaXMuX2FwcGx5Um90YXRpb24oKTtcbiAgICAgIHRoaXMucGFnZXMgPSB0aGlzLnBhZ2VzLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgdGhpcy5fYXBwbHlFbGxpcHNlcyhzdGFydCwgZW5kKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9nZXRWYWx1ZUluUmFuZ2UodmFsdWU6IG51bWJlciwgbWF4OiBudW1iZXIsIG1pbiA9IDApOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbih2YWx1ZSwgbWF4KSwgbWluKTtcbiAgfVxuXG4gIHByaXZhdGUgX2FwcGx5Um90YXRpb24oKTogW251bWJlciwgbnVtYmVyXSB7XG4gICAgbGV0IHN0YXJ0ID0gMDtcbiAgICBsZXQgZW5kID0gdGhpcy5wYWdlQ291bnQ7XG4gICAgY29uc3QgbGVmdE9mZnNldCA9IE1hdGguZmxvb3IodGhpcy5tYXhTaXplIC8gMik7XG4gICAgY29uc3QgcmlnaHRPZmZzZXQgPSB0aGlzLm1heFNpemUgJSAyID09PSAwID8gbGVmdE9mZnNldCAtIDEgOiBsZWZ0T2Zmc2V0O1xuXG4gICAgaWYgKHRoaXMucGFnZSA8PSBsZWZ0T2Zmc2V0KSB7XG4gICAgICBlbmQgPSB0aGlzLm1heFNpemU7XG4gICAgfSBlbHNlIGlmICh0aGlzLnBhZ2VDb3VudCAtIHRoaXMucGFnZSA8IGxlZnRPZmZzZXQpIHtcbiAgICAgIHN0YXJ0ID0gdGhpcy5wYWdlQ291bnQgLSB0aGlzLm1heFNpemU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXJ0ID0gdGhpcy5wYWdlIC0gbGVmdE9mZnNldCAtIDE7XG4gICAgICBlbmQgPSB0aGlzLnBhZ2UgKyByaWdodE9mZnNldDtcbiAgICB9XG5cbiAgICByZXR1cm4gW3N0YXJ0LCBlbmRdO1xuICB9XG5cbiAgcHJpdmF0ZSBfaXNOdW1iZXI8VD4odmFsdWU6IFQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIWlzTmFOKHRoaXMuX3RvSW50ZWdlcih2YWx1ZSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdG9JbnRlZ2VyPFQ+KHZhbHVlOiBUKTogbnVtYmVyIHtcbiAgICByZXR1cm4gcGFyc2VJbnQoYCR7dmFsdWV9YCwgMTApO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicmRzLWJhc2ljLXBhZ2luYXRvclwiPlxuICBAaWYgKHNob3dCdXR0b25zKSB7XG4gICAgPG5nLWNvbnRhaW5lclxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiYXJyb3dcIlxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICAgZGlzYWJsZWQ6IGlzUHJldmlvdXNEaXNhYmxlZCgpLFxuICAgICAgICBpY29uOiAnZmlyc3RfcGFnZScsXG4gICAgICAgIGJ0bkNsYXNzOiAncmRzLXBhZ2luYXRvci1uYXZpZ2F0aW9uLWZpcnN0JyxcbiAgICAgICAgdG9vbHRpcFRleHQ6IGludGwuZmlyc3RQYWdlTGFiZWwsXG4gICAgICAgIGNsaWNrOiBzZWxlY3RGaXJzdFBhZ2UuYmluZCh0aGlzKVxuICAgICAgfVwiXG4gICAgLz5cbiAgICA8bmctY29udGFpbmVyXG4gICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJhcnJvd1wiXG4gICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICBkaXNhYmxlZDogaXNQcmV2aW91c0Rpc2FibGVkKCksXG4gICAgICAgIGljb246ICdjaGV2cm9uX2xlZnQnLFxuICAgICAgICBidG5DbGFzczogJ3Jkcy1wYWdpbmF0b3ItbmF2aWdhdGlvbi1wcmV2aW91cycsXG4gICAgICAgIHRvb2x0aXBUZXh0OiBpbnRsLnByZXZpb3VzUGFnZUxhYmVsLFxuICAgICAgICBjbGljazogc2VsZWN0UHJldmlvdXNQYWdlLmJpbmQodGhpcylcbiAgICAgIH1cIlxuICAgIC8+XG4gIH1cbiAgQGZvciAocGFnZU51bWJlciBvZiBwYWdlczsgdHJhY2sgcGFnZU51bWJlcikge1xuICAgIDxkaXZcbiAgICAgIGNsYXNzPVwicmRzLXBhZ2UtaXRlbVwiXG4gICAgICBbY2xhc3MuYWN0aXZlXT1cInBhZ2VOdW1iZXIgPT09IHBhZ2VcIlxuICAgICAgW2NsYXNzLmRpc2FibGVkXT1cImlzRWxsaXBzaXMocGFnZU51bWJlcikgfHwgZGlzYWJsZWRcIlxuICAgICAgW2F0dHIuYXJpYS1jdXJyZW50XT1cInBhZ2VOdW1iZXIgPT09IHBhZ2UgPyAncGFnZScgOiBudWxsXCJcbiAgICA+XG4gICAgICBAaWYgKCFpc0VsbGlwc2lzKHBhZ2VOdW1iZXIpKSB7XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cInJkcy1wYWdlLWxpbmtcIlxuICAgICAgICAgIFthdHRyLnRhYmluZGV4XT1cImRpc2FibGVkID8gJy0xJyA6IG51bGxcIlxuICAgICAgICAgIFthdHRyLmFyaWEtZGlzYWJsZWRdPVwiZGlzYWJsZWQgPyAndHJ1ZScgOiBudWxsXCJcbiAgICAgICAgICAoY2xpY2spPVwic2VsZWN0UGFnZShwYWdlTnVtYmVyKTsgJGV2ZW50LnByZXZlbnREZWZhdWx0KClcIlxuICAgICAgICA+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICBjbGFzcz1cInJkcy1wYWdpbmF0b3ItcGFnZS1idXR0b24gcmRzLWJ1dHRvbi0tdGV4dFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge3sgcGFnZU51bWJlciB9fVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH0gQGVsc2Uge1xuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3M9XCJyZHMtcGFnZS1saW5rIHJkcy1wYWdpbmF0b3ItZWxsaXBzaXNcIlxuICAgICAgICAgIHRhYmluZGV4PVwiLTFcIlxuICAgICAgICAgIGFyaWEtZGlzYWJsZWQ9XCJ0cnVlXCJcbiAgICAgICAgPlxuICAgICAgICAgIC4uLlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgfVxuICBAaWYgKHNob3dCdXR0b25zKSB7XG4gICAgPG5nLWNvbnRhaW5lclxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiYXJyb3dcIlxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICAgZGlzYWJsZWQ6IGlzTmV4dERpc2FibGVkKCksXG4gICAgICAgIGljb246ICdjaGV2cm9uX3JpZ2h0JyxcbiAgICAgICAgYnRuQ2xhc3M6ICdyZHMtcGFnaW5hdG9yLW5hdmlnYXRpb24tbmV4dCcsXG4gICAgICAgIHRvb2x0aXBUZXh0OiBpbnRsLm5leHRQYWdlTGFiZWwsXG4gICAgICAgIGNsaWNrOiBzZWxlY3ROZXh0UGFnZS5iaW5kKHRoaXMpXG4gICAgICB9XCJcbiAgICAvPlxuICAgIDxuZy1jb250YWluZXJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImFycm93XCJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAgIGRpc2FibGVkOiBpc05leHREaXNhYmxlZCgpLFxuICAgICAgICBpY29uOiAnbGFzdF9wYWdlJyxcbiAgICAgICAgYnRuQ2xhc3M6ICdyZHMtcGFnaW5hdG9yLW5hdmlnYXRpb24tbGFzdCcsXG4gICAgICAgIHRvb2x0aXBUZXh0OiBpbnRsLmxhc3RQYWdlTGFiZWwsXG4gICAgICAgIGNsaWNrOiBzZWxlY3RMYXN0UGFnZS5iaW5kKHRoaXMpXG4gICAgICB9XCJcbiAgICAvPlxuICB9XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlXG4gICNhcnJvd1xuICBsZXQtZGlzYWJsZWQ9XCJkaXNhYmxlZFwiXG4gIGxldC1pY29uPVwiaWNvblwiXG4gIGxldC1idG5DbGFzcz1cImJ0bkNsYXNzXCJcbiAgbGV0LXRvb2x0aXBUZXh0PVwidG9vbHRpcFRleHRcIlxuICBsZXQtY2xpY2s9XCJjbGlja1wiXG4+XG4gIDxkaXYgY2xhc3M9XCJyZHMtcGFnZS1pdGVtXCIgW2NsYXNzLmRpc2FibGVkXT1cImRpc2FibGVkXCI+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJyZHMtcGFnZS1saW5rXCJcbiAgICAgIFthdHRyLnRhYmluZGV4XT1cImRpc2FibGVkID8gJy0xJyA6IG51bGxcIlxuICAgICAgW2F0dHIuYXJpYS1kaXNhYmxlZF09XCJkaXNhYmxlZCA/ICd0cnVlJyA6IG51bGxcIlxuICAgID5cbiAgICAgIDxidXR0b25cbiAgICAgICAgcmRzLWljb24tYnV0dG9uXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBzaXplPVwibVwiXG4gICAgICAgIFtjbGFzc109XCJidG5DbGFzc1wiXG4gICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwidG9vbHRpcFRleHRcIlxuICAgICAgICBbcmRzVG9vbHRpcF09XCJ0b29sdGlwVGV4dFwiXG4gICAgICAgIFtyZHNUb29sdGlwRGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgICByZHNUb29sdGlwUG9zaXRpb249XCJ0b3AtY2VudGVyXCJcbiAgICAgICAgW3Jkc1Rvb2x0aXBTaG93RGVsYXldPVwiNTAwXCJcbiAgICAgICAgcmRzVG9vbHRpcEhpZGVBcnJvd1xuICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgICAoY2xpY2spPVwiY2xpY2soKTsgJGV2ZW50LnByZXZlbnREZWZhdWx0KClcIlxuICAgICAgPlxuICAgICAgICA8cmRzLWljb24gW2ljb25dPVwiaWNvblwiIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgLz5cbiAgICAgIDwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=