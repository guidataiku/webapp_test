import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, DestroyRef, EventEmitter, HostBinding, inject, Input, Output, } from '@angular/core';
import { RdsFileItem } from '../file-item.class';
import { RdsUploadIntlService } from '../rds-upload-intl.service';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
import * as i1 from "../../icons/icon.component";
import * as i2 from "../../button/icon-button.component";
import * as i3 from "../../progress-bar/progress-bar.component";
import * as i4 from "@angular/common";
import * as i5 from "../file-size.pipe";
let rdsUploadItemNextId = 0;
export class RdsUploadListItemComponent {
    constructor() {
        this.cdr = inject(ChangeDetectorRef);
        this.destroyRef = inject(DestroyRef);
        this.intl = inject(RdsUploadIntlService);
        this.stateClass = '';
        this.ariaLiveContent = '';
        this.disabled = false;
        this.upload = new EventEmitter();
        this.remove = new EventEmitter();
        this.nameId = `rds-upload-item-${rdsUploadItemNextId++}-name`;
    }
    set size(v) {
        this._size = v;
        this.actionButtonSize = v === 'l' ? 'm' : 's';
    }
    get size() {
        return this._size;
    }
    get classes() {
        return [this.stateClass, `rds-upload-item-size-${this.size}`];
    }
    ngOnInit() {
        this.fileItem.state$
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe((state) => {
            this.stateClass = `rds-upload-item-${state}`;
            this.updateAriaLiveRegion();
            this.cdr.markForCheck();
        });
    }
    updateAriaLiveRegion() {
        if (this.fileItem.hasFailedFilters) {
            // we need to delay the update in case of immediately known errors, like incorrect file type,
            // because otherwise screen readers will miss the difference and won't announce anything
            setTimeout(() => {
                this.ariaLiveContent = this.intl.getFileItemFilterFailedMessage(this.fileItem);
                this.cdr.markForCheck();
            });
            return;
        }
        if (this.fileItem.state === 'success') {
            this.ariaLiveContent = this.intl.getFileItemUploadSuccessMessage(this.fileItem);
        }
        if (this.fileItem.state === 'error') {
            this.ariaLiveContent = this.intl.getFileItemUploadErrorMessage(this.fileItem);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsUploadListItemComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsUploadListItemComponent, selector: "li[rds-upload-list-item], li[rdsUploadListItem]", inputs: { fileItem: "fileItem", disabled: ["disabled", "disabled", booleanAttribute], size: "size" }, outputs: { upload: "upload", remove: "remove" }, host: { properties: { "class": "this.classes", "attr.aria-labelledby": "this.nameId" } }, ngImport: i0, template: "@if (intl.change$ | async; as t) {\n  <div class=\"rds-upload-name-and-actions\">\n    <div class=\"rds-upload-name\" [id]=\"nameId\">{{ fileItem.file.name }}</div>\n    <div class=\"rds-upload-actions\">\n      <ng-content />\n      @if (fileItem.state === 'error') {\n        <rds-icon\n          class=\"rds-upload-status-icon rds-upload-status-icon-error\"\n          namespace=\"outlined\"\n          icon=\"warning_circle\"\n        />\n        @if (!fileItem.hasFailedFilters) {\n          <button\n            rds-icon-button\n            [attr.aria-label]=\"t.retryButtonAriaLabel\"\n            [disabled]=\"disabled\"\n            [size]=\"actionButtonSize\"\n            (click)=\"upload.emit(fileItem)\"\n          >\n            <rds-icon namespace=\"outlined\" icon=\"repeat\" />\n          </button>\n        }\n      }\n      @if (fileItem.state === 'success') {\n        <rds-icon\n          class=\"rds-upload-status-icon rds-upload-status-icon-success\"\n          namespace=\"outlined\"\n          icon=\"checkmark_circle\"\n        />\n      } @else {\n        <button\n          rds-icon-button\n          [attr.aria-label]=\"t.cancelButtonAriaLabel\"\n          [disabled]=\"disabled\"\n          [size]=\"actionButtonSize\"\n          (click)=\"remove.emit(fileItem)\"\n        >\n          <rds-icon namespace=\"outlined\" icon=\"close\" />\n        </button>\n      }\n    </div>\n  </div>\n  @if ({ progress: fileItem.progress$ | async }; as fi) {\n    @if (!fileItem.hasFailedFilters) {\n      <rds-progress-bar\n        [mode]=\"fi.progress === null ? 'indeterminate' : 'determinate'\"\n        [value]=\"fi.progress\"\n      />\n    }\n    <div class=\"rds-upload-size-and-state\">\n      <span class=\"rds-upload-size\">{{\n        fileItem.file.size | rdsFileSize\n      }}</span>\n      {{ fileItem.isUploading || t[fileItem.errorIntlToken] ? '-' : '' }}\n      @if (fileItem.isUploading) {\n        <span>{{ intl.getFileItemProgressMessage(fi.progress) }}</span>\n      }\n      @if (fileItem.errorIntlToken !== 'EMPTY') {\n        <span>{{ t[fileItem.errorIntlToken] }}</span>\n      }\n      <div class=\"sr-only\" aria-live=\"polite\">\n        {{ ariaLiveContent }}\n      </div>\n    </div>\n  }\n}\n", styles: [":host.rds-upload-item-success .rds-progress-bar{--rds-progress-bar-fill-color: var(--rds-color-success)}:host.rds-upload-item-error .rds-progress-bar{--rds-progress-bar-fill-color: var(--rds-color-error)}:host.rds-upload-item-error .rds-upload-size-and-state,:host.rds-upload-item-error .rds-upload-size-and-state>.rds-upload-size{color:var(--rds-color-error)}:host.rds-upload-item-size-s .rds-upload-name-and-actions{font-size:14px;font-weight:400;line-height:20px;text-transform:none;letter-spacing:.3px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-s .rds-upload-name-and-actions .rds-upload-status-icon{width:18px;height:18px}:host.rds-upload-item-size-m .rds-upload-name-and-actions{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-m .rds-upload-name-and-actions .rds-upload-status-icon{width:18px;height:18px}:host.rds-upload-item-size-l .rds-upload-name-and-actions{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-l .rds-upload-name-and-actions .rds-upload-status-icon{width:24px;height:24px}.rds-upload-name-and-actions{display:flex;align-items:center;justify-content:space-between;gap:16px}.rds-upload-name-and-actions .rds-upload-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rds-upload-name-and-actions .rds-upload-actions{display:flex;align-items:center;justify-content:flex-end;gap:16px}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon{display:inline-flex}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon-success{color:var(--rds-color-success)}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon-error{color:var(--rds-color-error)}.rds-progress-bar{margin-block:8px 0}.rds-upload-size-and-state{font-size:12px;font-weight:400;line-height:16px;text-transform:none;letter-spacing:.5px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin-top:4px;color:var(--rds-color-grey-3)}.rds-upload-size-and-state .rds-upload-size{color:var(--rds-color-low-contrast)}\n"], dependencies: [{ kind: "component", type: i1.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }, { kind: "component", type: i3.RdsProgressBarComponent, selector: "rds-progress-bar", inputs: ["value", "bufferValue", "mode"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i5.RdsFileSizePipe, name: "rdsFileSize" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsUploadListItemComponent, decorators: [{
            type: Component,
            args: [{ selector: 'li[rds-upload-list-item], li[rdsUploadListItem]', changeDetection: ChangeDetectionStrategy.OnPush, template: "@if (intl.change$ | async; as t) {\n  <div class=\"rds-upload-name-and-actions\">\n    <div class=\"rds-upload-name\" [id]=\"nameId\">{{ fileItem.file.name }}</div>\n    <div class=\"rds-upload-actions\">\n      <ng-content />\n      @if (fileItem.state === 'error') {\n        <rds-icon\n          class=\"rds-upload-status-icon rds-upload-status-icon-error\"\n          namespace=\"outlined\"\n          icon=\"warning_circle\"\n        />\n        @if (!fileItem.hasFailedFilters) {\n          <button\n            rds-icon-button\n            [attr.aria-label]=\"t.retryButtonAriaLabel\"\n            [disabled]=\"disabled\"\n            [size]=\"actionButtonSize\"\n            (click)=\"upload.emit(fileItem)\"\n          >\n            <rds-icon namespace=\"outlined\" icon=\"repeat\" />\n          </button>\n        }\n      }\n      @if (fileItem.state === 'success') {\n        <rds-icon\n          class=\"rds-upload-status-icon rds-upload-status-icon-success\"\n          namespace=\"outlined\"\n          icon=\"checkmark_circle\"\n        />\n      } @else {\n        <button\n          rds-icon-button\n          [attr.aria-label]=\"t.cancelButtonAriaLabel\"\n          [disabled]=\"disabled\"\n          [size]=\"actionButtonSize\"\n          (click)=\"remove.emit(fileItem)\"\n        >\n          <rds-icon namespace=\"outlined\" icon=\"close\" />\n        </button>\n      }\n    </div>\n  </div>\n  @if ({ progress: fileItem.progress$ | async }; as fi) {\n    @if (!fileItem.hasFailedFilters) {\n      <rds-progress-bar\n        [mode]=\"fi.progress === null ? 'indeterminate' : 'determinate'\"\n        [value]=\"fi.progress\"\n      />\n    }\n    <div class=\"rds-upload-size-and-state\">\n      <span class=\"rds-upload-size\">{{\n        fileItem.file.size | rdsFileSize\n      }}</span>\n      {{ fileItem.isUploading || t[fileItem.errorIntlToken] ? '-' : '' }}\n      @if (fileItem.isUploading) {\n        <span>{{ intl.getFileItemProgressMessage(fi.progress) }}</span>\n      }\n      @if (fileItem.errorIntlToken !== 'EMPTY') {\n        <span>{{ t[fileItem.errorIntlToken] }}</span>\n      }\n      <div class=\"sr-only\" aria-live=\"polite\">\n        {{ ariaLiveContent }}\n      </div>\n    </div>\n  }\n}\n", styles: [":host.rds-upload-item-success .rds-progress-bar{--rds-progress-bar-fill-color: var(--rds-color-success)}:host.rds-upload-item-error .rds-progress-bar{--rds-progress-bar-fill-color: var(--rds-color-error)}:host.rds-upload-item-error .rds-upload-size-and-state,:host.rds-upload-item-error .rds-upload-size-and-state>.rds-upload-size{color:var(--rds-color-error)}:host.rds-upload-item-size-s .rds-upload-name-and-actions{font-size:14px;font-weight:400;line-height:20px;text-transform:none;letter-spacing:.3px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-s .rds-upload-name-and-actions .rds-upload-status-icon{width:18px;height:18px}:host.rds-upload-item-size-m .rds-upload-name-and-actions{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-m .rds-upload-name-and-actions .rds-upload-status-icon{width:18px;height:18px}:host.rds-upload-item-size-l .rds-upload-name-and-actions{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host.rds-upload-item-size-l .rds-upload-name-and-actions .rds-upload-status-icon{width:24px;height:24px}.rds-upload-name-and-actions{display:flex;align-items:center;justify-content:space-between;gap:16px}.rds-upload-name-and-actions .rds-upload-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rds-upload-name-and-actions .rds-upload-actions{display:flex;align-items:center;justify-content:flex-end;gap:16px}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon{display:inline-flex}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon-success{color:var(--rds-color-success)}.rds-upload-name-and-actions .rds-upload-actions .rds-upload-status-icon-error{color:var(--rds-color-error)}.rds-progress-bar{margin-block:8px 0}.rds-upload-size-and-state{font-size:12px;font-weight:400;line-height:16px;text-transform:none;letter-spacing:.5px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin-top:4px;color:var(--rds-color-grey-3)}.rds-upload-size-and-state .rds-upload-size{color:var(--rds-color-low-contrast)}\n"] }]
        }], propDecorators: { fileItem: [{
                type: Input
            }], disabled: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], size: [{
                type: Input
            }], upload: [{
                type: Output
            }], remove: [{
                type: Output
            }], classes: [{
                type: HostBinding,
                args: ['class']
            }], nameId: [{
                type: HostBinding,
                args: ['attr.aria-labelledby']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLWxpc3QtaXRlbS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3VwbG9hZC91cGxvYWQtbGlzdC1pdGVtL3VwbG9hZC1saXN0LWl0ZW0uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLWNvbXBvbmVudHMvc3JjL2xpYi91cGxvYWQvdXBsb2FkLWxpc3QtaXRlbS91cGxvYWQtbGlzdC1pdGVtLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxnQkFBZ0IsRUFDaEIsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsTUFBTSxFQUNOLEtBQUssRUFFTCxNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7Ozs7O0FBRWhFLElBQUksbUJBQW1CLEdBQUcsQ0FBQyxDQUFDO0FBUTVCLE1BQU0sT0FBTywwQkFBMEI7SUFOdkM7UUFPbUIsUUFBRyxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ2hDLGVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDeEMsU0FBSSxHQUFHLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBR3JDLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFHeEIsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFJbUIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQVkvQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQWUsQ0FBQztRQUN6QyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQWUsQ0FBQztRQVFuRCxXQUFNLEdBQUcsbUJBQW1CLG1CQUFtQixFQUFFLE9BQU8sQ0FBQztLQXNDMUQ7SUF6REMsSUFDSSxJQUFJLENBQUMsQ0FBZ0I7UUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7SUFDaEQsQ0FBQztJQUVELElBQUksSUFBSTtRQUNOLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBS0QsSUFDWSxPQUFPO1FBQ2pCLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLHdCQUF3QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBS0QsUUFBUTtRQUNOLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTthQUNqQixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ3pDLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ25CLElBQUksQ0FBQyxVQUFVLEdBQUcsbUJBQW1CLEtBQUssRUFBRSxDQUFDO1lBQzdDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQzVCLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8sb0JBQW9CO1FBQzFCLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ25DLDZGQUE2RjtZQUM3Rix3RkFBd0Y7WUFDeEYsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQzdELElBQUksQ0FBQyxRQUFRLENBQ2QsQ0FBQztnQkFDRixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQzFCLENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTztRQUNULENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FDOUQsSUFBSSxDQUFDLFFBQVEsQ0FDZCxDQUFDO1FBQ0osQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDcEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUM1RCxJQUFJLENBQUMsUUFBUSxDQUNkLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQzs4R0F2RVUsMEJBQTBCO2tHQUExQiwwQkFBMEIsa0lBYWpCLGdCQUFnQixzTEN4Q3RDLGtzRUFrRUE7OzJGRHZDYSwwQkFBMEI7a0JBTnRDLFNBQVM7K0JBQ0UsaURBQWlELG1CQUcxQyx1QkFBdUIsQ0FBQyxNQUFNOzhCQWF0QyxRQUFRO3NCQUFoQixLQUFLO2dCQUVrQyxRQUFRO3NCQUEvQyxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUdsQyxJQUFJO3NCQURQLEtBQUs7Z0JBVUksTUFBTTtzQkFBZixNQUFNO2dCQUNHLE1BQU07c0JBQWYsTUFBTTtnQkFHSyxPQUFPO3NCQURsQixXQUFXO3VCQUFDLE9BQU87Z0JBTXBCLE1BQU07c0JBREwsV0FBVzt1QkFBQyxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBib29sZWFuQXR0cmlidXRlLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRGVzdHJveVJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmRzQnV0dG9uU2l6ZSB9IGZyb20gJy4uLy4uL2J1dHRvbic7XG5pbXBvcnQgeyBSZHNVcGxvYWRTaXplIH0gZnJvbSAnLi4vdXBsb2FkLnR5cGVzJztcbmltcG9ydCB7IFJkc0ZpbGVJdGVtIH0gZnJvbSAnLi4vZmlsZS1pdGVtLmNsYXNzJztcbmltcG9ydCB7IFJkc1VwbG9hZEludGxTZXJ2aWNlIH0gZnJvbSAnLi4vcmRzLXVwbG9hZC1pbnRsLnNlcnZpY2UnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuXG5sZXQgcmRzVXBsb2FkSXRlbU5leHRJZCA9IDA7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2xpW3Jkcy11cGxvYWQtbGlzdC1pdGVtXSwgbGlbcmRzVXBsb2FkTGlzdEl0ZW1dJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3VwbG9hZC1saXN0LWl0ZW0uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi91cGxvYWQtbGlzdC1pdGVtLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNVcGxvYWRMaXN0SXRlbUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkZXN0cm95UmVmID0gaW5qZWN0KERlc3Ryb3lSZWYpO1xuICByZWFkb25seSBpbnRsID0gaW5qZWN0KFJkc1VwbG9hZEludGxTZXJ2aWNlKTtcblxuICBwcml2YXRlIF9zaXplOiBSZHNVcGxvYWRTaXplO1xuICBwcml2YXRlIHN0YXRlQ2xhc3MgPSAnJztcblxuICBhY3Rpb25CdXR0b25TaXplOiBSZHNCdXR0b25TaXplO1xuICBhcmlhTGl2ZUNvbnRlbnQgPSAnJztcblxuICBASW5wdXQoKSBmaWxlSXRlbTogUmRzRmlsZUl0ZW07XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGRpc2FibGVkID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgc2V0IHNpemUodjogUmRzVXBsb2FkU2l6ZSkge1xuICAgIHRoaXMuX3NpemUgPSB2O1xuICAgIHRoaXMuYWN0aW9uQnV0dG9uU2l6ZSA9IHYgPT09ICdsJyA/ICdtJyA6ICdzJztcbiAgfVxuXG4gIGdldCBzaXplKCk6IFJkc1VwbG9hZFNpemUge1xuICAgIHJldHVybiB0aGlzLl9zaXplO1xuICB9XG5cbiAgQE91dHB1dCgpIHVwbG9hZCA9IG5ldyBFdmVudEVtaXR0ZXI8UmRzRmlsZUl0ZW0+KCk7XG4gIEBPdXRwdXQoKSByZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyPFJkc0ZpbGVJdGVtPigpO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxuICBwcml2YXRlIGdldCBjbGFzc2VzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW3RoaXMuc3RhdGVDbGFzcywgYHJkcy11cGxvYWQtaXRlbS1zaXplLSR7dGhpcy5zaXplfWBdO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtbGFiZWxsZWRieScpXG4gIG5hbWVJZCA9IGByZHMtdXBsb2FkLWl0ZW0tJHtyZHNVcGxvYWRJdGVtTmV4dElkKyt9LW5hbWVgO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZmlsZUl0ZW0uc3RhdGUkXG4gICAgICAucGlwZSh0YWtlVW50aWxEZXN0cm95ZWQodGhpcy5kZXN0cm95UmVmKSlcbiAgICAgIC5zdWJzY3JpYmUoKHN0YXRlKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhdGVDbGFzcyA9IGByZHMtdXBsb2FkLWl0ZW0tJHtzdGF0ZX1gO1xuICAgICAgICB0aGlzLnVwZGF0ZUFyaWFMaXZlUmVnaW9uKCk7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUFyaWFMaXZlUmVnaW9uKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmZpbGVJdGVtLmhhc0ZhaWxlZEZpbHRlcnMpIHtcbiAgICAgIC8vIHdlIG5lZWQgdG8gZGVsYXkgdGhlIHVwZGF0ZSBpbiBjYXNlIG9mIGltbWVkaWF0ZWx5IGtub3duIGVycm9ycywgbGlrZSBpbmNvcnJlY3QgZmlsZSB0eXBlLFxuICAgICAgLy8gYmVjYXVzZSBvdGhlcndpc2Ugc2NyZWVuIHJlYWRlcnMgd2lsbCBtaXNzIHRoZSBkaWZmZXJlbmNlIGFuZCB3b24ndCBhbm5vdW5jZSBhbnl0aGluZ1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuYXJpYUxpdmVDb250ZW50ID0gdGhpcy5pbnRsLmdldEZpbGVJdGVtRmlsdGVyRmFpbGVkTWVzc2FnZShcbiAgICAgICAgICB0aGlzLmZpbGVJdGVtLFxuICAgICAgICApO1xuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZmlsZUl0ZW0uc3RhdGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgdGhpcy5hcmlhTGl2ZUNvbnRlbnQgPSB0aGlzLmludGwuZ2V0RmlsZUl0ZW1VcGxvYWRTdWNjZXNzTWVzc2FnZShcbiAgICAgICAgdGhpcy5maWxlSXRlbSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZmlsZUl0ZW0uc3RhdGUgPT09ICdlcnJvcicpIHtcbiAgICAgIHRoaXMuYXJpYUxpdmVDb250ZW50ID0gdGhpcy5pbnRsLmdldEZpbGVJdGVtVXBsb2FkRXJyb3JNZXNzYWdlKFxuICAgICAgICB0aGlzLmZpbGVJdGVtLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiIsIkBpZiAoaW50bC5jaGFuZ2UkIHwgYXN5bmM7IGFzIHQpIHtcbiAgPGRpdiBjbGFzcz1cInJkcy11cGxvYWQtbmFtZS1hbmQtYWN0aW9uc1wiPlxuICAgIDxkaXYgY2xhc3M9XCJyZHMtdXBsb2FkLW5hbWVcIiBbaWRdPVwibmFtZUlkXCI+e3sgZmlsZUl0ZW0uZmlsZS5uYW1lIH19PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJkcy11cGxvYWQtYWN0aW9uc1wiPlxuICAgICAgPG5nLWNvbnRlbnQgLz5cbiAgICAgIEBpZiAoZmlsZUl0ZW0uc3RhdGUgPT09ICdlcnJvcicpIHtcbiAgICAgICAgPHJkcy1pY29uXG4gICAgICAgICAgY2xhc3M9XCJyZHMtdXBsb2FkLXN0YXR1cy1pY29uIHJkcy11cGxvYWQtc3RhdHVzLWljb24tZXJyb3JcIlxuICAgICAgICAgIG5hbWVzcGFjZT1cIm91dGxpbmVkXCJcbiAgICAgICAgICBpY29uPVwid2FybmluZ19jaXJjbGVcIlxuICAgICAgICAvPlxuICAgICAgICBAaWYgKCFmaWxlSXRlbS5oYXNGYWlsZWRGaWx0ZXJzKSB7XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgcmRzLWljb24tYnV0dG9uXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cInQucmV0cnlCdXR0b25BcmlhTGFiZWxcIlxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcbiAgICAgICAgICAgIFtzaXplXT1cImFjdGlvbkJ1dHRvblNpemVcIlxuICAgICAgICAgICAgKGNsaWNrKT1cInVwbG9hZC5lbWl0KGZpbGVJdGVtKVwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgaWNvbj1cInJlcGVhdFwiIC8+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIEBpZiAoZmlsZUl0ZW0uc3RhdGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICA8cmRzLWljb25cbiAgICAgICAgICBjbGFzcz1cInJkcy11cGxvYWQtc3RhdHVzLWljb24gcmRzLXVwbG9hZC1zdGF0dXMtaWNvbi1zdWNjZXNzXCJcbiAgICAgICAgICBuYW1lc3BhY2U9XCJvdXRsaW5lZFwiXG4gICAgICAgICAgaWNvbj1cImNoZWNrbWFya19jaXJjbGVcIlxuICAgICAgICAvPlxuICAgICAgfSBAZWxzZSB7XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICByZHMtaWNvbi1idXR0b25cbiAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cInQuY2FuY2VsQnV0dG9uQXJpYUxhYmVsXCJcbiAgICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgICAgIFtzaXplXT1cImFjdGlvbkJ1dHRvblNpemVcIlxuICAgICAgICAgIChjbGljayk9XCJyZW1vdmUuZW1pdChmaWxlSXRlbSlcIlxuICAgICAgICA+XG4gICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgaWNvbj1cImNsb3NlXCIgLz5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICB9XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICBAaWYgKHsgcHJvZ3Jlc3M6IGZpbGVJdGVtLnByb2dyZXNzJCB8IGFzeW5jIH07IGFzIGZpKSB7XG4gICAgQGlmICghZmlsZUl0ZW0uaGFzRmFpbGVkRmlsdGVycykge1xuICAgICAgPHJkcy1wcm9ncmVzcy1iYXJcbiAgICAgICAgW21vZGVdPVwiZmkucHJvZ3Jlc3MgPT09IG51bGwgPyAnaW5kZXRlcm1pbmF0ZScgOiAnZGV0ZXJtaW5hdGUnXCJcbiAgICAgICAgW3ZhbHVlXT1cImZpLnByb2dyZXNzXCJcbiAgICAgIC8+XG4gICAgfVxuICAgIDxkaXYgY2xhc3M9XCJyZHMtdXBsb2FkLXNpemUtYW5kLXN0YXRlXCI+XG4gICAgICA8c3BhbiBjbGFzcz1cInJkcy11cGxvYWQtc2l6ZVwiPnt7XG4gICAgICAgIGZpbGVJdGVtLmZpbGUuc2l6ZSB8IHJkc0ZpbGVTaXplXG4gICAgICB9fTwvc3Bhbj5cbiAgICAgIHt7IGZpbGVJdGVtLmlzVXBsb2FkaW5nIHx8IHRbZmlsZUl0ZW0uZXJyb3JJbnRsVG9rZW5dID8gJy0nIDogJycgfX1cbiAgICAgIEBpZiAoZmlsZUl0ZW0uaXNVcGxvYWRpbmcpIHtcbiAgICAgICAgPHNwYW4+e3sgaW50bC5nZXRGaWxlSXRlbVByb2dyZXNzTWVzc2FnZShmaS5wcm9ncmVzcykgfX08L3NwYW4+XG4gICAgICB9XG4gICAgICBAaWYgKGZpbGVJdGVtLmVycm9ySW50bFRva2VuICE9PSAnRU1QVFknKSB7XG4gICAgICAgIDxzcGFuPnt7IHRbZmlsZUl0ZW0uZXJyb3JJbnRsVG9rZW5dIH19PC9zcGFuPlxuICAgICAgfVxuICAgICAgPGRpdiBjbGFzcz1cInNyLW9ubHlcIiBhcmlhLWxpdmU9XCJwb2xpdGVcIj5cbiAgICAgICAge3sgYXJpYUxpdmVDb250ZW50IH19XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgfVxufVxuIl19