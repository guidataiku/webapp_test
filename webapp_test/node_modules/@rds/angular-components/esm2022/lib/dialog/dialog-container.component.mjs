import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, EventEmitter, HostBinding, HostListener, inject, ViewChild, ViewEncapsulation, } from '@angular/core';
import { BasePortalOutlet, CdkPortalOutlet, } from '@angular/cdk/portal';
import { ConfigurableFocusTrapFactory, } from '@angular/cdk/a11y';
import { animate, state, style, transition, trigger, } from '@angular/animations';
import { DOCUMENT } from '@angular/common';
import { RdsDialogConfig } from './model';
import { TAB_INDEX_NOT_FOCUSABLE } from '../utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/portal";
const animations = {
    dialogComponent: trigger('dialogContainer', [
        state('void, exit', style({ opacity: 0, transform: 'scale(0.7)' })),
        state('enter', style({ transform: 'none' })),
        transition('* => enter', animate('150ms cubic-bezier(0, 0, 0.2, 1)', style({ transform: 'none', opacity: 1 }))),
        transition('* => void, * => exit', animate('75ms cubic-bezier(0.4, 0.0, 0.2, 1)', style({ opacity: 0 }))),
    ]),
};
export class RdsDialogContainerComponent extends BasePortalOutlet {
    constructor() {
        super(...arguments);
        this.elementRef = inject(ElementRef);
        this.focusTrapFactory = inject(ConfigurableFocusTrapFactory);
        this.cdr = inject(ChangeDetectorRef);
        this.document = inject(DOCUMENT);
        this.config = inject(RdsDialogConfig);
        this.ariaLabelledBy = this.config.ariaLabelledBy || null;
        this.animationState = 'enter';
        this.animationStateChanged = new EventEmitter();
        this.hostClass = 'rds-dialog';
        this.hostTabindex = TAB_INDEX_NOT_FOCUSABLE;
        this.hostAriaDialog = true;
        this.attachDomPortal = (portal) => {
            if (this.portalOutlet.hasAttached()) {
                this.throwCannotAttachError();
            }
            this.setupFocusTrap();
            return this.portalOutlet.attachDomPortal(portal);
        };
    }
    get hostId() {
        return this.id;
    }
    get hostSize() {
        return this.config.size;
    }
    get hostRole() {
        return this.config.role;
    }
    get hostAriaLabelledby() {
        return this.config.ariaLabel ? null : this.ariaLabelledBy;
    }
    get hostAriaLabel() {
        return this.config.ariaLabel || null;
    }
    get hostAriaDescribedby() {
        return this.config.ariaDescribedBy || null;
    }
    get hostDialogContainer() {
        return this.animationState;
    }
    onAnimationStart($event) {
        this.animationStateChanged.emit($event);
    }
    onAnimationDone(event) {
        if (event.toState === 'enter') {
            this.trapFocus();
        }
        else if (event.toState === 'exit') {
            this.restoreFocus();
        }
        this.animationStateChanged.emit(event);
    }
    attachComponentPortal(portal) {
        if (this.portalOutlet.hasAttached()) {
            this.throwCannotAttachError();
        }
        this.setupFocusTrap();
        return this.portalOutlet.attachComponentPortal(portal);
    }
    attachTemplatePortal(portal) {
        if (this.portalOutlet.hasAttached()) {
            this.throwCannotAttachError();
        }
        this.setupFocusTrap();
        return this.portalOutlet.attachTemplatePortal(portal);
    }
    startExitAnimation() {
        this.animationState = 'exit';
        this.cdr.markForCheck();
    }
    recaptureFocus() {
        if (!this.isFocusInsideDialog()) {
            const focusContainer = !this.focusTrap.focusInitialElement();
            if (focusContainer) {
                this.elementRef.nativeElement.focus();
            }
        }
    }
    trapFocus() {
        this.focusTrap.focusInitialElementWhenReady();
    }
    restoreFocus() {
        const elementToFocus = this.elementFocusedBeforeDialogWasOpened;
        // extra check, because IE can set the `activeElement` to null
        if (elementToFocus && typeof elementToFocus.focus === 'function') {
            const activeElement = this.document.activeElement;
            const hostNativeElement = this.elementRef.nativeElement;
            // Make sure that focus is still inside the dialog or is on the body
            if (!activeElement ||
                activeElement === this.document.body ||
                activeElement === hostNativeElement ||
                hostNativeElement.contains(activeElement)) {
                elementToFocus.focus();
            }
        }
        if (this.focusTrap) {
            this.focusTrap.destroy();
        }
    }
    setupFocusTrap() {
        if (!this.focusTrap) {
            this.focusTrap = this.focusTrapFactory.create(this.elementRef.nativeElement);
        }
        if (this.document) {
            this.elementFocusedBeforeDialogWasOpened = this.document
                .activeElement;
        }
    }
    isFocusInsideDialog() {
        const element = this.elementRef.nativeElement;
        const activeElement = this.document.activeElement;
        return element === activeElement || element.contains(activeElement);
    }
    throwCannotAttachError() {
        throw Error('Attempting to attach dialog content after content is already attached');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDialogContainerComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.1", type: RdsDialogContainerComponent, selector: "rds-dialog", host: { listeners: { "@dialogContainer.start": "onAnimationStart($event)", "@dialogContainer.done": "onAnimationDone($event)" }, properties: { "class": "this.hostClass", "tabIndex": "this.hostTabindex", "attr.aria-dialog": "this.hostAriaDialog", "attr.id": "this.hostId", "attr.size": "this.hostSize", "attr.role": "this.hostRole", "attr.aria-labelledby": "this.hostAriaLabelledby", "attr.aria-label": "this.hostAriaLabel", "attr.aria-describedby": "this.hostAriaDescribedby", "@dialogContainer": "this.hostDialogContainer" } }, viewQueries: [{ propertyName: "portalOutlet", first: true, predicate: CdkPortalOutlet, descendants: true, static: true }], usesInheritance: true, ngImport: i0, template: ` <ng-template cdkPortalOutlet /> `, isInline: true, styles: [".rds-dialog{background-color:var(--rds-color-bg-base-elevated);border-radius:2px;position:relative;width:100%;outline:none;margin:64px;overflow:hidden}.rds-dialog .rds-dialog__header{font-size:20px;font-weight:600;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;justify-content:space-between;padding:24px;row-gap:16px;color:var(--rds-color-high-contrast)}.rds-dialog .rds-dialog__icon-placeholder{top:24px;right:0;position:absolute;align-items:center;justify-content:flex-end;display:inline-flex;margin-right:24px;background:transparent;color:var(--rds-color-low-contrast)}.rds-dialog .rds-dialog__icon-placeholder .rds-button{margin-right:16px}.rds-dialog .rds-dialog__icon-placeholder .rds-button:last-of-type{margin-right:0}.rds-dialog .rds-dialog__content{padding-inline:24px;padding-block:0 24px;overflow-y:auto;color:var(--rds-color-high-contrast)}@media (max-width: 767.999999px){.rds-dialog .rds-dialog__content{font-size:14px;font-weight:200;line-height:20px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-dialog .rds-dialog__actions-container{display:flex;justify-content:flex-end;gap:16px;width:100%;padding:24px}.rds-dialog.rds-dialog--scrollable .rds-dialog__content{padding-right:12px}.rds-dialog.rds-dialog--scrollable .rds-dialog__actions-container{border-top:1px solid var(--rds-color-grey-2)}@media (max-width: 767.999999px){.rds-dialog{margin:16px}}\n"], dependencies: [{ kind: "directive", type: i1.CdkPortalOutlet, selector: "[cdkPortalOutlet]", inputs: ["cdkPortalOutlet"], outputs: ["attached"], exportAs: ["cdkPortalOutlet"] }], animations: [animations.dialogComponent], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDialogContainerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-dialog', template: ` <ng-template cdkPortalOutlet /> `, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, animations: [animations.dialogComponent], styles: [".rds-dialog{background-color:var(--rds-color-bg-base-elevated);border-radius:2px;position:relative;width:100%;outline:none;margin:64px;overflow:hidden}.rds-dialog .rds-dialog__header{font-size:20px;font-weight:600;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;justify-content:space-between;padding:24px;row-gap:16px;color:var(--rds-color-high-contrast)}.rds-dialog .rds-dialog__icon-placeholder{top:24px;right:0;position:absolute;align-items:center;justify-content:flex-end;display:inline-flex;margin-right:24px;background:transparent;color:var(--rds-color-low-contrast)}.rds-dialog .rds-dialog__icon-placeholder .rds-button{margin-right:16px}.rds-dialog .rds-dialog__icon-placeholder .rds-button:last-of-type{margin-right:0}.rds-dialog .rds-dialog__content{padding-inline:24px;padding-block:0 24px;overflow-y:auto;color:var(--rds-color-high-contrast)}@media (max-width: 767.999999px){.rds-dialog .rds-dialog__content{font-size:14px;font-weight:200;line-height:20px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-dialog .rds-dialog__content{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-dialog .rds-dialog__actions-container{display:flex;justify-content:flex-end;gap:16px;width:100%;padding:24px}.rds-dialog.rds-dialog--scrollable .rds-dialog__content{padding-right:12px}.rds-dialog.rds-dialog--scrollable .rds-dialog__actions-container{border-top:1px solid var(--rds-color-grey-2)}@media (max-width: 767.999999px){.rds-dialog{margin:16px}}\n"] }]
        }], propDecorators: { portalOutlet: [{
                type: ViewChild,
                args: [CdkPortalOutlet, { static: true }]
            }], hostClass: [{
                type: HostBinding,
                args: ['class']
            }], hostTabindex: [{
                type: HostBinding,
                args: ['tabIndex']
            }], hostAriaDialog: [{
                type: HostBinding,
                args: ['attr.aria-dialog']
            }], hostId: [{
                type: HostBinding,
                args: ['attr.id']
            }], hostSize: [{
                type: HostBinding,
                args: ['attr.size']
            }], hostRole: [{
                type: HostBinding,
                args: ['attr.role']
            }], hostAriaLabelledby: [{
                type: HostBinding,
                args: ['attr.aria-labelledby']
            }], hostAriaLabel: [{
                type: HostBinding,
                args: ['attr.aria-label']
            }], hostAriaDescribedby: [{
                type: HostBinding,
                args: ['attr.aria-describedby']
            }], hostDialogContainer: [{
                type: HostBinding,
                args: ['@dialogContainer']
            }], onAnimationStart: [{
                type: HostListener,
                args: ['@dialogContainer.start', ['$event']]
            }], onAnimationDone: [{
                type: HostListener,
                args: ['@dialogContainer.done', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2RpYWxvZy9kaWFsb2ctY29udGFpbmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBRVQsVUFBVSxFQUVWLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixTQUFTLEVBQ1QsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxnQkFBZ0IsRUFDaEIsZUFBZSxHQUloQixNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFFTCw0QkFBNEIsR0FDN0IsTUFBTSxtQkFBbUIsQ0FBQztBQUMzQixPQUFPLEVBQ0wsT0FBTyxFQUdQLEtBQUssRUFDTCxLQUFLLEVBQ0wsVUFBVSxFQUNWLE9BQU8sR0FDUixNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzFDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7O0FBRW5ELE1BQU0sVUFBVSxHQUVaO0lBQ0YsZUFBZSxFQUFFLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRTtRQUMxQyxLQUFLLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7UUFDbkUsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUM1QyxVQUFVLENBQ1IsWUFBWSxFQUNaLE9BQU8sQ0FD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RSxDQUFDO0lBRU8sc0JBQXNCO1FBQzVCLE1BQU0sS0FBSyxDQUNULHVFQUF1RSxDQUN4RSxDQUFDO0lBQ0osQ0FBQzs4R0F2S1UsMkJBQTJCO2tHQUEzQiwyQkFBMkIsaW5CQWlCM0IsZUFBZSxxRkF2QmhCLG1DQUFtQyxzc0ZBSWpDLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQzs7MkZBRTdCLDJCQUEyQjtrQkFSdkMsU0FBUzsrQkFDRSxZQUFZLFlBQ1osbUNBQW1DLG1CQUU1Qix1QkFBdUIsQ0FBQyxNQUFNLGlCQUNoQyxpQkFBaUIsQ0FBQyxJQUFJLGNBQ3pCLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQzs4QkFtQk0sWUFBWTtzQkFBekQsU0FBUzt1QkFBQyxlQUFlLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUViLFNBQVM7c0JBQXZDLFdBQVc7dUJBQUMsT0FBTztnQkFDYyxZQUFZO3NCQUE3QyxXQUFXO3VCQUFDLFVBQVU7Z0JBQ21CLGNBQWM7c0JBQXZELFdBQVc7dUJBQUMsa0JBQWtCO2dCQUVILE1BQU07c0JBQWpDLFdBQVc7dUJBQUMsU0FBUztnQkFJUSxRQUFRO3NCQUFyQyxXQUFXO3VCQUFDLFdBQVc7Z0JBSU0sUUFBUTtzQkFBckMsV0FBVzt1QkFBQyxXQUFXO2dCQUlpQixrQkFBa0I7c0JBQTFELFdBQVc7dUJBQUMsc0JBQXNCO2dCQUlDLGFBQWE7c0JBQWhELFdBQVc7dUJBQUMsaUJBQWlCO2dCQUlZLG1CQUFtQjtzQkFBNUQsV0FBVzt1QkFBQyx1QkFBdUI7Z0JBTUMsbUJBQW1CO3NCQUF2RCxXQUFXO3VCQUFDLGtCQUFrQjtnQkFLL0IsZ0JBQWdCO3NCQURmLFlBQVk7dUJBQUMsd0JBQXdCLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBTWxELGVBQWU7c0JBRGQsWUFBWTt1QkFBQyx1QkFBdUIsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIEVtYmVkZGVkVmlld1JlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBpbmplY3QsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQmFzZVBvcnRhbE91dGxldCxcbiAgQ2RrUG9ydGFsT3V0bGV0LFxuICBDb21wb25lbnRQb3J0YWwsXG4gIERvbVBvcnRhbCxcbiAgVGVtcGxhdGVQb3J0YWwsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHtcbiAgQ29uZmlndXJhYmxlRm9jdXNUcmFwLFxuICBDb25maWd1cmFibGVGb2N1c1RyYXBGYWN0b3J5LFxufSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuICBhbmltYXRlLFxuICBBbmltYXRpb25FdmVudCxcbiAgQW5pbWF0aW9uVHJpZ2dlck1ldGFkYXRhLFxuICBzdGF0ZSxcbiAgc3R5bGUsXG4gIHRyYW5zaXRpb24sXG4gIHRyaWdnZXIsXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgUmRzRGlhbG9nQ29uZmlnIH0gZnJvbSAnLi9tb2RlbCc7XG5pbXBvcnQgeyBUQUJfSU5ERVhfTk9UX0ZPQ1VTQUJMRSB9IGZyb20gJy4uL3V0aWxzJztcblxuY29uc3QgYW5pbWF0aW9uczoge1xuICByZWFkb25seSBkaWFsb2dDb21wb25lbnQ6IEFuaW1hdGlvblRyaWdnZXJNZXRhZGF0YTtcbn0gPSB7XG4gIGRpYWxvZ0NvbXBvbmVudDogdHJpZ2dlcignZGlhbG9nQ29udGFpbmVyJywgW1xuICAgIHN0YXRlKCd2b2lkLCBleGl0Jywgc3R5bGUoeyBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICdzY2FsZSgwLjcpJyB9KSksXG4gICAgc3RhdGUoJ2VudGVyJywgc3R5bGUoeyB0cmFuc2Zvcm06ICdub25lJyB9KSksXG4gICAgdHJhbnNpdGlvbihcbiAgICAgICcqID0+IGVudGVyJyxcbiAgICAgIGFuaW1hdGUoXG4gICAgICAgICcxNTBtcyBjdWJpYy1iZXppZXIoMCwgMCwgMC4yLCAxKScsXG4gICAgICAgIHN0eWxlKHsgdHJhbnNmb3JtOiAnbm9uZScsIG9wYWNpdHk6IDEgfSksXG4gICAgICApLFxuICAgICksXG4gICAgdHJhbnNpdGlvbihcbiAgICAgICcqID0+IHZvaWQsICogPT4gZXhpdCcsXG4gICAgICBhbmltYXRlKCc3NW1zIGN1YmljLWJlemllcigwLjQsIDAuMCwgMC4yLCAxKScsIHN0eWxlKHsgb3BhY2l0eTogMCB9KSksXG4gICAgKSxcbiAgXSksXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdyZHMtZGlhbG9nJyxcbiAgdGVtcGxhdGU6IGAgPG5nLXRlbXBsYXRlIGNka1BvcnRhbE91dGxldCAvPiBgLFxuICBzdHlsZVVybHM6IFsnLi9kaWFsb2ctY29udGFpbmVyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBhbmltYXRpb25zOiBbYW5pbWF0aW9ucy5kaWFsb2dDb21wb25lbnRdLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNEaWFsb2dDb250YWluZXJDb21wb25lbnQ8RD4gZXh0ZW5kcyBCYXNlUG9ydGFsT3V0bGV0IHtcbiAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmID0gaW5qZWN0KEVsZW1lbnRSZWYpO1xuICBwcml2YXRlIHJlYWRvbmx5IGZvY3VzVHJhcEZhY3RvcnkgPSBpbmplY3QoQ29uZmlndXJhYmxlRm9jdXNUcmFwRmFjdG9yeSk7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkb2N1bWVudCA9IGluamVjdChET0NVTUVOVCk7XG4gIHB1YmxpYyByZWFkb25seSBjb25maWcgPSBpbmplY3Q8UmRzRGlhbG9nQ29uZmlnPEQ+PihSZHNEaWFsb2dDb25maWcpO1xuXG4gIHByaXZhdGUgZm9jdXNUcmFwOiBDb25maWd1cmFibGVGb2N1c1RyYXA7XG4gIHByaXZhdGUgZWxlbWVudEZvY3VzZWRCZWZvcmVEaWFsb2dXYXNPcGVuZWQ6IEhUTUxFbGVtZW50O1xuXG4gIGFyaWFMYWJlbGxlZEJ5ID0gdGhpcy5jb25maWcuYXJpYUxhYmVsbGVkQnkgfHwgbnVsbDtcbiAgaWQ6IHN0cmluZztcblxuICBhbmltYXRpb25TdGF0ZTogJ3ZvaWQnIHwgJ2VudGVyJyB8ICdleGl0JyA9ICdlbnRlcic7XG5cbiAgcmVhZG9ubHkgYW5pbWF0aW9uU3RhdGVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxBbmltYXRpb25FdmVudD4oKTtcblxuICBAVmlld0NoaWxkKENka1BvcnRhbE91dGxldCwgeyBzdGF0aWM6IHRydWUgfSkgcG9ydGFsT3V0bGV0OiBDZGtQb3J0YWxPdXRsZXQ7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIHJlYWRvbmx5IGhvc3RDbGFzcyA9ICdyZHMtZGlhbG9nJztcbiAgQEhvc3RCaW5kaW5nKCd0YWJJbmRleCcpIHJlYWRvbmx5IGhvc3RUYWJpbmRleCA9IFRBQl9JTkRFWF9OT1RfRk9DVVNBQkxFO1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1kaWFsb2cnKSByZWFkb25seSBob3N0QXJpYURpYWxvZyA9IHRydWU7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmlkJykgZ2V0IGhvc3RJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlkO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnNpemUnKSBnZXQgaG9zdFNpemUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuc2l6ZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5yb2xlJykgZ2V0IGhvc3RSb2xlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnJvbGU7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1sYWJlbGxlZGJ5JykgZ2V0IGhvc3RBcmlhTGFiZWxsZWRieSgpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuYXJpYUxhYmVsID8gbnVsbCA6IHRoaXMuYXJpYUxhYmVsbGVkQnk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1sYWJlbCcpIGdldCBob3N0QXJpYUxhYmVsKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5hcmlhTGFiZWwgfHwgbnVsbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWRlc2NyaWJlZGJ5JykgZ2V0IGhvc3RBcmlhRGVzY3JpYmVkYnkoKTpcbiAgICB8IHN0cmluZ1xuICAgIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmFyaWFEZXNjcmliZWRCeSB8fCBudWxsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdAZGlhbG9nQ29udGFpbmVyJykgZ2V0IGhvc3REaWFsb2dDb250YWluZXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5hbmltYXRpb25TdGF0ZTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ0BkaWFsb2dDb250YWluZXIuc3RhcnQnLCBbJyRldmVudCddKVxuICBvbkFuaW1hdGlvblN0YXJ0KCRldmVudDogQW5pbWF0aW9uRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLmFuaW1hdGlvblN0YXRlQ2hhbmdlZC5lbWl0KCRldmVudCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdAZGlhbG9nQ29udGFpbmVyLmRvbmUnLCBbJyRldmVudCddKVxuICBvbkFuaW1hdGlvbkRvbmUoZXZlbnQ6IEFuaW1hdGlvbkV2ZW50KTogdm9pZCB7XG4gICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09ICdlbnRlcicpIHtcbiAgICAgIHRoaXMudHJhcEZvY3VzKCk7XG4gICAgfSBlbHNlIGlmIChldmVudC50b1N0YXRlID09PSAnZXhpdCcpIHtcbiAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgfVxuXG4gICAgdGhpcy5hbmltYXRpb25TdGF0ZUNoYW5nZWQuZW1pdChldmVudCk7XG4gIH1cblxuICBhdHRhY2hDb21wb25lbnRQb3J0YWw8VD4ocG9ydGFsOiBDb21wb25lbnRQb3J0YWw8VD4pOiBDb21wb25lbnRSZWY8VD4ge1xuICAgIGlmICh0aGlzLnBvcnRhbE91dGxldC5oYXNBdHRhY2hlZCgpKSB7XG4gICAgICB0aGlzLnRocm93Q2Fubm90QXR0YWNoRXJyb3IoKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldHVwRm9jdXNUcmFwKCk7XG5cbiAgICByZXR1cm4gdGhpcy5wb3J0YWxPdXRsZXQuYXR0YWNoQ29tcG9uZW50UG9ydGFsKHBvcnRhbCk7XG4gIH1cblxuICBhdHRhY2hUZW1wbGF0ZVBvcnRhbDxDPihwb3J0YWw6IFRlbXBsYXRlUG9ydGFsPEM+KTogRW1iZWRkZWRWaWV3UmVmPEM+IHtcbiAgICBpZiAodGhpcy5wb3J0YWxPdXRsZXQuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgdGhpcy50aHJvd0Nhbm5vdEF0dGFjaEVycm9yKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cEZvY3VzVHJhcCgpO1xuXG4gICAgcmV0dXJuIHRoaXMucG9ydGFsT3V0bGV0LmF0dGFjaFRlbXBsYXRlUG9ydGFsKHBvcnRhbCk7XG4gIH1cblxuICBvdmVycmlkZSBhdHRhY2hEb21Qb3J0YWwgPSAocG9ydGFsOiBEb21Qb3J0YWwpOiB2b2lkID0+IHtcbiAgICBpZiAodGhpcy5wb3J0YWxPdXRsZXQuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgdGhpcy50aHJvd0Nhbm5vdEF0dGFjaEVycm9yKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cEZvY3VzVHJhcCgpO1xuXG4gICAgcmV0dXJuIHRoaXMucG9ydGFsT3V0bGV0LmF0dGFjaERvbVBvcnRhbChwb3J0YWwpO1xuICB9O1xuXG4gIHN0YXJ0RXhpdEFuaW1hdGlvbigpOiB2b2lkIHtcbiAgICB0aGlzLmFuaW1hdGlvblN0YXRlID0gJ2V4aXQnO1xuXG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICByZWNhcHR1cmVGb2N1cygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNGb2N1c0luc2lkZURpYWxvZygpKSB7XG4gICAgICBjb25zdCBmb2N1c0NvbnRhaW5lciA9ICF0aGlzLmZvY3VzVHJhcC5mb2N1c0luaXRpYWxFbGVtZW50KCk7XG5cbiAgICAgIGlmIChmb2N1c0NvbnRhaW5lcikge1xuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdHJhcEZvY3VzKCk6IHZvaWQge1xuICAgIHRoaXMuZm9jdXNUcmFwLmZvY3VzSW5pdGlhbEVsZW1lbnRXaGVuUmVhZHkoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzdG9yZUZvY3VzKCk6IHZvaWQge1xuICAgIGNvbnN0IGVsZW1lbnRUb0ZvY3VzID0gdGhpcy5lbGVtZW50Rm9jdXNlZEJlZm9yZURpYWxvZ1dhc09wZW5lZDtcblxuICAgIC8vIGV4dHJhIGNoZWNrLCBiZWNhdXNlIElFIGNhbiBzZXQgdGhlIGBhY3RpdmVFbGVtZW50YCB0byBudWxsXG4gICAgaWYgKGVsZW1lbnRUb0ZvY3VzICYmIHR5cGVvZiBlbGVtZW50VG9Gb2N1cy5mb2N1cyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IHRoaXMuZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAgIGNvbnN0IGhvc3ROYXRpdmVFbGVtZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGZvY3VzIGlzIHN0aWxsIGluc2lkZSB0aGUgZGlhbG9nIG9yIGlzIG9uIHRoZSBib2R5XG4gICAgICBpZiAoXG4gICAgICAgICFhY3RpdmVFbGVtZW50IHx8XG4gICAgICAgIGFjdGl2ZUVsZW1lbnQgPT09IHRoaXMuZG9jdW1lbnQuYm9keSB8fFxuICAgICAgICBhY3RpdmVFbGVtZW50ID09PSBob3N0TmF0aXZlRWxlbWVudCB8fFxuICAgICAgICBob3N0TmF0aXZlRWxlbWVudC5jb250YWlucyhhY3RpdmVFbGVtZW50KVxuICAgICAgKSB7XG4gICAgICAgIGVsZW1lbnRUb0ZvY3VzLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZm9jdXNUcmFwKSB7XG4gICAgICB0aGlzLmZvY3VzVHJhcC5kZXN0cm95KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cEZvY3VzVHJhcCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZm9jdXNUcmFwKSB7XG4gICAgICB0aGlzLmZvY3VzVHJhcCA9IHRoaXMuZm9jdXNUcmFwRmFjdG9yeS5jcmVhdGUoXG4gICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kb2N1bWVudCkge1xuICAgICAgdGhpcy5lbGVtZW50Rm9jdXNlZEJlZm9yZURpYWxvZ1dhc09wZW5lZCA9IHRoaXMuZG9jdW1lbnRcbiAgICAgICAgLmFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc0ZvY3VzSW5zaWRlRGlhbG9nKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCBhY3RpdmVFbGVtZW50ID0gdGhpcy5kb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXG4gICAgcmV0dXJuIGVsZW1lbnQgPT09IGFjdGl2ZUVsZW1lbnQgfHwgZWxlbWVudC5jb250YWlucyhhY3RpdmVFbGVtZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgdGhyb3dDYW5ub3RBdHRhY2hFcnJvcigpOiB2b2lkIHtcbiAgICB0aHJvdyBFcnJvcihcbiAgICAgICdBdHRlbXB0aW5nIHRvIGF0dGFjaCBkaWFsb2cgY29udGVudCBhZnRlciBjb250ZW50IGlzIGFscmVhZHkgYXR0YWNoZWQnLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==