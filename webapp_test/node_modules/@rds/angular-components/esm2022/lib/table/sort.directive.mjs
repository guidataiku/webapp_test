import { booleanAttribute, Directive, EventEmitter, HostBinding, inject, InjectionToken, Input, Output, } from '@angular/core';
import { ReplaySubject, Subject } from 'rxjs';
import * as i0 from "@angular/core";
export const RDS_SORT_DEFAULT_OPTIONS = new InjectionToken('RDS_SORT_DEFAULT_OPTIONS');
export class RdsSortDirective {
    constructor() {
        this.defaultOptions = inject(RDS_SORT_DEFAULT_OPTIONS, {
            optional: true,
        });
        this._stateChanges = new Subject();
        this.sortables = new Map();
        this.class = 'rds-sort';
        this.active = null;
        this.disabled = false;
        this.start = 'asc';
        this._direction = '';
        this.disableClear = false;
        this._initialized = new ReplaySubject(1);
        this.rdsSortChange = new EventEmitter();
    }
    get direction() {
        return this._direction;
    }
    set direction(direction) {
        this._direction = direction;
    }
    get initialized() {
        return this._initialized.asObservable();
    }
    register(sortable) {
        if (!sortable.id) {
            throw Error(`RdsSortHeader must be provided with a unique id.`);
        }
        if (this.sortables.has(sortable.id)) {
            throw Error(`Cannot have two RdsSortables with the same id (${sortable.id}).`);
        }
        this.sortables.set(sortable.id, sortable);
    }
    deregister(sortable) {
        this.sortables.delete(sortable.id);
    }
    sort(sortable) {
        if (this.active != sortable.id) {
            this.active = sortable.id;
            this.direction = sortable.start ? sortable.start : this.start;
        }
        else {
            this.direction = this.getNextSortDirection(sortable);
        }
        this.rdsSortChange.emit({ active: this.active, direction: this.direction });
    }
    getNextSortDirection(sortable) {
        if (!sortable) {
            return '';
        }
        const disableClear = sortable?.disableClear ??
            this.disableClear ??
            !!this.defaultOptions?.disableClear;
        const sortDirectionCycle = this._getSortDirectionCycle(sortable.start, disableClear);
        let nextDirectionIndex = sortDirectionCycle.indexOf(this.direction) + 1;
        if (nextDirectionIndex >= sortDirectionCycle.length) {
            nextDirectionIndex = 0;
        }
        return sortDirectionCycle[nextDirectionIndex];
    }
    ngOnInit() {
        this._initialized.next();
    }
    ngOnChanges() {
        this._stateChanges.next();
    }
    ngOnDestroy() {
        this._stateChanges.complete();
        this._initialized.complete();
    }
    _getSortDirectionCycle(start = this.start, disableClear) {
        const sortOrder = ['asc', 'desc'];
        if (start === 'desc') {
            sortOrder.reverse();
        }
        if (!disableClear) {
            sortOrder.push('');
        }
        return sortOrder;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSortDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "16.1.0", version: "17.3.1", type: RdsSortDirective, selector: "[rdsSort], [rds-sort]", inputs: { active: ["rdsSortActive", "active"], disabled: ["rdsSortDisabled", "disabled", booleanAttribute], start: ["rdsSortStart", "start"], direction: ["rdsSortDirection", "direction"], disableClear: ["rdsSortDisableClear", "disableClear", booleanAttribute] }, outputs: { rdsSortChange: "rdsSortChange" }, host: { properties: { "class": "this.class" } }, exportAs: ["rdsSort"], usesOnChanges: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSortDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[rdsSort], [rds-sort]',
                    exportAs: 'rdsSort',
                }]
        }], propDecorators: { class: [{
                type: HostBinding,
                args: ['class']
            }], active: [{
                type: Input,
                args: ['rdsSortActive']
            }], disabled: [{
                type: Input,
                args: [{ alias: 'rdsSortDisabled', transform: booleanAttribute }]
            }], start: [{
                type: Input,
                args: ['rdsSortStart']
            }], direction: [{
                type: Input,
                args: ['rdsSortDirection']
            }], disableClear: [{
                type: Input,
                args: [{ alias: 'rdsSortDisableClear', transform: booleanAttribute }]
            }], rdsSortChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3RhYmxlL3NvcnQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsTUFBTSxFQUNOLGNBQWMsRUFDZCxLQUFLLEVBSUwsTUFBTSxHQUNQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOztBQW1CMUQsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQ25DLElBQUksY0FBYyxDQUF3QiwwQkFBMEIsQ0FBQyxDQUFDO0FBTXhFLE1BQU0sT0FBTyxnQkFBZ0I7SUFKN0I7UUFLbUIsbUJBQWMsR0FBRyxNQUFNLENBQUMsd0JBQXdCLEVBQUU7WUFDakUsUUFBUSxFQUFFLElBQUk7U0FDZixDQUFDLENBQUM7UUFFTSxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDN0MsY0FBUyxHQUFHLElBQUksR0FBRyxFQUF1QixDQUFDO1FBRXJCLFVBQUssR0FBRyxVQUFVLENBQUM7UUFFakIsV0FBTSxHQUFrQixJQUFJLENBQUM7UUFFYSxhQUFRLEdBQ3hFLEtBQUssQ0FBQztRQUVlLFVBQUssR0FBa0IsS0FBSyxDQUFDO1FBVzVDLGVBQVUsR0FBa0IsRUFBRSxDQUFDO1FBR3ZDLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBTWIsaUJBQVksR0FBRyxJQUFJLGFBQWEsQ0FBTyxDQUFDLENBQUMsQ0FBQztRQUd6QyxrQkFBYSxHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDO0tBbUZ2RTtJQXhHQyxJQUNJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELElBQUksU0FBUyxD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QUFDLENBQUM7UUFFbkQsSUFBSSxLQUFLLEtBQUssTUFBTSxFQUFFLENBQUM7WUFDckIsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3RCLENBQUM7UUFFRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDbEIsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNyQixDQUFDO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQzs4R0F4SFUsZ0JBQWdCO2tHQUFoQixnQkFBZ0IsOEhBWW1CLGdCQUFnQix5SUFnQlosZ0JBQWdCOzsyRkE1QnZELGdCQUFnQjtrQkFKNUIsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsdUJBQXVCO29CQUNqQyxRQUFRLEVBQUUsU0FBUztpQkFDcEI7OEJBU3VCLEtBQUs7c0JBQTFCLFdBQVc7dUJBQUMsT0FBTztnQkFFSSxNQUFNO3NCQUE3QixLQUFLO3VCQUFDLGVBQWU7Z0JBRTRDLFFBQVE7c0JBQXpFLEtBQUs7dUJBQUMsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUd6QyxLQUFLO3NCQUEzQixLQUFLO3VCQUFDLGNBQWM7Z0JBR2pCLFNBQVM7c0JBRFosS0FBSzt1QkFBQyxrQkFBa0I7Z0JBWXpCLFlBQVk7c0JBRFgsS0FBSzt1QkFBQyxFQUFFLEtBQUssRUFBRSxxQkFBcUIsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBVTNELGFBQWE7c0JBRHJCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBib29sZWFuQXR0cmlidXRlLFxuICBEaXJlY3RpdmUsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIGluamVjdCxcbiAgSW5qZWN0aW9uVG9rZW4sXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5leHBvcnQgdHlwZSBTb3J0RGlyZWN0aW9uID0gJ2FzYycgfCAnZGVzYycgfCAnJztcblxuZXhwb3J0IGludGVyZmFjZSBSZHNTb3J0YWJsZSB7XG4gIGlkOiBzdHJpbmc7XG4gIHN0YXJ0OiBTb3J0RGlyZWN0aW9uO1xuICBkaXNhYmxlQ2xlYXI6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU29ydCB7XG4gIGFjdGl2ZTogc3RyaW5nO1xuICBkaXJlY3Rpb246IFNvcnREaXJlY3Rpb247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmRzU29ydERlZmF1bHRPcHRpb25zIHtcbiAgZGlzYWJsZUNsZWFyPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IFJEU19TT1JUX0RFRkFVTFRfT1BUSU9OUyA9XG4gIG5ldyBJbmplY3Rpb25Ub2tlbjxSZHNTb3J0RGVmYXVsdE9wdGlvbnM+KCdSRFNfU09SVF9ERUZBVUxUX09QVElPTlMnKTtcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3Jkc1NvcnRdLCBbcmRzLXNvcnRdJyxcbiAgZXhwb3J0QXM6ICdyZHNTb3J0Jyxcbn0pXG5leHBvcnQgY2xhc3MgUmRzU29ydERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQge1xuICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRPcHRpb25zID0gaW5qZWN0KFJEU19TT1JUX0RFRkFVTFRfT1BUSU9OUywge1xuICAgIG9wdGlvbmFsOiB0cnVlLFxuICB9KTtcblxuICByZWFkb25seSBfc3RhdGVDaGFuZ2VzID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgc29ydGFibGVzID0gbmV3IE1hcDxzdHJpbmcsIFJkc1NvcnRhYmxlPigpO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbGFzcyA9ICdyZHMtc29ydCc7XG5cbiAgQElucHV0KCdyZHNTb3J0QWN0aXZlJykgYWN0aXZlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBASW5wdXQoeyBhbGlhczogJ3Jkc1NvcnREaXNhYmxlZCcsIHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBkaXNhYmxlZCA9XG4gICAgZmFsc2U7XG5cbiAgQElucHV0KCdyZHNTb3J0U3RhcnQnKSBzdGFydDogU29ydERpcmVjdGlvbiA9ICdhc2MnO1xuXG4gIEBJbnB1dCgncmRzU29ydERpcmVjdGlvbicpXG4gIGdldCBkaXJlY3Rpb24oKTogU29ydERpcmVjdGlvbiB7XG4gICAgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbjtcbiAgfVxuXG4gIHNldCBkaXJlY3Rpb24oZGlyZWN0aW9uOiBTb3J0RGlyZWN0aW9uKSB7XG4gICAgdGhpcy5fZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBfZGlyZWN0aW9uOiBTb3J0RGlyZWN0aW9uID0gJyc7XG5cbiAgQElucHV0KHsgYWxpYXM6ICdyZHNTb3J0RGlzYWJsZUNsZWFyJywgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG4gIGRpc2FibGVDbGVhciA9IGZhbHNlO1xuXG4gIGdldCBpbml0aWFsaXplZCgpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5faW5pdGlhbGl6ZWQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwcml2YXRlIF9pbml0aWFsaXplZCA9IG5ldyBSZXBsYXlTdWJqZWN0PHZvaWQ+KDEpO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSByZHNTb3J0Q2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ydD4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvcnQ+KCk7XG5cbiAgcmVnaXN0ZXIoc29ydGFibGU6IFJkc1NvcnRhYmxlKTogdm9pZCB7XG4gICAgaWYgKCFzb3J0YWJsZS5pZCkge1xuICAgICAgdGhyb3cgRXJyb3IoYFJkc1NvcnRIZWFkZXIgbXVzdCBiZSBwcm92aWRlZCB3aXRoIGEgdW5pcXVlIGlkLmApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNvcnRhYmxlcy5oYXMoc29ydGFibGUuaWQpKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgYENhbm5vdCBoYXZlIHR3byBSZHNTb3J0YWJsZXMgd2l0aCB0aGUgc2FtZSBpZCAoJHtzb3J0YWJsZS5pZH0pLmAsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuc29ydGFibGVzLnNldChzb3J0YWJsZS5pZCwgc29ydGFibGUpO1xuICB9XG5cbiAgZGVyZWdpc3Rlcihzb3J0YWJsZTogUmRzU29ydGFibGUpOiB2b2lkIHtcbiAgICB0aGlzLnNvcnRhYmxlcy5kZWxldGUoc29ydGFibGUuaWQpO1xuICB9XG5cbiAgc29ydChzb3J0YWJsZTogUmRzU29ydGFibGUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5hY3RpdmUgIT0gc29ydGFibGUuaWQpIHtcbiAgICAgIHRoaXMuYWN0aXZlID0gc29ydGFibGUuaWQ7XG4gICAgICB0aGlzLmRpcmVjdGlvbiA9IHNvcnRhYmxlLnN0YXJ0ID8gc29ydGFibGUuc3RhcnQgOiB0aGlzLnN0YXJ0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMuZ2V0TmV4dFNvcnREaXJlY3Rpb24oc29ydGFibGUpO1xuICAgIH1cblxuICAgIHRoaXMucmRzU29ydENoYW5nZS5lbWl0KHsgYWN0aXZlOiB0aGlzLmFjdGl2ZSwgZGlyZWN0aW9uOiB0aGlzLmRpcmVjdGlvbiB9KTtcbiAgfVxuXG4gIGdldE5leHRTb3J0RGlyZWN0aW9uKHNvcnRhYmxlOiBSZHNTb3J0YWJsZSk6IFNvcnREaXJlY3Rpb24ge1xuICAgIGlmICghc29ydGFibGUpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBjb25zdCBkaXNhYmxlQ2xlYXIgPVxuICAgICAgc29ydGFibGU/LmRpc2FibGVDbGVhciA/P1xuICAgICAgdGhpcy5kaXNhYmxlQ2xlYXIgPz9cbiAgICAgICEhdGhpcy5kZWZhdWx0T3B0aW9ucz8uZGlzYWJsZUNsZWFyO1xuICAgIGNvbnN0IHNvcnREaXJlY3Rpb25DeWNsZSA9IHRoaXMuX2dldFNvcnREaXJlY3Rpb25DeWNsZShcbiAgICAgIHNvcnRhYmxlLnN0YXJ0LFxuICAgICAgZGlzYWJsZUNsZWFyLFxuICAgICk7XG5cbiAgICBsZXQgbmV4dERpcmVjdGlvbkluZGV4ID0gc29ydERpcmVjdGlvbkN5Y2xlLmluZGV4T2YodGhpcy5kaXJlY3Rpb24pICsgMTtcblxuICAgIGlmIChuZXh0RGlyZWN0aW9uSW5kZXggPj0gc29ydERpcmVjdGlvbkN5Y2xlLmxlbmd0aCkge1xuICAgICAgbmV4dERpcmVjdGlvbkluZGV4ID0gMDtcbiAgICB9XG5cbiAgICByZXR1cm4gc29ydERpcmVjdGlvbkN5Y2xlW25leHREaXJlY3Rpb25JbmRleF07XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl9pbml0aWFsaXplZC5uZXh0KCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLl9zdGF0ZUNoYW5nZXMubmV4dCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fc3RhdGVDaGFuZ2VzLmNvbXBsZXRlKCk7XG4gICAgdGhpcy5faW5pdGlhbGl6ZWQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgX2dldFNvcnREaXJlY3Rpb25DeWNsZShcbiAgICBzdGFydDogU29ydERpcmVjdGlvbiA9IHRoaXMuc3RhcnQsXG4gICAgZGlzYWJsZUNsZWFyOiBib29sZWFuLFxuICApOiBTb3J0RGlyZWN0aW9uW10ge1xuICAgIGNvbnN0IHNvcnRPcmRlcjogU29ydERpcmVjdGlvbltdID0gWydhc2MnLCAnZGVzYyddO1xuXG4gICAgaWYgKHN0YXJ0ID09PSAnZGVzYycpIHtcbiAgICAgIHNvcnRPcmRlci5yZXZlcnNlKCk7XG4gICAgfVxuXG4gICAgaWYgKCFkaXNhYmxlQ2xlYXIpIHtcbiAgICAgIHNvcnRPcmRlci5wdXNoKCcnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc29ydE9yZGVyO1xuICB9XG59XG4iXX0=