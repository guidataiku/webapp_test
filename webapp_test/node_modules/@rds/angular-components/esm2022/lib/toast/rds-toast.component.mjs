import { animate, state, style, transition, trigger, } from '@angular/animations';
import { Component, DestroyRef, HostBinding, HostListener, inject, NgZone, } from '@angular/core';
import { RdsToastPackage } from './rds-toast.package';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
import * as i1 from "../icons/icon.component";
import * as i2 from "../button/icon-button.component";
export class RdsToastComponent {
    get displayStyle() {
        if (this.state.value === 'inactive') {
            return 'none';
        }
        return undefined;
    }
    tapToast() {
        if (this.state.value === 'removed') {
            return;
        }
        this.rdsToastPackage.triggerTap();
        if (this.options.tapToDismiss) {
            this.remove();
        }
    }
    stickAround() {
        if (this.state.value === 'removed') {
            return;
        }
        clearTimeout(this.timeout);
        this.options.timeOut = 0;
        this.hideTime = 0;
    }
    delayedHideToast() {
        if (this.options.disableTimeOut === true ||
            this.options.disableTimeOut === 'extendedTimeOut' ||
            this.options.extendedTimeOut === 0 ||
            this.state.value === 'removed') {
            return;
        }
        this.outsideTimeout(() => this.remove(), this.options.extendedTimeOut);
        this.options.timeOut = this.options.extendedTimeOut;
        this.hideTime = new Date().getTime() + (this.options.timeOut || 0);
    }
    constructor() {
        this.rdsToastPackage = inject(RdsToastPackage);
        this.destroyRef = inject(DestroyRef);
        this.ngZone = inject(NgZone, { optional: true });
        this.message = this.rdsToastPackage.message || null;
        this.title = this.rdsToastPackage.title || null;
        this.options = this.rdsToastPackage.config;
        this.originalTimeout = this.rdsToastPackage.config.timeOut;
        this.toastClasses = '';
        this.state = {
            value: 'inactive',
            params: {
                easeTime: this.rdsToastPackage.config.easeTime,
                easing: 'ease-in',
            },
        };
        this.toastClasses = `rds-toast-${this.rdsToastPackage.config.type} ${this.rdsToastPackage.config.toastClass}`;
        if (this.rdsToastPackage.config.tapToDismiss) {
            this.toastClasses += ' rds-toast-dismiss-click';
        }
        if (this.rdsToastPackage.config.closeButton) {
            this.toastClasses += ' rds-toast-with-close-icon';
        }
        if (this.title) {
            this.toastClasses += ' rds-toast-with-title';
        }
        this.rdsToastPackage.toastRef
            .afterActivate()
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.activateToast());
        this.rdsToastPackage.toastRef
            .manualClosed()
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.remove());
    }
    ngOnDestroy() {
        clearTimeout(this.timeout);
    }
    activateToast() {
        this.state = { ...this.state, value: 'active' };
        if (!(this.options.disableTimeOut === true ||
            this.options.disableTimeOut === 'timeOut') &&
            this.options.timeOut) {
            this.outsideTimeout(() => this.remove(), this.options.timeOut);
            this.hideTime = new Date().getTime() + this.options.timeOut;
        }
    }
    remove() {
        if (this.state.value === 'removed') {
            return;
        }
        clearTimeout(this.timeout);
        this.state = { ...this.state, value: 'removed' };
        this.outsideTimeout(() => this.rdsToastPackage.toastRef.close(), +this.rdsToastPackage.config.easeTime);
    }
    outsideTimeout(func, timeout) {
        if (this.ngZone) {
            this.ngZone.runOutsideAngular(() => {
                this.timeout = window.setTimeout(() => this.runInsideAngular(func), timeout);
            });
        }
        else {
            this.timeout = window.setTimeout(() => func(), timeout);
        }
    }
    runInsideAngular(func) {
        if (this.ngZone) {
            this.ngZone.run(() => func());
        }
        else {
            func();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsToastComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsToastComponent, selector: "[rds-toast-component]", host: { listeners: { "click": "tapToast()", "mouseenter": "stickAround()", "mouseleave": "delayedHideToast()" }, properties: { "class": "this.toastClasses", "@flyInOut": "this.state", "style.display": "this.displayStyle" } }, ngImport: i0, template: "<div class=\"rds-container-left\"></div>\n<div class=\"rds-toast-inner\">\n  @if (options.icon && options.iconNamespace) {\n    <rds-icon\n      [icon]=\"options.icon\"\n      [namespace]=\"options.iconNamespace\"\n      class=\"rds-toast__leading-icon rds-icon\"\n    />\n  }\n  <div class=\"rds-toast-text\">\n    @if (title) {\n      <div\n        class=\"rds-toast-text__header\"\n        [class]=\"options.titleClass\"\n        [attr.aria-label]=\"title\"\n      >\n        {{ title }}\n      </div>\n    }\n    @if (message && options.enableHtml) {\n      <div\n        role=\"alertdialog\"\n        aria-live=\"polite\"\n        class=\"rds-toast-text__message\"\n        [class]=\"options.messageClass\"\n        [attr.aria-label]=\"message\"\n        [innerHTML]=\"message\"\n      ></div>\n    }\n    @if (message && !options.enableHtml) {\n      <div\n        role=\"alertdialog\"\n        aria-live=\"polite\"\n        class=\"rds-toast-text__message\"\n        [class]=\"options.messageClass\"\n        [attr.aria-label]=\"message\"\n      >\n        {{ message }}\n      </div>\n    }\n  </div>\n</div>\n@if (options.closeButton) {\n  <button rds-icon-button class=\"rds-toast__close-button\" (click)=\"remove()\">\n    <rds-icon icon=\"close\" namespace=\"outlined\" />\n  </button>\n}\n", dependencies: [{ kind: "component", type: i1.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }], animations: [
            trigger('flyInOut', [
                state('inactive', style({ opacity: 0 })),
                state('active', style({ opacity: 1 })),
                state('removed', style({ opacity: 0 })),
                transition('inactive => active', animate('{{ easeTime }}ms {{ easing }}')),
                transition('active => removed', animate('{{ easeTime }}ms {{ easing }}')),
            ]),
        ] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsToastComponent, decorators: [{
            type: Component,
            args: [{ selector: '[rds-toast-component]', animations: [
                        trigger('flyInOut', [
                            state('inactive', style({ opacity: 0 })),
                            state('active', style({ opacity: 1 })),
                            state('removed', style({ opacity: 0 })),
                            transition('inactive => active', animate('{{ easeTime }}ms {{ easing }}')),
                            transition('active => removed', animate('{{ easeTime }}ms {{ easing }}')),
                        ]),
                    ], preserveWhitespaces: false, template: "<div class=\"rds-container-left\"></div>\n<div class=\"rds-toast-inner\">\n  @if (options.icon && options.iconNamespace) {\n    <rds-icon\n      [icon]=\"options.icon\"\n      [namespace]=\"options.iconNamespace\"\n      class=\"rds-toast__leading-icon rds-icon\"\n    />\n  }\n  <div class=\"rds-toast-text\">\n    @if (title) {\n      <div\n        class=\"rds-toast-text__header\"\n        [class]=\"options.titleClass\"\n        [attr.aria-label]=\"title\"\n      >\n        {{ title }}\n      </div>\n    }\n    @if (message && options.enableHtml) {\n      <div\n        role=\"alertdialog\"\n        aria-live=\"polite\"\n        class=\"rds-toast-text__message\"\n        [class]=\"options.messageClass\"\n        [attr.aria-label]=\"message\"\n        [innerHTML]=\"message\"\n      ></div>\n    }\n    @if (message && !options.enableHtml) {\n      <div\n        role=\"alertdialog\"\n        aria-live=\"polite\"\n        class=\"rds-toast-text__message\"\n        [class]=\"options.messageClass\"\n        [attr.aria-label]=\"message\"\n      >\n        {{ message }}\n      </div>\n    }\n  </div>\n</div>\n@if (options.closeButton) {\n  <button rds-icon-button class=\"rds-toast__close-button\" (click)=\"remove()\">\n    <rds-icon icon=\"close\" namespace=\"outlined\" />\n  </button>\n}\n" }]
        }], ctorParameters: () => [], propDecorators: { toastClasses: [{
                type: HostBinding,
                args: ['class']
            }], state: [{
                type: HostBinding,
                args: ['@flyInOut']
            }], displayStyle: [{
                type: HostBinding,
                args: ['style.display']
            }], tapToast: [{
                type: HostListener,
                args: ['click']
            }], stickAround: [{
                type: HostListener,
                args: ['mouseenter']
            }], delayedHideToast: [{
                type: HostListener,
                args: ['mouseleave']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmRzLXRvYXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvdG9hc3QvcmRzLXRvYXN0LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvdG9hc3QvcmRzLXRvYXN0LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxPQUFPLEVBQ1AsS0FBSyxFQUNMLEtBQUssRUFDTCxVQUFVLEVBQ1YsT0FBTyxHQUNSLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsV0FBVyxFQUNYLFlBQVksRUFDWixNQUFNLEVBQ04sTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQzs7OztBQW1CaEUsTUFBTSxPQUFPLGlCQUFpQjtJQXdCNUIsSUFDSSxZQUFZO1FBQ2QsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssS0FBSyxVQUFVLEVBQUUsQ0FBQztZQUNwQyxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUdELFFBQVE7UUFDTixJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQ25DLE9BQU87UUFDVCxDQUFDO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUVsQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDOUIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2hCLENBQUM7SUFDSCxDQUFDO0lBR0QsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDbkMsT0FBTztRQUNULENBQUM7UUFFRCxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBR0QsZ0JBQWdCO1FBQ2QsSUFDRSxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsS0FBSyxJQUFJO1lBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxLQUFLLGlCQUFpQjtZQUNqRCxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsS0FBSyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFDOUIsQ0FBQztZQUNELE9BQU87UUFDVCxDQUFDO1FBRUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQztRQUNwRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQ7UUF4RWdCLG9CQUFlLEdBQzdCLE1BQU0sQ0FBMkMsZUFBZSxDQUFDLENBQUM7UUFDakQsZUFBVSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNoQyxXQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRS9ELFlBQU8sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUM7UUFDL0MsVUFBSyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQztRQUMzQyxZQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUM7UUFDdEMsb0JBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFLaEMsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFFeEMsVUFBSyxHQUFHO1lBQ04sS0FBSyxFQUFFLFVBQVU7WUFDakIsTUFBTSxFQUFFO2dCQUNOLFFBQVEsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxRQUFRO2dCQUM5QyxNQUFNLEVBQUUsU0FBUzthQUNsQjtTQUNGLENBQUM7UUFvREEsSUFBSSxDQUFDLFlBQVksR0FBRyxhQUFhLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUU5RyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQzdDLElBQUksQ0FBQyxZQUFZLElBQUksMEJBQTBCLENBQUM7UUFDbEQsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsSUFBSSxDQUFDLFlBQVksSUFBSSw0QkFBNEIsQ0FBQztRQUNwRCxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsWUFBWSxJQUFJLHVCQUF1QixDQUFDO1FBQy9DLENBQUM7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVE7YUFDMUIsYUFBYSxFQUFFO2FBQ2YsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUN6QyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRO2FBQzFCLFlBQVksRUFBRTthQUNkLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDekMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxXQUFXO1FBQ1QsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsYUFBYTtRQUNYLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDO1FBRWhELElBQ0UsQ0FBQyxDQUNDLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxLQUFLLElBQUk7WUFDcEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEtBQUssU0FBUyxDQUMxQztZQUNELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUNwQixDQUFDO1lBQ0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMvRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDOUQsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNuQyxPQUFPO1FBQ1QsQ0FBQztRQUVELFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUM7UUFDakQsSUFBSSxDQUFDLGNBQWMsQ0FDakIsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEVBQzNDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUN0QyxDQUFDO0lBQ0osQ0FBQztJQUVELGNBQWMsQ0FBSSxJQUFhLEVBQUUsT0FBZTtRQUM5QyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtnQkFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUM5QixHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQ2pDLE9BQU8sQ0FDUixDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMxRCxDQUFDO0lBQ0gsQ0FBQztJQUVPLGdCQUFnQixDQUFJLElBQWE7UUFDdkMsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNoQyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksRUFBRSxDQUFDO1FBQ1QsQ0FBQztJQUNILENBQUM7OEdBckpVLGlCQUFpQjtrR0FBakIsaUJBQWlCLCtSQ3BDOUIsd3hDQStDQSxvV0R6QmM7WUFDVixPQUFPLENBQUMsVUFBVSxFQUFFO2dCQUNsQixLQUFLLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN4QyxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN0QyxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN2QyxVQUFVLENBQ1Isb0JBQW9CLEVBQ3BCLE9BQU8sQ0FBQywrQkFBK0IsQ0FBQyxDQUN6QztnQkFDRCxVQUFVLENBQUMsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUM7YUFDMUUsQ0FBQztTQUNIOzsyRkFHVSxpQkFBaUI7a0JBakI3QixTQUFTOytCQUNFLHVCQUF1QixjQUVyQjt3QkFDVixPQUFPLENBQUMsVUFBVSxFQUFFOzRCQUNsQixLQUFLLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUN4QyxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUN0QyxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUN2QyxVQUFVLENBQ1Isb0JBQW9CLEVBQ3BCLE9BQU8sQ0FBQywrQkFBK0IsQ0FBQyxDQUN6Qzs0QkFDRCxVQUFVLENBQUMsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUM7eUJBQzFFLENBQUM7cUJBQ0gsdUJBQ29CLEtBQUs7d0RBZ0JKLFlBQVk7c0JBQWpDLFdBQVc7dUJBQUMsT0FBTztnQkFFcEIsS0FBSztzQkFESixXQUFXO3VCQUFDLFdBQVc7Z0JBVXBCLFlBQVk7c0JBRGYsV0FBVzt1QkFBQyxlQUFlO2dCQVU1QixRQUFRO3NCQURQLFlBQVk7dUJBQUMsT0FBTztnQkFjckIsV0FBVztzQkFEVixZQUFZO3VCQUFDLFlBQVk7Z0JBWTFCLGdCQUFnQjtzQkFEZixZQUFZO3VCQUFDLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBhbmltYXRlLFxuICBzdGF0ZSxcbiAgc3R5bGUsXG4gIHRyYW5zaXRpb24sXG4gIHRyaWdnZXIsXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBEZXN0cm95UmVmLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBpbmplY3QsXG4gIE5nWm9uZSxcbiAgT25EZXN0cm95LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJkc1RvYXN0UGFja2FnZSB9IGZyb20gJy4vcmRzLXRvYXN0LnBhY2thZ2UnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbcmRzLXRvYXN0LWNvbXBvbmVudF0nLFxuICB0ZW1wbGF0ZVVybDogJy4vcmRzLXRvYXN0LmNvbXBvbmVudC5odG1sJyxcbiAgYW5pbWF0aW9uczogW1xuICAgIHRyaWdnZXIoJ2ZseUluT3V0JywgW1xuICAgICAgc3RhdGUoJ2luYWN0aXZlJywgc3R5bGUoeyBvcGFjaXR5OiAwIH0pKSxcbiAgICAgIHN0YXRlKCdhY3RpdmUnLCBzdHlsZSh7IG9wYWNpdHk6IDEgfSkpLFxuICAgICAgc3RhdGUoJ3JlbW92ZWQnLCBzdHlsZSh7IG9wYWNpdHk6IDAgfSkpLFxuICAgICAgdHJhbnNpdGlvbihcbiAgICAgICAgJ2luYWN0aXZlID0+IGFjdGl2ZScsXG4gICAgICAgIGFuaW1hdGUoJ3t7IGVhc2VUaW1lIH19bXMge3sgZWFzaW5nIH19JyksXG4gICAgICApLFxuICAgICAgdHJhbnNpdGlvbignYWN0aXZlID0+IHJlbW92ZWQnLCBhbmltYXRlKCd7eyBlYXNlVGltZSB9fW1zIHt7IGVhc2luZyB9fScpKSxcbiAgICBdKSxcbiAgXSxcbiAgcHJlc2VydmVXaGl0ZXNwYWNlczogZmFsc2UsXG59KVxuZXhwb3J0IGNsYXNzIFJkc1RvYXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgcHVibGljIHJlYWRvbmx5IHJkc1RvYXN0UGFja2FnZSA9XG4gICAgaW5qZWN0PFJkc1RvYXN0UGFja2FnZTxSZHNUb2FzdENvbXBvbmVudCwgdm9pZD4+KFJkc1RvYXN0UGFja2FnZSk7XG4gIHByb3RlY3RlZCByZWFkb25seSBkZXN0cm95UmVmID0gaW5qZWN0KERlc3Ryb3lSZWYpO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbmdab25lID0gaW5qZWN0KE5nWm9uZSwgeyBvcHRpb25hbDogdHJ1ZSB9KTtcblxuICBtZXNzYWdlID0gdGhpcy5yZHNUb2FzdFBhY2thZ2UubWVzc2FnZSB8fCBudWxsO1xuICB0aXRsZSA9IHRoaXMucmRzVG9hc3RQYWNrYWdlLnRpdGxlIHx8IG51bGw7XG4gIG9wdGlvbnMgPSB0aGlzLnJkc1RvYXN0UGFja2FnZS5jb25maWc7XG4gIG9yaWdpbmFsVGltZW91dCA9IHRoaXMucmRzVG9hc3RQYWNrYWdlLmNvbmZpZy50aW1lT3V0O1xuXG4gIHByaXZhdGUgdGltZW91dDogbnVtYmVyO1xuICBwcml2YXRlIGhpZGVUaW1lOiBudW1iZXI7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIHRvYXN0Q2xhc3NlcyA9ICcnO1xuICBASG9zdEJpbmRpbmcoJ0BmbHlJbk91dCcpXG4gIHN0YXRlID0ge1xuICAgIHZhbHVlOiAnaW5hY3RpdmUnLFxuICAgIHBhcmFtczoge1xuICAgICAgZWFzZVRpbWU6IHRoaXMucmRzVG9hc3RQYWNrYWdlLmNvbmZpZy5lYXNlVGltZSxcbiAgICAgIGVhc2luZzogJ2Vhc2UtaW4nLFxuICAgIH0sXG4gIH07XG5cbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS5kaXNwbGF5JylcbiAgZ2V0IGRpc3BsYXlTdHlsZSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlID09PSAnaW5hY3RpdmUnKSB7XG4gICAgICByZXR1cm4gJ25vbmUnO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdjbGljaycpXG4gIHRhcFRvYXN0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlID09PSAncmVtb3ZlZCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnJkc1RvYXN0UGFja2FnZS50cmlnZ2VyVGFwKCk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLnRhcFRvRGlzbWlzcykge1xuICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJylcbiAgc3RpY2tBcm91bmQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgPT09ICdyZW1vdmVkJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xuICAgIHRoaXMub3B0aW9ucy50aW1lT3V0ID0gMDtcbiAgICB0aGlzLmhpZGVUaW1lID0gMDtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKVxuICBkZWxheWVkSGlkZVRvYXN0KCk6IHZvaWQge1xuICAgIGlmIChcbiAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlVGltZU91dCA9PT0gdHJ1ZSB8fFxuICAgICAgdGhpcy5vcHRpb25zLmRpc2FibGVUaW1lT3V0ID09PSAnZXh0ZW5kZWRUaW1lT3V0JyB8fFxuICAgICAgdGhpcy5vcHRpb25zLmV4dGVuZGVkVGltZU91dCA9PT0gMCB8fFxuICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9PT0gJ3JlbW92ZWQnXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5vdXRzaWRlVGltZW91dCgoKSA9PiB0aGlzLnJlbW92ZSgpLCB0aGlzLm9wdGlvbnMuZXh0ZW5kZWRUaW1lT3V0KTtcbiAgICB0aGlzLm9wdGlvbnMudGltZU91dCA9IHRoaXMub3B0aW9ucy5leHRlbmRlZFRpbWVPdXQ7XG4gICAgdGhpcy5oaWRlVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgKHRoaXMub3B0aW9ucy50aW1lT3V0IHx8IDApO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50b2FzdENsYXNzZXMgPSBgcmRzLXRvYXN0LSR7dGhpcy5yZHNUb2FzdFBhY2thZ2UuY29uZmlnLnR5cGV9ICR7dGhpcy5yZHNUb2FzdFBhY2thZ2UuY29uZmlnLnRvYXN0Q2xhc3N9YDtcblxuICAgIGlmICh0aGlzLnJkc1RvYXN0UGFja2FnZS5jb25maWcudGFwVG9EaXNtaXNzKSB7XG4gICAgICB0aGlzLnRvYXN0Q2xhc3NlcyArPSAnIHJkcy10b2FzdC1kaXNtaXNzLWNsaWNrJztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZHNUb2FzdFBhY2thZ2UuY29uZmlnLmNsb3NlQnV0dG9uKSB7XG4gICAgICB0aGlzLnRvYXN0Q2xhc3NlcyArPSAnIHJkcy10b2FzdC13aXRoLWNsb3NlLWljb24nO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRpdGxlKSB7XG4gICAgICB0aGlzLnRvYXN0Q2xhc3NlcyArPSAnIHJkcy10b2FzdC13aXRoLXRpdGxlJztcbiAgICB9XG5cbiAgICB0aGlzLnJkc1RvYXN0UGFja2FnZS50b2FzdFJlZlxuICAgICAgLmFmdGVyQWN0aXZhdGUoKVxuICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuYWN0aXZhdGVUb2FzdCgpKTtcbiAgICB0aGlzLnJkc1RvYXN0UGFja2FnZS50b2FzdFJlZlxuICAgICAgLm1hbnVhbENsb3NlZCgpXG4gICAgICAucGlwZSh0YWtlVW50aWxEZXN0cm95ZWQodGhpcy5kZXN0cm95UmVmKSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5yZW1vdmUoKSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgfVxuXG4gIGFjdGl2YXRlVG9hc3QoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IHsgLi4udGhpcy5zdGF0ZSwgdmFsdWU6ICdhY3RpdmUnIH07XG5cbiAgICBpZiAoXG4gICAgICAhKFxuICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZVRpbWVPdXQgPT09IHRydWUgfHxcbiAgICAgICAgdGhpcy5vcHRpb25zLmRpc2FibGVUaW1lT3V0ID09PSAndGltZU91dCdcbiAgICAgICkgJiZcbiAgICAgIHRoaXMub3B0aW9ucy50aW1lT3V0XG4gICAgKSB7XG4gICAgICB0aGlzLm91dHNpZGVUaW1lb3V0KCgpID0+IHRoaXMucmVtb3ZlKCksIHRoaXMub3B0aW9ucy50aW1lT3V0KTtcbiAgICAgIHRoaXMuaGlkZVRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIHRoaXMub3B0aW9ucy50aW1lT3V0O1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zdGF0ZS52YWx1ZSA9PT0gJ3JlbW92ZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgdGhpcy5zdGF0ZSA9IHsgLi4udGhpcy5zdGF0ZSwgdmFsdWU6ICdyZW1vdmVkJyB9O1xuICAgIHRoaXMub3V0c2lkZVRpbWVvdXQoXG4gICAgICAoKSA9PiB0aGlzLnJkc1RvYXN0UGFja2FnZS50b2FzdFJlZi5jbG9zZSgpLFxuICAgICAgK3RoaXMucmRzVG9hc3RQYWNrYWdlLmNvbmZpZy5lYXNlVGltZSxcbiAgICApO1xuICB9XG5cbiAgb3V0c2lkZVRpbWVvdXQ8VD4oZnVuYzogKCkgPT4gVCwgdGltZW91dDogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubmdab25lKSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMudGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KFxuICAgICAgICAgICgpID0+IHRoaXMucnVuSW5zaWRlQW5ndWxhcihmdW5jKSxcbiAgICAgICAgICB0aW1lb3V0LFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IGZ1bmMoKSwgdGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBydW5JbnNpZGVBbmd1bGFyPFQ+KGZ1bmM6ICgpID0+IFQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5uZ1pvbmUpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiBmdW5jKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmdW5jKCk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicmRzLWNvbnRhaW5lci1sZWZ0XCI+PC9kaXY+XG48ZGl2IGNsYXNzPVwicmRzLXRvYXN0LWlubmVyXCI+XG4gIEBpZiAob3B0aW9ucy5pY29uICYmIG9wdGlvbnMuaWNvbk5hbWVzcGFjZSkge1xuICAgIDxyZHMtaWNvblxuICAgICAgW2ljb25dPVwib3B0aW9ucy5pY29uXCJcbiAgICAgIFtuYW1lc3BhY2VdPVwib3B0aW9ucy5pY29uTmFtZXNwYWNlXCJcbiAgICAgIGNsYXNzPVwicmRzLXRvYXN0X19sZWFkaW5nLWljb24gcmRzLWljb25cIlxuICAgIC8+XG4gIH1cbiAgPGRpdiBjbGFzcz1cInJkcy10b2FzdC10ZXh0XCI+XG4gICAgQGlmICh0aXRsZSkge1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz1cInJkcy10b2FzdC10ZXh0X19oZWFkZXJcIlxuICAgICAgICBbY2xhc3NdPVwib3B0aW9ucy50aXRsZUNsYXNzXCJcbiAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJ0aXRsZVwiXG4gICAgICA+XG4gICAgICAgIHt7IHRpdGxlIH19XG4gICAgICA8L2Rpdj5cbiAgICB9XG4gICAgQGlmIChtZXNzYWdlICYmIG9wdGlvbnMuZW5hYmxlSHRtbCkge1xuICAgICAgPGRpdlxuICAgICAgICByb2xlPVwiYWxlcnRkaWFsb2dcIlxuICAgICAgICBhcmlhLWxpdmU9XCJwb2xpdGVcIlxuICAgICAgICBjbGFzcz1cInJkcy10b2FzdC10ZXh0X19tZXNzYWdlXCJcbiAgICAgICAgW2NsYXNzXT1cIm9wdGlvbnMubWVzc2FnZUNsYXNzXCJcbiAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJtZXNzYWdlXCJcbiAgICAgICAgW2lubmVySFRNTF09XCJtZXNzYWdlXCJcbiAgICAgID48L2Rpdj5cbiAgICB9XG4gICAgQGlmIChtZXNzYWdlICYmICFvcHRpb25zLmVuYWJsZUh0bWwpIHtcbiAgICAgIDxkaXZcbiAgICAgICAgcm9sZT1cImFsZXJ0ZGlhbG9nXCJcbiAgICAgICAgYXJpYS1saXZlPVwicG9saXRlXCJcbiAgICAgICAgY2xhc3M9XCJyZHMtdG9hc3QtdGV4dF9fbWVzc2FnZVwiXG4gICAgICAgIFtjbGFzc109XCJvcHRpb25zLm1lc3NhZ2VDbGFzc1wiXG4gICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwibWVzc2FnZVwiXG4gICAgICA+XG4gICAgICAgIHt7IG1lc3NhZ2UgfX1cbiAgICAgIDwvZGl2PlxuICAgIH1cbiAgPC9kaXY+XG48L2Rpdj5cbkBpZiAob3B0aW9ucy5jbG9zZUJ1dHRvbikge1xuICA8YnV0dG9uIHJkcy1pY29uLWJ1dHRvbiBjbGFzcz1cInJkcy10b2FzdF9fY2xvc2UtYnV0dG9uXCIgKGNsaWNrKT1cInJlbW92ZSgpXCI+XG4gICAgPHJkcy1pY29uIGljb249XCJjbG9zZVwiIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgLz5cbiAgPC9idXR0b24+XG59XG4iXX0=