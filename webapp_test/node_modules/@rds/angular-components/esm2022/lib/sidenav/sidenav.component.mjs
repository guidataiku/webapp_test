import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, DestroyRef, ElementRef, EventEmitter, HostBinding, inject, Input, Output, QueryList, Renderer2, RendererStyleFlags2, ViewChild, ViewEncapsulation, } from '@angular/core';
import { RdsSidenavService } from './sidenav.service';
import { merge } from 'rxjs';
import { startWith, switchMap } from 'rxjs/operators';
import { DOCUMENT } from '@angular/common';
import { FocusKeyManager } from '@angular/cdk/a11y';
import { DOWN_ARROW, TAB, UP_ARROW } from '@angular/cdk/keycodes';
import { RdsSidenavMenuTriggerComponent } from './sidenav-menuitem-trigger/sidenav-menu-trigger.component';
import { SidenavItem } from './sidenav-item';
import { getScrollingAncestor } from '../utils';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
import * as i1 from "../icons/icon.component";
import * as i2 from "../button/icon-button.component";
import * as i3 from "../utils/resize-observer.util";
import * as i4 from "./sidenav-footer/sidenav-footer.component";
export class RdsSidenavComponent {
    constructor() {
        this.destroyRef = inject(DestroyRef);
        this.nativeElement = inject(ElementRef).nativeElement;
        this.document = inject(DOCUMENT);
        this.renderer = inject(Renderer2);
        this.cdr = inject(ChangeDetectorRef);
        this.sidenavService = inject(RdsSidenavService);
        this.menubarHeight = null;
        this.isExpandable = true;
        this.isMinimalChange = new EventEmitter();
        this.directDescendantItems = new QueryList();
    }
    set isMinimal(v) {
        this.sidenavService.isMinimal = booleanAttribute(v);
    }
    get isMinimal() {
        return this.sidenavService.isMinimal;
    }
    get isInMinimalState() {
        return this.isMinimal;
    }
    get isInFullState() {
        return !this.isMinimal;
    }
    ngOnInit() {
        this.sidenavService.isMinimal$
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe((isMinimal) => this.onMinimalStateChange(isMinimal));
    }
    ngAfterContentInit() {
        this.onContentChanged();
        this.updateDirectDescendants();
        this.keyManager = new FocusKeyManager(this.directDescendantItems)
            .withWrap()
            .withHomeAndEnd();
        this.directDescendantItems.changes
            .pipe(startWith(this.directDescendantItems), switchMap((menus) => merge(...menus.map((menu) => menu._focused))))
            .subscribe((focusedMenu) => {
            this.keyManager.updateActiveItem(focusedMenu);
        });
    }
    ngAfterViewInit() {
        this.scrollingAncestor =
            getScrollingAncestor(this.nativeElement) ?? this.document.body;
        // update other layout work like @HostBindings and other components destruction is finished
        setTimeout(() => {
            this.updateSelfAppearance();
        });
    }
    ngOnDestroy() {
        this.directDescendantItems.destroy();
    }
    toggleIsMinimal() {
        this.sidenavService.toggleIsMinimal();
    }
    onContentChanged(entries) {
        this.scrollingAncestor =
            getScrollingAncestor(this.nativeElement) ?? this.document.body;
        const newHeight = this.getHeight(entries);
        if (newHeight === null || newHeight !== this.menubarHeight) {
            this.menubarHeight = newHeight;
            this.noScroll = this.calculateNoScroll();
            this.cdr.detectChanges();
        }
    }
    handleKeydown(event) {
        const keyCode = event.keyCode;
        const manager = this.keyManager;
        const delta = event.shiftKey ? -1 : 1;
        const activeItemIndex = manager.activeItemIndex ?? -1;
        switch (keyCode) {
            case TAB:
                manager.setFocusOrigin('keyboard');
                manager.updateActiveItem(activeItemIndex + delta);
                if (!event.shiftKey) {
                    this.scrollIfNeeded(manager.activeItem);
                }
                break;
            default:
                if (keyCode === UP_ARROW || keyCode === DOWN_ARROW) {
                    manager.setFocusOrigin('keyboard');
                }
                manager.onKeydown(event);
        }
    }
    scrollIfNeeded(activeItem) {
        if (!activeItem || !this.footerRef) {
            return;
        }
        const elY = activeItem.nativeElement.offsetTop;
        const elHeight = activeItem.nativeElement.offsetHeight;
        const paddingTop = 20;
        if (elY + elHeight >= this.footerRef.nativeElement.offsetTop) {
            const scroller = this.isMinimal
                ? this.scrollingAncestor
                : this.navRef.nativeElement;
            scroller.scrollTo(0, elY - paddingTop);
        }
    }
    getHeight(entries) {
        if (!entries || !entries[0]) {
            return null;
        }
        return entries[0].contentRect.height;
    }
    onMinimalStateChange(isMinimal) {
        this.updateSelfAppearance();
        this.isMinimalChange.emit(isMinimal);
    }
    updateSelfAppearance() {
        const { top } = this.nativeElement.getBoundingClientRect();
        this.renderer.setStyle(this.nativeElement, '--rds-sidenav-offset-top', `${top}px`, RendererStyleFlags2.DashCase);
    }
    calculateNoScroll() {
        if (!this.nativeElement.firstElementChild) {
            return false;
        }
        return (this.scrollingAncestor.offsetHeight >=
            this.nativeElement.firstElementChild.scrollHeight);
    }
    updateDirectDescendants() {
        this.children.changes
            .pipe(startWith(this.children))
            .subscribe((items) => {
            this.directDescendantItems.reset(items.filter((item) => item instanceof RdsSidenavMenuTriggerComponent ||
                item._parentMenu == undefined));
            this.directDescendantItems.notifyOnChanges();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSidenavComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsSidenavComponent, selector: "rds-sidenav", inputs: { isExpandable: ["isExpandable", "isExpandable", booleanAttribute], isMinimal: "isMinimal" }, outputs: { isMinimalChange: "isMinimalChange" }, host: { properties: { "class.rds-sidenav-minimal": "this.isInMinimalState", "class.rds-sidenav-full": "this.isInFullState" } }, providers: [RdsSidenavService], queries: [{ propertyName: "children", predicate: SidenavItem, descendants: true }], viewQueries: [{ propertyName: "footerRef", first: true, predicate: ["footer"], descendants: true, read: ElementRef }, { propertyName: "navRef", first: true, predicate: ["nav"], descendants: true, read: ElementRef }], exportAs: ["rdsSidenav"], ngImport: i0, template: "<nav #nav>\n  <div\n    role=\"menubar\"\n    (rdsObserveResize)=\"onContentChanged($event)\"\n    (keydown)=\"handleKeydown($event)\"\n  >\n    <ng-content />\n  </div>\n  @if (isExpandable) {\n    <rds-sidenav-footer #footer [class.rds-sidenav-footer-no-scroll]=\"noScroll\">\n      <button\n        class=\"expand-toggle\"\n        title=\"expand toggle\"\n        rds-icon-button\n        size=\"m\"\n        (click)=\"toggleIsMinimal()\"\n      >\n        <rds-icon icon=\"double_chevron_right\" />\n      </button>\n    </rds-sidenav-footer>\n  }\n</nav>\n", styles: ["rds-sidenav{--rds-sidenav-background-color: var(--rds-color-bg-base-1);--rds-sidenav-border-right: 1px solid var(--rds-color-grey-1);display:flex;border-right:var(--rds-sidenav-border-right);height:calc(100% - var(--rds-sidenav-offset-top, 0px));max-height:calc(100vh - var(--rds-sidenav-offset-top, 0px));width:fit-content;background-color:var(--rds-sidenav-background-color)}rds-sidenav>nav{position:relative;flex-direction:column;display:flex;overflow-y:auto;width:18rem;padding:20px 24px}rds-sidenav>nav rds-sidenav-menu+button,rds-sidenav>nav [rds-sidenav-menuitem]+[rds-sidenav-menuitem]{margin-top:4px}rds-sidenav>nav rds-sidenav-group{--rds-sidenav-group-spacing: 24px;--rds-sidenav-group-padding: 24px 0;--rds-sidenav-group-divider-color: var(--rds-color-grey-2);--rds-sidenav-group-header-color: var(--rds-color-low-contrast);--rds-sidenav-group-header-padding: 8px 0}rds-sidenav>nav rds-sidenav-group+[rds-sidenav-menuitem]{margin-top:24px}rds-sidenav>nav rds-sidenav-footer{--rds-sidenav-footer-background-color: var(--rds-color-bg-base-1);--rds-sidenav-footer-position-bottom: -20px;--rds-sidenav-footer-margin-bottom: -20px;--rds-sidenav-footer-margin-inline: -24px;--rds-sidenav-footer-padding-bottom: 20px}rds-sidenav>nav .expand-toggle{height:40px!important;width:40px!important}rds-sidenav>nav .expand-toggle:after{left:0!important;top:0!important;height:40px!important;width:40px!important}rds-sidenav>nav .expand-toggle rds-icon{transform:rotateY(180deg);transition-duration:0ms}rds-sidenav>nav .expand-toggle:before{display:none!important}rds-sidenav.rds-sidenav-minimal{height:auto;min-height:calc(100vh - var(--rds-sidenav-offset-top, 0px));max-height:unset}rds-sidenav.rds-sidenav-minimal nav{overflow-y:visible;width:72px;padding:20px 16px}rds-sidenav.rds-sidenav-minimal nav .sr-only-when-minimal,rds-sidenav.rds-sidenav-minimal nav .sr-only-when-minimal-and-first-level{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}rds-sidenav.rds-sidenav-minimal nav rds-sidenav-footer{--rds-sidenav-footer-position-bottom: 0;--rds-sidenav-footer-margin-inline: -16px}rds-sidenav.rds-sidenav-minimal nav rds-sidenav-menu .sr-only-when-minimal-and-first-level{position:unset;width:unset;height:unset;overflow:unset;clip:unset;margin:unset;border:unset;padding:unset}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem{padding:8px}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem rds-icon{height:1.5rem;width:1.5rem}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:hover,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:hover{background:var(--rds-color-bg-transparent-hover-select)}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:hover>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger.rds-sidenav-menuitem-active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:hover>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-trigger,.rds-sidenav-menuitem{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;position:relative;align-items:center;display:flex;gap:12px;border:none;border-radius:6px;width:100%;padding:8px 0;background:none;cursor:pointer;-webkit-user-select:none;user-select:none;text-decoration:none;color:var(--rds-color-low-contrast)}.rds-sidenav-menu-trigger rds-icon,.rds-sidenav-menuitem rds-icon{height:18px;width:18px}.rds-sidenav-menu-trigger:hover,.rds-sidenav-menu-trigger:active,.rds-sidenav-menu-trigger.rds-sidenav-menuitem-active,.rds-sidenav-menuitem:hover,.rds-sidenav-menuitem:active,.rds-sidenav-menuitem.rds-sidenav-menuitem-active{outline:none;color:var(--rds-color-high-contrast)}.rds-sidenav-menu-trigger:hover>rds-icon,.rds-sidenav-menu-trigger:active>rds-icon,.rds-sidenav-menu-trigger.rds-sidenav-menuitem-active>rds-icon,.rds-sidenav-menuitem:hover>rds-icon,.rds-sidenav-menuitem:active>rds-icon,.rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-trigger:active,.rds-sidenav-menuitem:active{color:var(--rds-color-informative)}.rds-sidenav-menu-trigger:focus-visible,.rds-sidenav-menuitem:focus-visible{outline:1px solid var(--rds-color-stroke-active-focus)}.rds-sidenav-menu-trigger{z-index:2}.rds-sidenav-minimal.rds-sidenav-menuitem{padding:8px}.rds-sidenav-minimal.rds-sidenav-menuitem rds-icon{height:1.5rem;width:1.5rem}.rds-sidenav-minimal.rds-sidenav-menuitem:hover>rds-icon,.rds-sidenav-minimal.rds-sidenav-menuitem:active>rds-icon,.rds-sidenav-minimal.rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem{padding:8px 16px}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem:hover{background-color:var(--rds-color-bg-solid-hover-select);color:var(--rds-color-low-contrast)}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem:focus-visible{color:var(--rds-color-informative)}.rds-sidenav-minimal .expand-toggle rds-icon{transform:rotateY(0)}.rds-sidenav-badge-container{margin-top:-2px;margin-left:auto}.rds-sidenav-minimal .rds-sidenav-badge-container{position:absolute;top:-7%;left:55%}\n"], dependencies: [{ kind: "component", type: i1.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }, { kind: "directive", type: i3.RdsObserveResizeDirective, selector: "[rdsObserveResize]", inputs: ["rdsObserveResizeDisabled", "debounce"], outputs: ["rdsObserveResize"], exportAs: ["rdsObserveResize"] }, { kind: "component", type: i4.RdsSidenavFooterComponent, selector: "rds-sidenav-footer" }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSidenavComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-sidenav', exportAs: 'rdsSidenav', changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, providers: [RdsSidenavService], template: "<nav #nav>\n  <div\n    role=\"menubar\"\n    (rdsObserveResize)=\"onContentChanged($event)\"\n    (keydown)=\"handleKeydown($event)\"\n  >\n    <ng-content />\n  </div>\n  @if (isExpandable) {\n    <rds-sidenav-footer #footer [class.rds-sidenav-footer-no-scroll]=\"noScroll\">\n      <button\n        class=\"expand-toggle\"\n        title=\"expand toggle\"\n        rds-icon-button\n        size=\"m\"\n        (click)=\"toggleIsMinimal()\"\n      >\n        <rds-icon icon=\"double_chevron_right\" />\n      </button>\n    </rds-sidenav-footer>\n  }\n</nav>\n", styles: ["rds-sidenav{--rds-sidenav-background-color: var(--rds-color-bg-base-1);--rds-sidenav-border-right: 1px solid var(--rds-color-grey-1);display:flex;border-right:var(--rds-sidenav-border-right);height:calc(100% - var(--rds-sidenav-offset-top, 0px));max-height:calc(100vh - var(--rds-sidenav-offset-top, 0px));width:fit-content;background-color:var(--rds-sidenav-background-color)}rds-sidenav>nav{position:relative;flex-direction:column;display:flex;overflow-y:auto;width:18rem;padding:20px 24px}rds-sidenav>nav rds-sidenav-menu+button,rds-sidenav>nav [rds-sidenav-menuitem]+[rds-sidenav-menuitem]{margin-top:4px}rds-sidenav>nav rds-sidenav-group{--rds-sidenav-group-spacing: 24px;--rds-sidenav-group-padding: 24px 0;--rds-sidenav-group-divider-color: var(--rds-color-grey-2);--rds-sidenav-group-header-color: var(--rds-color-low-contrast);--rds-sidenav-group-header-padding: 8px 0}rds-sidenav>nav rds-sidenav-group+[rds-sidenav-menuitem]{margin-top:24px}rds-sidenav>nav rds-sidenav-footer{--rds-sidenav-footer-background-color: var(--rds-color-bg-base-1);--rds-sidenav-footer-position-bottom: -20px;--rds-sidenav-footer-margin-bottom: -20px;--rds-sidenav-footer-margin-inline: -24px;--rds-sidenav-footer-padding-bottom: 20px}rds-sidenav>nav .expand-toggle{height:40px!important;width:40px!important}rds-sidenav>nav .expand-toggle:after{left:0!important;top:0!important;height:40px!important;width:40px!important}rds-sidenav>nav .expand-toggle rds-icon{transform:rotateY(180deg);transition-duration:0ms}rds-sidenav>nav .expand-toggle:before{display:none!important}rds-sidenav.rds-sidenav-minimal{height:auto;min-height:calc(100vh - var(--rds-sidenav-offset-top, 0px));max-height:unset}rds-sidenav.rds-sidenav-minimal nav{overflow-y:visible;width:72px;padding:20px 16px}rds-sidenav.rds-sidenav-minimal nav .sr-only-when-minimal,rds-sidenav.rds-sidenav-minimal nav .sr-only-when-minimal-and-first-level{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}rds-sidenav.rds-sidenav-minimal nav rds-sidenav-footer{--rds-sidenav-footer-position-bottom: 0;--rds-sidenav-footer-margin-inline: -16px}rds-sidenav.rds-sidenav-minimal nav rds-sidenav-menu .sr-only-when-minimal-and-first-level{position:unset;width:unset;height:unset;overflow:unset;clip:unset;margin:unset;border:unset;padding:unset}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem{padding:8px}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem rds-icon{height:1.5rem;width:1.5rem}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:hover,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:hover{background:var(--rds-color-bg-transparent-hover-select)}rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:hover>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger:active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menu-trigger.rds-sidenav-menuitem-active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:hover>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem:active>rds-icon,rds-sidenav.rds-sidenav-minimal .rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-trigger,.rds-sidenav-menuitem{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;position:relative;align-items:center;display:flex;gap:12px;border:none;border-radius:6px;width:100%;padding:8px 0;background:none;cursor:pointer;-webkit-user-select:none;user-select:none;text-decoration:none;color:var(--rds-color-low-contrast)}.rds-sidenav-menu-trigger rds-icon,.rds-sidenav-menuitem rds-icon{height:18px;width:18px}.rds-sidenav-menu-trigger:hover,.rds-sidenav-menu-trigger:active,.rds-sidenav-menu-trigger.rds-sidenav-menuitem-active,.rds-sidenav-menuitem:hover,.rds-sidenav-menuitem:active,.rds-sidenav-menuitem.rds-sidenav-menuitem-active{outline:none;color:var(--rds-color-high-contrast)}.rds-sidenav-menu-trigger:hover>rds-icon,.rds-sidenav-menu-trigger:active>rds-icon,.rds-sidenav-menu-trigger.rds-sidenav-menuitem-active>rds-icon,.rds-sidenav-menuitem:hover>rds-icon,.rds-sidenav-menuitem:active>rds-icon,.rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-trigger:active,.rds-sidenav-menuitem:active{color:var(--rds-color-informative)}.rds-sidenav-menu-trigger:focus-visible,.rds-sidenav-menuitem:focus-visible{outline:1px solid var(--rds-color-stroke-active-focus)}.rds-sidenav-menu-trigger{z-index:2}.rds-sidenav-minimal.rds-sidenav-menuitem{padding:8px}.rds-sidenav-minimal.rds-sidenav-menuitem rds-icon{height:1.5rem;width:1.5rem}.rds-sidenav-minimal.rds-sidenav-menuitem:hover>rds-icon,.rds-sidenav-minimal.rds-sidenav-menuitem:active>rds-icon,.rds-sidenav-minimal.rds-sidenav-menuitem.rds-sidenav-menuitem-active>rds-icon{color:inherit}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem{padding:8px 16px}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem:hover{background-color:var(--rds-color-bg-solid-hover-select);color:var(--rds-color-low-contrast)}.rds-sidenav-menu-panel .rds-sidenav-minimal.rds-sidenav-menuitem:focus-visible{color:var(--rds-color-informative)}.rds-sidenav-minimal .expand-toggle rds-icon{transform:rotateY(0)}.rds-sidenav-badge-container{margin-top:-2px;margin-left:auto}.rds-sidenav-minimal .rds-sidenav-badge-container{position:absolute;top:-7%;left:55%}\n"] }]
        }], propDecorators: { isExpandable: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], isMinimal: [{
                type: Input
            }], isInMinimalState: [{
                type: HostBinding,
                args: ['class.rds-sidenav-minimal']
            }], isInFullState: [{
                type: HostBinding,
                args: ['class.rds-sidenav-full']
            }], isMinimalChange: [{
                type: Output
            }], children: [{
                type: ContentChildren,
                args: [SidenavItem, { descendants: true }]
            }], footerRef: [{
                type: ViewChild,
                args: ['footer', { read: ElementRef }]
            }], navRef: [{
                type: ViewChild,
                args: ['nav', { read: ElementRef }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZW5hdi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3NpZGVuYXYvc2lkZW5hdi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3NpZGVuYXYvc2lkZW5hdi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFDVCxtQkFBbUIsRUFDbkIsU0FBUyxFQUNULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdCLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUUzRyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWhELE9B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YixXQUFXLGdJQUtDLFVBQVUsd0ZBR2IsVUFBVSx1REM5RnRDLG9qQkFzQkE7OzJGRHdCYSxtQkFBbUI7a0JBVC9CLFNBQVM7K0JBQ0UsYUFBYSxZQUNiLFlBQVksbUJBR0wsdUJBQXVCLENBQUMsTUFBTSxpQkFDaEMsaUJBQWlCLENBQUMsSUFBSSxhQUMxQixDQUFDLGlCQUFpQixDQUFDOzhCQWtCVSxZQUFZO3NCQUFuRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUdsQyxTQUFTO3NCQURaLEtBQUs7Z0JBVUYsZ0JBQWdCO3NCQURuQixXQUFXO3VCQUFDLDJCQUEyQjtnQkFNcEMsYUFBYTtzQkFEaEIsV0FBVzt1QkFBQyx3QkFBd0I7Z0JBTXJDLGVBQWU7c0JBRGQsTUFBTTtnQkFJQyxRQUFRO3NCQURmLGVBQWU7dUJBQUMsV0FBVyxFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRTtnQkFNM0MsU0FBUztzQkFEaEIsU0FBUzt1QkFBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO2dCQUlqQyxNQUFNO3NCQURiLFNBQVM7dUJBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIERlc3Ryb3lSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIGluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgUmVuZGVyZXIyLFxuICBSZW5kZXJlclN0eWxlRmxhZ3MyLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJkc1NpZGVuYXZTZXJ2aWNlIH0gZnJvbSAnLi9zaWRlbmF2LnNlcnZpY2UnO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IG1lcmdlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzdGFydFdpdGgsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEZvY3VzS2V5TWFuYWdlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IERPV05fQVJST1csIFRBQiwgVVBfQVJST1cgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgUmRzU2lkZW5hdk1lbnVUcmlnZ2VyQ29tcG9uZW50IH0gZnJvbSAnLi9zaWRlbmF2LW1lbnVpdGVtLXRyaWdnZXIvc2lkZW5hdi1tZW51LXRyaWdnZXIuY29tcG9uZW50JztcbmltcG9ydCB7IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudCB9IGZyb20gJy4vc2lkZW5hdi1tZW51aXRlbS9zaWRlbmF2LW1lbnVpdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTaWRlbmF2SXRlbSB9IGZyb20gJy4vc2lkZW5hdi1pdGVtJztcbmltcG9ydCB7IGdldFNjcm9sbGluZ0FuY2VzdG9yIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgTmF0aXZlRWxlbWVudCB9IGZyb20gJy4vc2lkZW5hdi50eXBlcyc7XG5pbXBvcnQgeyB0YWtlVW50aWxEZXN0cm95ZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1zaWRlbmF2JyxcbiAgZXhwb3J0QXM6ICdyZHNTaWRlbmF2JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NpZGVuYXYuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnc2lkZW5hdi5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgcHJvdmlkZXJzOiBbUmRzU2lkZW5hdlNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNTaWRlbmF2Q29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3lcbntcbiAgcHJpdmF0ZSByZWFkb25seSBkZXN0cm95UmVmID0gaW5qZWN0KERlc3Ryb3lSZWYpO1xuICBwcml2YXRlIHJlYWRvbmx5IG5hdGl2ZUVsZW1lbnQ6IEhUTUxFbGVtZW50ID1cbiAgICBpbmplY3QoRWxlbWVudFJlZikubmF0aXZlRWxlbWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSBkb2N1bWVudDogRG9jdW1lbnQgPSBpbmplY3QoRE9DVU1FTlQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlbmRlcmVyID0gaW5qZWN0KFJlbmRlcmVyMik7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBzaWRlbmF2U2VydmljZSA9IGluamVjdChSZHNTaWRlbmF2U2VydmljZSk7XG5cbiAgcHJpdmF0ZSBtZW51YmFySGVpZ2h0OiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBzY3JvbGxpbmdBbmNlc3RvcjogSFRNTEVsZW1lbnQ7XG5cbiAgbm9TY3JvbGw6IGJvb2xlYW47XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGlzRXhwYW5kYWJsZSA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgc2V0IGlzTWluaW1hbCh2OiBCb29sZWFuSW5wdXQpIHtcbiAgICB0aGlzLnNpZGVuYXZTZXJ2aWNlLmlzTWluaW1hbCA9IGJvb2xlYW5BdHRyaWJ1dGUodik7XG4gIH1cblxuICBnZXQgaXNNaW5pbWFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNpZGVuYXZTZXJ2aWNlLmlzTWluaW1hbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MucmRzLXNpZGVuYXYtbWluaW1hbCcpXG4gIGdldCBpc0luTWluaW1hbFN0YXRlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzTWluaW1hbDtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MucmRzLXNpZGVuYXYtZnVsbCcpXG4gIGdldCBpc0luRnVsbFN0YXRlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5pc01pbmltYWw7XG4gIH1cblxuICBAT3V0cHV0KClcbiAgaXNNaW5pbWFsQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oU2lkZW5hdkl0ZW0sIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcbiAgcHJpdmF0ZSBjaGlsZHJlbjogUXVlcnlMaXN0PFxuICAgIFJkc1NpZGVuYXZNZW51VHJpZ2dlckNvbXBvbmVudCB8IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudFxuICA+O1xuXG4gIEBWaWV3Q2hpbGQoJ2Zvb3RlcicsIHsgcmVhZDogRWxlbWVudFJlZiB9KVxuICBwcml2YXRlIGZvb3RlclJlZj86IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+O1xuXG4gIEBWaWV3Q2hpbGQoJ25hdicsIHsgcmVhZDogRWxlbWVudFJlZiB9KVxuICBwcml2YXRlIG5hdlJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG5cbiAgcHJpdmF0ZSBkaXJlY3REZXNjZW5kYW50SXRlbXMgPSBuZXcgUXVlcnlMaXN0PFxuICAgIFJkc1NpZGVuYXZNZW51VHJpZ2dlckNvbXBvbmVudCB8IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudFxuICA+KCk7XG5cbiAgcHJpdmF0ZSBrZXlNYW5hZ2VyOiBGb2N1c0tleU1hbmFnZXI8XG4gICAgUmRzU2lkZW5hdk1lbnVUcmlnZ2VyQ29tcG9uZW50IHwgUmRzU2lkZW5hdk1lbnVpdGVtQ29tcG9uZW50XG4gID47XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zaWRlbmF2U2VydmljZS5pc01pbmltYWwkXG4gICAgICAucGlwZSh0YWtlVW50aWxEZXN0cm95ZWQodGhpcy5kZXN0cm95UmVmKSlcbiAgICAgIC5zdWJzY3JpYmUoKGlzTWluaW1hbCkgPT4gdGhpcy5vbk1pbmltYWxTdGF0ZUNoYW5nZShpc01pbmltYWwpKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ29udGVudENoYW5nZWQoKTtcbiAgICB0aGlzLnVwZGF0ZURpcmVjdERlc2NlbmRhbnRzKCk7XG4gICAgdGhpcy5rZXlNYW5hZ2VyID0gbmV3IEZvY3VzS2V5TWFuYWdlcih0aGlzLmRpcmVjdERlc2NlbmRhbnRJdGVtcylcbiAgICAgIC53aXRoV3JhcCgpXG4gICAgICAud2l0aEhvbWVBbmRFbmQoKTtcblxuICAgIHRoaXMuZGlyZWN0RGVzY2VuZGFudEl0ZW1zLmNoYW5nZXNcbiAgICAgIC5waXBlKFxuICAgICAgICBzdGFydFdpdGgodGhpcy5kaXJlY3REZXNjZW5kYW50SXRlbXMpLFxuICAgICAgICBzd2l0Y2hNYXAoKG1lbnVzKSA9PlxuICAgICAgICAgIG1lcmdlKFxuICAgICAgICAgICAgLi4ubWVudXMubWFwKFxuICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgbWVudTpcbiAgICAgICAgICAgICAgICAgIHwgUmRzU2lkZW5hdk1lbnVUcmlnZ2VyQ29tcG9uZW50XG4gICAgICAgICAgICAgICAgICB8IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudCxcbiAgICAgICAgICAgICAgKSA9PiBtZW51Ll9mb2N1c2VkLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICApLFxuICAgICAgICApLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoZm9jdXNlZE1lbnUpID0+IHtcbiAgICAgICAgdGhpcy5rZXlNYW5hZ2VyLnVwZGF0ZUFjdGl2ZUl0ZW0oXG4gICAgICAgICAgZm9jdXNlZE1lbnUgYXNcbiAgICAgICAgICAgIHwgUmRzU2lkZW5hdk1lbnVUcmlnZ2VyQ29tcG9uZW50XG4gICAgICAgICAgICB8IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudCxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc2Nyb2xsaW5nQW5jZXN0b3IgPVxuICAgICAgZ2V0U2Nyb2xsaW5nQW5jZXN0b3IodGhpcy5uYXRpdmVFbGVtZW50KSA/PyB0aGlzLmRvY3VtZW50LmJvZHk7XG5cbiAgICAvLyB1cGRhdGUgb3RoZXIgbGF5b3V0IHdvcmsgbGlrZSBASG9zdEJpbmRpbmdzIGFuZCBvdGhlciBjb21wb25lbnRzIGRlc3RydWN0aW9uIGlzIGZpbmlzaGVkXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGZBcHBlYXJhbmNlKCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRpcmVjdERlc2NlbmRhbnRJdGVtcy5kZXN0cm95KCk7XG4gIH1cblxuICB0b2dnbGVJc01pbmltYWwoKTogdm9pZCB7XG4gICAgdGhpcy5zaWRlbmF2U2VydmljZS50b2dnbGVJc01pbmltYWwoKTtcbiAgfVxuXG4gIG9uQ29udGVudENoYW5nZWQoZW50cmllcz86IFJlc2l6ZU9ic2VydmVyRW50cnlbXSk6IHZvaWQge1xuICAgIHRoaXMuc2Nyb2xsaW5nQW5jZXN0b3IgPVxuICAgICAgZ2V0U2Nyb2xsaW5nQW5jZXN0b3IodGhpcy5uYXRpdmVFbGVtZW50KSA/PyB0aGlzLmRvY3VtZW50LmJvZHk7XG5cbiAgICBjb25zdCBuZXdIZWlnaHQgPSB0aGlzLmdldEhlaWdodChlbnRyaWVzKTtcblxuICAgIGlmIChuZXdIZWlnaHQgPT09IG51bGwgfHwgbmV3SGVpZ2h0ICE9PSB0aGlzLm1lbnViYXJIZWlnaHQpIHtcbiAgICAgIHRoaXMubWVudWJhckhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgIHRoaXMubm9TY3JvbGwgPSB0aGlzLmNhbGN1bGF0ZU5vU2Nyb2xsKCk7XG4gICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5ZG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIGNvbnN0IGtleUNvZGUgPSBldmVudC5rZXlDb2RlO1xuICAgIGNvbnN0IG1hbmFnZXIgPSB0aGlzLmtleU1hbmFnZXI7XG4gICAgY29uc3QgZGVsdGEgPSBldmVudC5zaGlmdEtleSA/IC0xIDogMTtcbiAgICBjb25zdCBhY3RpdmVJdGVtSW5kZXggPSBtYW5hZ2VyLmFjdGl2ZUl0ZW1JbmRleCA/PyAtMTtcblxuICAgIHN3aXRjaCAoa2V5Q29kZSkge1xuICAgICAgY2FzZSBUQUI6XG4gICAgICAgIG1hbmFnZXIuc2V0Rm9jdXNPcmlnaW4oJ2tleWJvYXJkJyk7XG4gICAgICAgIG1hbmFnZXIudXBkYXRlQWN0aXZlSXRlbShhY3RpdmVJdGVtSW5kZXggKyBkZWx0YSk7XG5cbiAgICAgICAgaWYgKCFldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsSWZOZWVkZWQobWFuYWdlci5hY3RpdmVJdGVtIGFzIE5hdGl2ZUVsZW1lbnQgfCBudWxsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKGtleUNvZGUgPT09IFVQX0FSUk9XIHx8IGtleUNvZGUgPT09IERPV05fQVJST1cpIHtcbiAgICAgICAgICBtYW5hZ2VyLnNldEZvY3VzT3JpZ2luKCdrZXlib2FyZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgbWFuYWdlci5vbktleWRvd24oZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2Nyb2xsSWZOZWVkZWQoYWN0aXZlSXRlbTogTmF0aXZlRWxlbWVudCB8IG51bGwpOiB2b2lkIHtcbiAgICBpZiAoIWFjdGl2ZUl0ZW0gfHwgIXRoaXMuZm9vdGVyUmVmKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZWxZID0gYWN0aXZlSXRlbS5uYXRpdmVFbGVtZW50Lm9mZnNldFRvcDtcbiAgICBjb25zdCBlbEhlaWdodCA9IGFjdGl2ZUl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3QgcGFkZGluZ1RvcCA9IDIwO1xuXG4gICAgaWYgKGVsWSArIGVsSGVpZ2h0ID49IHRoaXMuZm9vdGVyUmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0VG9wKSB7XG4gICAgICBjb25zdCBzY3JvbGxlciA9IHRoaXMuaXNNaW5pbWFsXG4gICAgICAgID8gdGhpcy5zY3JvbGxpbmdBbmNlc3RvclxuICAgICAgICA6IHRoaXMubmF2UmVmLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgIHNjcm9sbGVyLnNjcm9sbFRvKDAsIGVsWSAtIHBhZGRpbmdUb3ApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0SGVpZ2h0KGVudHJpZXM/OiBSZXNpemVPYnNlcnZlckVudHJ5W10pOiBudW1iZXIgfCBudWxsIHtcbiAgICBpZiAoIWVudHJpZXMgfHwgIWVudHJpZXNbMF0pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBlbnRyaWVzWzBdLmNvbnRlbnRSZWN0LmhlaWdodDtcbiAgfVxuXG4gIHByaXZhdGUgb25NaW5pbWFsU3RhdGVDaGFuZ2UoaXNNaW5pbWFsOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy51cGRhdGVTZWxmQXBwZWFyYW5jZSgpO1xuICAgIHRoaXMuaXNNaW5pbWFsQ2hhbmdlLmVtaXQoaXNNaW5pbWFsKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU2VsZkFwcGVhcmFuY2UoKTogdm9pZCB7XG4gICAgY29uc3QgeyB0b3AgfSA9IHRoaXMubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAnLS1yZHMtc2lkZW5hdi1vZmZzZXQtdG9wJyxcbiAgICAgIGAke3RvcH1weGAsXG4gICAgICBSZW5kZXJlclN0eWxlRmxhZ3MyLkRhc2hDYXNlLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZU5vU2Nyb2xsKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5uYXRpdmVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuc2Nyb2xsaW5nQW5jZXN0b3Iub2Zmc2V0SGVpZ2h0ID49XG4gICAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQuc2Nyb2xsSGVpZ2h0XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGlyZWN0RGVzY2VuZGFudHMoKTogdm9pZCB7XG4gICAgdGhpcy5jaGlsZHJlbi5jaGFuZ2VzXG4gICAgICAucGlwZShzdGFydFdpdGgodGhpcy5jaGlsZHJlbikpXG4gICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAoXG4gICAgICAgICAgaXRlbXM6IFF1ZXJ5TGlzdDxcbiAgICAgICAgICAgIFJkc1NpZGVuYXZNZW51VHJpZ2dlckNvbXBvbmVudCB8IFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudFxuICAgICAgICAgID4sXG4gICAgICAgICkgPT4ge1xuICAgICAgICAgIHRoaXMuZGlyZWN0RGVzY2VuZGFudEl0ZW1zLnJlc2V0KFxuICAgICAgICAgICAgaXRlbXMuZmlsdGVyKFxuICAgICAgICAgICAgICAoaXRlbSkgPT5cbiAgICAgICAgICAgICAgICBpdGVtIGluc3RhbmNlb2YgUmRzU2lkZW5hdk1lbnVUcmlnZ2VyQ29tcG9uZW50IHx8XG4gICAgICAgICAgICAgICAgaXRlbS5fcGFyZW50TWVudSA9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5kaXJlY3REZXNjZW5kYW50SXRlbXMubm90aWZ5T25DaGFuZ2VzKCk7XG4gICAgICAgIH0sXG4gICAgICApO1xuICB9XG59XG4iLCI8bmF2ICNuYXY+XG4gIDxkaXZcbiAgICByb2xlPVwibWVudWJhclwiXG4gICAgKHJkc09ic2VydmVSZXNpemUpPVwib25Db250ZW50Q2hhbmdlZCgkZXZlbnQpXCJcbiAgICAoa2V5ZG93bik9XCJoYW5kbGVLZXlkb3duKCRldmVudClcIlxuICA+XG4gICAgPG5nLWNvbnRlbnQgLz5cbiAgPC9kaXY+XG4gIEBpZiAoaXNFeHBhbmRhYmxlKSB7XG4gICAgPHJkcy1zaWRlbmF2LWZvb3RlciAjZm9vdGVyIFtjbGFzcy5yZHMtc2lkZW5hdi1mb290ZXItbm8tc2Nyb2xsXT1cIm5vU2Nyb2xsXCI+XG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzPVwiZXhwYW5kLXRvZ2dsZVwiXG4gICAgICAgIHRpdGxlPVwiZXhwYW5kIHRvZ2dsZVwiXG4gICAgICAgIHJkcy1pY29uLWJ1dHRvblxuICAgICAgICBzaXplPVwibVwiXG4gICAgICAgIChjbGljayk9XCJ0b2dnbGVJc01pbmltYWwoKVwiXG4gICAgICA+XG4gICAgICAgIDxyZHMtaWNvbiBpY29uPVwiZG91YmxlX2NoZXZyb25fcmlnaHRcIiAvPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9yZHMtc2lkZW5hdi1mb290ZXI+XG4gIH1cbjwvbmF2PlxuIl19