import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, EventEmitter, HostBinding, inject, Input, Output, QueryList, TemplateRef, ViewChild, ViewEncapsulation, } from '@angular/core';
import { RdsSidenavMenuitemComponent } from '../sidenav-menuitem/sidenav-menuitem.component';
import { FocusKeyManager } from '@angular/cdk/a11y';
import { RDS_SIDENAV_MENU_PANEL, } from '../sidenav.types';
import { merge, Subject, Subscription } from 'rxjs';
import { startWith, switchMap } from 'rxjs/operators';
import { DOWN_ARROW, ESCAPE, hasModifierKey, LEFT_ARROW, RIGHT_ARROW, UP_ARROW, } from '@angular/cdk/keycodes';
import { RdsSidenavService } from '../sidenav.service';
import { rdsSidenavExpansionAnimations } from './sidenav-menu-expansion.animation';
import { RdsSidenavMenuHeaderComponent } from '../sidenav-menu-header/sidenav-menu-header.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
let menuPanelUid = 0;
export class RdsSidenavMenuComponent {
    constructor() {
        this.sidenav = inject(RdsSidenavService);
        this.cdr = inject(ChangeDetectorRef);
        this._hovered = new Subject();
        this.hovered = this._hovered.asObservable();
        this.attrAriaLabel = null;
        this.attrAriaLabelledBy = null;
        this.attrAriaDescribedBy = null;
        this._directDescendantItems = new QueryList();
        this._tabSubscription = Subscription.EMPTY;
        this._classList = {};
        this._panelAnimationState = 'void';
        this._animationDone = new Subject();
        this.expandedState = 'collapsed';
        this._isOpened = false;
        this.overlayPanelClass = '';
        this.backdropClass = 'cdk-overlay-transparent-backdrop';
        this.ariaLabel = null;
        this.ariaLabelledby = null;
        this.ariaDescribedby = null;
        this.openOnInit = false;
        this.closed = new EventEmitter();
        this.panelId = `rds-menu-panel-${menuPanelUid++}`;
        this.isMinimal$ = this.sidenav.isMinimal$;
    }
    get isOpened() {
        return this._isOpened;
    }
    set isOpened(value) {
        if (this._isOpened !== value) {
            this._isOpened = value;
            this.cdr.markForCheck();
        }
    }
    set title(v) {
        if (v !== this._title) {
            this._title = v;
            this.cdr.markForCheck();
        }
    }
    get title() {
        return this._title;
    }
    ngOnInit() {
        this.setPositionClasses();
    }
    ngAfterContentInit() {
        this._updateDirectDescendants();
        this._keyManager = new FocusKeyManager(this._directDescendantItems)
            .withWrap()
            .withTypeAhead()
            .withHomeAndEnd();
        this._tabSubscription = this._keyManager.tabOut.subscribe(() => this.closed.emit('tab'));
        this._directDescendantItems.changes
            .pipe(startWith(this._directDescendantItems), switchMap((items) => merge(...items.map((item) => item._focused))))
            .subscribe((focusedItem) => this._keyManager.updateActiveItem(focusedItem));
    }
    ngOnDestroy() {
        this._directDescendantItems.destroy();
        this._tabSubscription.unsubscribe();
        this.closed.complete();
    }
    _handleKeydown(event) {
        event.stopPropagation();
        const keyCode = event.keyCode;
        const manager = this._keyManager;
        switch (keyCode) {
            case ESCAPE:
                if (!hasModifierKey(event)) {
                    event.preventDefault();
                    this.closed.emit('keydown');
                }
                break;
            case LEFT_ARROW:
                if (this.direction === 'ltr') {
                    this.closed.emit('keydown');
                }
                break;
            case RIGHT_ARROW:
                if (this.direction === 'rtl') {
                    this.closed.emit('keydown');
                }
                break;
            default:
                if (keyCode === UP_ARROW || keyCode === DOWN_ARROW) {
                    manager.setFocusOrigin('keyboard');
                }
                manager.onKeydown(event);
        }
    }
    focusFirstItem(origin = 'program') {
        if (!this.sidenav.isMinimal) {
            setTimeout(() => this._focusFirstItem(origin));
            return;
        }
        this._focusFirstItem(origin);
    }
    _focusFirstItem(origin) {
        const manager = this._keyManager;
        manager.setFocusOrigin(origin).setFirstItemActive();
        if (!manager.activeItem && this._directDescendantItems.length) {
            let element = this._directDescendantItems.first.nativeElement.parentElement;
            while (element) {
                if (element.getAttribute('role') === 'menu') {
                    element.focus();
                    break;
                }
                else {
                    element = element.parentElement;
                }
            }
        }
    }
    resetActiveItem() {
        this._keyManager.setActiveItem(-1);
    }
    setPositionClasses(posX = 'after', posY = 'below') {
        const classes = this._classList;
        classes['rds-menu-before'] = posX === 'before';
        classes['rds-menu-after'] = posX === 'after';
        classes['rds-menu-above'] = posY === 'above';
        classes['rds-menu-below'] = posY === 'below';
    }
    _startAnimation() {
        this._panelAnimationState = 'enter';
        this.expandedState = 'expanded';
    }
    _resetAnimation() {
        this._panelAnimationState = 'void';
        this.expandedState = 'collapsed';
    }
    _onAnimationDone(event) {
        this._animationDone.next(event);
        this._isAnimating = false;
    }
    _updateDirectDescendants() {
        this._allItems.changes
            .pipe(startWith(this._allItems))
            .subscribe((items) => {
            const results = items.filter((item) => item._parentMenu === this);
            if (this.menuHeader) {
                results.push(this.menuHeader);
            }
            this._directDescendantItems.reset(results);
            this._directDescendantItems.notifyOnChanges();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSidenavMenuComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsSidenavMenuComponent, selector: "rds-sidenav-menu", inputs: { ariaLabel: ["aria-label", "ariaLabel"], ariaLabelledby: ["aria-labelledby", "ariaLabelledby"], ariaDescribedby: ["aria-describedby", "ariaDescribedby"], openOnInit: ["openOnInit", "openOnInit", booleanAttribute] }, outputs: { closed: "closed" }, host: { properties: { "attr.aria-label": "this.attrAriaLabel", "attr.aria-labelledby": "this.attrAriaLabelledBy", "attr.aria-describedby": "this.attrAriaDescribedBy" } }, providers: [
            { provide: RDS_SIDENAV_MENU_PANEL, useExisting: RdsSidenavMenuComponent },
        ], queries: [{ propertyName: "menuHeader", first: true, predicate: RdsSidenavMenuHeaderComponent, descendants: true }, { propertyName: "_allItems", predicate: RdsSidenavMenuitemComponent, descendants: true }], viewQueries: [{ propertyName: "templateRef", first: true, predicate: ["panel"], descendants: true }], exportAs: ["rdsSidenavMenu"], ngImport: i0, template: "<ng-template #panel>\n  <div\n    class=\"rds-sidenav-menu-panel\"\n    [id]=\"panelId\"\n    [ngClass]=\"_classList\"\n    (click)=\"closed.emit('click')\"\n    (mouseenter)=\"_hovered.next(true)\"\n    (mouseleave)=\"_hovered.next(false)\"\n    tabindex=\"-1\"\n    role=\"menu\"\n    [attr.aria-label]=\"ariaLabel || null\"\n    [attr.aria-labelledby]=\"ariaLabelledby || null\"\n    [attr.aria-describedby]=\"ariaDescribedby || null\"\n  >\n    <ng-container *ngTemplateOutlet=\"content\" />\n  </div>\n</ng-template>\n<ng-template #content>\n  <div class=\"rds-sidenav-menu-content\" (keydown)=\"_handleKeydown($event)\">\n    @if (menuHeader) {\n      <ng-content select=\".rds-sidenav-menu-header\" />\n    } @else {\n      <div class=\"rds-sidenav-menu-header\">\n        {{ title }}\n      </div>\n    }\n    <ng-content />\n  </div>\n</ng-template>\n@if ((isMinimal$ | async) === false) {\n  <div\n    class=\"rds-sidenav-expansion-body\"\n    [class.rds-sidenav-expansion-body-collapsed]=\"expandedState === 'collapsed'\"\n    role=\"menu\"\n    tabindex=\"-1\"\n    [@bodyExpansion]=\"expandedState\"\n    (@bodyExpansion.done)=\"_onAnimationDone($event)\"\n  >\n    <ng-container *ngTemplateOutlet=\"content\" />\n  </div>\n}\n", styles: ["rds-sidenav-menu{display:none}.rds-sidenav-full rds-sidenav-menu{display:block}.rds-sidenav-menu-panel{box-shadow:0 0 1px #0000003d,0 8px 20px #00000026;overflow:scroll;border-radius:1px;width:20rem;max-height:calc(100vh - 40px);min-height:88px;padding:24px 16px;background:var(--rds-color-bg-base-1);outline:0}.rds-sidenav-menu-panel.ng-animating{pointer-events:none}.rds-sidenav-menu-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;align-items:center;gap:8px;display:flex;margin:0 0 8px;min-height:40px;padding:8px 16px;color:var(--rds-color-high-contrast);text-decoration:none;border-radius:6px}a.rds-sidenav-menu-header:hover{background-color:var(--rds-color-bg-solid-hover-select)}a.rds-sidenav-menu-header:focus-visible{outline:1px solid var(--rds-color-stroke-active-focus)}a.rds-sidenav-menu-header:hover rds-icon,a.rds-sidenav-menu-header:active rds-icon,a.rds-sidenav-menu-header:focus-visible rds-icon{color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menu-header{display:none}.rds-sidenav-expansion-body{overflow:hidden}.rds-sidenav-expansion-body.rds-sidenav-expansion-body-collapsed{transition:visibility 0ms .35s;visibility:hidden}.rds-sidenav-expansion-body .rds-sidenav-menuitem{position:relative;margin-left:8px;width:calc(100% - 9px);padding-left:24px}.rds-sidenav-expansion-body .rds-sidenav-menuitem:before{content:\"\";position:absolute;left:0;top:0;height:100%;width:1px;background-color:var(--rds-color-grey-2)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:hover{outline:none;color:var(--rds-color-high-contrast)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:hover:before{background-color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:active,.rds-sidenav-expansion-body .rds-sidenav-menuitem.rds-sidenav-menuitem-active{outline:none;color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:active:before,.rds-sidenav-expansion-body .rds-sidenav-menuitem.rds-sidenav-menuitem-active:before{background-color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:focus-visible:before{background-color:transparent}.rds-sidenav-expansion-body .rds-sidenav-menuitem+.rds-sidenav-menuitem{margin-top:0}\n"], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "pipe", type: i1.AsyncPipe, name: "async" }], animations: [rdsSidenavExpansionAnimations.bodyExpansion], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsSidenavMenuComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-sidenav-menu', exportAs: 'rdsSidenavMenu', changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, providers: [
                        { provide: RDS_SIDENAV_MENU_PANEL, useExisting: RdsSidenavMenuComponent },
                    ], animations: [rdsSidenavExpansionAnimations.bodyExpansion], template: "<ng-template #panel>\n  <div\n    class=\"rds-sidenav-menu-panel\"\n    [id]=\"panelId\"\n    [ngClass]=\"_classList\"\n    (click)=\"closed.emit('click')\"\n    (mouseenter)=\"_hovered.next(true)\"\n    (mouseleave)=\"_hovered.next(false)\"\n    tabindex=\"-1\"\n    role=\"menu\"\n    [attr.aria-label]=\"ariaLabel || null\"\n    [attr.aria-labelledby]=\"ariaLabelledby || null\"\n    [attr.aria-describedby]=\"ariaDescribedby || null\"\n  >\n    <ng-container *ngTemplateOutlet=\"content\" />\n  </div>\n</ng-template>\n<ng-template #content>\n  <div class=\"rds-sidenav-menu-content\" (keydown)=\"_handleKeydown($event)\">\n    @if (menuHeader) {\n      <ng-content select=\".rds-sidenav-menu-header\" />\n    } @else {\n      <div class=\"rds-sidenav-menu-header\">\n        {{ title }}\n      </div>\n    }\n    <ng-content />\n  </div>\n</ng-template>\n@if ((isMinimal$ | async) === false) {\n  <div\n    class=\"rds-sidenav-expansion-body\"\n    [class.rds-sidenav-expansion-body-collapsed]=\"expandedState === 'collapsed'\"\n    role=\"menu\"\n    tabindex=\"-1\"\n    [@bodyExpansion]=\"expandedState\"\n    (@bodyExpansion.done)=\"_onAnimationDone($event)\"\n  >\n    <ng-container *ngTemplateOutlet=\"content\" />\n  </div>\n}\n", styles: ["rds-sidenav-menu{display:none}.rds-sidenav-full rds-sidenav-menu{display:block}.rds-sidenav-menu-panel{box-shadow:0 0 1px #0000003d,0 8px 20px #00000026;overflow:scroll;border-radius:1px;width:20rem;max-height:calc(100vh - 40px);min-height:88px;padding:24px 16px;background:var(--rds-color-bg-base-1);outline:0}.rds-sidenav-menu-panel.ng-animating{pointer-events:none}.rds-sidenav-menu-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;align-items:center;gap:8px;display:flex;margin:0 0 8px;min-height:40px;padding:8px 16px;color:var(--rds-color-high-contrast);text-decoration:none;border-radius:6px}a.rds-sidenav-menu-header:hover{background-color:var(--rds-color-bg-solid-hover-select)}a.rds-sidenav-menu-header:focus-visible{outline:1px solid var(--rds-color-stroke-active-focus)}a.rds-sidenav-menu-header:hover rds-icon,a.rds-sidenav-menu-header:active rds-icon,a.rds-sidenav-menu-header:focus-visible rds-icon{color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menu-header{display:none}.rds-sidenav-expansion-body{overflow:hidden}.rds-sidenav-expansion-body.rds-sidenav-expansion-body-collapsed{transition:visibility 0ms .35s;visibility:hidden}.rds-sidenav-expansion-body .rds-sidenav-menuitem{position:relative;margin-left:8px;width:calc(100% - 9px);padding-left:24px}.rds-sidenav-expansion-body .rds-sidenav-menuitem:before{content:\"\";position:absolute;left:0;top:0;height:100%;width:1px;background-color:var(--rds-color-grey-2)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:hover{outline:none;color:var(--rds-color-high-contrast)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:hover:before{background-color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:active,.rds-sidenav-expansion-body .rds-sidenav-menuitem.rds-sidenav-menuitem-active{outline:none;color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:active:before,.rds-sidenav-expansion-body .rds-sidenav-menuitem.rds-sidenav-menuitem-active:before{background-color:var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:focus-visible{outline:none;box-shadow:inset 0 0 0 2px var(--rds-color-informative)}.rds-sidenav-expansion-body .rds-sidenav-menuitem:focus-visible:before{background-color:transparent}.rds-sidenav-expansion-body .rds-sidenav-menuitem+.rds-sidenav-menuitem{margin-top:0}\n"] }]
        }], propDecorators: { menuHeader: [{
                type: ContentChild,
                args: [RdsSidenavMenuHeaderComponent]
            }], _allItems: [{
                type: ContentChildren,
                args: [RdsSidenavMenuitemComponent, { descendants: true }]
            }], attrAriaLabel: [{
                type: HostBinding,
                args: ['attr.aria-label']
            }], attrAriaLabelledBy: [{
                type: HostBinding,
                args: ['attr.aria-labelledby']
            }], attrAriaDescribedBy: [{
                type: HostBinding,
                args: ['attr.aria-describedby']
            }], ariaLabel: [{
                type: Input,
                args: ['aria-label']
            }], ariaLabelledby: [{
                type: Input,
                args: ['aria-labelledby']
            }], ariaDescribedby: [{
                type: Input,
                args: ['aria-describedby']
            }], openOnInit: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], templateRef: [{
                type: ViewChild,
                args: ['panel']
            }], closed: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZW5hdi1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvc2lkZW5hdi9zaWRlbmF2LW1lbnUvc2lkZW5hdi1tZW51LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvc2lkZW5hdi9zaWRlbmF2LW1lbnUvc2lkZW5hdi1tZW51LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxnQkFBZ0IsRUFDaEIsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLGVBQWUsRUFDZixZQUFZLEVBQ1osV0FBVyxFQUNYLE1BQU0sRUFDTixLQUFLLEVBR0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxXQUFXLEVBQ1gsU0FBUyxFQUNULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUM3RixPQUFPLEVBQUUsZUFBZSxFQUFlLE1BQU0sbUJBQW1CLENBQUM7QUFDakUsT0FBTyxFQUNMLHNCQUFzQixHQUd2QixNQUFNLGtCQUFrQixDQUFDO0FBQzFCLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUdwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFDTCxVQUFVLEVBQ1YsTUFBTSxFQUNOLGNBQWMsRUFDZCxVQUFVLEVBQ1YsV0FBVyxFQUNYLFFBQVEsR0FDVCxNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSw2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LG1CQUFtQjtzQkFBeEQsV0FBVzt1QkFBQyx1QkFBdUI7Z0JBaURmLFNBQVM7c0JBQTdCLEtBQUs7dUJBQUMsWUFBWTtnQkFDTyxjQUFjO3NCQUF2QyxLQUFLO3VCQUFDLGlCQUFpQjtnQkFDRyxlQUFlO3NCQUF6QyxLQUFLO3VCQUFDLGtCQUFrQjtnQkFFZSxVQUFVO3NCQUFqRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUVsQixXQUFXO3NCQUE5QixTQUFTO3VCQUFDLE9BQU87Z0JBRUMsTUFBTTtzQkFBeEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZHNTaWRlbmF2TWVudWl0ZW1Db21wb25lbnQgfSBmcm9tICcuLi9zaWRlbmF2LW1lbnVpdGVtL3NpZGVuYXYtbWVudWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IEZvY3VzS2V5TWFuYWdlciwgRm9jdXNPcmlnaW4gfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuICBSRFNfU0lERU5BVl9NRU5VX1BBTkVMLFxuICBSZHNTaWRlbmF2TWVudUNsb3NlUmVhc29uLFxuICBSZHNTaWRlbmF2TWVudVBhbmVsLFxufSBmcm9tICcuLi9zaWRlbmF2LnR5cGVzJztcbmltcG9ydCB7IG1lcmdlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFuaW1hdGlvbkV2ZW50IH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XG5pbXBvcnQgeyBzdGFydFdpdGgsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIERPV05fQVJST1csXG4gIEVTQ0FQRSxcbiAgaGFzTW9kaWZpZXJLZXksXG4gIExFRlRfQVJST1csXG4gIFJJR0hUX0FSUk9XLFxuICBVUF9BUlJPVyxcbn0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IFJkc1NpZGVuYXZTZXJ2aWNlIH0gZnJvbSAnLi4vc2lkZW5hdi5zZXJ2aWNlJztcbmltcG9ydCB7IHJkc1NpZGVuYXZFeHBhbnNpb25BbmltYXRpb25zIH0gZnJvbSAnLi9zaWRlbmF2LW1lbnUtZXhwYW5zaW9uLmFuaW1hdGlvbic7XG5pbXBvcnQgeyBSZHNNZW51UG9zaXRpb25YLCBSZHNNZW51UG9zaXRpb25ZIH0gZnJvbSAnLi4vLi4vbWVudSc7XG5pbXBvcnQgeyBSZHNTaWRlbmF2TWVudUhlYWRlckNvbXBvbmVudCB9IGZyb20gJy4uL3NpZGVuYXYtbWVudS1oZWFkZXIvc2lkZW5hdi1tZW51LWhlYWRlci5jb21wb25lbnQnO1xuXG5sZXQgbWVudVBhbmVsVWlkID0gMDtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncmRzLXNpZGVuYXYtbWVudScsXG4gIGV4cG9ydEFzOiAncmRzU2lkZW5hdk1lbnUnLFxuICB0ZW1wbGF0ZVVybDogJy4vc2lkZW5hdi1tZW51LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ3NpZGVuYXYtbWVudS5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgeyBwcm92aWRlOiBSRFNfU0lERU5BVl9NRU5VX1BBTkVMLCB1c2VFeGlzdGluZzogUmRzU2lkZW5hdk1lbnVDb21wb25lbnQgfSxcbiAgXSxcbiAgYW5pbWF0aW9uczogW3Jkc1NpZGVuYXZFeHBhbnNpb25BbmltYXRpb25zLmJvZHlFeHBhbnNpb25dLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNTaWRlbmF2TWVudUNvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBSZHNTaWRlbmF2TWVudVBhbmVsXG57XG4gIHByaXZhdGUgcmVhZG9ubHkgc2lkZW5hdiA9IGluamVjdChSZHNTaWRlbmF2U2VydmljZSk7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcblxuICBwcml2YXRlIF9rZXlNYW5hZ2VyOiBGb2N1c0tleU1hbmFnZXI8XG4gICAgUmRzU2lkZW5hdk1lbnVpdGVtQ29tcG9uZW50IHwgUmRzU2lkZW5hdk1lbnVIZWFkZXJDb21wb25lbnRcbiAgPjtcblxuICBfaG92ZXJlZCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG4gIGhvdmVyZWQgPSB0aGlzLl9ob3ZlcmVkLmFzT2JzZXJ2YWJsZSgpO1xuXG4gIEBDb250ZW50Q2hpbGQoUmRzU2lkZW5hdk1lbnVIZWFkZXJDb21wb25lbnQpXG4gIG1lbnVIZWFkZXI/OiBSZHNTaWRlbmF2TWVudUhlYWRlckNvbXBvbmVudDtcblxuICBAQ29udGVudENoaWxkcmVuKFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudCwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KVxuICBfYWxsSXRlbXM6IFF1ZXJ5TGlzdDxSZHNTaWRlbmF2TWVudWl0ZW1Db21wb25lbnQ+O1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWxhYmVsJykgYXR0ckFyaWFMYWJlbCA9IG51bGw7XG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWxhYmVsbGVkYnknKSBhdHRyQXJpYUxhYmVsbGVkQnkgPSBudWxsO1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuYXJpYS1kZXNjcmliZWRieScpIGF0dHJBcmlhRGVzY3JpYmVkQnkgPSBudWxsO1xuXG4gIHByaXZhdGUgX2RpcmVjdERlc2NlbmRhbnRJdGVtcyA9IG5ldyBRdWVyeUxpc3Q8XG4gICAgUmRzU2lkZW5hdk1lbnVpdGVtQ29tcG9uZW50IHwgUmRzU2lkZW5hdk1lbnVIZWFkZXJDb21wb25lbnRcbiAgPigpO1xuXG4gIHByaXZhdGUgX3RhYlN1YnNjcmlwdGlvbiA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcblxuICBfY2xhc3NMaXN0OiB7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfSA9IHt9O1xuXG4gIF9wYW5lbEFuaW1hdGlvblN0YXRlOiAndm9pZCcgfCAnZW50ZXInID0gJ3ZvaWQnO1xuXG4gIHJlYWRvbmx5IF9hbmltYXRpb25Eb25lID0gbmV3IFN1YmplY3Q8QW5pbWF0aW9uRXZlbnQ+KCk7XG5cbiAgX2lzQW5pbWF0aW5nOiBib29sZWFuO1xuXG4gIHBhcmVudE1lbnU6IFJkc1NpZGVuYXZNZW51UGFuZWwgfCB1bmRlZmluZWQ7XG5cbiAgZGlyZWN0aW9uOiBEaXJlY3Rpb247XG5cbiAgZXhwYW5kZWRTdGF0ZTogJ2V4cGFuZGVkJyB8ICdjb2xsYXBzZWQnID0gJ2NvbGxhcHNlZCc7XG5cbiAgcHJpdmF0ZSBfaXNPcGVuZWQgPSBmYWxzZTtcbiAgZ2V0IGlzT3BlbmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9pc09wZW5lZDtcbiAgfVxuXG4gIHNldCBpc09wZW5lZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLl9pc09wZW5lZCAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMuX2lzT3BlbmVkID0gdmFsdWU7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF90aXRsZTogc3RyaW5nO1xuICBzZXQgdGl0bGUodjogc3RyaW5nKSB7XG4gICAgaWYgKHYgIT09IHRoaXMuX3RpdGxlKSB7XG4gICAgICB0aGlzLl90aXRsZSA9IHY7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBnZXQgdGl0bGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fdGl0bGU7XG4gIH1cblxuICBvdmVybGF5UGFuZWxDbGFzczogc3RyaW5nIHwgc3RyaW5nW10gPSAnJztcbiAgYmFja2Ryb3BDbGFzcyA9ICdjZGstb3ZlcmxheS10cmFuc3BhcmVudC1iYWNrZHJvcCc7XG5cbiAgQElucHV0KCdhcmlhLWxhYmVsJykgYXJpYUxhYmVsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCdhcmlhLWxhYmVsbGVkYnknKSBhcmlhTGFiZWxsZWRieTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIEBJbnB1dCgnYXJpYS1kZXNjcmliZWRieScpIGFyaWFEZXNjcmliZWRieTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIG9wZW5PbkluaXQgPSBmYWxzZTtcblxuICBAVmlld0NoaWxkKCdwYW5lbCcpIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjx1bmtub3duPjtcblxuICBAT3V0cHV0KCkgcmVhZG9ubHkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxSZHNTaWRlbmF2TWVudUNsb3NlUmVhc29uPigpO1xuXG4gIHJlYWRvbmx5IHBhbmVsSWQgPSBgcmRzLW1lbnUtcGFuZWwtJHttZW51UGFuZWxVaWQrK31gO1xuICByZWFkb25seSBpc01pbmltYWwkID0gdGhpcy5zaWRlbmF2LmlzTWluaW1hbCQ7XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRQb3NpdGlvbkNsYXNzZXMoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl91cGRhdGVEaXJlY3REZXNjZW5kYW50cygpO1xuICAgIHRoaXMuX2tleU1hbmFnZXIgPSBuZXcgRm9jdXNLZXlNYW5hZ2VyKHRoaXMuX2RpcmVjdERlc2NlbmRhbnRJdGVtcylcbiAgICAgIC53aXRoV3JhcCgpXG4gICAgICAud2l0aFR5cGVBaGVhZCgpXG4gICAgICAud2l0aEhvbWVBbmRFbmQoKTtcbiAgICB0aGlzLl90YWJTdWJzY3JpcHRpb24gPSB0aGlzLl9rZXlNYW5hZ2VyLnRhYk91dC5zdWJzY3JpYmUoKCkgPT5cbiAgICAgIHRoaXMuY2xvc2VkLmVtaXQoJ3RhYicpLFxuICAgICk7XG5cbiAgICB0aGlzLl9kaXJlY3REZXNjZW5kYW50SXRlbXMuY2hhbmdlc1xuICAgICAgLnBpcGUoXG4gICAgICAgIHN0YXJ0V2l0aCh0aGlzLl9kaXJlY3REZXNjZW5kYW50SXRlbXMpLFxuICAgICAgICBzd2l0Y2hNYXAoKGl0ZW1zKSA9PlxuICAgICAgICAgIG1lcmdlKFxuICAgICAgICAgICAgLi4uaXRlbXMubWFwKFxuICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgaXRlbTpcbiAgICAgICAgICAgICAgICAgIHwgUmRzU2lkZW5hdk1lbnVpdGVtQ29tcG9uZW50XG4gICAgICAgICAgICAgICAgICB8IFJkc1NpZGVuYXZNZW51SGVhZGVyQ29tcG9uZW50LFxuICAgICAgICAgICAgICApID0+IGl0ZW0uX2ZvY3VzZWQsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICksXG4gICAgICAgICksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChmb2N1c2VkSXRlbSkgPT5cbiAgICAgICAgdGhpcy5fa2V5TWFuYWdlci51cGRhdGVBY3RpdmVJdGVtKFxuICAgICAgICAgIGZvY3VzZWRJdGVtIGFzIFJkc1NpZGVuYXZNZW51aXRlbUNvbXBvbmVudCxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLl9kaXJlY3REZXNjZW5kYW50SXRlbXMuZGVzdHJveSgpO1xuICAgIHRoaXMuX3RhYlN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuY2xvc2VkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBfaGFuZGxlS2V5ZG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgY29uc3Qga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgY29uc3QgbWFuYWdlciA9IHRoaXMuX2tleU1hbmFnZXI7XG5cbiAgICBzd2l0Y2ggKGtleUNvZGUpIHtcbiAgICAgIGNhc2UgRVNDQVBFOlxuICAgICAgICBpZiAoIWhhc01vZGlmaWVyS2V5KGV2ZW50KSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdGhpcy5jbG9zZWQuZW1pdCgna2V5ZG93bicpO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIExFRlRfQVJST1c6XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ2x0cicpIHtcbiAgICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KCdrZXlkb3duJyk7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUklHSFRfQVJST1c6XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3J0bCcpIHtcbiAgICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KCdrZXlkb3duJyk7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmIChrZXlDb2RlID09PSBVUF9BUlJPVyB8fCBrZXlDb2RlID09PSBET1dOX0FSUk9XKSB7XG4gICAgICAgICAgbWFuYWdlci5zZXRGb2N1c09yaWdpbigna2V5Ym9hcmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1hbmFnZXIub25LZXlkb3duKGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBmb2N1c0ZpcnN0SXRlbShvcmlnaW46IEZvY3VzT3JpZ2luID0gJ3Byb2dyYW0nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnNpZGVuYXYuaXNNaW5pbWFsKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX2ZvY3VzRmlyc3RJdGVtKG9yaWdpbikpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fZm9jdXNGaXJzdEl0ZW0ob3JpZ2luKTtcbiAgfVxuXG4gIHByaXZhdGUgX2ZvY3VzRmlyc3RJdGVtKG9yaWdpbjogRm9jdXNPcmlnaW4pOiB2b2lkIHtcbiAgICBjb25zdCBtYW5hZ2VyID0gdGhpcy5fa2V5TWFuYWdlcjtcbiAgICBtYW5hZ2VyLnNldEZvY3VzT3JpZ2luKG9yaWdpbikuc2V0Rmlyc3RJdGVtQWN0aXZlKCk7XG5cbiAgICBpZiAoIW1hbmFnZXIuYWN0aXZlSXRlbSAmJiB0aGlzLl9kaXJlY3REZXNjZW5kYW50SXRlbXMubGVuZ3RoKSB7XG4gICAgICBsZXQgZWxlbWVudCA9XG4gICAgICAgIHRoaXMuX2RpcmVjdERlc2NlbmRhbnRJdGVtcy5maXJzdC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG5cbiAgICAgIHdoaWxlIChlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50LmdldEF0dHJpYnV0ZSgncm9sZScpID09PSAnbWVudScpIHtcbiAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc2V0QWN0aXZlSXRlbSgpOiB2b2lkIHtcbiAgICB0aGlzLl9rZXlNYW5hZ2VyLnNldEFjdGl2ZUl0ZW0oLTEpO1xuICB9XG5cbiAgc2V0UG9zaXRpb25DbGFzc2VzKFxuICAgIHBvc1g6IFJkc01lbnVQb3NpdGlvblggPSAnYWZ0ZXInLFxuICAgIHBvc1k6IFJkc01lbnVQb3NpdGlvblkgPSAnYmVsb3cnLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBjbGFzc2VzID0gdGhpcy5fY2xhc3NMaXN0O1xuICAgIGNsYXNzZXNbJ3Jkcy1tZW51LWJlZm9yZSddID0gcG9zWCA9PT0gJ2JlZm9yZSc7XG4gICAgY2xhc3Nlc1sncmRzLW1lbnUtYWZ0ZXInXSA9IHBvc1ggPT09ICdhZnRlcic7XG4gICAgY2xhc3Nlc1sncmRzLW1lbnUtYWJvdmUnXSA9IHBvc1kgPT09ICdhYm92ZSc7XG4gICAgY2xhc3Nlc1sncmRzLW1lbnUtYmVsb3cnXSA9IHBvc1kgPT09ICdiZWxvdyc7XG4gIH1cblxuICBfc3RhcnRBbmltYXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5fcGFuZWxBbmltYXRpb25TdGF0ZSA9ICdlbnRlcic7XG4gICAgdGhpcy5leHBhbmRlZFN0YXRlID0gJ2V4cGFuZGVkJztcbiAgfVxuXG4gIF9yZXNldEFuaW1hdGlvbigpOiB2b2lkIHtcbiAgICB0aGlzLl9wYW5lbEFuaW1hdGlvblN0YXRlID0gJ3ZvaWQnO1xuICAgIHRoaXMuZXhwYW5kZWRTdGF0ZSA9ICdjb2xsYXBzZWQnO1xuICB9XG5cbiAgX29uQW5pbWF0aW9uRG9uZShldmVudDogQW5pbWF0aW9uRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLl9hbmltYXRpb25Eb25lLm5leHQoZXZlbnQpO1xuICAgIHRoaXMuX2lzQW5pbWF0aW5nID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVEaXJlY3REZXNjZW5kYW50cygpOiB2b2lkIHtcbiAgICB0aGlzLl9hbGxJdGVtcy5jaGFuZ2VzXG4gICAgICAucGlwZShzdGFydFdpdGgodGhpcy5fYWxsSXRlbXMpKVxuICAgICAgLnN1YnNjcmliZSgoaXRlbXM6IFF1ZXJ5TGlzdDxSZHNTaWRlbmF2TWVudWl0ZW1Db21wb25lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHM6IChcbiAgICAgICAgICB8IFJkc1NpZGVuYXZNZW51SGVhZGVyQ29tcG9uZW50XG4gICAgICAgICAgfCBSZHNTaWRlbmF2TWVudWl0ZW1Db21wb25lbnRcbiAgICAgICAgKVtdID0gaXRlbXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtLl9wYXJlbnRNZW51ID09PSB0aGlzKTtcblxuICAgICAgICBpZiAodGhpcy5tZW51SGVhZGVyKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMubWVudUhlYWRlcik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9kaXJlY3REZXNjZW5kYW50SXRlbXMucmVzZXQocmVzdWx0cyk7XG4gICAgICAgIHRoaXMuX2RpcmVjdERlc2NlbmRhbnRJdGVtcy5ub3RpZnlPbkNoYW5nZXMoKTtcbiAgICAgIH0pO1xuICB9XG59XG4iLCI8bmctdGVtcGxhdGUgI3BhbmVsPlxuICA8ZGl2XG4gICAgY2xhc3M9XCJyZHMtc2lkZW5hdi1tZW51LXBhbmVsXCJcbiAgICBbaWRdPVwicGFuZWxJZFwiXG4gICAgW25nQ2xhc3NdPVwiX2NsYXNzTGlzdFwiXG4gICAgKGNsaWNrKT1cImNsb3NlZC5lbWl0KCdjbGljaycpXCJcbiAgICAobW91c2VlbnRlcik9XCJfaG92ZXJlZC5uZXh0KHRydWUpXCJcbiAgICAobW91c2VsZWF2ZSk9XCJfaG92ZXJlZC5uZXh0KGZhbHNlKVwiXG4gICAgdGFiaW5kZXg9XCItMVwiXG4gICAgcm9sZT1cIm1lbnVcIlxuICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiYXJpYUxhYmVsIHx8IG51bGxcIlxuICAgIFthdHRyLmFyaWEtbGFiZWxsZWRieV09XCJhcmlhTGFiZWxsZWRieSB8fCBudWxsXCJcbiAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cImFyaWFEZXNjcmliZWRieSB8fCBudWxsXCJcbiAgPlxuICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjb250ZW50XCIgLz5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuPG5nLXRlbXBsYXRlICNjb250ZW50PlxuICA8ZGl2IGNsYXNzPVwicmRzLXNpZGVuYXYtbWVudS1jb250ZW50XCIgKGtleWRvd24pPVwiX2hhbmRsZUtleWRvd24oJGV2ZW50KVwiPlxuICAgIEBpZiAobWVudUhlYWRlcikge1xuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiLnJkcy1zaWRlbmF2LW1lbnUtaGVhZGVyXCIgLz5cbiAgICB9IEBlbHNlIHtcbiAgICAgIDxkaXYgY2xhc3M9XCJyZHMtc2lkZW5hdi1tZW51LWhlYWRlclwiPlxuICAgICAgICB7eyB0aXRsZSB9fVxuICAgICAgPC9kaXY+XG4gICAgfVxuICAgIDxuZy1jb250ZW50IC8+XG4gIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cbkBpZiAoKGlzTWluaW1hbCQgfCBhc3luYykgPT09IGZhbHNlKSB7XG4gIDxkaXZcbiAgICBjbGFzcz1cInJkcy1zaWRlbmF2LWV4cGFuc2lvbi1ib2R5XCJcbiAgICBbY2xhc3MucmRzLXNpZGVuYXYtZXhwYW5zaW9uLWJvZHktY29sbGFwc2VkXT1cImV4cGFuZGVkU3RhdGUgPT09ICdjb2xsYXBzZWQnXCJcbiAgICByb2xlPVwibWVudVwiXG4gICAgdGFiaW5kZXg9XCItMVwiXG4gICAgW0Bib2R5RXhwYW5zaW9uXT1cImV4cGFuZGVkU3RhdGVcIlxuICAgIChAYm9keUV4cGFuc2lvbi5kb25lKT1cIl9vbkFuaW1hdGlvbkRvbmUoJGV2ZW50KVwiXG4gID5cbiAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiY29udGVudFwiIC8+XG4gIDwvZGl2PlxufVxuIl19