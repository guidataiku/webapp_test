import { ComponentFactoryResolver, Directive, ElementRef, inject, Input, Renderer2, ViewContainerRef, } from '@angular/core';
import { RdsBadgeComponent } from './badge.component';
import { CdkPortalOutlet, ComponentPortal } from '@angular/cdk/portal';
import * as i0 from "@angular/core";
const DOT_BADGE_POS_RIGHT_PX = -4;
const BADGE_OFFSET_RIGHT_PX = 10;
export class RdsBadgeDirective {
    constructor() {
        this.viewContainerRef = inject(ViewContainerRef);
        this.componentFactoryResolver = inject(ComponentFactoryResolver);
        this.renderer = inject(Renderer2);
        this.elementRef = inject(ElementRef);
        this._componentRef = null;
        this.rdsBadgeLabel = null;
        this.rdsBadgeColor = 'info';
        this.rdsBadgeType = 'default';
        this.rdsBadgeAriaDescribedBy = null;
        this.rdsBadgePlacement = 'top-right';
    }
    ngAfterViewInit() {
        this.renderer.setStyle(this.elementRef.nativeElement, 'position', 'relative');
        this._createComponent();
    }
    ngOnChanges(changes) {
        if (this._componentRef) {
            let shouldDetectChanges = false;
            const label = this._getLabel();
            const badgeType = this._getBadgeType();
            const instance = this._componentRef.instance;
            instance.size = 's';
            if (changes['rdsBadgeLabel'] && instance.label !== label) {
                instance.label = label;
                shouldDetectChanges = true;
            }
            if (changes['rdsBadgeColor'] && instance.color !== this.rdsBadgeColor) {
                instance.color = this.rdsBadgeColor;
                shouldDetectChanges = true;
            }
            if ((changes['rdsBadgeType'] || changes['rdsBadgeLabel']) &&
                instance.type !== badgeType) {
                instance.type = badgeType;
                shouldDetectChanges = true;
            }
            if (changes['rdsBadgeAriaDescribedBy'] &&
                instance.ariaDescribedBy !== this.rdsBadgeAriaDescribedBy) {
                instance.ariaDescribedBy = this.rdsBadgeAriaDescribedBy;
                shouldDetectChanges = true;
            }
            if (shouldDetectChanges) {
                instance.detectChanges();
            }
            if (shouldDetectChanges ||
                (changes['rdsBadgePlacement'] &&
                    changes['rdsBadgePlacement'].previousValue !== this.rdsBadgePlacement)) {
                this._setPosition();
            }
        }
    }
    ngOnDestroy() {
        this._componentRef?.destroy();
    }
    _createComponent() {
        const outlet = new CdkPortalOutlet(this.componentFactoryResolver, this.viewContainerRef);
        const portal = new ComponentPortal(RdsBadgeComponent, this.viewContainerRef);
        this._componentRef = outlet.attachComponentPortal(portal);
        this._componentRef.instance._isAttached = true;
        this._componentRef.instance.label = this._getLabel();
        this._componentRef.instance.color = this.rdsBadgeColor;
        this._componentRef.instance.type = this._getBadgeType();
        this._componentRef.instance.ariaDescribedBy = this.rdsBadgeAriaDescribedBy;
        this._setComponentLocation();
        this._componentRef.changeDetectorRef.detectChanges();
        this._setPosition();
        this._componentRef.onDestroy(() => {
            portal.detach();
            outlet.detach();
        });
    }
    _setComponentLocation() {
        this.renderer.appendChild(this.elementRef.nativeElement, this._getBadgeElement());
        this.renderer.setStyle(this._getBadgeElement(), 'position', 'absolute');
    }
    _setPosition() {
        const badge = this._getBadgeElement();
        this.renderer.removeStyle(badge, 'top');
        this.renderer.removeStyle(badge, 'bottom');
        this.renderer.removeStyle(badge, 'left');
        this.renderer.removeStyle(badge, 'right');
        const offsetY = badge.offsetHeight / 2;
        const offsetWidth = badge.offsetWidth;
        if (this.rdsBadgePlacement?.includes('bottom')) {
            this.renderer.setStyle(badge, 'bottom', `${-offsetY}px`);
        }
        else {
            this.renderer.setStyle(badge, 'top', `${-offsetY}px`);
        }
        this.renderer.setStyle(badge, 'right', `${Math.min(BADGE_OFFSET_RIGHT_PX - offsetWidth, DOT_BADGE_POS_RIGHT_PX)}px`);
    }
    _getLabel() {
        if (this.rdsBadgeType === 'dot' ||
            this.rdsBadgeLabel === null ||
            this.rdsBadgeLabel === undefined) {
            return '';
        }
        return this.rdsBadgeLabel;
    }
    _getBadgeType() {
        return this._getLabel().length > 0 ? this.rdsBadgeType : 'dot';
    }
    _getBadgeElement() {
        return this._componentRef?.location.nativeElement;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsBadgeDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.1", type: RdsBadgeDirective, isStandalone: true, selector: "[rds-badge], [rdsBadge]", inputs: { rdsBadgeLabel: "rdsBadgeLabel", rdsBadgeColor: "rdsBadgeColor", rdsBadgeType: "rdsBadgeType", rdsBadgeAriaDescribedBy: "rdsBadgeAriaDescribedBy", rdsBadgePlacement: "rdsBadgePlacement" }, usesOnChanges: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsBadgeDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[rds-badge], [rdsBadge]',
                    standalone: true,
                }]
        }], propDecorators: { rdsBadgeLabel: [{
                type: Input
            }], rdsBadgeColor: [{
                type: Input
            }], rdsBadgeType: [{
                type: Input
            }], rdsBadgeAriaDescribedBy: [{
                type: Input
            }], rdsBadgePlacement: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkZ2UuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLWNvbXBvbmVudHMvc3JjL2xpYi9iYWRnZS9iYWRnZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLHdCQUF3QixFQUV4QixTQUFTLEVBQ1QsVUFBVSxFQUNWLE1BQU0sRUFDTixLQUFLLEVBR0wsU0FBUyxFQUVULGdCQUFnQixHQUNqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDOztBQUd2RSxNQUFNLHNCQUFzQixHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ2xDLE1BQU0scUJBQXFCLEdBQUcsRUFBRSxDQUFDO0FBUWpDLE1BQU0sT0FBTyxpQkFBaUI7SUFKOUI7UUFLbUIscUJBQWdCLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDNUMsNkJBQXdCLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDNUQsYUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QixlQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXpDLGtCQUFhLEdBQTJDLElBQUksQ0FBQztRQUU1RCxrQkFBYSxHQUFrQixJQUFJLENBQUM7UUFDcEMsa0JBQWEsR0FBa0IsTUFBTSxDQUFDO1FBQ3RDLGlCQUFZLEdBQWlCLFNBQVMsQ0FBQztRQUN2Qyw0QkFBdUIsR0FBa0IsSUFBSSxDQUFDO1FBQzlDLHNCQUFpQixHQUFzQixXQUFXLENBQUM7S0E0STdEO0lBMUlDLGVBQWU7UUFDYixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FDcEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQzdC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QkFBaUI7a0JBSjdCLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHlCQUF5QjtvQkFDbkMsVUFBVSxFQUFFLElBQUk7aUJBQ2pCOzhCQVNVLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLHVCQUF1QjtzQkFBL0IsS0FBSztnQkFDRyxpQkFBaUI7c0JBQXpCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIENvbXBvbmVudFJlZixcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBpbmplY3QsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgUmVuZGVyZXIyLFxuICBTaW1wbGVDaGFuZ2VzLFxuICBWaWV3Q29udGFpbmVyUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJkc0JhZGdlQ29tcG9uZW50IH0gZnJvbSAnLi9iYWRnZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ2RrUG9ydGFsT3V0bGV0LCBDb21wb25lbnRQb3J0YWwgfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcbmltcG9ydCB7IFJkc0JhZGdlQ29sb3IsIFJkc0JhZGdlVHlwZSB9IGZyb20gJy4vYmFkZ2UudHlwZXMnO1xuXG5jb25zdCBET1RfQkFER0VfUE9TX1JJR0hUX1BYID0gLTQ7XG5jb25zdCBCQURHRV9PRkZTRVRfUklHSFRfUFggPSAxMDtcblxuZXhwb3J0IHR5cGUgUmRzQmFkZ2VQbGFjZW1lbnQgPSAndG9wLXJpZ2h0JyB8ICdib3R0b20tcmlnaHQnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbcmRzLWJhZGdlXSwgW3Jkc0JhZGdlXScsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG59KVxuZXhwb3J0IGNsYXNzIFJkc0JhZGdlRGlyZWN0aXZlIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xuICBwcml2YXRlIHJlYWRvbmx5IHZpZXdDb250YWluZXJSZWYgPSBpbmplY3QoVmlld0NvbnRhaW5lclJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyID0gaW5qZWN0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXIgPSBpbmplY3QoUmVuZGVyZXIyKTtcbiAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmID0gaW5qZWN0KEVsZW1lbnRSZWYpO1xuXG4gIHByaXZhdGUgX2NvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPFJkc0JhZGdlQ29tcG9uZW50PiB8IG51bGwgPSBudWxsO1xuXG4gIEBJbnB1dCgpIHJkc0JhZGdlTGFiZWw6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSByZHNCYWRnZUNvbG9yOiBSZHNCYWRnZUNvbG9yID0gJ2luZm8nO1xuICBASW5wdXQoKSByZHNCYWRnZVR5cGU6IFJkc0JhZGdlVHlwZSA9ICdkZWZhdWx0JztcbiAgQElucHV0KCkgcmRzQmFkZ2VBcmlhRGVzY3JpYmVkQnk6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSByZHNCYWRnZVBsYWNlbWVudDogUmRzQmFkZ2VQbGFjZW1lbnQgPSAndG9wLXJpZ2h0JztcblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShcbiAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgJ3Bvc2l0aW9uJyxcbiAgICAgICdyZWxhdGl2ZScsXG4gICAgKTtcbiAgICB0aGlzLl9jcmVhdGVDb21wb25lbnQoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fY29tcG9uZW50UmVmKSB7XG4gICAgICBsZXQgc2hvdWxkRGV0ZWN0Q2hhbmdlcyA9IGZhbHNlO1xuICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLl9nZXRMYWJlbCgpO1xuICAgICAgY29uc3QgYmFkZ2VUeXBlID0gdGhpcy5fZ2V0QmFkZ2VUeXBlKCk7XG4gICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuX2NvbXBvbmVudFJlZi5pbnN0YW5jZTtcbiAgICAgIGluc3RhbmNlLnNpemUgPSAncyc7XG5cbiAgICAgIGlmIChjaGFuZ2VzWydyZHNCYWRnZUxhYmVsJ10gJiYgaW5zdGFuY2UubGFiZWwgIT09IGxhYmVsKSB7XG4gICAgICAgIGluc3RhbmNlLmxhYmVsID0gbGFiZWw7XG4gICAgICAgIHNob3VsZERldGVjdENoYW5nZXMgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2hhbmdlc1sncmRzQmFkZ2VDb2xvciddICYmIGluc3RhbmNlLmNvbG9yICE9PSB0aGlzLnJkc0JhZGdlQ29sb3IpIHtcbiAgICAgICAgaW5zdGFuY2UuY29sb3IgPSB0aGlzLnJkc0JhZGdlQ29sb3I7XG4gICAgICAgIHNob3VsZERldGVjdENoYW5nZXMgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIChjaGFuZ2VzWydyZHNCYWRnZVR5cGUnXSB8fCBjaGFuZ2VzWydyZHNCYWRnZUxhYmVsJ10pICYmXG4gICAgICAgIGluc3RhbmNlLnR5cGUgIT09IGJhZGdlVHlwZVxuICAgICAgKSB7XG4gICAgICAgIGluc3RhbmNlLnR5cGUgPSBiYWRnZVR5cGU7XG4gICAgICAgIHNob3VsZERldGVjdENoYW5nZXMgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGNoYW5nZXNbJ3Jkc0JhZGdlQXJpYURlc2NyaWJlZEJ5J10gJiZcbiAgICAgICAgaW5zdGFuY2UuYXJpYURlc2NyaWJlZEJ5ICE9PSB0aGlzLnJkc0JhZGdlQXJpYURlc2NyaWJlZEJ5XG4gICAgICApIHtcbiAgICAgICAgaW5zdGFuY2UuYXJpYURlc2NyaWJlZEJ5ID0gdGhpcy5yZHNCYWRnZUFyaWFEZXNjcmliZWRCeTtcbiAgICAgICAgc2hvdWxkRGV0ZWN0Q2hhbmdlcyA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChzaG91bGREZXRlY3RDaGFuZ2VzKSB7XG4gICAgICAgIGluc3RhbmNlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBzaG91bGREZXRlY3RDaGFuZ2VzIHx8XG4gICAgICAgIChjaGFuZ2VzWydyZHNCYWRnZVBsYWNlbWVudCddICYmXG4gICAgICAgICAgY2hhbmdlc1sncmRzQmFkZ2VQbGFjZW1lbnQnXS5wcmV2aW91c1ZhbHVlICE9PSB0aGlzLnJkc0JhZGdlUGxhY2VtZW50KVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuX3NldFBvc2l0aW9uKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fY29tcG9uZW50UmVmPy5kZXN0cm95KCk7XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVDb21wb25lbnQoKTogdm9pZCB7XG4gICAgY29uc3Qgb3V0bGV0ID0gbmV3IENka1BvcnRhbE91dGxldChcbiAgICAgIHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLFxuICAgICk7XG4gICAgY29uc3QgcG9ydGFsID0gbmV3IENvbXBvbmVudFBvcnRhbChcbiAgICAgIFJkc0JhZGdlQ29tcG9uZW50LFxuICAgICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLFxuICAgICk7XG4gICAgdGhpcy5fY29tcG9uZW50UmVmID0gb3V0bGV0LmF0dGFjaENvbXBvbmVudFBvcnRhbChwb3J0YWwpO1xuICAgIHRoaXMuX2NvbXBvbmVudFJlZi5pbnN0YW5jZS5faXNBdHRhY2hlZCA9IHRydWU7XG4gICAgdGhpcy5fY29tcG9uZW50UmVmLmluc3RhbmNlLmxhYmVsID0gdGhpcy5fZ2V0TGFiZWwoKTtcbiAgICB0aGlzLl9jb21wb25lbnRSZWYuaW5zdGFuY2UuY29sb3IgPSB0aGlzLnJkc0JhZGdlQ29sb3I7XG4gICAgdGhpcy5fY29tcG9uZW50UmVmLmluc3RhbmNlLnR5cGUgPSB0aGlzLl9nZXRCYWRnZVR5cGUoKTtcbiAgICB0aGlzLl9jb21wb25lbnRSZWYuaW5zdGFuY2UuYXJpYURlc2NyaWJlZEJ5ID0gdGhpcy5yZHNCYWRnZUFyaWFEZXNjcmliZWRCeTtcbiAgICB0aGlzLl9zZXRDb21wb25lbnRMb2NhdGlvbigpO1xuICAgIHRoaXMuX2NvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy5fc2V0UG9zaXRpb24oKTtcbiAgICB0aGlzLl9jb21wb25lbnRSZWYub25EZXN0cm95KCgpID0+IHtcbiAgICAgIHBvcnRhbC5kZXRhY2goKTtcbiAgICAgIG91dGxldC5kZXRhY2goKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3NldENvbXBvbmVudExvY2F0aW9uKCk6IHZvaWQge1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoXG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgIHRoaXMuX2dldEJhZGdlRWxlbWVudCgpLFxuICAgICk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9nZXRCYWRnZUVsZW1lbnQoKSwgJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJyk7XG4gIH1cblxuICBwcml2YXRlIF9zZXRQb3NpdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCBiYWRnZSA9IHRoaXMuX2dldEJhZGdlRWxlbWVudCgpO1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlU3R5bGUoYmFkZ2UsICd0b3AnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKGJhZGdlLCAnYm90dG9tJyk7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZShiYWRnZSwgJ2xlZnQnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKGJhZGdlLCAncmlnaHQnKTtcblxuICAgIGNvbnN0IG9mZnNldFkgPSBiYWRnZS5vZmZzZXRIZWlnaHQgLyAyO1xuICAgIGNvbnN0IG9mZnNldFdpZHRoID0gYmFkZ2Uub2Zmc2V0V2lkdGg7XG5cbiAgICBpZiAodGhpcy5yZHNCYWRnZVBsYWNlbWVudD8uaW5jbHVkZXMoJ2JvdHRvbScpKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGJhZGdlLCAnYm90dG9tJywgYCR7LW9mZnNldFl9cHhgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShiYWRnZSwgJ3RvcCcsIGAkey1vZmZzZXRZfXB4YCk7XG4gICAgfVxuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShcbiAgICAgIGJhZGdlLFxuICAgICAgJ3JpZ2h0JyxcbiAgICAgIGAke01hdGgubWluKFxuICAgICAgICBCQURHRV9PRkZTRVRfUklHSFRfUFggLSBvZmZzZXRXaWR0aCxcbiAgICAgICAgRE9UX0JBREdFX1BPU19SSUdIVF9QWCxcbiAgICAgICl9cHhgLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIF9nZXRMYWJlbCgpOiBzdHJpbmcge1xuICAgIGlmIChcbiAgICAgIHRoaXMucmRzQmFkZ2VUeXBlID09PSAnZG90JyB8fFxuICAgICAgdGhpcy5yZHNCYWRnZUxhYmVsID09PSBudWxsIHx8XG4gICAgICB0aGlzLnJkc0JhZGdlTGFiZWwgPT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJkc0JhZGdlTGFiZWw7XG4gIH1cblxuICBwcml2YXRlIF9nZXRCYWRnZVR5cGUoKTogUmRzQmFkZ2VUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5fZ2V0TGFiZWwoKS5sZW5ndGggPiAwID8gdGhpcy5yZHNCYWRnZVR5cGUgOiAnZG90JztcbiAgfVxuXG4gIHByaXZhdGUgX2dldEJhZGdlRWxlbWVudCgpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudFJlZj8ubG9jYXRpb24ubmF0aXZlRWxlbWVudDtcbiAgfVxufVxuIl19