import { CdkAccordionItem } from '@angular/cdk/accordion';
import { UniqueSelectionDispatcher } from '@angular/cdk/collections';
import { TemplatePortal } from '@angular/cdk/portal';
import { DOCUMENT } from '@angular/common';
import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ElementRef, EventEmitter, HostBinding, inject, Input, Output, ViewChild, ViewContainerRef, ViewEncapsulation, } from '@angular/core';
import { Subject } from 'rxjs';
import { distinctUntilChanged, filter, startWith, take } from 'rxjs/operators';
import { RDS_ACCORDION, } from './accordion-base';
import { rdsExpansionAnimations } from './expansion.animations';
import { RdsExpansionPanelContentDirective } from './expansion-panel-content.directive';
import { FocusMonitor } from '@angular/cdk/a11y';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/portal";
let uniqueId = 0;
export class RdsExpansionPanelComponent extends CdkAccordionItem {
    get togglePosition() {
        return (this._togglePosition || (this.accordion && this.accordion.togglePosition));
    }
    set togglePosition(value) {
        this._togglePosition = value;
    }
    set expanded(value) {
        super.expanded = value;
    }
    get expanded() {
        return super.expanded;
    }
    constructor() {
        super(inject(RDS_ACCORDION, {
            optional: true,
            skipSelf: true,
        }), inject(ChangeDetectorRef), inject(UniqueSelectionDispatcher));
        this.accordion = inject(RDS_ACCORDION, {
            optional: true,
            skipSelf: true,
        });
        this.viewContainerRef = inject(ViewContainerRef);
        this.document = inject(DOCUMENT);
        this.focusMonitor = inject(FocusMonitor);
        this.elementRef = inject(ElementRef);
        this.class = 'rds-expansion-panel';
        this.afterExpand = new EventEmitter();
        this.afterCollapse = new EventEmitter();
        this.opened = new EventEmitter();
        this.closed = new EventEmitter();
        this.expandedChange = new EventEmitter();
        this._inputChanges = new Subject();
        this._headerId = `rds-expansion-panel-header-${uniqueId++}`;
        this._bodyAnimationDone = new Subject();
        this._bodyAnimationDone
            .pipe(distinctUntilChanged((x, y) => {
            return x.fromState === y.fromState && x.toState === y.toState;
        }))
            .subscribe((event) => {
            if (event.fromState !== 'void') {
                if (event.toState === 'expanded') {
                    this.afterExpand.emit();
                }
                else if (event.toState === 'collapsed') {
                    this.afterCollapse.emit();
                }
            }
        });
    }
    _getExpandedState() {
        return this.expanded ? 'expanded' : 'collapsed';
    }
    toggle() {
        this.expanded = !this.expanded;
    }
    close() {
        this.expanded = false;
    }
    open() {
        this.expanded = true;
    }
    ngAfterContentInit() {
        this.focusMonitor.monitor(this.elementRef, true);
        if (this._lazyContent) {
            this.opened
                .pipe(startWith(null), filter(() => this.expanded && !this._portal), take(1))
                .subscribe(() => {
                this._portal = new TemplatePortal(this._lazyContent._template, this.viewContainerRef);
            });
        }
    }
    ngOnChanges(changes) {
        this._inputChanges.next(changes);
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this.focusMonitor.stopMonitoring(this.elementRef);
        this._bodyAnimationDone.complete();
        this._inputChanges.complete();
    }
    focus(origin, options) {
        if (origin) {
            this.focusMonitor.focusVia(this.elementRef, origin, options);
        }
        else {
            this.elementRef.nativeElement.focus(options);
        }
    }
    _containsFocus() {
        if (this._body) {
            const focusedElement = this.document.activeElement;
            const bodyElement = this._body.nativeElement;
            return (focusedElement === bodyElement || bodyElement.contains(focusedElement));
        }
        return false;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsExpansionPanelComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "16.1.0", version: "17.3.1", type: RdsExpansionPanelComponent, selector: "rds-expansion-panel", inputs: { togglePosition: "togglePosition", disabled: ["disabled", "disabled", booleanAttribute], expanded: ["expanded", "expanded", booleanAttribute] }, outputs: { afterExpand: "afterExpand", afterCollapse: "afterCollapse", opened: "opened", closed: "closed", expandedChange: "expandedChange" }, host: { properties: { "class": "this.class", "class.rds-disabled": "this.disabled", "class.rds-expanded": "this.expanded" } }, providers: [{ provide: RDS_ACCORDION, useValue: undefined }], queries: [{ propertyName: "_lazyContent", first: true, predicate: RdsExpansionPanelContentDirective, descendants: true }], viewQueries: [{ propertyName: "_body", first: true, predicate: ["body"], descendants: true }], exportAs: ["rdsExpansionPanel"], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: ` <ng-content select="rds-expansion-panel-header" />
    <div
      class="rds-expansion-panel-content"
      role="region"
      [@bodyExpansion]="_getExpandedState()"
      (@bodyExpansion.done)="_bodyAnimationDone.next($event)"
      [attr.aria-labelledby]="_headerId"
      [id]="id"
      #body
    >
      <div class="rds-expansion-panel-body">
        <ng-content />
        <ng-template [cdkPortalOutlet]="_portal" />
      </div>
    </div>`, isInline: true, styles: [".rds-accordion{width:100%}.rds-accordion .rds-expansion-panel{box-sizing:content-box;display:flex;flex-direction:column;position:relative;overflow:hidden;padding-bottom:0;border-radius:0;border-bottom:1px solid var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel:hover:not(.rds-disabled){border-bottom:2px solid var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel:hover:not(.rds-disabled) .rds-expansion-panel-header{padding:16px 0 14px}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled){padding-bottom:19px}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled):hover{padding-bottom:18px;border-bottom:2px solid var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled) .rds-expansion-panel-header{padding:16px 0}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled) .rds-expansion-panel-header:hover{padding:16px 0}.rds-accordion .rds-expansion-panel.cdk-focused.cdk-keyboard-focused:not(.rds-disabled){outline:2px solid var(--rds-color-stroke-active-focus)}.rds-accordion .rds-expansion-panel.rds-disabled{border-bottom-color:var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel.rds-disabled .rds-expansion-panel-content{color:var(--rds-color-disabled)}.rds-accordion .rds-expansion-panel.rds-disabled.rds-expanded{padding-bottom:19px}.rds-accordion .rds-expansion-panel.rds-disabled.rds-expanded .rds-expansion-panel-header{padding:16px 0}.rds-accordion .rds-expansion-panel.rds-disabled:hover{border-bottom:1px solid var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{color:var(--rds-color-low-contrast);display:flex;flex-direction:row;align-items:center;padding:16px 0 15px;border:none;cursor:pointer}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover,.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:focus{outline:none}@media (max-width: 767.999999px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:20px;font-weight:400;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:20px;font-weight:400;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-indicator{color:var(--rds-color-low-contrast)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover,.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover .rds-expansion-indicator{color:var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before{flex-direction:row-reverse}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before .rds-expansion-indicator{margin:0 12px 0 0}[dir=rtl] .rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before .rds-expansion-indicator{margin:0 0 0 12px}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header[aria-disabled=true]{color:var(--rds-color-disabled);cursor:default}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header[aria-disabled=true] .rds-expansion-indicator{color:var(--rds-color-disabled)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title{display:flex;flex-grow:1;margin-right:16px;align-items:center}[dir=rtl] .rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title{margin-right:0;margin-left:16px}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title>*{font-size:inherit;font-family:inherit;font-weight:inherit;line-height:inherit}.rds-accordion .rds-expansion-panel .rds-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.rds-accordion.rds-accordion-size-s .rds-expansion-panel .rds-expansion-panel-header{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}\n"], dependencies: [{ kind: "directive", type: i1.CdkPortalOutlet, selector: "[cdkPortalOutlet]", inputs: ["cdkPortalOutlet"], outputs: ["attached"], exportAs: ["cdkPortalOutlet"] }], animations: [rdsExpansionAnimations.bodyExpansion], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsExpansionPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-expansion-panel', exportAs: 'rdsExpansionPanel', template: ` <ng-content select="rds-expansion-panel-header" />
    <div
      class="rds-expansion-panel-content"
      role="region"
      [@bodyExpansion]="_getExpandedState()"
      (@bodyExpansion.done)="_bodyAnimationDone.next($event)"
      [attr.aria-labelledby]="_headerId"
      [id]="id"
      #body
    >
      <div class="rds-expansion-panel-body">
        <ng-content />
        <ng-template [cdkPortalOutlet]="_portal" />
      </div>
    </div>`, encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, animations: [rdsExpansionAnimations.bodyExpansion], providers: [{ provide: RDS_ACCORDION, useValue: undefined }], styles: [".rds-accordion{width:100%}.rds-accordion .rds-expansion-panel{box-sizing:content-box;display:flex;flex-direction:column;position:relative;overflow:hidden;padding-bottom:0;border-radius:0;border-bottom:1px solid var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel:hover:not(.rds-disabled){border-bottom:2px solid var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel:hover:not(.rds-disabled) .rds-expansion-panel-header{padding:16px 0 14px}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled){padding-bottom:19px}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled):hover{padding-bottom:18px;border-bottom:2px solid var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled) .rds-expansion-panel-header{padding:16px 0}.rds-accordion .rds-expansion-panel.rds-expanded:not(.rds-disabled) .rds-expansion-panel-header:hover{padding:16px 0}.rds-accordion .rds-expansion-panel.cdk-focused.cdk-keyboard-focused:not(.rds-disabled){outline:2px solid var(--rds-color-stroke-active-focus)}.rds-accordion .rds-expansion-panel.rds-disabled{border-bottom-color:var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel.rds-disabled .rds-expansion-panel-content{color:var(--rds-color-disabled)}.rds-accordion .rds-expansion-panel.rds-disabled.rds-expanded{padding-bottom:19px}.rds-accordion .rds-expansion-panel.rds-disabled.rds-expanded .rds-expansion-panel-header{padding:16px 0}.rds-accordion .rds-expansion-panel.rds-disabled:hover{border-bottom:1px solid var(--rds-color-grey-2)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{color:var(--rds-color-low-contrast);display:flex;flex-direction:row;align-items:center;padding:16px 0 15px;border:none;cursor:pointer}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover,.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:focus{outline:none}@media (max-width: 767.999999px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:20px;font-weight:400;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-accordion .rds-expansion-panel .rds-expansion-panel-header{font-size:20px;font-weight:400;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-indicator{color:var(--rds-color-low-contrast)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover,.rds-accordion .rds-expansion-panel .rds-expansion-panel-header:hover .rds-expansion-indicator{color:var(--rds-color-informative-hover)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before{flex-direction:row-reverse}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before .rds-expansion-indicator{margin:0 12px 0 0}[dir=rtl] .rds-accordion .rds-expansion-panel .rds-expansion-panel-header.rds-expansion-toggle-indicator-before .rds-expansion-indicator{margin:0 0 0 12px}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header[aria-disabled=true]{color:var(--rds-color-disabled);cursor:default}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header[aria-disabled=true] .rds-expansion-indicator{color:var(--rds-color-disabled)}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title{display:flex;flex-grow:1;margin-right:16px;align-items:center}[dir=rtl] .rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title{margin-right:0;margin-left:16px}.rds-accordion .rds-expansion-panel .rds-expansion-panel-header .rds-expansion-panel-header-title>*{font-size:inherit;font-family:inherit;font-weight:inherit;line-height:inherit}.rds-accordion .rds-expansion-panel .rds-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.rds-accordion.rds-accordion-size-s .rds-expansion-panel .rds-expansion-panel-header{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}\n"] }]
        }], ctorParameters: () => [], propDecorators: { class: [{
                type: HostBinding,
                args: ['class']
            }], togglePosition: [{
                type: Input
            }], disabled: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }, {
                type: HostBinding,
                args: ['class.rds-disabled']
            }], expanded: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }, {
                type: HostBinding,
                args: ['class.rds-expanded']
            }], afterExpand: [{
                type: Output
            }], afterCollapse: [{
                type: Output
            }], opened: [{
                type: Output
            }], closed: [{
                type: Output
            }], expandedChange: [{
                type: Output
            }], _lazyContent: [{
                type: ContentChild,
                args: [RdsExpansionPanelContentDirective]
            }], _body: [{
                type: ViewChild,
                args: ['body']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwYW5zaW9uLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvYWNjb3JkaW9uL2V4cGFuc2lvbi1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBRUwsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxNQUFNLEVBQ04sS0FBSyxFQUdMLE1BQU0sRUFFTixTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2hCLGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9FLE9BQU8sRUFDTCxhQUFhLEdBR2QsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN4RixPQUFPLEVBQW1CLFlBQVksRUFBZSxNQUFNLG1CQUFtQixDQUFDOzs7QUFLL0UsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBMEJqQixNQUFNLE9BQU8sMEJB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LFFBQVE7c0JBRmhCLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7O3NCQUNyQyxXQUFXO3VCQUFDLG9CQUFvQjtnQkFLcEIsUUFBUTtzQkFGcEIsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTs7c0JBQ3JDLFdBQVc7dUJBQUMsb0JBQW9CO2dCQVNkLFdBQVc7c0JBQTdCLE1BQU07Z0JBQ1ksYUFBYTtzQkFBL0IsTUFBTTtnQkFDcUIsTUFBTTtzQkFBakMsTUFBTTtnQkFDcUIsTUFBTTtzQkFBakMsTUFBTTtnQkFDcUIsY0FBYztzQkFBekMsTUFBTTtnQkFLUCxZQUFZO3NCQURYLFlBQVk7dUJBQUMsaUNBQWlDO2dCQUU1QixLQUFLO3NCQUF2QixTQUFTO3VCQUFDLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbmltYXRpb25FdmVudCB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgQ2RrQWNjb3JkaW9uSXRlbSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hY2NvcmRpb24nO1xuaW1wb3J0IHsgVW5pcXVlU2VsZWN0aW9uRGlzcGF0Y2hlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XG5pbXBvcnQgeyBUZW1wbGF0ZVBvcnRhbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgYm9vbGVhbkF0dHJpYnV0ZSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBzdGFydFdpdGgsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBSRFNfQUNDT1JESU9OLFxuICBSZHNBY2NvcmRpb25CYXNlLFxuICBSZHNBY2NvcmRpb25Ub2dnbGVQb3NpdGlvbixcbn0gZnJvbSAnLi9hY2NvcmRpb24tYmFzZSc7XG5pbXBvcnQgeyByZHNFeHBhbnNpb25BbmltYXRpb25zIH0gZnJvbSAnLi9leHBhbnNpb24uYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBSZHNFeHBhbnNpb25QYW5lbENvbnRlbnREaXJlY3RpdmUgfSBmcm9tICcuL2V4cGFuc2lvbi1wYW5lbC1jb250ZW50LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBGb2N1c2FibGVPcHRpb24sIEZvY3VzTW9uaXRvciwgRm9jdXNPcmlnaW4gfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQgeyBCb29sZWFuSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuXG5leHBvcnQgdHlwZSBSZHNFeHBhbnNpb25QYW5lbFN0YXRlID0gJ2V4cGFuZGVkJyB8ICdjb2xsYXBzZWQnO1xuXG5sZXQgdW5pcXVlSWQgPSAwO1xuXG5AQ29tcG9uZW50KHtcbiAgc3R5bGVVcmxzOiBbJy4vZXhwYW5zaW9uLXBhbmVsLmNvbXBvbmVudC5zY3NzJ10sXG4gIHNlbGVjdG9yOiAncmRzLWV4cGFuc2lvbi1wYW5lbCcsXG4gIGV4cG9ydEFzOiAncmRzRXhwYW5zaW9uUGFuZWwnLFxuICB0ZW1wbGF0ZTogYCA8bmctY29udGVudCBzZWxlY3Q9XCJyZHMtZXhwYW5zaW9uLXBhbmVsLWhlYWRlclwiIC8+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJyZHMtZXhwYW5zaW9uLXBhbmVsLWNvbnRlbnRcIlxuICAgICAgcm9sZT1cInJlZ2lvblwiXG4gICAgICBbQGJvZHlFeHBhbnNpb25dPVwiX2dldEV4cGFuZGVkU3RhdGUoKVwiXG4gICAgICAoQGJvZHlFeHBhbnNpb24uZG9uZSk9XCJfYm9keUFuaW1hdGlvbkRvbmUubmV4dCgkZXZlbnQpXCJcbiAgICAgIFthdHRyLmFyaWEtbGFiZWxsZWRieV09XCJfaGVhZGVySWRcIlxuICAgICAgW2lkXT1cImlkXCJcbiAgICAgICNib2R5XG4gICAgPlxuICAgICAgPGRpdiBjbGFzcz1cInJkcy1leHBhbnNpb24tcGFuZWwtYm9keVwiPlxuICAgICAgICA8bmctY29udGVudCAvPlxuICAgICAgICA8bmctdGVtcGxhdGUgW2Nka1BvcnRhbE91dGxldF09XCJfcG9ydGFsXCIgLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PmAsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBhbmltYXRpb25zOiBbcmRzRXhwYW5zaW9uQW5pbWF0aW9ucy5ib2R5RXhwYW5zaW9uXSxcbiAgcHJvdmlkZXJzOiBbeyBwcm92aWRlOiBSRFNfQUNDT1JESU9OLCB1c2VWYWx1ZTogdW5kZWZpbmVkIH1dLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNFeHBhbnNpb25QYW5lbENvbXBvbmVudFxuICBleHRlbmRzIENka0FjY29yZGlvbkl0ZW1cbiAgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBGb2N1c2FibGVPcHRpb24sIE9uQ2hhbmdlcywgT25EZXN0cm95XG57XG4gIG92ZXJyaWRlIHJlYWRvbmx5IGFjY29yZGlvbiA9IGluamVjdChSRFNfQUNDT1JESU9OLCB7XG4gICAgb3B0aW9uYWw6IHRydWUsXG4gICAgc2tpcFNlbGY6IHRydWUsXG4gIH0pIGFzIFJkc0FjY29yZGlvbkJhc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgdmlld0NvbnRhaW5lclJlZiA9IGluamVjdChWaWV3Q29udGFpbmVyUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkb2N1bWVudCA9IGluamVjdChET0NVTUVOVCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZm9jdXNNb25pdG9yID0gaW5qZWN0KEZvY3VzTW9uaXRvcik7XG4gIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudFJlZiA9IGluamVjdChFbGVtZW50UmVmKTtcbiAgcHJpdmF0ZSBfdG9nZ2xlUG9zaXRpb246IFJkc0FjY29yZGlvblRvZ2dsZVBvc2l0aW9uO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbGFzcyA9ICdyZHMtZXhwYW5zaW9uLXBhbmVsJztcblxuICBASW5wdXQoKVxuICBnZXQgdG9nZ2xlUG9zaXRpb24oKTogUmRzQWNjb3JkaW9uVG9nZ2xlUG9zaXRpb24ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLl90b2dnbGVQb3NpdGlvbiB8fCAodGhpcy5hY2NvcmRpb24gJiYgdGhpcy5hY2NvcmRpb24udG9nZ2xlUG9zaXRpb24pXG4gICAgKTtcbiAgfVxuXG4gIHNldCB0b2dnbGVQb3NpdGlvbih2YWx1ZTogUmRzQWNjb3JkaW9uVG9nZ2xlUG9zaXRpb24pIHtcbiAgICB0aGlzLl90b2dnbGVQb3NpdGlvbiA9IHZhbHVlO1xuICB9XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG4gIEBIb3N0QmluZGluZygnY2xhc3MucmRzLWRpc2FibGVkJylcbiAgb3ZlcnJpZGUgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG4gIEBIb3N0QmluZGluZygnY2xhc3MucmRzLWV4cGFuZGVkJylcbiAgb3ZlcnJpZGUgc2V0IGV4cGFuZGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgc3VwZXIuZXhwYW5kZWQgPSB2YWx1ZTtcbiAgfVxuXG4gIG92ZXJyaWRlIGdldCBleHBhbmRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3VwZXIuZXhwYW5kZWQ7XG4gIH1cblxuICBAT3V0cHV0KCkgcmVhZG9ubHkgYWZ0ZXJFeHBhbmQgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gIEBPdXRwdXQoKSByZWFkb25seSBhZnRlckNvbGxhcHNlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgb3ZlcnJpZGUgcmVhZG9ubHkgb3BlbmVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgb3ZlcnJpZGUgcmVhZG9ubHkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgb3ZlcnJpZGUgcmVhZG9ubHkgZXhwYW5kZWRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgcmVhZG9ubHkgX2lucHV0Q2hhbmdlcyA9IG5ldyBTdWJqZWN0PFNpbXBsZUNoYW5nZXM+KCk7XG5cbiAgQENvbnRlbnRDaGlsZChSZHNFeHBhbnNpb25QYW5lbENvbnRlbnREaXJlY3RpdmUpXG4gIF9sYXp5Q29udGVudDogUmRzRXhwYW5zaW9uUGFuZWxDb250ZW50RGlyZWN0aXZlO1xuICBAVmlld0NoaWxkKCdib2R5JykgX2JvZHk6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+O1xuICBfcG9ydGFsOiBUZW1wbGF0ZVBvcnRhbDtcbiAgX2hlYWRlcklkID0gYHJkcy1leHBhbnNpb24tcGFuZWwtaGVhZGVyLSR7dW5pcXVlSWQrK31gO1xuXG4gIHJlYWRvbmx5IF9ib2R5QW5pbWF0aW9uRG9uZSA9IG5ldyBTdWJqZWN0PEFuaW1hdGlvbkV2ZW50PigpO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFxuICAgICAgaW5qZWN0KFJEU19BQ0NPUkRJT04sIHtcbiAgICAgICAgb3B0aW9uYWw6IHRydWUsXG4gICAgICAgIHNraXBTZWxmOiB0cnVlLFxuICAgICAgfSkgYXMgUmRzQWNjb3JkaW9uQmFzZSxcbiAgICAgIGluamVjdChDaGFuZ2VEZXRlY3RvclJlZiksXG4gICAgICBpbmplY3QoVW5pcXVlU2VsZWN0aW9uRGlzcGF0Y2hlciksXG4gICAgKTtcbiAgICB0aGlzLl9ib2R5QW5pbWF0aW9uRG9uZVxuICAgICAgLnBpcGUoXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCh4LCB5KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHguZnJvbVN0YXRlID09PSB5LmZyb21TdGF0ZSAmJiB4LnRvU3RhdGUgPT09IHkudG9TdGF0ZTtcbiAgICAgICAgfSksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChldmVudCkgPT4ge1xuICAgICAgICBpZiAoZXZlbnQuZnJvbVN0YXRlICE9PSAndm9pZCcpIHtcbiAgICAgICAgICBpZiAoZXZlbnQudG9TdGF0ZSA9PT0gJ2V4cGFuZGVkJykge1xuICAgICAgICAgICAgdGhpcy5hZnRlckV4cGFuZC5lbWl0KCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChldmVudC50b1N0YXRlID09PSAnY29sbGFwc2VkJykge1xuICAgICAgICAgICAgdGhpcy5hZnRlckNvbGxhcHNlLmVtaXQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgX2dldEV4cGFuZGVkU3RhdGUoKTogUmRzRXhwYW5zaW9uUGFuZWxTdGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kZWQgPyAnZXhwYW5kZWQnIDogJ2NvbGxhcHNlZCc7XG4gIH1cblxuICBvdmVycmlkZSB0b2dnbGUoKTogdm9pZCB7XG4gICAgdGhpcy5leHBhbmRlZCA9ICF0aGlzLmV4cGFuZGVkO1xuICB9XG5cbiAgb3ZlcnJpZGUgY2xvc2UoKTogdm9pZCB7XG4gICAgdGhpcy5leHBhbmRlZCA9IGZhbHNlO1xuICB9XG5cbiAgb3ZlcnJpZGUgb3BlbigpOiB2b2lkIHtcbiAgICB0aGlzLmV4cGFuZGVkID0gdHJ1ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuZWxlbWVudFJlZiwgdHJ1ZSk7XG5cbiAgICBpZiAodGhpcy5fbGF6eUNvbnRlbnQpIHtcbiAgICAgIHRoaXMub3BlbmVkXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHN0YXJ0V2l0aChudWxsKSxcbiAgICAgICAgICBmaWx0ZXIoKCkgPT4gdGhpcy5leHBhbmRlZCAmJiAhdGhpcy5fcG9ydGFsKSxcbiAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX3BvcnRhbCA9IG5ldyBUZW1wbGF0ZVBvcnRhbChcbiAgICAgICAgICAgIHRoaXMuX2xhenlDb250ZW50Ll90ZW1wbGF0ZSxcbiAgICAgICAgICAgIHRoaXMudmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgdGhpcy5faW5wdXRDaGFuZ2VzLm5leHQoY2hhbmdlcyk7XG4gIH1cblxuICBvdmVycmlkZSBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICAgIHRoaXMuZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuZWxlbWVudFJlZik7XG4gICAgdGhpcy5fYm9keUFuaW1hdGlvbkRvbmUuY29tcGxldGUoKTtcbiAgICB0aGlzLl9pbnB1dENoYW5nZXMuY29tcGxldGUoKTtcbiAgfVxuXG4gIGZvY3VzKG9yaWdpbj86IEZvY3VzT3JpZ2luLCBvcHRpb25zPzogRm9jdXNPcHRpb25zKTogdm9pZCB7XG4gICAgaWYgKG9yaWdpbikge1xuICAgICAgdGhpcy5mb2N1c01vbml0b3IuZm9jdXNWaWEodGhpcy5lbGVtZW50UmVmLCBvcmlnaW4sIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cyhvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBfY29udGFpbnNGb2N1cygpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5fYm9keSkge1xuICAgICAgY29uc3QgZm9jdXNlZEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgICBjb25zdCBib2R5RWxlbWVudCA9IHRoaXMuX2JvZHkubmF0aXZlRWxlbWVudDtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgZm9jdXNlZEVsZW1lbnQgPT09IGJvZHlFbGVtZW50IHx8IGJvZHlFbGVtZW50LmNvbnRhaW5zKGZvY3VzZWRFbGVtZW50KVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiJdfQ==