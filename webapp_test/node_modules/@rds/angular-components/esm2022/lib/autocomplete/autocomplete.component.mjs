import { ChangeDetectionStrategy, Component, forwardRef } from '@angular/core';
import { AsyncPipe } from '@angular/common';
import { RdsAbstractFormFieldControl } from '../form-field';
import { RdsProgressSpinnerModule } from '../progress-spinner';
import { RdsIconComponent } from '../icons';
import { RdsButtonModule } from '../button';
import { RdsAbstractAutocompleteComponent } from './abstract-autocomplete.component';
import * as i0 from "@angular/core";
import * as i1 from "../progress-spinner/progress-spinner.component";
import * as i2 from "../button/icon-button.component";
export class RdsAutocompleteComponent extends RdsAbstractAutocompleteComponent {
    set value(value) {
        const oldValue = this.value;
        this._value = value;
        if (!this.compareItem(oldValue, this.value)) {
            this.inputEl.nativeElement.value = this.getDisplayProperty(this.value);
            this.cdr.markForCheck();
        }
    }
    get value() {
        return this._value;
    }
    isInputFilled() {
        return this.value &&
            this.getDisplayProperty(this.value) === this.inputEl?.nativeElement.value
            ? false
            : this.inputEl?.nativeElement.value.length > 0 || false;
    }
    setValueForClear() {
        this.value = null;
    }
    focusChanged(isFocused) {
        if (!isFocused && this.values.length === 1) {
            super.focusChanged(isFocused);
            if (this._search$.getValue() !== '') {
                this._search$.next('');
            }
        }
        else {
            super.focusChanged(isFocused);
        }
    }
    select(option) {
        if (!this.disabled && !this.isSelected(option)) {
            this._search$.next('');
            this.inputEl.nativeElement.value = this.getDisplayProperty(option);
            this._onFocusInputValue = this.inputEl.nativeElement.value;
            if (this.minSearchChars === 0) {
                this._options = [];
            }
            this.updateDropdownOptions();
            const previousValue = this.value;
            if (this._newValues.some((o) => this.compareItem(o, previousValue))) {
                this._options = this._options.filter((o) => !this.compareItem(o, previousValue));
                this._newValues = [];
            }
            this.value = option;
            this.inputEl.nativeElement.focus();
            this.stateChanges.emit();
            this.hide();
        }
    }
    hide() {
        if (this.values.length === 1) {
            this.inputEl.nativeElement.value = this.getDisplayProperty(this.values[0]);
        }
        super.hide();
    }
    deselect(option) {
        if (!this.disabled && (!option || this.isSelected(option))) {
            if (option && this._newValues.some((v) => this.compareItem(v, option))) {
                this._options = this._options.filter((o) => !this.compareItem(o, option));
                this._newValues = this._newValues.filter((v) => !this.compareItem(v, option));
            }
            this.hide();
            this.value = null;
            this.inputEl.nativeElement.value = '';
            this.inputEl.nativeElement.focus();
            this.updateDropdownOptions();
        }
    }
    get values() {
        return this.value ? [this.value] : [];
    }
    assignInputsToDropdown() {
        this._dropdownInstance.instance.type = 'single';
        super.assignInputsToDropdown();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAutocompleteComponent, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsAutocompleteComponent, isStandalone: true, selector: "rds-autocomplete", providers: [
            {
                provide: RdsAbstractFormFieldControl,
                useExisting: forwardRef(() => RdsAutocompleteComponent),
            },
        ], usesInheritance: true, ngImport: i0, template: `
    <div
      class="rds-autocomplete rds-autocomplete-{{
        formField.size
      }} rds-autocomplete-single"
      (click)="inputEl.focus(); show()"
      [class.rds-autocomplete-disabled]="disabled"
      [class.rds-autocomplete-typing]="typing | async"
      [class.rds-autocomplete-has-value]="hasValue()"
    >
      <div class="rds-autocomplete-input-container" #inputContainer>
        <input
          [placeholder]="getPlaceholder()"
          [disabled]="attrDisabled"
          [attr.aria-invalid]="errorState"
          [attr.aria-describedby]="inputAriaDescribedBy"
          autocomplete="off"
          class="rds-form-field__control"
          #inputEl
          (keydown.shift.tab)="addNewItemOnBlurAndHide()"
          (keydown.tab)="addNewItemOnBlurAndHide()"
          (blur)="focusChanged(false)"
          (focus)="focusChanged(true)"
          (input)="search()"
          (keydown)="onInputKeydown($event)"
        />
      </div>
      <div class="rds-autocomplete-icon-container">
        @if (values.length > 0 || inputEl.value) {
          <button
            rds-icon-button
            (click)="clearValue($event)"
            [disabled]="ngControl?.disabled"
          >
            <rds-icon namespace="outlined" icon="close" />
          </button>
        }
        @if (loading | async) {
          <rds-progress-spinner size="s" />
        } @else {
          <rds-icon
            namespace="outlined"
            [icon]="_open ? 'caret_up' : 'caret_down'"
          />
        }
      </div>
    </div>
  `, isInline: true, styles: [".rds-autocomplete{display:flex;justify-content:space-between;align-items:center;height:100%}.rds-autocomplete .rds-autocomplete-input-container{align-items:center;display:flex;width:100%}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled){position:relative}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{position:absolute;left:0;top:calc((100% - 24px)/2);content:\"\";height:24px;width:1px;border-left:1px solid var(--rds-color-high-contrast)}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled).rds-form-field__control-focused:before{display:none}.rds-autocomplete .rds-autocomplete-icon-container{display:flex;align-items:center;height:24px}.rds-autocomplete.rds-autocomplete-disabled .rds-autocomplete-icon-container{color:var(--rds-color-disabled)}.rds-autocomplete.rds-autocomplete-multi .rds-autocomplete-multi-container{display:flex;flex-wrap:wrap;width:100%}.rds-autocomplete.rds-autocomplete-floating-label.rds-autocomplete-multi.rds-autocomplete-floating-label .rds-autocomplete-multi-container{margin-top:16px}.rds-autocomplete.rds-autocomplete-l .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 24px)/2);height:24px}.rds-autocomplete.rds-autocomplete-l.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-l.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-l .rds-autocomplete-icon-container{gap:8px;margin-left:8px}.rds-autocomplete.rds-autocomplete-m .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 24px)/2);height:24px}.rds-autocomplete.rds-autocomplete-m.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-m.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-m .rds-autocomplete-icon-container{gap:8px;margin-left:8px}.rds-autocomplete.rds-autocomplete-s .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 20px)/2);height:20px}.rds-autocomplete.rds-autocomplete-s.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-s.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-s .rds-autocomplete-icon-container{gap:8px;margin-left:8px}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "ngmodule", type: RdsProgressSpinnerModule }, { kind: "component", type: i1.RdsProgressSpinnerComponent, selector: "rds-progress-spinner", inputs: ["value", "minValue", "maxValue", "mode", "size", "label", "white"] }, { kind: "component", type: RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "ngmodule", type: RdsButtonModule }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAutocompleteComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-autocomplete', changeDetection: ChangeDetectionStrategy.OnPush, template: `
    <div
      class="rds-autocomplete rds-autocomplete-{{
        formField.size
      }} rds-autocomplete-single"
      (click)="inputEl.focus(); show()"
      [class.rds-autocomplete-disabled]="disabled"
      [class.rds-autocomplete-typing]="typing | async"
      [class.rds-autocomplete-has-value]="hasValue()"
    >
      <div class="rds-autocomplete-input-container" #inputContainer>
        <input
          [placeholder]="getPlaceholder()"
          [disabled]="attrDisabled"
          [attr.aria-invalid]="errorState"
          [attr.aria-describedby]="inputAriaDescribedBy"
          autocomplete="off"
          class="rds-form-field__control"
          #inputEl
          (keydown.shift.tab)="addNewItemOnBlurAndHide()"
          (keydown.tab)="addNewItemOnBlurAndHide()"
          (blur)="focusChanged(false)"
          (focus)="focusChanged(true)"
          (input)="search()"
          (keydown)="onInputKeydown($event)"
        />
      </div>
      <div class="rds-autocomplete-icon-container">
        @if (values.length > 0 || inputEl.value) {
          <button
            rds-icon-button
            (click)="clearValue($event)"
            [disabled]="ngControl?.disabled"
          >
            <rds-icon namespace="outlined" icon="close" />
          </button>
        }
        @if (loading | async) {
          <rds-progress-spinner size="s" />
        } @else {
          <rds-icon
            namespace="outlined"
            [icon]="_open ? 'caret_up' : 'caret_down'"
          />
        }
      </div>
    </div>
  `, providers: [
                        {
                            provide: RdsAbstractFormFieldControl,
                            useExisting: forwardRef(() => RdsAutocompleteComponent),
                        },
                    ], standalone: true, imports: [
                        AsyncPipe,
                        RdsProgressSpinnerModule,
                        RdsIconComponent,
                        RdsButtonModule,
                    ], styles: [".rds-autocomplete{display:flex;justify-content:space-between;align-items:center;height:100%}.rds-autocomplete .rds-autocomplete-input-container{align-items:center;display:flex;width:100%}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled){position:relative}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{position:absolute;left:0;top:calc((100% - 24px)/2);content:\"\";height:24px;width:1px;border-left:1px solid var(--rds-color-high-contrast)}.rds-autocomplete .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled).rds-form-field__control-focused:before{display:none}.rds-autocomplete .rds-autocomplete-icon-container{display:flex;align-items:center;height:24px}.rds-autocomplete.rds-autocomplete-disabled .rds-autocomplete-icon-container{color:var(--rds-color-disabled)}.rds-autocomplete.rds-autocomplete-multi .rds-autocomplete-multi-container{display:flex;flex-wrap:wrap;width:100%}.rds-autocomplete.rds-autocomplete-floating-label.rds-autocomplete-multi.rds-autocomplete-floating-label .rds-autocomplete-multi-container{margin-top:16px}.rds-autocomplete.rds-autocomplete-l .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 24px)/2);height:24px}.rds-autocomplete.rds-autocomplete-l.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-l.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-l .rds-autocomplete-icon-container{gap:8px;margin-left:8px}.rds-autocomplete.rds-autocomplete-m .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 24px)/2);height:24px}.rds-autocomplete.rds-autocomplete-m.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-m.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-m .rds-autocomplete-icon-container{gap:8px;margin-left:8px}.rds-autocomplete.rds-autocomplete-s .rds-autocomplete-input-container.rds-form-field__control-show-caret:not(.rds-form-field__control-disabled):before{top:calc((100% - 20px)/2);height:20px}.rds-autocomplete.rds-autocomplete-s.rds-autocomplete-multi,.rds-autocomplete.rds-autocomplete-s.rds-autocomplete-multi .rds-autocomplete-multi-container{gap:4px}.rds-autocomplete.rds-autocomplete-s .rds-autocomplete-icon-container{gap:8px;margin-left:8px}\n"] }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvYXV0b2NvbXBsZXRlL2F1dG9jb21wbGV0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzVDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDNUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUM1QyxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQzs7OztBQW9FckYsTUFBTSxPQUFPLHdCQUVYLFNBQVEsZ0NBQXNDO0lBQzlDLElBQWEsS0FBSyxDQUFDLEtBQVE7UUFDekIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUVwQixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFhLEVBQUUsSUFBSSxDQUFDLEtBQVUsQ0FBQyxFQUFFLENBQUM7WUFDdEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUMxQixDQUFDO0lBQ0gsQ0FBQztJQUVELElBQWEsS0FBSztR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QyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVrQixzQkFBc0I7UUFDdkMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO1FBQ2hELEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2pDLENBQUM7OEdBeEdVLHdCQUF3QjtrR0FBeEIsd0JBQXdCLCtEQWR4QjtZQUNUO2dCQUNFLE9BQU8sRUFBRSwyQkFBMkI7Z0JBQ3BDLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsd0JBQXdCLENBQUM7YUFDeEQ7U0FDRixpREF0RFM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBK0NULHVtRkFVQyxTQUFTLDZDQUNULHdCQUF3QiwyTUFDeEIsZ0JBQWdCLG1GQUNoQixlQUFlOzsyRkFHTix3QkFBd0I7a0JBbEVwQyxTQUFTOytCQUNFLGtCQUFrQixtQkFDWCx1QkFBdUIsQ0FBQyxNQUFNLFlBQ3JDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQStDVCxhQUVVO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSwyQkFBMkI7NEJBQ3BDLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDO3lCQUN4RDtxQkFDRixjQUNXLElBQUksV0FDUDt3QkFDUCxTQUFTO3dCQUNULHdCQUF3Qjt3QkFDeEIsZ0JBQWdCO3dCQUNoQixlQUFlO3FCQUNoQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIGZvcndhcmRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFzeW5jUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBSZHNBYnN0cmFjdEZvcm1GaWVsZENvbnRyb2wgfSBmcm9tICcuLi9mb3JtLWZpZWxkJztcbmltcG9ydCB7IFJkc1Byb2dyZXNzU3Bpbm5lck1vZHVsZSB9IGZyb20gJy4uL3Byb2dyZXNzLXNwaW5uZXInO1xuaW1wb3J0IHsgUmRzSWNvbkNvbXBvbmVudCB9IGZyb20gJy4uL2ljb25zJztcbmltcG9ydCB7IFJkc0J1dHRvbk1vZHVsZSB9IGZyb20gJy4uL2J1dHRvbic7XG5pbXBvcnQgeyBSZHNBYnN0cmFjdEF1dG9jb21wbGV0ZUNvbXBvbmVudCB9IGZyb20gJy4vYWJzdHJhY3QtYXV0b2NvbXBsZXRlLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1hdXRvY29tcGxldGUnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2XG4gICAgICBjbGFzcz1cInJkcy1hdXRvY29tcGxldGUgcmRzLWF1dG9jb21wbGV0ZS17e1xuICAgICAgICBmb3JtRmllbGQuc2l6ZVxuICAgICAgfX0gcmRzLWF1dG9jb21wbGV0ZS1zaW5nbGVcIlxuICAgICAgKGNsaWNrKT1cImlucHV0RWwuZm9jdXMoKTsgc2hvdygpXCJcbiAgICAgIFtjbGFzcy5yZHMtYXV0b2NvbXBsZXRlLWRpc2FibGVkXT1cImRpc2FibGVkXCJcbiAgICAgIFtjbGFzcy5yZHMtYXV0b2NvbXBsZXRlLXR5cGluZ109XCJ0eXBpbmcgfCBhc3luY1wiXG4gICAgICBbY2xhc3MucmRzLWF1dG9jb21wbGV0ZS1oYXMtdmFsdWVdPVwiaGFzVmFsdWUoKVwiXG4gICAgPlxuICAgICAgPGRpdiBjbGFzcz1cInJkcy1hdXRvY29tcGxldGUtaW5wdXQtY29udGFpbmVyXCIgI2lucHV0Q29udGFpbmVyPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwiZ2V0UGxhY2Vob2xkZXIoKVwiXG4gICAgICAgICAgW2Rpc2FibGVkXT1cImF0dHJEaXNhYmxlZFwiXG4gICAgICAgICAgW2F0dHIuYXJpYS1pbnZhbGlkXT1cImVycm9yU3RhdGVcIlxuICAgICAgICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiaW5wdXRBcmlhRGVzY3JpYmVkQnlcIlxuICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgY2xhc3M9XCJyZHMtZm9ybS1maWVsZF9fY29udHJvbFwiXG4gICAgICAgICAgI2lucHV0RWxcbiAgICAgICAgICAoa2V5ZG93bi5zaGlmdC50YWIpPVwiYWRkTmV3SXRlbU9uQmx1ckFuZEhpZGUoKVwiXG4gICAgICAgICAgKGtleWRvd24udGFiKT1cImFkZE5ld0l0ZW1PbkJsdXJBbmRIaWRlKClcIlxuICAgICAgICAgIChibHVyKT1cImZvY3VzQ2hhbmdlZChmYWxzZSlcIlxuICAgICAgICAgIChmb2N1cyk9XCJmb2N1c0NoYW5nZWQodHJ1ZSlcIlxuICAgICAgICAgIChpbnB1dCk9XCJzZWFyY2goKVwiXG4gICAgICAgICAgKGtleWRvd24pPVwib25JbnB1dEtleWRvd24oJGV2ZW50KVwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJyZHMtYXV0b2NvbXBsZXRlLWljb24tY29udGFpbmVyXCI+XG4gICAgICAgIEBpZiAodmFsdWVzLmxlbmd0aCA+IDAgfHwgaW5wdXRFbC52YWx1ZSkge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIHJkcy1pY29uLWJ1dHRvblxuICAgICAgICAgICAgKGNsaWNrKT1cImNsZWFyVmFsdWUoJGV2ZW50KVwiXG4gICAgICAgICAgICBbZGlzYWJsZWRdPVwibmdDb250cm9sPy5kaXNhYmxlZFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgaWNvbj1cImNsb3NlXCIgLz5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgICBAaWYgKGxvYWRpbmcgfCBhc3luYykge1xuICAgICAgICAgIDxyZHMtcHJvZ3Jlc3Mtc3Bpbm5lciBzaXplPVwic1wiIC8+XG4gICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgIDxyZHMtaWNvblxuICAgICAgICAgICAgbmFtZXNwYWNlPVwib3V0bGluZWRcIlxuICAgICAgICAgICAgW2ljb25dPVwiX29wZW4gPyAnY2FyZXRfdXAnIDogJ2NhcmV0X2Rvd24nXCJcbiAgICAgICAgICAvPlxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYCxcbiAgc3R5bGVVcmxzOiBbJy4vYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IFJkc0Fic3RyYWN0Rm9ybUZpZWxkQ29udHJvbCxcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFJkc0F1dG9jb21wbGV0ZUNvbXBvbmVudCksXG4gICAgfSxcbiAgXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIEFzeW5jUGlwZSxcbiAgICBSZHNQcm9ncmVzc1NwaW5uZXJNb2R1bGUsXG4gICAgUmRzSWNvbkNvbXBvbmVudCxcbiAgICBSZHNCdXR0b25Nb2R1bGUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFJkc0F1dG9jb21wbGV0ZUNvbXBvbmVudDxcbiAgVCxcbj4gZXh0ZW5kcyBSZHNBYnN0cmFjdEF1dG9jb21wbGV0ZUNvbXBvbmVudDxULCBUPiB7XG4gIG92ZXJyaWRlIHNldCB2YWx1ZSh2YWx1ZTogVCkge1xuICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuXG4gICAgaWYgKCF0aGlzLmNvbXBhcmVJdGVtKG9sZFZhbHVlIGFzIFQsIHRoaXMudmFsdWUgYXMgVCkpIHtcbiAgICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnZhbHVlID0gdGhpcy5nZXREaXNwbGF5UHJvcGVydHkodGhpcy52YWx1ZSk7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBnZXQgdmFsdWUoKTogVCB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgaXNJbnB1dEZpbGxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZSAmJlxuICAgICAgdGhpcy5nZXREaXNwbGF5UHJvcGVydHkodGhpcy52YWx1ZSkgPT09IHRoaXMuaW5wdXRFbD8ubmF0aXZlRWxlbWVudC52YWx1ZVxuICAgICAgPyBmYWxzZVxuICAgICAgOiB0aGlzLmlucHV0RWw/Lm5hdGl2ZUVsZW1lbnQudmFsdWUubGVuZ3RoID4gMCB8fCBmYWxzZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRWYWx1ZUZvckNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMudmFsdWUgPSBudWxsIGFzIFQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgZm9jdXNDaGFuZ2VkKGlzRm9jdXNlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghaXNGb2N1c2VkICYmIHRoaXMudmFsdWVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgc3VwZXIuZm9jdXNDaGFuZ2VkKGlzRm9jdXNlZCk7XG5cbiAgICAgIGlmICh0aGlzLl9zZWFyY2gkLmdldFZhbHVlKCkgIT09ICcnKSB7XG4gICAgICAgIHRoaXMuX3NlYXJjaCQubmV4dCgnJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1cGVyLmZvY3VzQ2hhbmdlZChpc0ZvY3VzZWQpO1xuICAgIH1cbiAgfVxuXG4gIHNlbGVjdChvcHRpb246IFQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgIXRoaXMuaXNTZWxlY3RlZChvcHRpb24pKSB7XG4gICAgICB0aGlzLl9zZWFyY2gkLm5leHQoJycpO1xuICAgICAgdGhpcy5pbnB1dEVsLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLmdldERpc3BsYXlQcm9wZXJ0eShvcHRpb24pO1xuICAgICAgdGhpcy5fb25Gb2N1c0lucHV0VmFsdWUgPSB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC52YWx1ZTtcblxuICAgICAgaWYgKHRoaXMubWluU2VhcmNoQ2hhcnMgPT09IDApIHtcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IFtdO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZURyb3Bkb3duT3B0aW9ucygpO1xuXG4gICAgICBjb25zdCBwcmV2aW91c1ZhbHVlID0gdGhpcy52YWx1ZTtcblxuICAgICAgaWYgKHRoaXMuX25ld1ZhbHVlcy5zb21lKChvKSA9PiB0aGlzLmNvbXBhcmVJdGVtKG8sIHByZXZpb3VzVmFsdWUpKSkge1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gdGhpcy5fb3B0aW9ucy5maWx0ZXIoXG4gICAgICAgICAgKG8pID0+ICF0aGlzLmNvbXBhcmVJdGVtKG8sIHByZXZpb3VzVmFsdWUpLFxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9uZXdWYWx1ZXMgPSBbXTtcbiAgICAgIH1cblxuICAgICAgdGhpcy52YWx1ZSA9IG9wdGlvbjtcbiAgICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICB0aGlzLnN0YXRlQ2hhbmdlcy5lbWl0KCk7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH1cblxuICBvdmVycmlkZSBoaWRlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnZhbHVlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnZhbHVlID0gdGhpcy5nZXREaXNwbGF5UHJvcGVydHkoXG4gICAgICAgIHRoaXMudmFsdWVzWzBdLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBzdXBlci5oaWRlKCk7XG4gIH1cblxuICBvdmVycmlkZSBkZXNlbGVjdChvcHRpb24/OiBUIHwgbnVsbCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiAoIW9wdGlvbiB8fCB0aGlzLmlzU2VsZWN0ZWQob3B0aW9uKSkpIHtcbiAgICAgIGlmIChvcHRpb24gJiYgdGhpcy5fbmV3VmFsdWVzLnNvbWUoKHYpID0+IHRoaXMuY29tcGFyZUl0ZW0odiwgb3B0aW9uKSkpIHtcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IHRoaXMuX29wdGlvbnMuZmlsdGVyKFxuICAgICAgICAgIChvKSA9PiAhdGhpcy5jb21wYXJlSXRlbShvLCBvcHRpb24pLFxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9uZXdWYWx1ZXMgPSB0aGlzLl9uZXdWYWx1ZXMuZmlsdGVyKFxuICAgICAgICAgICh2KSA9PiAhdGhpcy5jb21wYXJlSXRlbSh2LCBvcHRpb24pLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIHRoaXMudmFsdWUgPSBudWxsIGFzIFQ7XG4gICAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICAgICAgdGhpcy5pbnB1dEVsLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIHRoaXMudXBkYXRlRHJvcGRvd25PcHRpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHZhbHVlcygpOiBUW10ge1xuICAgIHJldHVybiB0aGlzLnZhbHVlID8gW3RoaXMudmFsdWVdIDogW107XG4gIH1cblxuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgYXNzaWduSW5wdXRzVG9Ecm9wZG93bigpOiB2b2lkIHtcbiAgICB0aGlzLl9kcm9wZG93bkluc3RhbmNlLmluc3RhbmNlLnR5cGUgPSAnc2luZ2xlJztcbiAgICBzdXBlci5hc3NpZ25JbnB1dHNUb0Ryb3Bkb3duKCk7XG4gIH1cbn1cbiJdfQ==