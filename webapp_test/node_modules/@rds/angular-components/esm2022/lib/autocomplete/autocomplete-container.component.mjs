import { ChangeDetectionStrategy, ChangeDetectorRef, Component, DestroyRef, ElementRef, inject, Input, ViewChild, ViewEncapsulation, } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { AsyncPipe, NgTemplateOutlet } from '@angular/common';
import { RdsListItemModule } from '../list-item';
import { RdsIconComponent } from '../icons';
import { RdsAutocompleteIntl } from './autocomplete-intl.service';
import { RdsAutocompleteHighlightDirective } from './autocomplete-highlight.directive';
import { ContentObserver } from '@angular/cdk/observers';
import { RDS_AUTOCOMPLETE_CONFIG, RDS_AUTOCOMPLETE_DEFAULT_CONFIG, } from './autocomplete.config';
import { RdsAutocompleteOptionDirective } from './autocomplete-option.directive';
import * as i0 from "@angular/core";
import * as i1 from "../list-item/list-item.component";
import * as i2 from "../list-item/multi-select-list-item.component";
import * as i3 from "../list-item/single-select-list-item.component";
export class RdsAutocompleteContainerComponent {
    constructor() {
        this.cdr = inject(ChangeDetectorRef);
        this.intl = inject(RdsAutocompleteIntl);
        this.observer = inject(ContentObserver);
        this.destroyRef = inject(DestroyRef);
        this.elementRef = inject(ElementRef);
        this.config = {
            ...RDS_AUTOCOMPLETE_DEFAULT_CONFIG,
            ...inject(RDS_AUTOCOMPLETE_CONFIG, { optional: true }),
        };
        this.size = 's';
        this._options = [];
        this.selectedOptions = [];
        this.availableOptions = [];
        this.lastSelectedValue = null;
        this.loadingText = RdsAutocompleteIntl.translations.loadingText;
        this.noDataText = RdsAutocompleteIntl.translations.noDataText;
        this.newItemText = RdsAutocompleteIntl.translations.newItemText;
        this.autocompleteOptions = new Map();
        this.optionElements = [];
        this.trackBy = (_i, a) => this.autocomplete.getUniqProperty(a);
    }
    set options(options) {
        this._options = options;
        this.selectedOptions = options.filter((o) => this.autocomplete.isSelected(o));
        this.availableOptions = options.filter((o) => !this.autocomplete.isSelected(o));
        this.lastSelectedValue =
            this.autocomplete.values.length > 0
                ? this.autocomplete.values[this.autocomplete.values.length - 1]
                : null;
    }
    get options() {
        return this._options;
    }
    ngOnInit() {
        this.intl.change$
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe((t) => {
            this.loadingText = this.autocomplete.loadingText || t.loadingText;
            this.noDataText = this.autocomplete.noDataText || t.noDataText;
            this.newItemText = this.autocomplete.newItemText || t.newItemText;
            this.cdr.markForCheck();
        });
        this.observer
            .observe(this.elementRef)
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.autocomplete.updatePosition());
    }
    _addOption(option, component) {
        this.autocompleteOptions.set(option, component);
    }
    _deleteOption(option) {
        this.autocompleteOptions.delete(option);
    }
    ngAfterContentChecked() {
        this.optionElements = [];
        for (let i = 0; i < this.autocompleteContainer?.nativeElement.children.length; i++) {
            const record = this.autocompleteOptions.get(this.autocompleteContainer.nativeElement.children.item(i));
            if (record) {
                this.optionElements.push(record);
            }
        }
    }
    onKeydown(event) {
        if (['Enter', 'ArrowUp', 'ArrowDown'].includes(event.key)) {
            event.preventDefault();
            event.stopPropagation();
            if (event.key === 'Enter') {
                this.onEnter();
            }
            else if (event.key === 'ArrowUp') {
                this.onUpArrow();
            }
            else if (event.key === 'ArrowDown') {
                this.onDownArrow();
            }
        }
    }
    shouldShowCreateNewOption() {
        if (this.autocomplete.isInputFilled() &&
            typeof this.autocomplete.newItem === 'function') {
            const newItem = this.autocomplete.getNewItem();
            return !this.getSelectedFirstOptions().some((o) => this.autocomplete.compareItem(o, newItem));
        }
        else {
            return false;
        }
    }
    getSelectedFirstOptions() {
        return [...this.selectedOptions, ...this.availableOptions];
    }
    onDownArrow() {
        if (!this.keyboardFocusedItem) {
            this.selectFirstItem();
        }
        else {
            const index = this.optionElements.findIndex((e) => e === this.keyboardFocusedItem);
            const nextIndex = (index + 1) % this.optionElements.length;
            this.keyboardFocusedItem = this.optionElements[nextIndex];
        }
        this.scrollToSelectedItem();
        this.cdr.markForCheck();
    }
    onUpArrow() {
        if (!this.keyboardFocusedItem) {
            this.selectFirstItem();
        }
        else {
            const index = this.optionElements.findIndex((e) => e === this.keyboardFocusedItem);
            const nextIndex = index - 1 < 0 ? this.optionElements.length - 1 : index - 1;
            this.keyboardFocusedItem = this.optionElements[nextIndex];
        }
        this.scrollToSelectedItem();
        this.cdr.markForCheck();
    }
    onEnter() {
        if (this.optionElements) {
            const index = this.optionElements.findIndex((v) => v === this.keyboardFocusedItem);
            if (index >= 0) {
                for (const [element, option] of this.autocompleteOptions) {
                    if (this.optionElements[index] === option) {
                        element.dispatchEvent(new MouseEvent('click'));
                        break;
                    }
                }
            }
        }
    }
    scrollToSelectedItem() {
        let optionElement;
        for (const [element, option] of this.autocompleteOptions) {
            if (this.keyboardFocusedItem === option) {
                optionElement = element;
                break;
            }
        }
        if (this.keyboardFocusedItem) {
            const itemHeight = optionElement?.offsetHeight || 0;
            const scrollContainerHeight = this.autocompleteContainer.nativeElement.scrollHeight;
            const panelHeight = Math.min(scrollContainerHeight, this.config.optionsContainerMaxHeight);
            const divider = 2;
            const maxScroll = scrollContainerHeight - panelHeight;
            const scrollBuffer = panelHeight / divider;
            const optionOffsetFormScrollTop = this.optionElements.findIndex((el) => el === this.keyboardFocusedItem) *
                itemHeight;
            const halfOptionHeight = itemHeight / divider;
            const optimalScrollPosition = optionOffsetFormScrollTop - scrollBuffer + halfOptionHeight;
            this.autocompleteContainer.nativeElement.scrollTop = Math.min(Math.max(0, optimalScrollPosition), maxScroll);
        }
    }
    selectFirstItem() {
        if (this.optionElements[0]) {
            this.keyboardFocusedItem = this.optionElements[0];
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAutocompleteContainerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsAutocompleteContainerComponent, isStandalone: true, selector: "rds-autocomplete-container", inputs: { size: "size", type: "type", options: "options" }, viewQueries: [{ propertyName: "autocompleteContainer", first: true, predicate: ["autocompleteContainer"], descendants: true }], ngImport: i0, template: `
    <div class="rds-autocomplete-container" #autocompleteContainer>
      @if (autocomplete.loading | async) {
        @if (autocomplete.loadingTemplate) {
          <ng-container
            [ngTemplateOutlet]="autocomplete.loadingTemplate"
            [ngTemplateOutletContext]="{
              $implicit: autocomplete,
              autocomplete
            }"
          />
        } @else {
          <button
            class="rds-autocomplete-loading"
            rds-list-item
            [size]="size"
            disabled
          >
            {{ autocomplete.loadingText || loadingText }}
          </button>
        }
      } @else {
        @for (option of selectedOptions; track trackBy($index, option)) {
          <ng-container
            [ngTemplateOutlet]="
              autocomplete.optionTemplate || defaultOptionTemplate
            "
            [ngTemplateOutletContext]="{
              option,
              keyboardFocusedItem,
              $implicit: autocomplete,
              autocomplete
            }"
          />
        }
        @if (
          selectedOptions.length > 0 &&
          (availableOptions.length > 0 ||
            shouldShowCreateNewOption() ||
            (options.length === 0 && !shouldShowCreateNewOption()))
        ) {
          <div class="rds-autocomplete-separator"></div>
        }
        @if (shouldShowCreateNewOption()) {
          @if (autocomplete.newItemTemplate) {
            <ng-container
              [ngTemplateOutlet]="autocomplete.newItemTemplate"
              [ngTemplateOutletContext]="{
                $implicit: autocomplete,
                autocomplete,
                keyboardFocusedItem
              }"
            />
          } @else {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              class="rds-autocomplete-option-new-item"
              rds-list-item
              [size]="size"
              (click)="autocomplete.selectNewItem()"
            >
              <span class="rds-autocomplete-text">{{ newItemText }}</span>
              {{ autocomplete.getSearchQuery() }}
            </button>
          }
        }
        @for (option of availableOptions; track trackBy($index, option)) {
          <ng-container
            [ngTemplateOutlet]="
              autocomplete.optionTemplate || defaultOptionTemplate
            "
            [ngTemplateOutletContext]="{
              option,
              keyboardFocusedItem,
              $implicit: autocomplete,
              autocomplete
            }"
          />
        }
        <ng-template #defaultOptionTemplate let-o="option">
          @if (type === 'single') {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              rds-single-select-list-item
              [size]="size"
              [checked]="autocomplete.isSelected(o)"
              (click)="autocomplete.toggle(o)"
            >
              <span
                [innerHTML]="autocomplete.getDisplayProperty(o)"
                [rdsAutocomplateHighlight]="autocomplete.getSearchQuery()"
                [rdsAutocomplateHighlightDisabled]="
                  autocomplete.highlightQuery === false
                "
                [rdsAutocomplateHighlightInverse]="
                  autocomplete.highlightQuery === 'inverse'
                "
              ></span>
            </button>
          }
          @if (type === 'multi') {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              rds-multi-select-list-item
              [size]="size"
              [checked]="autocomplete.isSelected(o)"
              (click)="autocomplete.toggle(o)"
            >
              <span
                [innerHTML]="autocomplete.getDisplayProperty(o)"
                [rdsAutocomplateHighlight]="autocomplete.getSearchQuery()"
                [rdsAutocomplateHighlightDisabled]="
                  autocomplete.highlightQuery === false
                "
                [rdsAutocomplateHighlightInverse]="
                  autocomplete.highlightQuery === 'inverse'
                "
              ></span>
            </button>
          }
        </ng-template>
      }
      @if (
        (autocomplete.loading | async) === false &&
        options.length === 0 &&
        !shouldShowCreateNewOption()
      ) {
        @if (autocomplete.noDataTemplate) {
          <ng-container
            [ngTemplateOutlet]="autocomplete.noDataTemplate"
            [ngTemplateOutletContext]="{
              $implicit: autocomplete,
              autocomplete
            }"
          />
        } @else {
          <button
            class="rds-autocomplete-option-no-data"
            rds-list-item
            [size]="size"
            disabled
          >
            <rds-icon namespace="outlined" icon="warning_circle" />
            {{ autocomplete.noDataText || noDataText }}
          </button>
        }
      }
    </div>
  `, isInline: true, styles: ["rds-autocomplete-container{width:100%;background:var(--rds-color-bg-base-1)}rds-autocomplete-container .rds-autocomplete-container{box-shadow:0 0 1px #0000003d,0 8px 20px #00000026;border-radius:2px;max-height:256px;padding-top:12px;padding-bottom:12px;background:var(--rds-color-bg-base-1);display:flex;flex-direction:column;background-clip:padding-box;overflow-y:auto}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplete-highlight{font-weight:400;color:inherit;background:inherit}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplate-highlight-inverse{font-weight:400}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplate-highlight-inverse .rds-autocomplete-highlight{font-weight:200;color:inherit;background:inherit}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option.rds-autocomplete-option-new-item .rds-autocomplete-text{color:var(--rds-color-informative);font-weight:400}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-separator{border-bottom:1px solid var(--rds-color-grey-2);margin-top:4px;margin-bottom:4px}\n"], dependencies: [{ kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "ngmodule", type: RdsListItemModule }, { kind: "component", type: i1.RdsListItemComponent, selector: "button[rds-list-item], button[rdsListItem]", inputs: ["size", "role", "disabled"] }, { kind: "component", type: i2.RdsMultiSelectListItemComponent, selector: "button[rds-multi-select-list-item], button[rdsMultiSelectListItem]" }, { kind: "component", type: i3.RdsSingleSelectListItemComponent, selector: "button[rds-single-select-list-item], button[rdsSingleSelectListItem]" }, { kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "directive", type: RdsAutocompleteHighlightDirective, selector: "[rdsAutocomplateHighlight], [rds-autocomplate-highlight]", inputs: ["rdsAutocomplateHighlight", "rdsAutocomplateHighlightCaseSensitive", "rdsAutocomplateHighlightCustomClasses", "rdsAutocomplateHighlightInverse", "rdsAutocomplateHighlightDisabled"] }, { kind: "directive", type: RdsAutocompleteOptionDirective, selector: "rds-autocomplete-option, [rds-autocomplete-option], [rdsAutocompleteOption]", inputs: ["rdsAutocompleteOption", "keyboardFocusedItem"], exportAs: ["rdsAutocompleteOption"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAutocompleteContainerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-autocomplete-container', template: `
    <div class="rds-autocomplete-container" #autocompleteContainer>
      @if (autocomplete.loading | async) {
        @if (autocomplete.loadingTemplate) {
          <ng-container
            [ngTemplateOutlet]="autocomplete.loadingTemplate"
            [ngTemplateOutletContext]="{
              $implicit: autocomplete,
              autocomplete
            }"
          />
        } @else {
          <button
            class="rds-autocomplete-loading"
            rds-list-item
            [size]="size"
            disabled
          >
            {{ autocomplete.loadingText || loadingText }}
          </button>
        }
      } @else {
        @for (option of selectedOptions; track trackBy($index, option)) {
          <ng-container
            [ngTemplateOutlet]="
              autocomplete.optionTemplate || defaultOptionTemplate
            "
            [ngTemplateOutletContext]="{
              option,
              keyboardFocusedItem,
              $implicit: autocomplete,
              autocomplete
            }"
          />
        }
        @if (
          selectedOptions.length > 0 &&
          (availableOptions.length > 0 ||
            shouldShowCreateNewOption() ||
            (options.length === 0 && !shouldShowCreateNewOption()))
        ) {
          <div class="rds-autocomplete-separator"></div>
        }
        @if (shouldShowCreateNewOption()) {
          @if (autocomplete.newItemTemplate) {
            <ng-container
              [ngTemplateOutlet]="autocomplete.newItemTemplate"
              [ngTemplateOutletContext]="{
                $implicit: autocomplete,
                autocomplete,
                keyboardFocusedItem
              }"
            />
          } @else {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              class="rds-autocomplete-option-new-item"
              rds-list-item
              [size]="size"
              (click)="autocomplete.selectNewItem()"
            >
              <span class="rds-autocomplete-text">{{ newItemText }}</span>
              {{ autocomplete.getSearchQuery() }}
            </button>
          }
        }
        @for (option of availableOptions; track trackBy($index, option)) {
          <ng-container
            [ngTemplateOutlet]="
              autocomplete.optionTemplate || defaultOptionTemplate
            "
            [ngTemplateOutletContext]="{
              option,
              keyboardFocusedItem,
              $implicit: autocomplete,
              autocomplete
            }"
          />
        }
        <ng-template #defaultOptionTemplate let-o="option">
          @if (type === 'single') {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              rds-single-select-list-item
              [size]="size"
              [checked]="autocomplete.isSelected(o)"
              (click)="autocomplete.toggle(o)"
            >
              <span
                [innerHTML]="autocomplete.getDisplayProperty(o)"
                [rdsAutocomplateHighlight]="autocomplete.getSearchQuery()"
                [rdsAutocomplateHighlightDisabled]="
                  autocomplete.highlightQuery === false
                "
                [rdsAutocomplateHighlightInverse]="
                  autocomplete.highlightQuery === 'inverse'
                "
              ></span>
            </button>
          }
          @if (type === 'multi') {
            <button
              [rdsAutocompleteOption]="autocomplete"
              [keyboardFocusedItem]="keyboardFocusedItem"
              #option="rdsAutocompleteOption"
              rds-multi-select-list-item
              [size]="size"
              [checked]="autocomplete.isSelected(o)"
              (click)="autocomplete.toggle(o)"
            >
              <span
                [innerHTML]="autocomplete.getDisplayProperty(o)"
                [rdsAutocomplateHighlight]="autocomplete.getSearchQuery()"
                [rdsAutocomplateHighlightDisabled]="
                  autocomplete.highlightQuery === false
                "
                [rdsAutocomplateHighlightInverse]="
                  autocomplete.highlightQuery === 'inverse'
                "
              ></span>
            </button>
          }
        </ng-template>
      }
      @if (
        (autocomplete.loading | async) === false &&
        options.length === 0 &&
        !shouldShowCreateNewOption()
      ) {
        @if (autocomplete.noDataTemplate) {
          <ng-container
            [ngTemplateOutlet]="autocomplete.noDataTemplate"
            [ngTemplateOutletContext]="{
              $implicit: autocomplete,
              autocomplete
            }"
          />
        } @else {
          <button
            class="rds-autocomplete-option-no-data"
            rds-list-item
            [size]="size"
            disabled
          >
            <rds-icon namespace="outlined" icon="warning_circle" />
            {{ autocomplete.noDataText || noDataText }}
          </button>
        }
      }
    </div>
  `, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, standalone: true, imports: [
                        AsyncPipe,
                        RdsListItemModule,
                        NgTemplateOutlet,
                        RdsIconComponent,
                        RdsAutocompleteHighlightDirective,
                        RdsAutocompleteOptionDirective,
                    ], styles: ["rds-autocomplete-container{width:100%;background:var(--rds-color-bg-base-1)}rds-autocomplete-container .rds-autocomplete-container{box-shadow:0 0 1px #0000003d,0 8px 20px #00000026;border-radius:2px;max-height:256px;padding-top:12px;padding-bottom:12px;background:var(--rds-color-bg-base-1);display:flex;flex-direction:column;background-clip:padding-box;overflow-y:auto}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplete-highlight{font-weight:400;color:inherit;background:inherit}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplate-highlight-inverse{font-weight:400}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option .rds-autocomplate-highlight-inverse .rds-autocomplete-highlight{font-weight:200;color:inherit;background:inherit}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-option.rds-autocomplete-option-new-item .rds-autocomplete-text{color:var(--rds-color-informative);font-weight:400}rds-autocomplete-container .rds-autocomplete-container .rds-autocomplete-separator{border-bottom:1px solid var(--rds-color-grey-2);margin-top:4px;margin-bottom:4px}\n"] }]
        }], propDecorators: { size: [{
                type: Input
            }], type: [{
                type: Input,
                args: [{ required: true }]
            }], options: [{
                type: Input
            }], autocompleteContainer: [{
                type: ViewChild,
                args: ['autocompleteContainer']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2F1dG9jb21wbGV0ZS9hdXRvY29tcGxldGUtY29udGFpbmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFVBQVUsRUFDVixNQUFNLEVBQ04sS0FBSyxFQUdMLFNBQVMsRUFDVCxpQkFBaUIsR0FDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlELE9BQU8sRUFBRSxpQkFBaUIsRUFBbUIsTUFBTSxjQUFjLENBQUM7QUFDbEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUV6RCxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLCtCQUErQixHQUNoQyxNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7OztBQThLakYsTUFBTSxPQUFPLGlDQUFpQztJQTFLOUM7UUFnTG1CLFFBQUcsR0FBRyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNoQyxTQUFJLEdBQUcsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDbkMsYUFBUSxHQUFH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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EwSlQsbUJBRWdCLHVCQUF1QixDQUFDLE1BQU0saUJBQ2hDLGlCQUFpQixDQUFDLElBQUksY0FDekIsSUFBSSxXQUNQO3dCQUNQLFNBQVM7d0JBQ1QsaUJBQWlCO3dCQUNqQixnQkFBZ0I7d0JBQ2hCLGdCQUFnQjt3QkFDaEIsaUNBQWlDO3dCQUNqQyw4QkFBOEI7cUJBQy9COzhCQW1CUSxJQUFJO3NCQUFaLEtBQUs7Z0JBQ3FCLElBQUk7c0JBQTlCLEtBQUs7dUJBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO2dCQUdyQixPQUFPO3NCQURWLEtBQUs7Z0JBc0NJLHFCQUFxQjtzQkFEOUIsU0FBUzt1QkFBQyx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRDaGVja2VkLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRGVzdHJveVJlZixcbiAgRWxlbWVudFJlZixcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBUcmFja0J5RnVuY3Rpb24sXG4gIFZpZXdDaGlsZCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHsgQXN5bmNQaXBlLCBOZ1RlbXBsYXRlT3V0bGV0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFJkc0xpc3RJdGVtTW9kdWxlLCBSZHNMaXN0SXRlbVNpemUgfSBmcm9tICcuLi9saXN0LWl0ZW0nO1xuaW1wb3J0IHsgUmRzSWNvbkNvbXBvbmVudCB9IGZyb20gJy4uL2ljb25zJztcbmltcG9ydCB7IFJkc0F1dG9jb21wbGV0ZUludGwgfSBmcm9tICcuL2F1dG9jb21wbGV0ZS1pbnRsLnNlcnZpY2UnO1xuaW1wb3J0IHsgUmRzQXV0b2NvbXBsZXRlSGlnaGxpZ2h0RGlyZWN0aXZlIH0gZnJvbSAnLi9hdXRvY29tcGxldGUtaGlnaGxpZ2h0LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBDb250ZW50T2JzZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvb2JzZXJ2ZXJzJztcbmltcG9ydCB7IFJkc0Fic3RyYWN0QXV0b2NvbXBsZXRlQ29tcG9uZW50IH0gZnJvbSAnLi9hYnN0cmFjdC1hdXRvY29tcGxldGUuY29tcG9uZW50JztcbmltcG9ydCB7XG4gIFJEU19BVVRPQ09NUExFVEVfQ09ORklHLFxuICBSRFNfQVVUT0NPTVBMRVRFX0RFRkFVTFRfQ09ORklHLFxufSBmcm9tICcuL2F1dG9jb21wbGV0ZS5jb25maWcnO1xuaW1wb3J0IHsgUmRzQXV0b2NvbXBsZXRlT3B0aW9uRGlyZWN0aXZlIH0gZnJvbSAnLi9hdXRvY29tcGxldGUtb3B0aW9uLmRpcmVjdGl2ZSc7XG5cbmV4cG9ydCB0eXBlIFJkc0F1dG9jb21wbGV0ZVR5cGUgPSAnc2luZ2xlJyB8ICdtdWx0aSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1hdXRvY29tcGxldGUtY29udGFpbmVyJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwicmRzLWF1dG9jb21wbGV0ZS1jb250YWluZXJcIiAjYXV0b2NvbXBsZXRlQ29udGFpbmVyPlxuICAgICAgQGlmIChhdXRvY29tcGxldGUubG9hZGluZyB8IGFzeW5jKSB7XG4gICAgICAgIEBpZiAoYXV0b2NvbXBsZXRlLmxvYWRpbmdUZW1wbGF0ZSkge1xuICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImF1dG9jb21wbGV0ZS5sb2FkaW5nVGVtcGxhdGVcIlxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICAgICAgICAgJGltcGxpY2l0OiBhdXRvY29tcGxldGUsXG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgLz5cbiAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgY2xhc3M9XCJyZHMtYXV0b2NvbXBsZXRlLWxvYWRpbmdcIlxuICAgICAgICAgICAgcmRzLWxpc3QtaXRlbVxuICAgICAgICAgICAgW3NpemVdPVwic2l6ZVwiXG4gICAgICAgICAgICBkaXNhYmxlZFxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7IGF1dG9jb21wbGV0ZS5sb2FkaW5nVGV4dCB8fCBsb2FkaW5nVGV4dCB9fVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICB9XG4gICAgICB9IEBlbHNlIHtcbiAgICAgICAgQGZvciAob3B0aW9uIG9mIHNlbGVjdGVkT3B0aW9uczsgdHJhY2sgdHJhY2tCeSgkaW5kZXgsIG9wdGlvbikpIHtcbiAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJcbiAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlLm9wdGlvblRlbXBsYXRlIHx8IGRlZmF1bHRPcHRpb25UZW1wbGF0ZVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAgICAgICAgIG9wdGlvbixcbiAgICAgICAgICAgICAga2V5Ym9hcmRGb2N1c2VkSXRlbSxcbiAgICAgICAgICAgICAgJGltcGxpY2l0OiBhdXRvY29tcGxldGUsXG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZVxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgICBAaWYgKFxuICAgICAgICAgIHNlbGVjdGVkT3B0aW9ucy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgKGF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgc2hvdWxkU2hvd0NyZWF0ZU5ld09wdGlvbigpIHx8XG4gICAgICAgICAgICAob3B0aW9ucy5sZW5ndGggPT09IDAgJiYgIXNob3VsZFNob3dDcmVhdGVOZXdPcHRpb24oKSkpXG4gICAgICAgICkge1xuICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZHMtYXV0b2NvbXBsZXRlLXNlcGFyYXRvclwiPjwvZGl2PlxuICAgICAgICB9XG4gICAgICAgIEBpZiAoc2hvdWxkU2hvd0NyZWF0ZU5ld09wdGlvbigpKSB7XG4gICAgICAgICAgQGlmIChhdXRvY29tcGxldGUubmV3SXRlbVRlbXBsYXRlKSB7XG4gICAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImF1dG9jb21wbGV0ZS5uZXdJdGVtVGVtcGxhdGVcIlxuICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgICAgICAgICRpbXBsaWNpdDogYXV0b2NvbXBsZXRlLFxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZSxcbiAgICAgICAgICAgICAgICBrZXlib2FyZEZvY3VzZWRJdGVtXG4gICAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICB9IEBlbHNlIHtcbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgW3Jkc0F1dG9jb21wbGV0ZU9wdGlvbl09XCJhdXRvY29tcGxldGVcIlxuICAgICAgICAgICAgICBba2V5Ym9hcmRGb2N1c2VkSXRlbV09XCJrZXlib2FyZEZvY3VzZWRJdGVtXCJcbiAgICAgICAgICAgICAgI29wdGlvbj1cInJkc0F1dG9jb21wbGV0ZU9wdGlvblwiXG4gICAgICAgICAgICAgIGNsYXNzPVwicmRzLWF1dG9jb21wbGV0ZS1vcHRpb24tbmV3LWl0ZW1cIlxuICAgICAgICAgICAgICByZHMtbGlzdC1pdGVtXG4gICAgICAgICAgICAgIFtzaXplXT1cInNpemVcIlxuICAgICAgICAgICAgICAoY2xpY2spPVwiYXV0b2NvbXBsZXRlLnNlbGVjdE5ld0l0ZW0oKVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicmRzLWF1dG9jb21wbGV0ZS10ZXh0XCI+e3sgbmV3SXRlbVRleHQgfX08L3NwYW4+XG4gICAgICAgICAgICAgIHt7IGF1dG9jb21wbGV0ZS5nZXRTZWFyY2hRdWVyeSgpIH19XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgQGZvciAob3B0aW9uIG9mIGF2YWlsYWJsZU9wdGlvbnM7IHRyYWNrIHRyYWNrQnkoJGluZGV4LCBvcHRpb24pKSB7XG4gICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiXG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZS5vcHRpb25UZW1wbGF0ZSB8fCBkZWZhdWx0T3B0aW9uVGVtcGxhdGVcbiAgICAgICAgICAgIFwiXG4gICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgICAgICBvcHRpb24sXG4gICAgICAgICAgICAgIGtleWJvYXJkRm9jdXNlZEl0ZW0sXG4gICAgICAgICAgICAgICRpbXBsaWNpdDogYXV0b2NvbXBsZXRlLFxuICAgICAgICAgICAgICBhdXRvY29tcGxldGVcbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgIC8+XG4gICAgICAgIH1cbiAgICAgICAgPG5nLXRlbXBsYXRlICNkZWZhdWx0T3B0aW9uVGVtcGxhdGUgbGV0LW89XCJvcHRpb25cIj5cbiAgICAgICAgICBAaWYgKHR5cGUgPT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIFtyZHNBdXRvY29tcGxldGVPcHRpb25dPVwiYXV0b2NvbXBsZXRlXCJcbiAgICAgICAgICAgICAgW2tleWJvYXJkRm9jdXNlZEl0ZW1dPVwia2V5Ym9hcmRGb2N1c2VkSXRlbVwiXG4gICAgICAgICAgICAgICNvcHRpb249XCJyZHNBdXRvY29tcGxldGVPcHRpb25cIlxuICAgICAgICAgICAgICByZHMtc2luZ2xlLXNlbGVjdC1saXN0LWl0ZW1cbiAgICAgICAgICAgICAgW3NpemVdPVwic2l6ZVwiXG4gICAgICAgICAgICAgIFtjaGVja2VkXT1cImF1dG9jb21wbGV0ZS5pc1NlbGVjdGVkKG8pXCJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cImF1dG9jb21wbGV0ZS50b2dnbGUobylcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgIFtpbm5lckhUTUxdPVwiYXV0b2NvbXBsZXRlLmdldERpc3BsYXlQcm9wZXJ0eShvKVwiXG4gICAgICAgICAgICAgICAgW3Jkc0F1dG9jb21wbGF0ZUhpZ2hsaWdodF09XCJhdXRvY29tcGxldGUuZ2V0U2VhcmNoUXVlcnkoKVwiXG4gICAgICAgICAgICAgICAgW3Jkc0F1dG9jb21wbGF0ZUhpZ2hsaWdodERpc2FibGVkXT1cIlxuICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlLmhpZ2hsaWdodFF1ZXJ5ID09PSBmYWxzZVxuICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgICAgW3Jkc0F1dG9jb21wbGF0ZUhpZ2hsaWdodEludmVyc2VdPVwiXG4gICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGUuaGlnaGxpZ2h0UXVlcnkgPT09ICdpbnZlcnNlJ1xuICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgID48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICB9XG4gICAgICAgICAgQGlmICh0eXBlID09PSAnbXVsdGknKSB7XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIFtyZHNBdXRvY29tcGxldGVPcHRpb25dPVwiYXV0b2NvbXBsZXRlXCJcbiAgICAgICAgICAgICAgW2tleWJvYXJkRm9jdXNlZEl0ZW1dPVwia2V5Ym9hcmRGb2N1c2VkSXRlbVwiXG4gICAgICAgICAgICAgICNvcHRpb249XCJyZHNBdXRvY29tcGxldGVPcHRpb25cIlxuICAgICAgICAgICAgICByZHMtbXVsdGktc2VsZWN0LWxpc3QtaXRlbVxuICAgICAgICAgICAgICBbc2l6ZV09XCJzaXplXCJcbiAgICAgICAgICAgICAgW2NoZWNrZWRdPVwiYXV0b2NvbXBsZXRlLmlzU2VsZWN0ZWQobylcIlxuICAgICAgICAgICAgICAoY2xpY2spPVwiYXV0b2NvbXBsZXRlLnRvZ2dsZShvKVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgW2lubmVySFRNTF09XCJhdXRvY29tcGxldGUuZ2V0RGlzcGxheVByb3BlcnR5KG8pXCJcbiAgICAgICAgICAgICAgICBbcmRzQXV0b2NvbXBsYXRlSGlnaGxpZ2h0XT1cImF1dG9jb21wbGV0ZS5nZXRTZWFyY2hRdWVyeSgpXCJcbiAgICAgICAgICAgICAgICBbcmRzQXV0b2NvbXBsYXRlSGlnaGxpZ2h0RGlzYWJsZWRdPVwiXG4gICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGUuaGlnaGxpZ2h0UXVlcnkgPT09IGZhbHNlXG4gICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICBbcmRzQXV0b2NvbXBsYXRlSGlnaGxpZ2h0SW52ZXJzZV09XCJcbiAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZS5oaWdobGlnaHRRdWVyeSA9PT0gJ2ludmVyc2UnXG4gICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIH1cbiAgICAgIEBpZiAoXG4gICAgICAgIChhdXRvY29tcGxldGUubG9hZGluZyB8IGFzeW5jKSA9PT0gZmFsc2UgJiZcbiAgICAgICAgb3B0aW9ucy5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgIXNob3VsZFNob3dDcmVhdGVOZXdPcHRpb24oKVxuICAgICAgKSB7XG4gICAgICAgIEBpZiAoYXV0b2NvbXBsZXRlLm5vRGF0YVRlbXBsYXRlKSB7XG4gICAgICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiYXV0b2NvbXBsZXRlLm5vRGF0YVRlbXBsYXRlXCJcbiAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAgICAgICAgICRpbXBsaWNpdDogYXV0b2NvbXBsZXRlLFxuICAgICAgICAgICAgICBhdXRvY29tcGxldGVcbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgIC8+XG4gICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIGNsYXNzPVwicmRzLWF1dG9jb21wbGV0ZS1vcHRpb24tbm8tZGF0YVwiXG4gICAgICAgICAgICByZHMtbGlzdC1pdGVtXG4gICAgICAgICAgICBbc2l6ZV09XCJzaXplXCJcbiAgICAgICAgICAgIGRpc2FibGVkXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cIm91dGxpbmVkXCIgaWNvbj1cIndhcm5pbmdfY2lyY2xlXCIgLz5cbiAgICAgICAgICAgIHt7IGF1dG9jb21wbGV0ZS5ub0RhdGFUZXh0IHx8IG5vRGF0YVRleHQgfX1cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIDwvZGl2PlxuICBgLFxuICBzdHlsZVVybHM6IFsnLi9hdXRvY29tcGxldGUtY29udGFpbmVyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQXN5bmNQaXBlLFxuICAgIFJkc0xpc3RJdGVtTW9kdWxlLFxuICAgIE5nVGVtcGxhdGVPdXRsZXQsXG4gICAgUmRzSWNvbkNvbXBvbmVudCxcbiAgICBSZHNBdXRvY29tcGxldGVIaWdobGlnaHREaXJlY3RpdmUsXG4gICAgUmRzQXV0b2NvbXBsZXRlT3B0aW9uRGlyZWN0aXZlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNBdXRvY29tcGxldGVDb250YWluZXJDb21wb25lbnQ8XG4gICAgVCxcbiAgICBBcnJheU9mRmxhdFR5cGUgZXh0ZW5kcyBUIHwgVFtdLFxuICA+XG4gIGltcGxlbWVudHMgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgT25Jbml0XG57XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBpbnRsID0gaW5qZWN0KFJkc0F1dG9jb21wbGV0ZUludGwpO1xuICBwcml2YXRlIHJlYWRvbmx5IG9ic2VydmVyID0gaW5qZWN0KENvbnRlbnRPYnNlcnZlcik7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmID0gaW5qZWN0KEVsZW1lbnRSZWYpO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgY29uZmlnID0ge1xuICAgIC4uLlJEU19BVVRPQ09NUExFVEVfREVGQVVMVF9DT05GSUcsXG4gICAgLi4uaW5qZWN0KFJEU19BVVRPQ09NUExFVEVfQ09ORklHLCB7IG9wdGlvbmFsOiB0cnVlIH0pLFxuICB9O1xuXG4gIGF1dG9jb21wbGV0ZTogUmRzQWJzdHJhY3RBdXRvY29tcGxldGVDb21wb25lbnQ8VCwgQXJyYXlPZkZsYXRUeXBlPjtcbiAgQElucHV0KCkgc2l6ZTogUmRzTGlzdEl0ZW1TaXplID0gJ3MnO1xuICBASW5wdXQoeyByZXF1aXJlZDogdHJ1ZSB9KSB0eXBlOiBSZHNBdXRvY29tcGxldGVUeXBlO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBvcHRpb25zKG9wdGlvbnM6IFRbXSkge1xuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gb3B0aW9ucy5maWx0ZXIoKG8pID0+XG4gICAgICB0aGlzLmF1dG9jb21wbGV0ZS5pc1NlbGVjdGVkKG8pLFxuICAgICk7XG4gICAgdGhpcy5hdmFpbGFibGVPcHRpb25zID0gb3B0aW9ucy5maWx0ZXIoXG4gICAgICAobykgPT4gIXRoaXMuYXV0b2NvbXBsZXRlLmlzU2VsZWN0ZWQobyksXG4gICAgKTtcbiAgICB0aGlzLmxhc3RTZWxlY3RlZFZhbHVlID1cbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLnZhbHVlcy5sZW5ndGggPiAwXG4gICAgICAgID8gdGhpcy5hdXRvY29tcGxldGUudmFsdWVzW3RoaXMuYXV0b2NvbXBsZXRlLnZhbHVlcy5sZW5ndGggLSAxXVxuICAgICAgICA6IG51bGw7XG4gIH1cblxuICBnZXQgb3B0aW9ucygpOiBUW10ge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9vcHRpb25zOiBUW10gPSBbXTtcbiAgcHJvdGVjdGVkIHNlbGVjdGVkT3B0aW9uczogVFtdID0gW107XG4gIHByb3RlY3RlZCBhdmFpbGFibGVPcHRpb25zOiBUW10gPSBbXTtcbiAgcHJvdGVjdGVkIGxhc3RTZWxlY3RlZFZhbHVlOiBUIHwgbnVsbCA9IG51bGw7XG4gIHByb3RlY3RlZCBsb2FkaW5nVGV4dCA9IFJkc0F1dG9jb21wbGV0ZUludGwudHJhbnNsYXRpb25zLmxvYWRpbmdUZXh0O1xuICBwcm90ZWN0ZWQgbm9EYXRhVGV4dCA9IFJkc0F1dG9jb21wbGV0ZUludGwudHJhbnNsYXRpb25zLm5vRGF0YVRleHQ7XG4gIHByb3RlY3RlZCBuZXdJdGVtVGV4dCA9IFJkc0F1dG9jb21wbGV0ZUludGwudHJhbnNsYXRpb25zLm5ld0l0ZW1UZXh0O1xuICBwcm90ZWN0ZWQga2V5Ym9hcmRGb2N1c2VkSXRlbTogUmRzQXV0b2NvbXBsZXRlT3B0aW9uRGlyZWN0aXZlPFxuICAgIFQsXG4gICAgQXJyYXlPZkZsYXRUeXBlXG4gID4gfCBudWxsO1xuICBwcml2YXRlIGF1dG9jb21wbGV0ZU9wdGlvbnMgPSBuZXcgTWFwPFxuICAgIEhUTUxFbGVtZW50LFxuICAgIFJkc0F1dG9jb21wbGV0ZU9wdGlvbkRpcmVjdGl2ZTxULCBBcnJheU9mRmxhdFR5cGU+XG4gID4oKTtcbiAgcHJpdmF0ZSBvcHRpb25FbGVtZW50czogUmRzQXV0b2NvbXBsZXRlT3B0aW9uRGlyZWN0aXZlPFQsIEFycmF5T2ZGbGF0VHlwZT5bXSA9XG4gICAgW107XG5cbiAgQFZpZXdDaGlsZCgnYXV0b2NvbXBsZXRlQ29udGFpbmVyJylcbiAgcHJvdGVjdGVkIGF1dG9jb21wbGV0ZUNvbnRhaW5lcjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG5cbiAgcHJvdGVjdGVkIHRyYWNrQnk6IFRyYWNrQnlGdW5jdGlvbjxUPiA9IChfaTogbnVtYmVyLCBhOiBUKSA9PlxuICAgIHRoaXMuYXV0b2NvbXBsZXRlLmdldFVuaXFQcm9wZXJ0eShhKTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmludGwuY2hhbmdlJFxuICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpXG4gICAgICAuc3Vic2NyaWJlKCh0KSA9PiB7XG4gICAgICAgIHRoaXMubG9hZGluZ1RleHQgPSB0aGlzLmF1dG9jb21wbGV0ZS5sb2FkaW5nVGV4dCB8fCB0LmxvYWRpbmdUZXh0O1xuICAgICAgICB0aGlzLm5vRGF0YVRleHQgPSB0aGlzLmF1dG9jb21wbGV0ZS5ub0RhdGFUZXh0IHx8IHQubm9EYXRhVGV4dDtcbiAgICAgICAgdGhpcy5uZXdJdGVtVGV4dCA9IHRoaXMuYXV0b2NvbXBsZXRlLm5ld0l0ZW1UZXh0IHx8IHQubmV3SXRlbVRleHQ7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgfSk7XG4gICAgdGhpcy5vYnNlcnZlclxuICAgICAgLm9ic2VydmUodGhpcy5lbGVtZW50UmVmKVxuICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuYXV0b2NvbXBsZXRlLnVwZGF0ZVBvc2l0aW9uKCkpO1xuICB9XG5cbiAgX2FkZE9wdGlvbihcbiAgICBvcHRpb246IEhUTUxFbGVtZW50LFxuICAgIGNvbXBvbmVudDogUmRzQXV0b2NvbXBsZXRlT3B0aW9uRGlyZWN0aXZlPFQsIEFycmF5T2ZGbGF0VHlwZT4sXG4gICk6IHZvaWQge1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucy5zZXQob3B0aW9uLCBjb21wb25lbnQpO1xuICB9XG5cbiAgX2RlbGV0ZU9wdGlvbihvcHRpb246IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgdGhpcy5hdXRvY29tcGxldGVPcHRpb25zLmRlbGV0ZShvcHRpb24pO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRDaGVja2VkKCk6IHZvaWQge1xuICAgIHRoaXMub3B0aW9uRWxlbWVudHMgPSBbXTtcblxuICAgIGZvciAoXG4gICAgICBsZXQgaSA9IDA7XG4gICAgICBpIDwgdGhpcy5hdXRvY29tcGxldGVDb250YWluZXI/Lm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgaSsrXG4gICAgKSB7XG4gICAgICBjb25zdCByZWNvcmQgPSB0aGlzLmF1dG9jb21wbGV0ZU9wdGlvbnMuZ2V0KFxuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLml0ZW0oXG4gICAgICAgICAgaSxcbiAgICAgICAgKSBhcyBIVE1MRWxlbWVudCxcbiAgICAgICk7XG5cbiAgICAgIGlmIChyZWNvcmQpIHtcbiAgICAgICAgdGhpcy5vcHRpb25FbGVtZW50cy5wdXNoKHJlY29yZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgaWYgKFsnRW50ZXInLCAnQXJyb3dVcCcsICdBcnJvd0Rvd24nXS5pbmNsdWRlcyhldmVudC5rZXkpKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgdGhpcy5vbkVudGVyKCk7XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnKSB7XG4gICAgICAgIHRoaXMub25VcEFycm93KCk7XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicpIHtcbiAgICAgICAgdGhpcy5vbkRvd25BcnJvdygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBzaG91bGRTaG93Q3JlYXRlTmV3T3B0aW9uKCk6IGJvb2xlYW4ge1xuICAgIGlmIChcbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLmlzSW5wdXRGaWxsZWQoKSAmJlxuICAgICAgdHlwZW9mIHRoaXMuYXV0b2NvbXBsZXRlLm5ld0l0ZW0gPT09ICdmdW5jdGlvbidcbiAgICApIHtcbiAgICAgIGNvbnN0IG5ld0l0ZW0gPSB0aGlzLmF1dG9jb21wbGV0ZS5nZXROZXdJdGVtKCkgYXMgVDtcblxuICAgICAgcmV0dXJuICF0aGlzLmdldFNlbGVjdGVkRmlyc3RPcHRpb25zKCkuc29tZSgobykgPT5cbiAgICAgICAgdGhpcy5hdXRvY29tcGxldGUuY29tcGFyZUl0ZW0obywgbmV3SXRlbSksXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGdldFNlbGVjdGVkRmlyc3RPcHRpb25zKCk6IFRbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnNlbGVjdGVkT3B0aW9ucywgLi4udGhpcy5hdmFpbGFibGVPcHRpb25zXTtcbiAgfVxuXG4gIHByaXZhdGUgb25Eb3duQXJyb3coKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmtleWJvYXJkRm9jdXNlZEl0ZW0pIHtcbiAgICAgIHRoaXMuc2VsZWN0Rmlyc3RJdGVtKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5vcHRpb25FbGVtZW50cy5maW5kSW5kZXgoXG4gICAgICAgIChlKSA9PiBlID09PSB0aGlzLmtleWJvYXJkRm9jdXNlZEl0ZW0sXG4gICAgICApO1xuICAgICAgY29uc3QgbmV4dEluZGV4ID0gKGluZGV4ICsgMSkgJSB0aGlzLm9wdGlvbkVsZW1lbnRzLmxlbmd0aDtcblxuICAgICAgdGhpcy5rZXlib2FyZEZvY3VzZWRJdGVtID0gdGhpcy5vcHRpb25FbGVtZW50c1tuZXh0SW5kZXhdO1xuICAgIH1cblxuICAgIHRoaXMuc2Nyb2xsVG9TZWxlY3RlZEl0ZW0oKTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgb25VcEFycm93KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5rZXlib2FyZEZvY3VzZWRJdGVtKSB7XG4gICAgICB0aGlzLnNlbGVjdEZpcnN0SXRlbSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMub3B0aW9uRWxlbWVudHMuZmluZEluZGV4KFxuICAgICAgICAoZSkgPT4gZSA9PT0gdGhpcy5rZXlib2FyZEZvY3VzZWRJdGVtLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IG5leHRJbmRleCA9XG4gICAgICAgIGluZGV4IC0gMSA8IDAgPyB0aGlzLm9wdGlvbkVsZW1lbnRzLmxlbmd0aCAtIDEgOiBpbmRleCAtIDE7XG5cbiAgICAgIHRoaXMua2V5Ym9hcmRGb2N1c2VkSXRlbSA9IHRoaXMub3B0aW9uRWxlbWVudHNbbmV4dEluZGV4XTtcbiAgICB9XG5cbiAgICB0aGlzLnNjcm9sbFRvU2VsZWN0ZWRJdGVtKCk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBwcml2YXRlIG9uRW50ZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub3B0aW9uRWxlbWVudHMpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5vcHRpb25FbGVtZW50cy5maW5kSW5kZXgoXG4gICAgICAgICh2KSA9PiB2ID09PSB0aGlzLmtleWJvYXJkRm9jdXNlZEl0ZW0sXG4gICAgICApO1xuXG4gICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtlbGVtZW50LCBvcHRpb25dIG9mIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucykge1xuICAgICAgICAgIGlmICh0aGlzLm9wdGlvbkVsZW1lbnRzW2luZGV4XSA9PT0gb3B0aW9uKSB7XG4gICAgICAgICAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoJ2NsaWNrJykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzY3JvbGxUb1NlbGVjdGVkSXRlbSgpOiB2b2lkIHtcbiAgICBsZXQgb3B0aW9uRWxlbWVudDogSFRNTEVsZW1lbnQgfCB1bmRlZmluZWQ7XG5cbiAgICBmb3IgKGNvbnN0IFtlbGVtZW50LCBvcHRpb25dIG9mIHRoaXMuYXV0b2NvbXBsZXRlT3B0aW9ucykge1xuICAgICAgaWYgKHRoaXMua2V5Ym9hcmRGb2N1c2VkSXRlbSA9PT0gb3B0aW9uKSB7XG4gICAgICAgIG9wdGlvbkVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5rZXlib2FyZEZvY3VzZWRJdGVtKSB7XG4gICAgICBjb25zdCBpdGVtSGVpZ2h0ID0gb3B0aW9uRWxlbWVudD8ub2Zmc2V0SGVpZ2h0IHx8IDA7XG4gICAgICBjb25zdCBzY3JvbGxDb250YWluZXJIZWlnaHQgPVxuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbEhlaWdodDtcbiAgICAgIGNvbnN0IHBhbmVsSGVpZ2h0ID0gTWF0aC5taW4oXG4gICAgICAgIHNjcm9sbENvbnRhaW5lckhlaWdodCxcbiAgICAgICAgdGhpcy5jb25maWcub3B0aW9uc0NvbnRhaW5lck1heEhlaWdodCxcbiAgICAgICk7XG4gICAgICBjb25zdCBkaXZpZGVyID0gMjtcbiAgICAgIGNvbnN0IG1heFNjcm9sbCA9IHNjcm9sbENvbnRhaW5lckhlaWdodCAtIHBhbmVsSGVpZ2h0O1xuICAgICAgY29uc3Qgc2Nyb2xsQnVmZmVyID0gcGFuZWxIZWlnaHQgLyBkaXZpZGVyO1xuICAgICAgY29uc3Qgb3B0aW9uT2Zmc2V0Rm9ybVNjcm9sbFRvcCA9XG4gICAgICAgIHRoaXMub3B0aW9uRWxlbWVudHMuZmluZEluZGV4KChlbCkgPT4gZWwgPT09IHRoaXMua2V5Ym9hcmRGb2N1c2VkSXRlbSkgKlxuICAgICAgICBpdGVtSGVpZ2h0O1xuICAgICAgY29uc3QgaGFsZk9wdGlvbkhlaWdodCA9IGl0ZW1IZWlnaHQgLyBkaXZpZGVyO1xuXG4gICAgICBjb25zdCBvcHRpbWFsU2Nyb2xsUG9zaXRpb24gPVxuICAgICAgICBvcHRpb25PZmZzZXRGb3JtU2Nyb2xsVG9wIC0gc2Nyb2xsQnVmZmVyICsgaGFsZk9wdGlvbkhlaWdodDtcbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG9wID0gTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KDAsIG9wdGltYWxTY3JvbGxQb3NpdGlvbiksXG4gICAgICAgIG1heFNjcm9sbCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RGaXJzdEl0ZW0oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMub3B0aW9uRWxlbWVudHNbMF0pIHtcbiAgICAgIHRoaXMua2V5Ym9hcmRGb2N1c2VkSXRlbSA9IHRoaXMub3B0aW9uRWxlbWVudHNbMF07XG4gICAgfVxuICB9XG59XG4iXX0=