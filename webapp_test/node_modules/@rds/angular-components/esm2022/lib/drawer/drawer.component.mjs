import { ConfigurableFocusTrapFactory, FocusMonitor, InteractivityChecker, } from '@angular/cdk/a11y';
import { ESCAPE, hasModifierKey } from '@angular/cdk/keycodes';
import { ContentObserver } from '@angular/cdk/observers';
import { DOCUMENT, isPlatformBrowser } from '@angular/common';
import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, DestroyRef, ElementRef, EventEmitter, HostBinding, HostListener, inject, Input, NgZone, Output, PLATFORM_ID, ViewChild, ViewEncapsulation, } from '@angular/core';
import { BehaviorSubject, filter, fromEvent, Subject } from 'rxjs';
import { RdsDrawerActionsDirective } from './drawer-actions.directive';
import { rdsDrawerAnimations } from './drawer-animations';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { TAB_INDEX_NOT_FOCUSABLE } from '../utils';
import { RdsIconComponent } from '../icons';
import { RdsButtonModule } from '../button';
import * as i0 from "@angular/core";
import * as i1 from "../button/icon-button.component";
export class RdsDrawerComponent {
    get mode() {
        return this._mode;
    }
    set mode(value) {
        this._mode = value;
        this.updateFocusTrapState();
        this._modeChanged.next();
    }
    get position() {
        return this._position;
    }
    set position(value) {
        this._position = value === 'end' ? 'end' : 'start';
        this.positionChanged.emit(this._position);
    }
    set expanded(value) {
        this.toggle(booleanAttribute(value));
    }
    get expanded() {
        return this.isOpened;
    }
    set autoFocus(value) {
        if (value === 'true' || value === 'false' || value == null) {
            value = booleanAttribute(value);
        }
        this._autoFocus = value;
    }
    get autoFocus() {
        const value = this._autoFocus;
        if (value == null) {
            if (this.mode === 'side') {
                return 'dialog';
            }
            else {
                return 'first-tabbable';
            }
        }
        return value;
    }
    get class() {
        const classes = ['rds-drawer', `rds-drawer-${this.size}`];
        if (this.mode === 'overlay') {
            classes.push('rds-drawer-overlay');
        }
        if (this.position === 'end') {
            classes.push('rds-drawer-end');
        }
        else {
            classes.push('rds-drawer-start');
        }
        return classes;
    }
    get transform() {
        return this._animationState;
    }
    get isOpened() {
        return this._isOpened$.getValue();
    }
    get isOpened$() {
        return this._isOpened$.asObservable();
    }
    constructor() {
        this.destroyRef = inject(DestroyRef);
        this.elementRef = inject(ElementRef);
        this.cdr = inject(ChangeDetectorRef);
        this.contentObserver = inject(ContentObserver);
        this.ngZone = inject(NgZone);
        this.focusTrapFactory = inject(ConfigurableFocusTrapFactory);
        this.focusMonitor = inject(FocusMonitor);
        this.document = inject(DOCUMENT);
        this.interactivityChecker = inject(InteractivityChecker);
        this.platformId = inject(PLATFORM_ID);
        this._modeChanged = new Subject();
        this._animationStarted = new Subject();
        this._animationEnd = new Subject();
        this._animationState = 'void';
        this._animating = null;
        this._isOpened$ = new BehaviorSubject(false);
        this._elementFocusedBeforeDrawerWasOpened = null;
        this.size = 'm';
        this.closeBtnAriaLabel = 'Close';
        this._mode = 'overlay';
        this._position = 'start';
        this.closable = true;
        this.disableClose = false;
        this.closeDrawer = new EventEmitter();
        this.openDrawer = new EventEmitter();
        this.positionChanged = new EventEmitter();
        this.body = { nativeElement: undefined };
        this.tabIndex = TAB_INDEX_NOT_FOCUSABLE;
        this.scrollable = false;
        this.ngZone.runOutsideAngular(() => {
            if (isPlatformBrowser(this.platformId)) {
                fromEvent(window, 'keydown')
                    .pipe(filter((event) => event.keyCode === ESCAPE &&
                    !this.disableClose &&
                    !hasModifierKey(event)), takeUntilDestroyed())
                    .subscribe((event) => this.ngZone.run(() => {
                    this.close();
                    event.stopPropagation();
                    event.preventDefault();
                }));
            }
        });
    }
    ngAfterViewInit() {
        this._focusTrap = this.focusTrapFactory.create(this.elementRef.nativeElement);
        this.updateFocusTrapState();
    }
    ngAfterContentInit() {
        this.contentObserver
            .observe(this.elementRef.nativeElement)
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => {
            this.scrollable = this.isScrollable();
            this.cdr.markForCheck();
        });
    }
    ngOnDestroy() {
        if (this._focusTrap) {
            this._focusTrap.destroy();
        }
        this._animationStarted.complete();
        this._animationEnd.complete();
        this._modeChanged.complete();
    }
    transformStart(event) {
        if (event.toState === 'void') {
            this._animating = 'collapsing';
        }
        else if (event.toState === 'open') {
            this._animating = 'expanding';
        }
        this._animationStarted.next(event);
    }
    transformEnd(event) {
        this._animating = null;
        this._animationEnd.next(event);
        // animation.done changes opened value
        const isOpened = event.toState === 'open' || event.toState === 'open-instant';
        if (isOpened) {
            if (this.document) {
                this._elementFocusedBeforeDrawerWasOpened = this.document
                    .activeElement;
            }
            this.takeFocus();
        }
        else if (this.isFocusWithinDrawer()) {
            this.restoreFocus(this._openedVia || 'program');
        }
        this._isOpened$.next(isOpened);
        if (event.fromState !== event.toState) {
            if (isOpened) {
                this.openDrawer.emit();
            }
            else {
                this.closeDrawer.emit();
            }
        }
        this.scrollable = this.isScrollable();
    }
    toggle(expanded = !this._isOpened$.getValue(), openedVia) {
        if (expanded && openedVia) {
            this._openedVia = openedVia;
        }
        if (this.isOpened !== expanded) {
            if (expanded) {
                this.open();
            }
            else {
                this.close();
            }
        }
    }
    open() {
        this._animationState = 'open';
    }
    close() {
        this._animationState = 'void';
    }
    forceFocus(element, options) {
        if (!this.interactivityChecker.isFocusable(element)) {
            element.tabIndex = TAB_INDEX_NOT_FOCUSABLE;
            this.ngZone.runOutsideAngular(() => {
                const callback = () => {
                    element.removeEventListener('blur', callback);
                    element.removeEventListener('mousedown', callback);
                    element.removeAttribute('tabindex');
                };
                element.addEventListener('blur', callback);
                element.addEventListener('mousedown', callback);
            });
        }
        element.focus(options);
    }
    focusByCssSelector(selector, options) {
        const elementToFocus = this.elementRef.nativeElement.querySelector(selector);
        if (elementToFocus) {
            this.forceFocus(elementToFocus, options);
        }
    }
    takeFocus() {
        if (!this._focusTrap) {
            return;
        }
        const element = this.elementRef.nativeElement;
        switch (this.autoFocus) {
            case false:
            case 'dialog':
                return;
            case true:
            case 'first-tabbable':
                this._focusTrap.focusInitialElementWhenReady().then((hasMovedFocus) => {
                    if (!hasMovedFocus &&
                        typeof this.elementRef.nativeElement.focus === 'function') {
                        element.focus();
                    }
                });
                break;
            case 'first-heading':
                this.focusByCssSelector('rds-drawer-header, [rds-drawer-header], [rdsDrawerHeader]');
                break;
            default:
                this.focusByCssSelector(this.autoFocus);
                break;
        }
    }
    restoreFocus(focusOrigin) {
        if (this.autoFocus === 'dialog') {
            return;
        }
        else if (this._elementFocusedBeforeDrawerWasOpened) {
            this.focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened, focusOrigin);
        }
        else {
            this.elementRef.nativeElement.blur();
        }
        this._elementFocusedBeforeDrawerWasOpened = null;
    }
    isFocusWithinDrawer() {
        const activeEl = this.document.activeElement;
        return !!activeEl && this.elementRef.nativeElement.contains(activeEl);
    }
    updateFocusTrapState() {
        if (this._focusTrap) {
            this._focusTrap.enabled = this.expanded && this.mode !== 'side';
        }
    }
    isScrollable() {
        return (this.body.nativeElement.scrollHeight >
            this.body.nativeElement.clientHeight);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDrawerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsDrawerComponent, isStandalone: true, selector: "rds-drawer", inputs: { size: "size", closeBtnAriaLabel: "closeBtnAriaLabel", mode: "mode", position: "position", closable: ["closable", "closable", booleanAttribute], expanded: "expanded", disableClose: ["disableClose", "disableClose", booleanAttribute], autoFocus: "autoFocus" }, outputs: { closeDrawer: "closeDrawer", openDrawer: "openDrawer", positionChanged: "positionChanged" }, host: { listeners: { "@transform.start": "transformStart($event)", "@transform.done": "transformEnd($event)" }, properties: { "class": "this.class", "tabIndex": "this.tabIndex", "@transform": "this.transform", "class.rds-drawer-scrollable": "this.scrollable" } }, queries: [{ propertyName: "actions", first: true, predicate: RdsDrawerActionsDirective, descendants: true }], viewQueries: [{ propertyName: "body", first: true, predicate: ["body"], descendants: true }], ngImport: i0, template: "<div class=\"rds-drawer-header\">\n  <ng-content\n    select=\"rds-drawer-header, [rds-drawer-header], [rdsDrawerHeader]\"\n  />\n  @if (closable) {\n    <button\n      rds-icon-button\n      size=\"m\"\n      (click)=\"toggle(false)\"\n      [attr.aria-label]=\"closeBtnAriaLabel\"\n    >\n      <rds-icon icon=\"close\" />\n    </button>\n  }\n</div>\n<div class=\"rds-drawer-body\" #body>\n  <ng-content />\n</div>\n<div [class.rds-drawer-actions]=\"actions\">\n  <ng-content\n    select=\"rds-drawer-actions, [rds-drawer-actions], [rdsDrawerActions]\"\n  />\n</div>\n", styles: [".rds-drawer{background-color:var(--rds-color-bg-base-elevated);border-radius:2px;position:absolute;z-index:3;top:0;bottom:0;outline:0;display:flex;flex-direction:column;box-sizing:border-box;height:100%}.rds-drawer.rds-drawer-s{width:360px}.rds-drawer.rds-drawer-m{width:512px}.rds-drawer.rds-drawer-l{width:736px}.rds-drawer[style*=\"visibility: hidden\"]{display:none}.rds-drawer.rds-drawer-end{transform:translate3d(100%,0,0);order:1;right:0}.rds-drawer.rds-drawer-start{transform:translate3d(-100%,0,0);left:0}.rds-drawer.rds-drawer-overlay{position:absolute;z-index:4}.rds-drawer .rds-drawer-header{font-size:20px;font-weight:600;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;justify-content:space-between;padding:24px;row-gap:16px;color:var(--rds-color-high-contrast)}.rds-drawer .rds-drawer-body{padding-inline:24px;padding-block:0 24px;overflow-y:auto;color:var(--rds-color-high-contrast);width:100%;height:100%}@media (max-width: 767.999999px){.rds-drawer .rds-drawer-body{font-size:14px;font-weight:200;line-height:20px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-drawer .rds-drawer-actions{display:flex;justify-content:flex-end;gap:16px;width:100%;padding:24px}.rds-drawer.rds-drawer-scrollable .rds-drawer-body{padding-right:12px}.rds-drawer.rds-drawer-scrollable .rds-drawer-actions{border-top:1px solid var(--rds-color-grey-2)}\n"], dependencies: [{ kind: "component", type: RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "ngmodule", type: RdsButtonModule }, { kind: "component", type: i1.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }], animations: [rdsDrawerAnimations.expandDrawer], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDrawerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-drawer', encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, animations: [rdsDrawerAnimations.expandDrawer], standalone: true, imports: [RdsIconComponent, RdsButtonModule], template: "<div class=\"rds-drawer-header\">\n  <ng-content\n    select=\"rds-drawer-header, [rds-drawer-header], [rdsDrawerHeader]\"\n  />\n  @if (closable) {\n    <button\n      rds-icon-button\n      size=\"m\"\n      (click)=\"toggle(false)\"\n      [attr.aria-label]=\"closeBtnAriaLabel\"\n    >\n      <rds-icon icon=\"close\" />\n    </button>\n  }\n</div>\n<div class=\"rds-drawer-body\" #body>\n  <ng-content />\n</div>\n<div [class.rds-drawer-actions]=\"actions\">\n  <ng-content\n    select=\"rds-drawer-actions, [rds-drawer-actions], [rdsDrawerActions]\"\n  />\n</div>\n", styles: [".rds-drawer{background-color:var(--rds-color-bg-base-elevated);border-radius:2px;position:absolute;z-index:3;top:0;bottom:0;outline:0;display:flex;flex-direction:column;box-sizing:border-box;height:100%}.rds-drawer.rds-drawer-s{width:360px}.rds-drawer.rds-drawer-m{width:512px}.rds-drawer.rds-drawer-l{width:736px}.rds-drawer[style*=\"visibility: hidden\"]{display:none}.rds-drawer.rds-drawer-end{transform:translate3d(100%,0,0);order:1;right:0}.rds-drawer.rds-drawer-start{transform:translate3d(-100%,0,0);left:0}.rds-drawer.rds-drawer-overlay{position:absolute;z-index:4}.rds-drawer .rds-drawer-header{font-size:20px;font-weight:600;line-height:28px;text-transform:none;letter-spacing:0;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;justify-content:space-between;padding:24px;row-gap:16px;color:var(--rds-color-high-contrast)}.rds-drawer .rds-drawer-body{padding-inline:24px;padding-block:0 24px;overflow-y:auto;color:var(--rds-color-high-contrast);width:100%;height:100%}@media (max-width: 767.999999px){.rds-drawer .rds-drawer-body{font-size:14px;font-weight:200;line-height:20px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 768px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1024px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1440px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media (min-width: 1672px){.rds-drawer .rds-drawer-body{font-size:16px;font-weight:200;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}.rds-drawer .rds-drawer-actions{display:flex;justify-content:flex-end;gap:16px;width:100%;padding:24px}.rds-drawer.rds-drawer-scrollable .rds-drawer-body{padding-right:12px}.rds-drawer.rds-drawer-scrollable .rds-drawer-actions{border-top:1px solid var(--rds-color-grey-2)}\n"] }]
        }], ctorParameters: () => [], propDecorators: { size: [{
                type: Input
            }], closeBtnAriaLabel: [{
                type: Input
            }], mode: [{
                type: Input
            }], position: [{
                type: Input
            }], closable: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], expanded: [{
                type: Input
            }], disableClose: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], autoFocus: [{
                type: Input
            }], closeDrawer: [{
                type: Output
            }], openDrawer: [{
                type: Output
            }], positionChanged: [{
                type: Output
            }], actions: [{
                type: ContentChild,
                args: [RdsDrawerActionsDirective]
            }], body: [{
                type: ViewChild,
                args: ['body']
            }], class: [{
                type: HostBinding,
                args: ['class']
            }], tabIndex: [{
                type: HostBinding,
                args: ['tabIndex']
            }], transform: [{
                type: HostBinding,
                args: ['@transform']
            }], scrollable: [{
                type: HostBinding,
                args: ['class.rds-drawer-scrollable']
            }], transformStart: [{
                type: HostListener,
                args: ['@transform.start', ['$event']]
            }], transformEnd: [{
                type: HostListener,
                args: ['@transform.done', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvZHJhd2VyL2RyYXdlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2RyYXdlci9kcmF3ZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUVMLDRCQUE0QixFQUM1QixZQUFZLEVBRVosb0JBQW9CLEdBQ3JCLE1BQU0sbUJBQW1CLENBQUM7QUFFM0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlELE9BQU8sRUFHTCxnQkFBZ0IsRUFDaEIsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFDTCxNQUFNLEVBRU4sTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1QsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0UsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdkUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFPMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDaEUsT0FB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QXpCLEtBQUs7Z0JBR0YsSUFBSTtzQkFEUCxLQUFLO2dCQWNGLFFBQVE7c0JBRFgsS0FBSztnQkFZa0MsUUFBUTtzQkFBL0MsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFHbEMsUUFBUTtzQkFEWCxLQUFLO2dCQVdrQyxZQUFZO3NCQUFuRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUdsQyxTQUFTO3NCQURaLEtBQUs7Z0JBeUJhLFdBQVc7c0JBQTdCLE1BQU07Z0JBRVksVUFBVTtzQkFBNUIsTUFBTTtnQkFFWSxlQUFlO3NCQUFqQyxNQUFNO2dCQUVrQyxPQUFPO3NCQUEvQyxZQUFZO3VCQUFDLHlCQUF5QjtnQkFFcEIsSUFBSTtzQkFBdEIsU0FBUzt1QkFBQyxNQUFNO2dCQUVTLEtBQUs7c0JBQTlCLFdBQVc7dUJBQUMsT0FBTztnQkFnQkssUUFBUTtzQkFBaEMsV0FBVzt1QkFBQyxVQUFVO2dCQUduQixTQUFTO3NCQURaLFdBQVc7dUJBQUMsWUFBWTtnQkFjekIsVUFBVTtzQkFEVCxXQUFXO3VCQUFDLDZCQUE2QjtnQkF1RDFDLGNBQWM7c0JBRGIsWUFBWTt1QkFBQyxrQkFBa0IsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQkFZNUMsWUFBWTtzQkFEWCxZQUFZO3VCQUFDLGlCQUFpQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5pbWF0aW9uRXZlbnQgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7XG4gIENvbmZpZ3VyYWJsZUZvY3VzVHJhcCxcbiAgQ29uZmlndXJhYmxlRm9jdXNUcmFwRmFjdG9yeSxcbiAgRm9jdXNNb25pdG9yLFxuICBGb2N1c09yaWdpbixcbiAgSW50ZXJhY3Rpdml0eUNoZWNrZXIsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyBFU0NBUEUsIGhhc01vZGlmaWVyS2V5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IENvbnRlbnRPYnNlcnZlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vYnNlcnZlcnMnO1xuaW1wb3J0IHsgRE9DVU1FTlQsIGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIERlc3Ryb3lSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgaW5qZWN0LFxuICBJbnB1dCxcbiAgTmdab25lLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgUExBVEZPUk1fSUQsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBmaWx0ZXIsIGZyb21FdmVudCwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUmRzRHJhd2VyQWN0aW9uc0RpcmVjdGl2ZSB9IGZyb20gJy4vZHJhd2VyLWFjdGlvbnMuZGlyZWN0aXZlJztcbmltcG9ydCB7IHJkc0RyYXdlckFuaW1hdGlvbnMgfSBmcm9tICcuL2RyYXdlci1hbmltYXRpb25zJztcbmltcG9ydCB7XG4gIEF1dG9Gb2N1c1RhcmdldCxcbiAgUmRzRHJhd2VyTW9kZSxcbiAgUmRzRHJhd2VyUG9zaXRpb24sXG4gIFJkc0RyYXdlclNpemUsXG59IGZyb20gJy4vZHJhd2VyLXR5cGVzJztcbmltcG9ydCB7IHRha2VVbnRpbERlc3Ryb3llZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcbmltcG9ydCB7IFRBQl9JTkRFWF9OT1RfRk9DVVNBQkxFIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgUmRzSWNvbkNvbXBvbmVudCB9IGZyb20gJy4uL2ljb25zJztcbmltcG9ydCB7IFJkc0J1dHRvbk1vZHVsZSB9IGZyb20gJy4uL2J1dHRvbic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1kcmF3ZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJhd2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ2RyYXdlci5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgYW5pbWF0aW9uczogW3Jkc0RyYXdlckFuaW1hdGlvbnMuZXhwYW5kRHJhd2VyXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1Jkc0ljb25Db21wb25lbnQsIFJkc0J1dHRvbk1vZHVsZV0sXG59KVxuZXhwb3J0IGNsYXNzIFJkc0RyYXdlckNvbXBvbmVudFxuICBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveVxue1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3lSZWYgPSBpbmplY3QoRGVzdHJveVJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudFJlZiA9IGluamVjdDxFbGVtZW50UmVmPEhUTUxFbGVtZW50Pj4oRWxlbWVudFJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZW50T2JzZXJ2ZXIgPSBpbmplY3QoQ29udGVudE9ic2VydmVyKTtcbiAgcHJpdmF0ZSByZWFkb25seSBuZ1pvbmUgPSBpbmplY3QoTmdab25lKTtcbiAgcHJpdmF0ZSByZWFkb25seSBmb2N1c1RyYXBGYWN0b3J5ID0gaW5qZWN0KENvbmZpZ3VyYWJsZUZvY3VzVHJhcEZhY3RvcnkpO1xuICBwcml2YXRlIHJlYWRvbmx5IGZvY3VzTW9uaXRvciA9IGluamVjdChGb2N1c01vbml0b3IpO1xuICBwcml2YXRlIHJlYWRvbmx5IGRvY3VtZW50ID0gaW5qZWN0KERPQ1VNRU5UKTtcbiAgcHJpdmF0ZSByZWFkb25seSBpbnRlcmFjdGl2aXR5Q2hlY2tlciA9IGluamVjdChJbnRlcmFjdGl2aXR5Q2hlY2tlcik7XG4gIHByaXZhdGUgcmVhZG9ubHkgcGxhdGZvcm1JZCA9IGluamVjdDxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oUExBVEZPUk1fSUQpO1xuXG4gIHJlYWRvbmx5IF9tb2RlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIHJlYWRvbmx5IF9hbmltYXRpb25TdGFydGVkID0gbmV3IFN1YmplY3Q8QW5pbWF0aW9uRXZlbnQ+KCk7XG4gIHJlYWRvbmx5IF9hbmltYXRpb25FbmQgPSBuZXcgU3ViamVjdDxBbmltYXRpb25FdmVudD4oKTtcblxuICBfYW5pbWF0aW9uU3RhdGU6ICdvcGVuLWluc3RhbnQnIHwgJ29wZW4nIHwgJ3ZvaWQnID0gJ3ZvaWQnO1xuICBfYW5pbWF0aW5nOiAnZXhwYW5kaW5nJyB8ICdjb2xsYXBzaW5nJyB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2lzT3BlbmVkJCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xuXG4gIHByaXZhdGUgX2ZvY3VzVHJhcDogQ29uZmlndXJhYmxlRm9jdXNUcmFwO1xuICBwcml2YXRlIF9lbGVtZW50Rm9jdXNlZEJlZm9yZURyYXdlcldhc09wZW5lZDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICBASW5wdXQoKSBzaXplOiBSZHNEcmF3ZXJTaXplID0gJ20nO1xuXG4gIEBJbnB1dCgpIGNsb3NlQnRuQXJpYUxhYmVsID0gJ0Nsb3NlJztcblxuICBASW5wdXQoKVxuICBnZXQgbW9kZSgpOiBSZHNEcmF3ZXJNb2RlIHtcbiAgICByZXR1cm4gdGhpcy5fbW9kZTtcbiAgfVxuXG4gIHNldCBtb2RlKHZhbHVlOiBSZHNEcmF3ZXJNb2RlKSB7XG4gICAgdGhpcy5fbW9kZSA9IHZhbHVlO1xuICAgIHRoaXMudXBkYXRlRm9jdXNUcmFwU3RhdGUoKTtcbiAgICB0aGlzLl9tb2RlQ2hhbmdlZC5uZXh0KCk7XG4gIH1cblxuICBwcml2YXRlIF9tb2RlOiBSZHNEcmF3ZXJNb2RlID0gJ292ZXJsYXknO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBwb3NpdGlvbigpOiBSZHNEcmF3ZXJQb3NpdGlvbiB7XG4gICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uO1xuICB9XG5cbiAgc2V0IHBvc2l0aW9uKHZhbHVlOiBSZHNEcmF3ZXJQb3NpdGlvbikge1xuICAgIHRoaXMuX3Bvc2l0aW9uID0gdmFsdWUgPT09ICdlbmQnID8gJ2VuZCcgOiAnc3RhcnQnO1xuICAgIHRoaXMucG9zaXRpb25DaGFuZ2VkLmVtaXQodGhpcy5fcG9zaXRpb24pO1xuICB9XG5cbiAgcHJpdmF0ZSBfcG9zaXRpb246IFJkc0RyYXdlclBvc2l0aW9uID0gJ3N0YXJ0JztcblxuICBASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSkgY2xvc2FibGUgPSB0cnVlO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBleHBhbmRlZCh2YWx1ZTogQm9vbGVhbklucHV0KSB7XG4gICAgdGhpcy50b2dnbGUoYm9vbGVhbkF0dHJpYnV0ZSh2YWx1ZSkpO1xuICB9XG5cbiAgZ2V0IGV4cGFuZGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzT3BlbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBfb3BlbmVkVmlhOiBGb2N1c09yaWdpbiB8IG51bGw7XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGRpc2FibGVDbG9zZSA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBhdXRvRm9jdXModmFsdWU6IEF1dG9Gb2N1c1RhcmdldCB8IHN0cmluZyB8IEJvb2xlYW5JbnB1dCkge1xuICAgIGlmICh2YWx1ZSA9PT0gJ3RydWUnIHx8IHZhbHVlID09PSAnZmFsc2UnIHx8IHZhbHVlID09IG51bGwpIHtcbiAgICAgIHZhbHVlID0gYm9vbGVhbkF0dHJpYnV0ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5fYXV0b0ZvY3VzID0gdmFsdWU7XG4gIH1cblxuICBnZXQgYXV0b0ZvY3VzKCk6IEF1dG9Gb2N1c1RhcmdldCB8IHN0cmluZyB8IGJvb2xlYW4ge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fYXV0b0ZvY3VzO1xuXG4gICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaWRlJykge1xuICAgICAgICByZXR1cm4gJ2RpYWxvZyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ2ZpcnN0LXRhYmJhYmxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9hdXRvRm9jdXM6IEF1dG9Gb2N1c1RhcmdldCB8IHN0cmluZyB8IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG5cbiAgQE91dHB1dCgpIHJlYWRvbmx5IGNsb3NlRHJhd2VyID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBPdXRwdXQoKSByZWFkb25seSBvcGVuRHJhd2VyID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBPdXRwdXQoKSByZWFkb25seSBwb3NpdGlvbkNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFJkc0RyYXdlclBvc2l0aW9uPigpO1xuXG4gIEBDb250ZW50Q2hpbGQoUmRzRHJhd2VyQWN0aW9uc0RpcmVjdGl2ZSkgYWN0aW9uczogUmRzRHJhd2VyQWN0aW9uc0RpcmVjdGl2ZTtcblxuICBAVmlld0NoaWxkKCdib2R5JykgYm9keTogRWxlbWVudFJlZiA9IHsgbmF0aXZlRWxlbWVudDogdW5kZWZpbmVkIH07XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGdldCBjbGFzcygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY2xhc3NlcyA9IFsncmRzLWRyYXdlcicsIGByZHMtZHJhd2VyLSR7dGhpcy5zaXplfWBdO1xuXG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ292ZXJsYXknKSB7XG4gICAgICBjbGFzc2VzLnB1c2goJ3Jkcy1kcmF3ZXItb3ZlcmxheScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAnZW5kJykge1xuICAgICAgY2xhc3Nlcy5wdXNoKCdyZHMtZHJhd2VyLWVuZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbGFzc2VzLnB1c2goJ3Jkcy1kcmF3ZXItc3RhcnQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2xhc3NlcztcbiAgfVxuXG4gIEBIb3N0QmluZGluZygndGFiSW5kZXgnKSB0YWJJbmRleCA9IFRBQl9JTkRFWF9OT1RfRk9DVVNBQkxFO1xuXG4gIEBIb3N0QmluZGluZygnQHRyYW5zZm9ybScpXG4gIGdldCB0cmFuc2Zvcm0oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uU3RhdGU7XG4gIH1cblxuICBnZXQgaXNPcGVuZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzT3BlbmVkJC5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgZ2V0IGlzT3BlbmVkJCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5faXNPcGVuZWQkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5yZHMtZHJhd2VyLXNjcm9sbGFibGUnKVxuICBzY3JvbGxhYmxlID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm1JZCkpIHtcbiAgICAgICAgZnJvbUV2ZW50PEtleWJvYXJkRXZlbnQ+KHdpbmRvdywgJ2tleWRvd24nKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgZmlsdGVyKFxuICAgICAgICAgICAgICAoZXZlbnQpID0+XG4gICAgICAgICAgICAgICAgZXZlbnQua2V5Q29kZSA9PT0gRVNDQVBFICYmXG4gICAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZUNsb3NlICYmXG4gICAgICAgICAgICAgICAgIWhhc01vZGlmaWVyS2V5KGV2ZW50KSxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0YWtlVW50aWxEZXN0cm95ZWQoKSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnN1YnNjcmliZSgoZXZlbnQpID0+XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl9mb2N1c1RyYXAgPSB0aGlzLmZvY3VzVHJhcEZhY3RvcnkuY3JlYXRlKFxuICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgKTtcbiAgICB0aGlzLnVwZGF0ZUZvY3VzVHJhcFN0YXRlKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jb250ZW50T2JzZXJ2ZXJcbiAgICAgIC5vYnNlcnZlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KVxuICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5zY3JvbGxhYmxlID0gdGhpcy5pc1Njcm9sbGFibGUoKTtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9mb2N1c1RyYXApIHtcbiAgICAgIHRoaXMuX2ZvY3VzVHJhcC5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgdGhpcy5fYW5pbWF0aW9uU3RhcnRlZC5jb21wbGV0ZSgpO1xuICAgIHRoaXMuX2FuaW1hdGlvbkVuZC5jb21wbGV0ZSgpO1xuICAgIHRoaXMuX21vZGVDaGFuZ2VkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdAdHJhbnNmb3JtLnN0YXJ0JywgWyckZXZlbnQnXSlcbiAgdHJhbnNmb3JtU3RhcnQoZXZlbnQ6IEFuaW1hdGlvbkV2ZW50KTogdm9pZCB7XG4gICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09ICd2b2lkJykge1xuICAgICAgdGhpcy5fYW5pbWF0aW5nID0gJ2NvbGxhcHNpbmcnO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQudG9TdGF0ZSA9PT0gJ29wZW4nKSB7XG4gICAgICB0aGlzLl9hbmltYXRpbmcgPSAnZXhwYW5kaW5nJztcbiAgICB9XG5cbiAgICB0aGlzLl9hbmltYXRpb25TdGFydGVkLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignQHRyYW5zZm9ybS5kb25lJywgWyckZXZlbnQnXSlcbiAgdHJhbnNmb3JtRW5kKGV2ZW50OiBBbmltYXRpb25FdmVudCk6IHZvaWQge1xuICAgIHRoaXMuX2FuaW1hdGluZyA9IG51bGw7XG4gICAgdGhpcy5fYW5pbWF0aW9uRW5kLm5leHQoZXZlbnQpO1xuXG4gICAgLy8gYW5pbWF0aW9uLmRvbmUgY2hhbmdlcyBvcGVuZWQgdmFsdWVcbiAgICBjb25zdCBpc09wZW5lZCA9XG4gICAgICBldmVudC50b1N0YXRlID09PSAnb3BlbicgfHwgZXZlbnQudG9TdGF0ZSA9PT0gJ29wZW4taW5zdGFudCc7XG5cbiAgICBpZiAoaXNPcGVuZWQpIHtcbiAgICAgIGlmICh0aGlzLmRvY3VtZW50KSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRGb2N1c2VkQmVmb3JlRHJhd2VyV2FzT3BlbmVkID0gdGhpcy5kb2N1bWVudFxuICAgICAgICAgIC5hY3RpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgfVxuXG4gICAgICB0aGlzLnRha2VGb2N1cygpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc0ZvY3VzV2l0aGluRHJhd2VyKCkpIHtcbiAgICAgIHRoaXMucmVzdG9yZUZvY3VzKHRoaXMuX29wZW5lZFZpYSB8fCAncHJvZ3JhbScpO1xuICAgIH1cblxuICAgIHRoaXMuX2lzT3BlbmVkJC5uZXh0KGlzT3BlbmVkKTtcblxuICAgIGlmIChldmVudC5mcm9tU3RhdGUgIT09IGV2ZW50LnRvU3RhdGUpIHtcbiAgICAgIGlmIChpc09wZW5lZCkge1xuICAgICAgICB0aGlzLm9wZW5EcmF3ZXIuZW1pdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jbG9zZURyYXdlci5lbWl0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zY3JvbGxhYmxlID0gdGhpcy5pc1Njcm9sbGFibGUoKTtcbiAgfVxuXG4gIHRvZ2dsZShcbiAgICBleHBhbmRlZCA9ICF0aGlzLl9pc09wZW5lZCQuZ2V0VmFsdWUoKSxcbiAgICBvcGVuZWRWaWE/OiBGb2N1c09yaWdpbixcbiAgKTogdm9pZCB7XG4gICAgaWYgKGV4cGFuZGVkICYmIG9wZW5lZFZpYSkge1xuICAgICAgdGhpcy5fb3BlbmVkVmlhID0gb3BlbmVkVmlhO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzT3BlbmVkICE9PSBleHBhbmRlZCkge1xuICAgICAgaWYgKGV4cGFuZGVkKSB7XG4gICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9wZW4oKTogdm9pZCB7XG4gICAgdGhpcy5fYW5pbWF0aW9uU3RhdGUgPSAnb3Blbic7XG4gIH1cblxuICBjbG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9hbmltYXRpb25TdGF0ZSA9ICd2b2lkJztcbiAgfVxuXG4gIHByaXZhdGUgZm9yY2VGb2N1cyhlbGVtZW50OiBIVE1MRWxlbWVudCwgb3B0aW9ucz86IEZvY3VzT3B0aW9ucyk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2aXR5Q2hlY2tlci5pc0ZvY3VzYWJsZShlbGVtZW50KSkge1xuICAgICAgZWxlbWVudC50YWJJbmRleCA9IFRBQl9JTkRFWF9OT1RfRk9DVVNBQkxFO1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICBjb25zdCBjYWxsYmFjayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCBjYWxsYmFjayk7XG4gICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBjYWxsYmFjayk7XG4gICAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgY2FsbGJhY2spO1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGNhbGxiYWNrKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGVsZW1lbnQuZm9jdXMob3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIGZvY3VzQnlDc3NTZWxlY3RvcihzZWxlY3Rvcjogc3RyaW5nLCBvcHRpb25zPzogRm9jdXNPcHRpb25zKTogdm9pZCB7XG4gICAgY29uc3QgZWxlbWVudFRvRm9jdXMgPVxuICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oc2VsZWN0b3IpO1xuXG4gICAgaWYgKGVsZW1lbnRUb0ZvY3VzKSB7XG4gICAgICB0aGlzLmZvcmNlRm9jdXMoZWxlbWVudFRvRm9jdXMsIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdGFrZUZvY3VzKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5fZm9jdXNUcmFwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuXG4gICAgc3dpdGNoICh0aGlzLmF1dG9Gb2N1cykge1xuICAgICAgY2FzZSBmYWxzZTpcbiAgICAgIGNhc2UgJ2RpYWxvZyc6XG4gICAgICAgIHJldHVybjtcbiAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgIGNhc2UgJ2ZpcnN0LXRhYmJhYmxlJzpcbiAgICAgICAgdGhpcy5fZm9jdXNUcmFwLmZvY3VzSW5pdGlhbEVsZW1lbnRXaGVuUmVhZHkoKS50aGVuKChoYXNNb3ZlZEZvY3VzKSA9PiB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgIWhhc01vdmVkRm9jdXMgJiZcbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cyA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICkge1xuICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZmlyc3QtaGVhZGluZyc6XG4gICAgICAgIHRoaXMuZm9jdXNCeUNzc1NlbGVjdG9yKFxuICAgICAgICAgICdyZHMtZHJhd2VyLWhlYWRlciwgW3Jkcy1kcmF3ZXItaGVhZGVyXSwgW3Jkc0RyYXdlckhlYWRlcl0nLFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuZm9jdXNCeUNzc1NlbGVjdG9yKHRoaXMuYXV0b0ZvY3VzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXN0b3JlRm9jdXMoZm9jdXNPcmlnaW46IEV4Y2x1ZGU8Rm9jdXNPcmlnaW4sIG51bGw+KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuYXV0b0ZvY3VzID09PSAnZGlhbG9nJykge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fZWxlbWVudEZvY3VzZWRCZWZvcmVEcmF3ZXJXYXNPcGVuZWQpIHtcbiAgICAgIHRoaXMuZm9jdXNNb25pdG9yLmZvY3VzVmlhKFxuICAgICAgICB0aGlzLl9lbGVtZW50Rm9jdXNlZEJlZm9yZURyYXdlcldhc09wZW5lZCxcbiAgICAgICAgZm9jdXNPcmlnaW4sXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fZWxlbWVudEZvY3VzZWRCZWZvcmVEcmF3ZXJXYXNPcGVuZWQgPSBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0ZvY3VzV2l0aGluRHJhd2VyKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGFjdGl2ZUVsID0gdGhpcy5kb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXG4gICAgcmV0dXJuICEhYWN0aXZlRWwgJiYgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoYWN0aXZlRWwpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVGb2N1c1RyYXBTdGF0ZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fZm9jdXNUcmFwKSB7XG4gICAgICB0aGlzLl9mb2N1c1RyYXAuZW5hYmxlZCA9IHRoaXMuZXhwYW5kZWQgJiYgdGhpcy5tb2RlICE9PSAnc2lkZSc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1Njcm9sbGFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuYm9keS5uYXRpdmVFbGVtZW50LnNjcm9sbEhlaWdodCA+XG4gICAgICB0aGlzLmJvZHkubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHRcbiAgICApO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicmRzLWRyYXdlci1oZWFkZXJcIj5cbiAgPG5nLWNvbnRlbnRcbiAgICBzZWxlY3Q9XCJyZHMtZHJhd2VyLWhlYWRlciwgW3Jkcy1kcmF3ZXItaGVhZGVyXSwgW3Jkc0RyYXdlckhlYWRlcl1cIlxuICAvPlxuICBAaWYgKGNsb3NhYmxlKSB7XG4gICAgPGJ1dHRvblxuICAgICAgcmRzLWljb24tYnV0dG9uXG4gICAgICBzaXplPVwibVwiXG4gICAgICAoY2xpY2spPVwidG9nZ2xlKGZhbHNlKVwiXG4gICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnRuQXJpYUxhYmVsXCJcbiAgICA+XG4gICAgICA8cmRzLWljb24gaWNvbj1cImNsb3NlXCIgLz5cbiAgICA8L2J1dHRvbj5cbiAgfVxuPC9kaXY+XG48ZGl2IGNsYXNzPVwicmRzLWRyYXdlci1ib2R5XCIgI2JvZHk+XG4gIDxuZy1jb250ZW50IC8+XG48L2Rpdj5cbjxkaXYgW2NsYXNzLnJkcy1kcmF3ZXItYWN0aW9uc109XCJhY3Rpb25zXCI+XG4gIDxuZy1jb250ZW50XG4gICAgc2VsZWN0PVwicmRzLWRyYXdlci1hY3Rpb25zLCBbcmRzLWRyYXdlci1hY3Rpb25zXSwgW3Jkc0RyYXdlckFjdGlvbnNdXCJcbiAgLz5cbjwvZGl2PlxuIl19