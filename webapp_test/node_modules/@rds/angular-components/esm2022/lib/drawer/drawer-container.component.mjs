import { booleanAttribute, Component, ContentChild, DestroyRef, ElementRef, EventEmitter, HostBinding, inject, Input, NgZone, Output, Renderer2, ViewEncapsulation, } from '@angular/core';
import { BehaviorSubject, filter, merge } from 'rxjs';
import { RdsDrawerComponent } from './drawer.component';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
export class RdsDrawerContainerComponent {
    constructor() {
        this.ngZone = inject(NgZone);
        this.elementRef = inject(ElementRef);
        this.destroyRef = inject(DestroyRef);
        this.renderer = inject(Renderer2);
        this.class = [
            'rds-drawer-container',
            'rds-drawer-overlay',
        ];
        this.backdropClick = new EventEmitter();
        this._contentMargin$ = new BehaviorSubject({
            left: 0,
            right: 0,
        });
        this.contentMargins$ = this._contentMargin$.asObservable();
        this._backdrop = false;
    }
    set backdrop(value) {
        if (value !== 'transparent') {
            value = booleanAttribute(value);
        }
        this._backdrop = value;
    }
    get backdrop() {
        if (this._backdrop == null) {
            return !this.start || !this.end;
        }
        return this._backdrop;
    }
    ngAfterContentInit() {
        this.watchDrawerToggle();
        merge(this.drawer.positionChanged, this.drawer._modeChanged)
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.updateContentMargins());
    }
    ngOnDestroy() {
        this._contentMargin$.complete();
    }
    /** for internal purposes only */
    _onBackdropClicked() {
        this.drawer.toggle(false);
        this.backdropClick.emit();
    }
    isShowingBackdrop() {
        return this.isDrawerOpen() && !!this.backdrop;
    }
    updateContentMargins() {
        let left = 0;
        let right = 0;
        if (this.drawer &&
            this.drawer._animating === 'expanding' &&
            this.drawer.position == 'start') {
            if (this.drawer.mode == 'side') {
                left += this.getDrawerWidth();
            }
            else if (this.drawer.mode == 'push') {
                const width = this.getDrawerWidth();
                left += width;
                right -= width;
            }
        }
        if (this.drawer &&
            this.drawer._animating === 'expanding' &&
            this.drawer.position == 'end') {
            if (this.drawer.mode == 'side') {
                right += this.getDrawerWidth();
            }
            else if (this.drawer.mode == 'push') {
                const width = this.getDrawerWidth();
                right += width;
                left -= width;
            }
        }
        this.ngZone.run(() => this._contentMargin$.next({ left, right }));
    }
    isDrawerOpen() {
        return (this.drawer != null &&
            (this.drawer._animating !== null || this.drawer.expanded));
    }
    watchDrawerToggle() {
        this.drawer._animationStarted
            .pipe(filter((event) => event.fromState !== event.toState), takeUntilDestroyed(this.destroyRef))
            .subscribe((event) => {
            if (event.toState !== 'open-instant') {
                this.renderer.addClass(this.elementRef.nativeElement, 'rds-drawer-transition');
            }
            this.updateContentMargins();
        });
    }
    getDrawerWidth() {
        return this.drawerElement?.nativeElement?.offsetWidth ?? 0;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDrawerContainerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsDrawerContainerComponent, isStandalone: true, selector: "rds-drawer-container", inputs: { backdrop: "backdrop" }, outputs: { backdropClick: "backdropClick" }, host: { properties: { "class": "this.class" } }, queries: [{ propertyName: "drawer", first: true, predicate: RdsDrawerComponent, descendants: true }, { propertyName: "drawerElement", first: true, predicate: RdsDrawerComponent, descendants: true, read: ElementRef }], ngImport: i0, template: "@if (backdrop) {\n  <div\n    (click)=\"_onBackdropClicked()\"\n    class=\"rds-drawer-backdrop\"\n    [class.cdk-overlay-dark-backdrop]=\"backdrop !== 'transparent'\"\n    [class.rds-drawer-backdrop--transparent]=\"backdrop === 'transparent'\"\n    [class.rds-drawer-shown]=\"isShowingBackdrop()\"\n  ></div>\n}\n<ng-content select=\"rds-drawer\" />\n<ng-content select=\"rds-drawer-content\" />\n", styles: [".rds-drawer-container{position:relative;display:flex;flex-direction:row;align-items:flex-start;overflow:hidden;width:100%;height:100%}.rds-drawer-container.rds-drawer-transition .rds-drawer-content{transition-duration:.4s;transition-timing-function:cubic-bezier(.25,.8,.25,1);transition-property:transform,margin-left,margin-right}.rds-drawer-backdrop{position:absolute;z-index:3;inset:0;display:block;visibility:hidden}.rds-drawer-backdrop.rds-drawer-shown{visibility:visible}.rds-drawer-backdrop.rds-drawer-backdrop--transparent{background-color:transparent}\n"], encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsDrawerContainerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-drawer-container', encapsulation: ViewEncapsulation.None, standalone: true, template: "@if (backdrop) {\n  <div\n    (click)=\"_onBackdropClicked()\"\n    class=\"rds-drawer-backdrop\"\n    [class.cdk-overlay-dark-backdrop]=\"backdrop !== 'transparent'\"\n    [class.rds-drawer-backdrop--transparent]=\"backdrop === 'transparent'\"\n    [class.rds-drawer-shown]=\"isShowingBackdrop()\"\n  ></div>\n}\n<ng-content select=\"rds-drawer\" />\n<ng-content select=\"rds-drawer-content\" />\n", styles: [".rds-drawer-container{position:relative;display:flex;flex-direction:row;align-items:flex-start;overflow:hidden;width:100%;height:100%}.rds-drawer-container.rds-drawer-transition .rds-drawer-content{transition-duration:.4s;transition-timing-function:cubic-bezier(.25,.8,.25,1);transition-property:transform,margin-left,margin-right}.rds-drawer-backdrop{position:absolute;z-index:3;inset:0;display:block;visibility:hidden}.rds-drawer-backdrop.rds-drawer-shown{visibility:visible}.rds-drawer-backdrop.rds-drawer-backdrop--transparent{background-color:transparent}\n"] }]
        }], propDecorators: { class: [{
                type: HostBinding,
                args: ['class']
            }], drawer: [{
                type: ContentChild,
                args: [RdsDrawerComponent, { descendants: true }]
            }], drawerElement: [{
                type: ContentChild,
                args: [RdsDrawerComponent, { descendants: true, read: ElementRef }]
            }], backdropClick: [{
                type: Output
            }], backdrop: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2RyYXdlci9kcmF3ZXItY29udGFpbmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvZHJhd2VyL2RyYXdlci1jb250YWluZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUVMLGdCQUFnQixFQUNoQixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sRUFFTixNQUFNLEVBQ04sU0FBUyxFQUNULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFLdEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDeEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7O0FBU2hFLE1BQU0sT0FBTywyQkFBMkI7SUFQeEM7UUFVbUIsV0FBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixlQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hDLGVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEMsYUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVmLFVBQUssR0FBRztZQUNyQyxzQkFBc0I7WUFDdEIsb0JBQW9CO1NBQ3JCLENBQUM7UUFNaUIsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRTNDLG9CQUFlLEdBQzlC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QUEzQiwyQkFBMkIsb1BBWXhCLGtCQUFrQixnRkFFbEIsa0JBQWtCLDJCQUE2QixVQUFVLDZCQy9DekUsZ1pBV0E7OzJGRHNCYSwyQkFBMkI7a0JBUHZDLFNBQVM7K0JBQ0Usc0JBQXNCLGlCQUdqQixpQkFBaUIsQ0FBQyxJQUFJLGNBQ3pCLElBQUk7OEJBVWUsS0FBSztzQkFBbkMsV0FBVzt1QkFBQyxPQUFPO2dCQUtaLE1BQU07c0JBRGIsWUFBWTt1QkFBQyxrQkFBa0IsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUU7Z0JBRy9DLGFBQWE7c0JBRHBCLFlBQVk7dUJBQUMsa0JBQWtCLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7Z0JBR3RELGFBQWE7c0JBQS9CLE1BQU07Z0JBYUgsUUFBUTtzQkFEWCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQm9vbGVhbklucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBEZXN0cm95UmVmLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBpbmplY3QsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgZmlsdGVyLCBtZXJnZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgUmRzRHJhd2VyQmFja2Ryb3AsXG4gIFJkc0RyYXdlckNvbnRhaW5lckNvbnRlbnRNYXJnaW5zLFxufSBmcm9tICcuL2RyYXdlci10eXBlcyc7XG5pbXBvcnQgeyBSZHNEcmF3ZXJDb21wb25lbnQgfSBmcm9tICcuL2RyYXdlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdyZHMtZHJhd2VyLWNvbnRhaW5lcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kcmF3ZXItY29udGFpbmVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZHJhd2VyLWNvbnRhaW5lci5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBzdGFuZGFsb25lOiB0cnVlLFxufSlcbmV4cG9ydCBjbGFzcyBSZHNEcmF3ZXJDb250YWluZXJDb21wb25lbnRcbiAgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3lcbntcbiAgcHJpdmF0ZSByZWFkb25seSBuZ1pvbmUgPSBpbmplY3QoTmdab25lKTtcbiAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmID0gaW5qZWN0KEVsZW1lbnRSZWYpO1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3lSZWYgPSBpbmplY3QoRGVzdHJveVJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXIgPSBpbmplY3QoUmVuZGVyZXIyKTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgcmVhZG9ubHkgY2xhc3MgPSBbXG4gICAgJ3Jkcy1kcmF3ZXItY29udGFpbmVyJyxcbiAgICAncmRzLWRyYXdlci1vdmVybGF5JyxcbiAgXTtcbiAgQENvbnRlbnRDaGlsZChSZHNEcmF3ZXJDb21wb25lbnQsIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcbiAgcHJpdmF0ZSBkcmF3ZXI6IFJkc0RyYXdlckNvbXBvbmVudDtcbiAgQENvbnRlbnRDaGlsZChSZHNEcmF3ZXJDb21wb25lbnQsIHsgZGVzY2VuZGFudHM6IHRydWUsIHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgcHJpdmF0ZSBkcmF3ZXJFbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIEBPdXRwdXQoKSByZWFkb25seSBiYWNrZHJvcENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2NvbnRlbnRNYXJnaW4kID1cbiAgICBuZXcgQmVoYXZpb3JTdWJqZWN0PFJkc0RyYXdlckNvbnRhaW5lckNvbnRlbnRNYXJnaW5zPih7XG4gICAgICBsZWZ0OiAwLFxuICAgICAgcmlnaHQ6IDAsXG4gICAgfSk7XG4gIHJlYWRvbmx5IGNvbnRlbnRNYXJnaW5zJCA9IHRoaXMuX2NvbnRlbnRNYXJnaW4kLmFzT2JzZXJ2YWJsZSgpO1xuXG4gIHByaXZhdGUgc3RhcnQ6IFJkc0RyYXdlckNvbXBvbmVudCB8IG51bGw7XG4gIHByaXZhdGUgZW5kOiBSZHNEcmF3ZXJDb21wb25lbnQgfCBudWxsO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBiYWNrZHJvcCh2YWx1ZTogUmRzRHJhd2VyQmFja2Ryb3AgfCBCb29sZWFuSW5wdXQpIHtcbiAgICBpZiAodmFsdWUgIT09ICd0cmFuc3BhcmVudCcpIHtcbiAgICAgIHZhbHVlID0gYm9vbGVhbkF0dHJpYnV0ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5fYmFja2Ryb3AgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCBiYWNrZHJvcCgpOiBSZHNEcmF3ZXJCYWNrZHJvcCB7XG4gICAgaWYgKHRoaXMuX2JhY2tkcm9wID09IG51bGwpIHtcbiAgICAgIHJldHVybiAhdGhpcy5zdGFydCB8fCAhdGhpcy5lbmQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX2JhY2tkcm9wO1xuICB9XG5cbiAgcHJpdmF0ZSBfYmFja2Ryb3A6IFJkc0RyYXdlckJhY2tkcm9wID0gZmFsc2U7XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMud2F0Y2hEcmF3ZXJUb2dnbGUoKTtcbiAgICBtZXJnZSh0aGlzLmRyYXdlci5wb3NpdGlvbkNoYW5nZWQsIHRoaXMuZHJhd2VyLl9tb2RlQ2hhbmdlZClcbiAgICAgIC5waXBlKHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLnVwZGF0ZUNvbnRlbnRNYXJnaW5zKCkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fY29udGVudE1hcmdpbiQuY29tcGxldGUoKTtcbiAgfVxuXG4gIC8qKiBmb3IgaW50ZXJuYWwgcHVycG9zZXMgb25seSAqL1xuICBfb25CYWNrZHJvcENsaWNrZWQoKTogdm9pZCB7XG4gICAgdGhpcy5kcmF3ZXIudG9nZ2xlKGZhbHNlKTtcbiAgICB0aGlzLmJhY2tkcm9wQ2xpY2suZW1pdCgpO1xuICB9XG5cbiAgaXNTaG93aW5nQmFja2Ryb3AoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNEcmF3ZXJPcGVuKCkgJiYgISF0aGlzLmJhY2tkcm9wO1xuICB9XG5cbiAgdXBkYXRlQ29udGVudE1hcmdpbnMoKTogdm9pZCB7XG4gICAgbGV0IGxlZnQgPSAwO1xuICAgIGxldCByaWdodCA9IDA7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLmRyYXdlciAmJlxuICAgICAgdGhpcy5kcmF3ZXIuX2FuaW1hdGluZyA9PT0gJ2V4cGFuZGluZycgJiZcbiAgICAgIHRoaXMuZHJhd2VyLnBvc2l0aW9uID09ICdzdGFydCdcbiAgICApIHtcbiAgICAgIGlmICh0aGlzLmRyYXdlci5tb2RlID09ICdzaWRlJykge1xuICAgICAgICBsZWZ0ICs9IHRoaXMuZ2V0RHJhd2VyV2lkdGgoKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5kcmF3ZXIubW9kZSA9PSAncHVzaCcpIHtcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmdldERyYXdlcldpZHRoKCk7XG4gICAgICAgIGxlZnQgKz0gd2lkdGg7XG4gICAgICAgIHJpZ2h0IC09IHdpZHRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHRoaXMuZHJhd2VyICYmXG4gICAgICB0aGlzLmRyYXdlci5fYW5pbWF0aW5nID09PSAnZXhwYW5kaW5nJyAmJlxuICAgICAgdGhpcy5kcmF3ZXIucG9zaXRpb24gPT0gJ2VuZCdcbiAgICApIHtcbiAgICAgIGlmICh0aGlzLmRyYXdlci5tb2RlID09ICdzaWRlJykge1xuICAgICAgICByaWdodCArPSB0aGlzLmdldERyYXdlcldpZHRoKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZHJhd2VyLm1vZGUgPT0gJ3B1c2gnKSB7XG4gICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5nZXREcmF3ZXJXaWR0aCgpO1xuICAgICAgICByaWdodCArPSB3aWR0aDtcbiAgICAgICAgbGVmdCAtPSB3aWR0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5fY29udGVudE1hcmdpbiQubmV4dCh7IGxlZnQsIHJpZ2h0IH0pKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNEcmF3ZXJPcGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLmRyYXdlciAhPSBudWxsICYmXG4gICAgICAodGhpcy5kcmF3ZXIuX2FuaW1hdGluZyAhPT0gbnVsbCB8fCB0aGlzLmRyYXdlci5leHBhbmRlZClcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSB3YXRjaERyYXdlclRvZ2dsZSgpOiB2b2lkIHtcbiAgICB0aGlzLmRyYXdlci5fYW5pbWF0aW9uU3RhcnRlZFxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoZXZlbnQpID0+IGV2ZW50LmZyb21TdGF0ZSAhPT0gZXZlbnQudG9TdGF0ZSksXG4gICAgICAgIHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnRvU3RhdGUgIT09ICdvcGVuLWluc3RhbnQnKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgICAgICAgJ3Jkcy1kcmF3ZXItdHJhbnNpdGlvbicsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlQ29udGVudE1hcmdpbnMoKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREcmF3ZXJXaWR0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRyYXdlckVsZW1lbnQ/Lm5hdGl2ZUVsZW1lbnQ/Lm9mZnNldFdpZHRoID8/IDA7XG4gIH1cbn1cbiIsIkBpZiAoYmFja2Ryb3ApIHtcbiAgPGRpdlxuICAgIChjbGljayk9XCJfb25CYWNrZHJvcENsaWNrZWQoKVwiXG4gICAgY2xhc3M9XCJyZHMtZHJhd2VyLWJhY2tkcm9wXCJcbiAgICBbY2xhc3MuY2RrLW92ZXJsYXktZGFyay1iYWNrZHJvcF09XCJiYWNrZHJvcCAhPT0gJ3RyYW5zcGFyZW50J1wiXG4gICAgW2NsYXNzLnJkcy1kcmF3ZXItYmFja2Ryb3AtLXRyYW5zcGFyZW50XT1cImJhY2tkcm9wID09PSAndHJhbnNwYXJlbnQnXCJcbiAgICBbY2xhc3MucmRzLWRyYXdlci1zaG93bl09XCJpc1Nob3dpbmdCYWNrZHJvcCgpXCJcbiAgPjwvZGl2PlxufVxuPG5nLWNvbnRlbnQgc2VsZWN0PVwicmRzLWRyYXdlclwiIC8+XG48bmctY29udGVudCBzZWxlY3Q9XCJyZHMtZHJhd2VyLWNvbnRlbnRcIiAvPlxuIl19