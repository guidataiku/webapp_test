import { inject, Injectable } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { fromEvent, Subject } from 'rxjs';
import { distinctUntilChanged, filter, map, takeUntil } from 'rxjs/operators';
import { RdsThemeDark, RdsThemeLight } from '@rds/core';
import { RDS_THEME_CONFIG } from './theme.config';
import * as i0 from "@angular/core";
export class RdsThemeService {
    static { this.ATTRIBUTE_NAME = 'rds-theme'; }
    constructor() {
        this.documentElement = inject(DOCUMENT).documentElement;
        this.config = inject(RDS_THEME_CONFIG, { optional: true });
        this._killAutoTheme$ = new Subject();
        this._globalThemeChange$ = new Subject();
        this.globalThemeChange$ = this._globalThemeChange$.pipe(distinctUntilChanged());
        if (!this.config || this.config.setAutoTheme) {
            this.setAuto();
        }
        new MutationObserver(() => this.emitValue()).observe(this.documentElement, {
            attributes: true,
            attributeFilter: [RdsThemeService.ATTRIBUTE_NAME],
        });
    }
    setAuto() {
        this._killAutoTheme$.next();
        const savedThemeChoice = localStorage.getItem(RdsThemeService.ATTRIBUTE_NAME);
        if (savedThemeChoice) {
            this.set(savedThemeChoice);
            return;
        }
        if (window.matchMedia) {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches &&
                !this.isDark()) {
                this.setDark();
            }
            fromEvent(window.matchMedia('(prefers-color-scheme: dark)'), 'change')
                .pipe(map((e) => (e.matches ? RdsThemeDark : RdsThemeLight)), filter((t) => t !== this.get()), takeUntil(this._killAutoTheme$))
                .subscribe((t) => this.set(t));
        }
    }
    setLight(element = this.documentElement) {
        this.set(RdsThemeLight, element);
    }
    setDark(element = this.documentElement) {
        this.set(RdsThemeDark, element);
    }
    isDark(element = this.documentElement) {
        return this.get(element) === RdsThemeDark;
    }
    isLight(element = this.documentElement) {
        return [RdsThemeLight, null].includes(this.get(element));
    }
    set(theme, element = this.documentElement) {
        element.setAttribute(RdsThemeService.ATTRIBUTE_NAME, theme);
        localStorage.setItem(RdsThemeService.ATTRIBUTE_NAME, theme);
        if (element === this.documentElement) {
            this.emitValue();
        }
    }
    clear(element = this.documentElement) {
        element.removeAttribute(RdsThemeService.ATTRIBUTE_NAME);
        localStorage.setItem(RdsThemeService.ATTRIBUTE_NAME, RdsThemeLight);
        this.emitValue();
    }
    get(element = this.documentElement) {
        return element.getAttribute(RdsThemeService.ATTRIBUTE_NAME);
    }
    has(element = this.documentElement) {
        return element.hasAttribute(RdsThemeService.ATTRIBUTE_NAME);
    }
    emitValue() {
        this._globalThemeChange$.next(this.documentElement.getAttribute(RdsThemeService.ATTRIBUTE_NAME));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsThemeService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsThemeService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsThemeService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvdGhlbWUvdGhlbWUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUUsT0FBTyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQWdCLE1BQU0sV0FBVyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQUtsRCxNQUFNLE9BQU8sZUFBZTthQUNGLG1CQUFjLEdBQUcsV0FBVyxBQUFkLENBQWU7SUFTckQ7UUFSaUIsb0JBQWUsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsZUFBZSxDQUFDO1FBQ25ELFdBQU0sR0FBRyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUN0RCxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDdEMsd0JBQW1CLEdBQUcsSUFBSSxPQUFPLEVBQVksQ0FBQztRQUN0RCx1QkFBa0IsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUN6RCxvQkFBb0IsRUFBRSxDQUN2QixDQUFDO1FBR0EsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUM3QyxJQUFJLENBQUMs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WSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsR0FBRyxDQUFDLFVBQW1CLElBQUksQ0FBQyxlQUFlO1FBQ3pDLE9BQU8sT0FBTyxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFNLENBQUM7SUFDbkUsQ0FBQztJQUVELEdBQUcsQ0FBQyxVQUFtQixJQUFJLENBQUMsZUFBZTtRQUN6QyxPQUFPLE9BQU8sQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFTyxTQUFTO1FBQ2YsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FDM0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQy9CLGVBQWUsQ0FBQyxjQUFjLENBQ25CLENBQ2QsQ0FBQztJQUNKLENBQUM7OEdBcEdVLGVBQWU7a0hBQWYsZUFBZSxjQUZkLE1BQU07OzJGQUVQLGVBQWU7a0JBSDNCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIG1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUmRzVGhlbWVEYXJrLCBSZHNUaGVtZUxpZ2h0LCBSZHNUaGVtZU5hbWUgfSBmcm9tICdAcmRzL2NvcmUnO1xuaW1wb3J0IHsgUkRTX1RIRU1FX0NPTkZJRyB9IGZyb20gJy4vdGhlbWUuY29uZmlnJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIFJkc1RoZW1lU2VydmljZTxUIGV4dGVuZHMgc3RyaW5nID0gUmRzVGhlbWVOYW1lIHwgJ2F1dG8nPiB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFUVFJJQlVURV9OQU1FID0gJ3Jkcy10aGVtZSc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZG9jdW1lbnRFbGVtZW50ID0gaW5qZWN0KERPQ1VNRU5UKS5kb2N1bWVudEVsZW1lbnQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnID0gaW5qZWN0KFJEU19USEVNRV9DT05GSUcsIHsgb3B0aW9uYWw6IHRydWUgfSk7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2tpbGxBdXRvVGhlbWUkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfZ2xvYmFsVGhlbWVDaGFuZ2UkID0gbmV3IFN1YmplY3Q8VCB8IG51bGw+KCk7XG4gIHJlYWRvbmx5IGdsb2JhbFRoZW1lQ2hhbmdlJCA9IHRoaXMuX2dsb2JhbFRoZW1lQ2hhbmdlJC5waXBlKFxuICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZyB8fCB0aGlzLmNvbmZpZy5zZXRBdXRvVGhlbWUpIHtcbiAgICAgIHRoaXMuc2V0QXV0bygpO1xuICAgIH1cblxuICAgIG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHRoaXMuZW1pdFZhbHVlKCkpLm9ic2VydmUodGhpcy5kb2N1bWVudEVsZW1lbnQsIHtcbiAgICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFtSZHNUaGVtZVNlcnZpY2UuQVRUUklCVVRFX05BTUVdLFxuICAgIH0pO1xuICB9XG5cbiAgc2V0QXV0bygpOiB2b2lkIHtcbiAgICB0aGlzLl9raWxsQXV0b1RoZW1lJC5uZXh0KCk7XG5cbiAgICBjb25zdCBzYXZlZFRoZW1lQ2hvaWNlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXG4gICAgICBSZHNUaGVtZVNlcnZpY2UuQVRUUklCVVRFX05BTUUsXG4gICAgKTtcblxuICAgIGlmIChzYXZlZFRoZW1lQ2hvaWNlKSB7XG4gICAgICB0aGlzLnNldChzYXZlZFRoZW1lQ2hvaWNlIGFzIFQpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspJykubWF0Y2hlcyAmJlxuICAgICAgICAhdGhpcy5pc0RhcmsoKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2V0RGFyaygpO1xuICAgICAgfVxuXG4gICAgICBmcm9tRXZlbnQ8TWVkaWFRdWVyeUxpc3RFdmVudD4oXG4gICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspJyksXG4gICAgICAgICdjaGFuZ2UnLFxuICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAoKGUpID0+IChlLm1hdGNoZXMgPyBSZHNUaGVtZURhcmsgOiBSZHNUaGVtZUxpZ2h0KSksXG4gICAgICAgICAgZmlsdGVyKCh0KSA9PiB0ICE9PSB0aGlzLmdldCgpKSxcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5fa2lsbEF1dG9UaGVtZSQpLFxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKHQpID0+IHRoaXMuc2V0KHQgYXMgVCkpO1xuICAgIH1cbiAgfVxuXG4gIHNldExpZ2h0KGVsZW1lbnQ6IEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50RWxlbWVudCk6IHZvaWQge1xuICAgIHRoaXMuc2V0KFJkc1RoZW1lTGlnaHQgYXMgVCwgZWxlbWVudCk7XG4gIH1cblxuICBzZXREYXJrKGVsZW1lbnQ6IEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50RWxlbWVudCk6IHZvaWQge1xuICAgIHRoaXMuc2V0KFJkc1RoZW1lRGFyayBhcyBULCBlbGVtZW50KTtcbiAgfVxuXG4gIGlzRGFyayhlbGVtZW50OiBFbGVtZW50ID0gdGhpcy5kb2N1bWVudEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoZWxlbWVudCkgPT09IFJkc1RoZW1lRGFyaztcbiAgfVxuXG4gIGlzTGlnaHQoZWxlbWVudDogRWxlbWVudCA9IHRoaXMuZG9jdW1lbnRFbGVtZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChbUmRzVGhlbWVMaWdodCwgbnVsbF0gYXMgKFQgfCBudWxsKVtdKS5pbmNsdWRlcyh0aGlzLmdldChlbGVtZW50KSk7XG4gIH1cblxuICBzZXQodGhlbWU6IFQsIGVsZW1lbnQ6IEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50RWxlbWVudCk6IHZvaWQge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFJkc1RoZW1lU2VydmljZS5BVFRSSUJVVEVfTkFNRSwgdGhlbWUgYXMgc3RyaW5nKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShSZHNUaGVtZVNlcnZpY2UuQVRUUklCVVRFX05BTUUsIHRoZW1lKTtcblxuICAgIGlmIChlbGVtZW50ID09PSB0aGlzLmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgdGhpcy5lbWl0VmFsdWUoKTtcbiAgICB9XG4gIH1cblxuICBjbGVhcihlbGVtZW50OiBFbGVtZW50ID0gdGhpcy5kb2N1bWVudEVsZW1lbnQpOiB2b2lkIHtcbiAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShSZHNUaGVtZVNlcnZpY2UuQVRUUklCVVRFX05BTUUpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFJkc1RoZW1lU2VydmljZS5BVFRSSUJVVEVfTkFNRSwgUmRzVGhlbWVMaWdodCk7XG4gICAgdGhpcy5lbWl0VmFsdWUoKTtcbiAgfVxuXG4gIGdldChlbGVtZW50OiBFbGVtZW50ID0gdGhpcy5kb2N1bWVudEVsZW1lbnQpOiBUIHwgbnVsbCB7XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKFJkc1RoZW1lU2VydmljZS5BVFRSSUJVVEVfTkFNRSkgYXMgVDtcbiAgfVxuXG4gIGhhcyhlbGVtZW50OiBFbGVtZW50ID0gdGhpcy5kb2N1bWVudEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZWxlbWVudC5oYXNBdHRyaWJ1dGUoUmRzVGhlbWVTZXJ2aWNlLkFUVFJJQlVURV9OQU1FKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdFZhbHVlKCk6IHZvaWQge1xuICAgIHRoaXMuX2dsb2JhbFRoZW1lQ2hhbmdlJC5uZXh0KFxuICAgICAgdGhpcy5kb2N1bWVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFxuICAgICAgICBSZHNUaGVtZVNlcnZpY2UuQVRUUklCVVRFX05BTUUsXG4gICAgICApIGFzIFQgfCBudWxsLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==