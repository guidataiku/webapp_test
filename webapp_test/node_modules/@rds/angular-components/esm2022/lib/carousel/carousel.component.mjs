import { RdsCarouselItemDirective } from './carousel-item.directive';
import { booleanAttribute, ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, DestroyRef, HostBinding, inject, Input, numberAttribute, QueryList, ViewEncapsulation, } from '@angular/core';
import { BreakpointUtil } from '../utils';
import { delay, takeUntil, tap } from 'rxjs/operators';
import { interval, Subject, timer } from 'rxjs';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
import * as i1 from "../icons/icon.component";
import * as i2 from "../button/icon-button.component";
const INITIAL_AUTOPLAY_DELAY = 2000;
export class RdsCarouselComponent {
    constructor() {
        this.cdr = inject(ChangeDetectorRef);
        this.destroyRef = inject(DestroyRef);
        this.indexOfActiveCarouselItem = 0;
        this.hostClass = 'rds-carousel';
        this.autoplay = false;
        this.autoplayDelay = INITIAL_AUTOPLAY_DELAY;
        this.showButtons = false;
        this.destroyTimeout$ = new Subject();
    }
    get indexOfLastElement() {
        return this.carouselItems.length - 1;
    }
    ngAfterContentInit() {
        this.selectActiveItem();
        this.carouselItems.changes
            .pipe(delay(0), takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.selectActiveItem());
    }
    ngOnChanges(changes) {
        if (changes['autoplay'] || changes['autoplayDelay']) {
            this.defineAutoplayInterval();
        }
    }
    ngOnDestroy() {
        this.destroyTimeout$.next();
        this.destroyTimeout$.complete();
    }
    prev() {
        this.hideCurrentVisibleCarouselItem();
        let indexOfNewCarouselItemToShow = this.indexOfActiveCarouselItem - 1;
        if (this.indexOfActiveCarouselItem === 0) {
            indexOfNewCarouselItemToShow = this.indexOfLastElement;
        }
        this.indexOfActiveCarouselItem = indexOfNewCarouselItemToShow;
        this.showCarouselItemMatchedWithIndexOfActive();
        this.defineAutoplayInterval();
    }
    next() {
        this.hideCurrentVisibleCarouselItem();
        let indexOfNewCarouselItemToShow = this.indexOfActiveCarouselItem + 1;
        if (this.indexOfActiveCarouselItem === this.indexOfLastElement) {
            indexOfNewCarouselItemToShow = 0;
        }
        this.indexOfActiveCarouselItem = indexOfNewCarouselItemToShow;
        this.showCarouselItemMatchedWithIndexOfActive();
        this.defineAutoplayInterval();
    }
    _changeActive({ index }) {
        this.hideCurrentVisibleCarouselItem();
        this.indexOfActiveCarouselItem = index;
        this.showCarouselItemMatchedWithIndexOfActive();
    }
    _isMobile() {
        return BreakpointUtil.isMobile();
    }
    defineAutoplayInterval() {
        this.destroyTimeout$.next();
        if (this.autoplay) {
            interval(this.autoplayDelay)
                .pipe(tap(() => this.next()), takeUntil(this.destroyTimeout$), takeUntilDestroyed(this.destroyRef))
                .subscribe();
        }
    }
    showCarouselItemMatchedWithIndexOfActive() {
        const carouselItemToShow = this.carouselItems.get(this.indexOfActiveCarouselItem);
        if (carouselItemToShow) {
            carouselItemToShow._show();
            timer(0)
                .pipe(tap(() => this.cdr.markForCheck()))
                .subscribe();
        }
    }
    hideCurrentVisibleCarouselItem() {
        const carouselItemToHide = this.carouselItems.get(this.indexOfActiveCarouselItem);
        if (carouselItemToHide) {
            carouselItemToHide._hide();
        }
    }
    selectActiveItem() {
        this.indexOfActiveCarouselItem = Math.max(this.carouselItems.toArray().findIndex((item) => item.isShown()), 0);
        this.carouselItems.forEach((item, index) => {
            if (index !== this.indexOfActiveCarouselItem && item.isShown()) {
                item._hide();
            }
        });
        this.showCarouselItemMatchedWithIndexOfActive();
        this.defineAutoplayInterval();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsCarouselComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsCarouselComponent, selector: "rds-carousel", inputs: { autoplay: ["autoplay", "autoplay", booleanAttribute], autoplayDelay: ["autoplayDelay", "autoplayDelay", (v) => numberAttribute(v, INITIAL_AUTOPLAY_DELAY)], showButtons: ["showButtons", "showButtons", booleanAttribute] }, host: { properties: { "class": "this.hostClass" } }, queries: [{ propertyName: "carouselItems", predicate: RdsCarouselItemDirective }], exportAs: ["rdsCarousel"], usesOnChanges: true, ngImport: i0, template: `
    <div class="rds-carousel__carousel-items">
      <ng-content />
    </div>
    <div class="rds-carousel__carousel-pagination">
      @if (showButtons) {
        <div
          class="rds-carousel__carousel-navigation-button-wrapper rds-carousel__carousel-navigation-button-wrapper--left"
        >
          <button
            rds-icon-button
            (click)="prev()"
            [size]="_isMobile() ? 's' : 'm'"
          >
            <rds-icon namespace="filled" icon="chevron_left" />
          </button>
        </div>
      }
      <div class="rds-carousel__carousel-pagination--text">
        {{ indexOfActiveCarouselItem + 1 }}/{{ carouselItems.length || 0 }}
      </div>
      @if (showButtons) {
        <div
          class="rds-carousel__carousel-navigation-button-wrapper rds-carousel__carousel-navigation-button-wrapper--right"
        >
          <button
            rds-icon-button
            (click)="next()"
            [size]="_isMobile() ? 's' : 'm'"
          >
            <rds-icon namespace="filled" icon="chevron_right" />
          </button>
        </div>
      }
    </div>
  `, isInline: true, styles: ["@keyframes fade{0%{opacity:.1}to{opacity:1}}.rds-carousel{position:relative;flex-direction:column;display:flex;overflow:hidden;margin:0 auto;padding-left:96px;padding-right:96px;width:100%}.rds-carousel .rds-carousel__carousel-items{align-items:center;justify-content:center;display:flex}.rds-carousel .rds-carousel__item{display:none;animation:fade .4s;width:100%}.rds-carousel .rds-carousel__item.rds-carousel__item--visible{align-items:center;justify-content:center;display:flex}.rds-carousel__carousel-pagination{display:flex;justify-content:center;align-items:center;margin-top:32px;height:40px}.rds-carousel__carousel-pagination .rds-carousel__carousel-pagination--text{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:var(--rds-color-low-contrast);padding-left:24px;padding-right:24px}.rds-carousel__carousel-pagination .rds-carousel__carousel-navigation-button-wrapper{display:flex}@media (max-width: 767.999999px){.rds-carousel{padding-left:20px;padding-right:20px}.rds-carousel__carousel-pagination{height:36px}.rds-carousel__carousel-pagination .rds-carousel__carousel-pagination--text{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}\n"], dependencies: [{ kind: "component", type: i1.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsCarouselComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-carousel', template: `
    <div class="rds-carousel__carousel-items">
      <ng-content />
    </div>
    <div class="rds-carousel__carousel-pagination">
      @if (showButtons) {
        <div
          class="rds-carousel__carousel-navigation-button-wrapper rds-carousel__carousel-navigation-button-wrapper--left"
        >
          <button
            rds-icon-button
            (click)="prev()"
            [size]="_isMobile() ? 's' : 'm'"
          >
            <rds-icon namespace="filled" icon="chevron_left" />
          </button>
        </div>
      }
      <div class="rds-carousel__carousel-pagination--text">
        {{ indexOfActiveCarouselItem + 1 }}/{{ carouselItems.length || 0 }}
      </div>
      @if (showButtons) {
        <div
          class="rds-carousel__carousel-navigation-button-wrapper rds-carousel__carousel-navigation-button-wrapper--right"
        >
          <button
            rds-icon-button
            (click)="next()"
            [size]="_isMobile() ? 's' : 'm'"
          >
            <rds-icon namespace="filled" icon="chevron_right" />
          </button>
        </div>
      }
    </div>
  `, changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, exportAs: 'rdsCarousel', styles: ["@keyframes fade{0%{opacity:.1}to{opacity:1}}.rds-carousel{position:relative;flex-direction:column;display:flex;overflow:hidden;margin:0 auto;padding-left:96px;padding-right:96px;width:100%}.rds-carousel .rds-carousel__carousel-items{align-items:center;justify-content:center;display:flex}.rds-carousel .rds-carousel__item{display:none;animation:fade .4s;width:100%}.rds-carousel .rds-carousel__item.rds-carousel__item--visible{align-items:center;justify-content:center;display:flex}.rds-carousel__carousel-pagination{display:flex;justify-content:center;align-items:center;margin-top:32px;height:40px}.rds-carousel__carousel-pagination .rds-carousel__carousel-pagination--text{font-size:18px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:var(--rds-color-low-contrast);padding-left:24px;padding-right:24px}.rds-carousel__carousel-pagination .rds-carousel__carousel-navigation-button-wrapper{display:flex}@media (max-width: 767.999999px){.rds-carousel{padding-left:20px;padding-right:20px}.rds-carousel__carousel-pagination{height:36px}.rds-carousel__carousel-pagination .rds-carousel__carousel-pagination--text{font-size:16px;font-weight:400;line-height:24px;text-transform:none;letter-spacing:.2px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}\n"] }]
        }], propDecorators: { hostClass: [{
                type: HostBinding,
                args: ['class']
            }], autoplay: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], autoplayDelay: [{
                type: Input,
                args: [{
                        transform: (v) => numberAttribute(v, INITIAL_AUTOPLAY_DELAY),
                    }]
            }], showButtons: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], carouselItems: [{
                type: ContentChildren,
                args: [RdsCarouselItemDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLWNvbXBvbmVudHMvc3JjL2xpYi9jYXJvdXNlbC9jYXJvdXNlbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDckUsT0FBTyxFQUVMLGdCQUFnQixFQUNoQix1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFdBQVcsRUFDWCxNQUFNLEVBQ04sS0FBSyxFQUNMLGVBQWUsRUFHZixTQUFTLEVBRVQsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDMUMsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7O0FBRWhFLE1BQU0sc0JBQXNCLEdBQUcsSUFBSSxDQUFDO0FBNkNwQyxNQUFNLE9BQU8sb0JBQW9CO0lBM0NqQztRQThDbUIsUUFBRyxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ2hDLGVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFdkMsOEJBQXlCLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLGNBQVMsR0FBRyxjQUFjLENBQUM7UUFFVCxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBSXpELGtCQUFhLEdBQUcsc0JBQXNCLENBQUM7UUFDQyxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQVMzQyxvQkFBZSxHQUFHLElB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LENBQVUsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxzQkFBc0IsQ0FBQywrQ0FHbkQsZ0JBQWdCLGdIQUVuQix3QkFBd0IsNkVBMUQvQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQ1Q7OzJGQU1VLG9CQUFvQjtrQkEzQ2hDLFNBQVM7K0JBQ0UsY0FBYyxZQUNkOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQW1DVCxtQkFFZ0IsdUJBQXVCLENBQUMsTUFBTSxpQkFDaEMsaUJBQWlCLENBQUMsSUFBSSxZQUMzQixhQUFhOzhCQVVELFNBQVM7c0JBQTlCLFdBQVc7dUJBQUMsT0FBTztnQkFFb0IsUUFBUTtzQkFBL0MsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFJdEMsYUFBYTtzQkFIWixLQUFLO3VCQUFDO3dCQUNMLFNBQVMsRUFBRSxDQUFDLENBQVUsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxzQkFBc0IsQ0FBQztxQkFDdEU7Z0JBRXVDLFdBQVc7c0JBQWxELEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBR3RDLGFBQWE7c0JBRFosZUFBZTt1QkFBQyx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZHNDYXJvdXNlbEl0ZW1EaXJlY3RpdmUgfSBmcm9tICcuL2Nhcm91c2VsLWl0ZW0uZGlyZWN0aXZlJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIERlc3Ryb3lSZWYsXG4gIEhvc3RCaW5kaW5nLFxuICBpbmplY3QsXG4gIElucHV0LFxuICBudW1iZXJBdHRyaWJ1dGUsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBRdWVyeUxpc3QsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJkc0Nhcm91c2VsQWN0aXZlSXRlbUNoYW5nZWRFdmVudCB9IGZyb20gJy4vY2Fyb3VzZWwudHlwZXMnO1xuaW1wb3J0IHsgQnJlYWtwb2ludFV0aWwgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBkZWxheSwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBpbnRlcnZhbCwgU3ViamVjdCwgdGltZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbERlc3Ryb3llZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcblxuY29uc3QgSU5JVElBTF9BVVRPUExBWV9ERUxBWSA9IDIwMDA7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Jkcy1jYXJvdXNlbCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBjbGFzcz1cInJkcy1jYXJvdXNlbF9fY2Fyb3VzZWwtaXRlbXNcIj5cbiAgICAgIDxuZy1jb250ZW50IC8+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJkcy1jYXJvdXNlbF9fY2Fyb3VzZWwtcGFnaW5hdGlvblwiPlxuICAgICAgQGlmIChzaG93QnV0dG9ucykge1xuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3M9XCJyZHMtY2Fyb3VzZWxfX2Nhcm91c2VsLW5hdmlnYXRpb24tYnV0dG9uLXdyYXBwZXIgcmRzLWNhcm91c2VsX19jYXJvdXNlbC1uYXZpZ2F0aW9uLWJ1dHRvbi13cmFwcGVyLS1sZWZ0XCJcbiAgICAgICAgPlxuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIHJkcy1pY29uLWJ1dHRvblxuICAgICAgICAgICAgKGNsaWNrKT1cInByZXYoKVwiXG4gICAgICAgICAgICBbc2l6ZV09XCJfaXNNb2JpbGUoKSA/ICdzJyA6ICdtJ1wiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cImZpbGxlZFwiIGljb249XCJjaGV2cm9uX2xlZnRcIiAvPlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICAgIDxkaXYgY2xhc3M9XCJyZHMtY2Fyb3VzZWxfX2Nhcm91c2VsLXBhZ2luYXRpb24tLXRleHRcIj5cbiAgICAgICAge3sgaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSArIDEgfX0ve3sgY2Fyb3VzZWxJdGVtcy5sZW5ndGggfHwgMCB9fVxuICAgICAgPC9kaXY+XG4gICAgICBAaWYgKHNob3dCdXR0b25zKSB7XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cInJkcy1jYXJvdXNlbF9fY2Fyb3VzZWwtbmF2aWdhdGlvbi1idXR0b24td3JhcHBlciByZHMtY2Fyb3VzZWxfX2Nhcm91c2VsLW5hdmlnYXRpb24tYnV0dG9uLXdyYXBwZXItLXJpZ2h0XCJcbiAgICAgICAgPlxuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIHJkcy1pY29uLWJ1dHRvblxuICAgICAgICAgICAgKGNsaWNrKT1cIm5leHQoKVwiXG4gICAgICAgICAgICBbc2l6ZV09XCJfaXNNb2JpbGUoKSA/ICdzJyA6ICdtJ1wiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPHJkcy1pY29uIG5hbWVzcGFjZT1cImZpbGxlZFwiIGljb249XCJjaGV2cm9uX3JpZ2h0XCIgLz5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICB9XG4gICAgPC9kaXY+XG4gIGAsXG4gIHN0eWxlVXJsczogWycuL2Nhcm91c2VsLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBleHBvcnRBczogJ3Jkc0Nhcm91c2VsJyxcbn0pXG5leHBvcnQgY2xhc3MgUmRzQ2Fyb3VzZWxDb21wb25lbnRcbiAgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlc1xue1xuICBwcml2YXRlIHJlYWRvbmx5IGNkciA9IGluamVjdChDaGFuZ2VEZXRlY3RvclJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcblxuICBwcm90ZWN0ZWQgaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSA9IDA7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGhvc3RDbGFzcyA9ICdyZHMtY2Fyb3VzZWwnO1xuXG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBhdXRvcGxheSA9IGZhbHNlO1xuICBASW5wdXQoe1xuICAgIHRyYW5zZm9ybTogKHY6IHVua25vd24pID0+IG51bWJlckF0dHJpYnV0ZSh2LCBJTklUSUFMX0FVVE9QTEFZX0RFTEFZKSxcbiAgfSlcbiAgYXV0b3BsYXlEZWxheSA9IElOSVRJQUxfQVVUT1BMQVlfREVMQVk7XG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBzaG93QnV0dG9ucyA9IGZhbHNlO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oUmRzQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlKVxuICBjYXJvdXNlbEl0ZW1zOiBRdWVyeUxpc3Q8UmRzQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlPjtcblxuICBnZXQgaW5kZXhPZkxhc3RFbGVtZW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2Fyb3VzZWxJdGVtcy5sZW5ndGggLSAxO1xuICB9XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkZXN0cm95VGltZW91dCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdEFjdGl2ZUl0ZW0oKTtcbiAgICB0aGlzLmNhcm91c2VsSXRlbXMuY2hhbmdlc1xuICAgICAgLnBpcGUoZGVsYXkoMCksIHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLnNlbGVjdEFjdGl2ZUl0ZW0oKSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXNbJ2F1dG9wbGF5J10gfHwgY2hhbmdlc1snYXV0b3BsYXlEZWxheSddKSB7XG4gICAgICB0aGlzLmRlZmluZUF1dG9wbGF5SW50ZXJ2YWwoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRlc3Ryb3lUaW1lb3V0JC5uZXh0KCk7XG4gICAgdGhpcy5kZXN0cm95VGltZW91dCQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByZXYoKTogdm9pZCB7XG4gICAgdGhpcy5oaWRlQ3VycmVudFZpc2libGVDYXJvdXNlbEl0ZW0oKTtcblxuICAgIGxldCBpbmRleE9mTmV3Q2Fyb3VzZWxJdGVtVG9TaG93ID0gdGhpcy5pbmRleE9mQWN0aXZlQ2Fyb3VzZWxJdGVtIC0gMTtcblxuICAgIGlmICh0aGlzLmluZGV4T2ZBY3RpdmVDYXJvdXNlbEl0ZW0gPT09IDApIHtcbiAgICAgIGluZGV4T2ZOZXdDYXJvdXNlbEl0ZW1Ub1Nob3cgPSB0aGlzLmluZGV4T2ZMYXN0RWxlbWVudDtcbiAgICB9XG5cbiAgICB0aGlzLmluZGV4T2ZBY3RpdmVDYXJvdXNlbEl0ZW0gPSBpbmRleE9mTmV3Q2Fyb3VzZWxJdGVtVG9TaG93O1xuXG4gICAgdGhpcy5zaG93Q2Fyb3VzZWxJdGVtTWF0Y2hlZFdpdGhJbmRleE9mQWN0aXZlKCk7XG4gICAgdGhpcy5kZWZpbmVBdXRvcGxheUludGVydmFsKCk7XG4gIH1cblxuICBuZXh0KCk6IHZvaWQge1xuICAgIHRoaXMuaGlkZUN1cnJlbnRWaXNpYmxlQ2Fyb3VzZWxJdGVtKCk7XG5cbiAgICBsZXQgaW5kZXhPZk5ld0Nhcm91c2VsSXRlbVRvU2hvdyA9IHRoaXMuaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSArIDE7XG5cbiAgICBpZiAodGhpcy5pbmRleE9mQWN0aXZlQ2Fyb3VzZWxJdGVtID09PSB0aGlzLmluZGV4T2ZMYXN0RWxlbWVudCkge1xuICAgICAgaW5kZXhPZk5ld0Nhcm91c2VsSXRlbVRvU2hvdyA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5pbmRleE9mQWN0aXZlQ2Fyb3VzZWxJdGVtID0gaW5kZXhPZk5ld0Nhcm91c2VsSXRlbVRvU2hvdztcblxuICAgIHRoaXMuc2hvd0Nhcm91c2VsSXRlbU1hdGNoZWRXaXRoSW5kZXhPZkFjdGl2ZSgpO1xuICAgIHRoaXMuZGVmaW5lQXV0b3BsYXlJbnRlcnZhbCgpO1xuICB9XG5cbiAgX2NoYW5nZUFjdGl2ZSh7IGluZGV4IH06IFJkc0Nhcm91c2VsQWN0aXZlSXRlbUNoYW5nZWRFdmVudCk6IHZvaWQge1xuICAgIHRoaXMuaGlkZUN1cnJlbnRWaXNpYmxlQ2Fyb3VzZWxJdGVtKCk7XG4gICAgdGhpcy5pbmRleE9mQWN0aXZlQ2Fyb3VzZWxJdGVtID0gaW5kZXg7XG4gICAgdGhpcy5zaG93Q2Fyb3VzZWxJdGVtTWF0Y2hlZFdpdGhJbmRleE9mQWN0aXZlKCk7XG4gIH1cblxuICBfaXNNb2JpbGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJyZWFrcG9pbnRVdGlsLmlzTW9iaWxlKCk7XG4gIH1cblxuICBwcml2YXRlIGRlZmluZUF1dG9wbGF5SW50ZXJ2YWwoKTogdm9pZCB7XG4gICAgdGhpcy5kZXN0cm95VGltZW91dCQubmV4dCgpO1xuXG4gICAgaWYgKHRoaXMuYXV0b3BsYXkpIHtcbiAgICAgIGludGVydmFsKHRoaXMuYXV0b3BsYXlEZWxheSlcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGFwKCgpID0+IHRoaXMubmV4dCgpKSxcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95VGltZW91dCQpLFxuICAgICAgICAgIHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpLFxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNob3dDYXJvdXNlbEl0ZW1NYXRjaGVkV2l0aEluZGV4T2ZBY3RpdmUoKTogdm9pZCB7XG4gICAgY29uc3QgY2Fyb3VzZWxJdGVtVG9TaG93ID0gdGhpcy5jYXJvdXNlbEl0ZW1zLmdldChcbiAgICAgIHRoaXMuaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSxcbiAgICApO1xuXG4gICAgaWYgKGNhcm91c2VsSXRlbVRvU2hvdykge1xuICAgICAgY2Fyb3VzZWxJdGVtVG9TaG93Ll9zaG93KCk7XG4gICAgICB0aW1lcigwKVxuICAgICAgICAucGlwZSh0YXAoKCkgPT4gdGhpcy5jZHIubWFya0ZvckNoZWNrKCkpKVxuICAgICAgICAuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoaWRlQ3VycmVudFZpc2libGVDYXJvdXNlbEl0ZW0oKTogdm9pZCB7XG4gICAgY29uc3QgY2Fyb3VzZWxJdGVtVG9IaWRlID0gdGhpcy5jYXJvdXNlbEl0ZW1zLmdldChcbiAgICAgIHRoaXMuaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSxcbiAgICApO1xuXG4gICAgaWYgKGNhcm91c2VsSXRlbVRvSGlkZSkge1xuICAgICAgY2Fyb3VzZWxJdGVtVG9IaWRlLl9oaWRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RBY3RpdmVJdGVtKCk6IHZvaWQge1xuICAgIHRoaXMuaW5kZXhPZkFjdGl2ZUNhcm91c2VsSXRlbSA9IE1hdGgubWF4KFxuICAgICAgdGhpcy5jYXJvdXNlbEl0ZW1zLnRvQXJyYXkoKS5maW5kSW5kZXgoKGl0ZW0pID0+IGl0ZW0uaXNTaG93bigpKSxcbiAgICAgIDAsXG4gICAgKTtcbiAgICB0aGlzLmNhcm91c2VsSXRlbXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChpbmRleCAhPT0gdGhpcy5pbmRleE9mQWN0aXZlQ2Fyb3VzZWxJdGVtICYmIGl0ZW0uaXNTaG93bigpKSB7XG4gICAgICAgIGl0ZW0uX2hpZGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnNob3dDYXJvdXNlbEl0ZW1NYXRjaGVkV2l0aEluZGV4T2ZBY3RpdmUoKTtcbiAgICB0aGlzLmRlZmluZUF1dG9wbGF5SW50ZXJ2YWwoKTtcbiAgfVxufVxuIl19