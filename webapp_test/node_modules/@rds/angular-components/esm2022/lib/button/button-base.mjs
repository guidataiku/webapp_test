import { booleanAttribute, Component, ContentChildren, DestroyRef, ElementRef, EventEmitter, HostBinding, HostListener, inject, Input, Output, QueryList, } from '@angular/core';
import { FocusMonitor } from '@angular/cdk/a11y';
import { RdsIconComponent } from '../icons';
import { throwInvalidSizeError } from '../core/errors';
import { ContentObserver } from '@angular/cdk/observers';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
export class RdsButtonBaseComponent {
    constructor() {
        this.elementRef = inject(ElementRef);
        this.focusMonitor = inject(FocusMonitor);
        this.destroyRef = inject(DestroyRef);
        this.contentObserver = inject(ContentObserver);
        this.buttonHostAttributesToClassMapper = {};
        this._defaultSize = 'm';
        this._size = this._defaultSize;
        this._hasIcon = false;
        this._hasFirstIcon = false;
        this._hasLastIcon = false;
        this._hasOnlyIcon = false;
        this._pressed = false;
        this.toggle = false;
        this.pressedChange = new EventEmitter();
    }
    get size() {
        return this._size;
    }
    set size(size) {
        if (size !== 's' && size !== 'm' && size !== 'l') {
            throwInvalidSizeError(this, size);
        }
        this._size = size;
    }
    set pressed(isPressed) {
        const value = this.pressed;
        this._pressed = booleanAttribute(isPressed);
        if (this.toggle && value !== this._pressed) {
            this.pressedChange.next(this._pressed);
        }
    }
    get pressed() {
        return this.toggle && this._pressed;
    }
    get attrToggle() {
        return this.toggle ? this.pressed : null;
    }
    get disabled() {
        return !!this.elementRef.nativeElement.getAttribute('disabled');
    }
    get buttonClasses() {
        const classesMappedFromHostAttributes = Object.entries(this.buttonHostAttributesToClassMapper)
            .filter(([hostAttribute]) => this.hostElement.hasAttribute(hostAttribute))
            .map(([, buttonClass]) => buttonClass);
        const additionalClasses = [];
        if (this._hasFirstIcon) {
            additionalClasses.push('rds-button--with-left-icon');
        }
        if (this._hasLastIcon) {
            additionalClasses.push('rds-button--with-right-icon');
        }
        if (this._hasOnlyIcon) {
            additionalClasses.push('rds-button--with-only-icon');
        }
        return [
            'rds-button',
            `rds-button-${this.size}`,
            ...classesMappedFromHostAttributes,
            ...additionalClasses,
        ];
    }
    get hasIcon() {
        return this._hasIcon;
    }
    ngAfterContentInit() {
        this.checkIcons();
        this.icons.changes.subscribe(() => this.checkIcons());
    }
    ngAfterViewInit() {
        this.focusMonitor.monitor(this.elementRef, true);
        this.contentObserver
            .observe(this.elementRef)
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this.onContentChange());
    }
    ngOnDestroy() {
        this.focusMonitor.stopMonitoring(this.elementRef);
    }
    changeToggle() {
        if (this.toggle && !this.disabled) {
            this.pressed = !this.pressed;
        }
    }
    focus(origin = 'program', options) {
        this.focusMonitor.focusVia(this.hostElement, origin, options);
    }
    get hostElement() {
        return this.elementRef.nativeElement;
    }
    checkIcons() {
        this._hasIcon = this.icons.length > 0;
        if (this.hasIcon) {
            const btnContent = this.elementRef.nativeElement;
            const firstChild = this._getChild('first');
            const lastChild = this._getChild('last');
            if (firstChild && firstChild.nodeName) {
                this._hasFirstIcon = firstChild.nodeName.toUpperCase() === 'RDS-ICON';
            }
            else {
                this._hasFirstIcon = false;
            }
            if (lastChild && lastChild.nodeName) {
                this._hasLastIcon =
                    btnContent.lastChild?.nodeName.toUpperCase() === 'RDS-ICON';
            }
            else {
                this._hasLastIcon = false;
            }
            if (firstChild && firstChild === lastChild) {
                this._hasOnlyIcon = true;
                this._hasLastIcon = false;
                this._hasFirstIcon = false;
            }
            else {
                this._hasOnlyIcon = false;
            }
        }
        else {
            this._hasLastIcon = false;
            this._hasLastIcon = false;
            this._hasOnlyIcon = false;
        }
    }
    _getButtonClassName() {
        return this.constructor.name;
    }
    onContentChange() {
        this.checkIcons();
    }
    _getChild(firstOrLast) {
        let currentChild = firstOrLast === 'first'
            ? this.elementRef.nativeElement.firstChild
            : this.elementRef.nativeElement.lastChild;
        while (!currentChild ||
            currentChild.nodeName.toUpperCase() === '#COMMENT') {
            if (!currentChild) {
                return null;
            }
            currentChild =
                firstOrLast === 'first'
                    ? currentChild.nextSibling
                    : currentChild.previousSibling;
        }
        return currentChild;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsButtonBaseComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "16.1.0", version: "17.3.1", type: RdsButtonBaseComponent, selector: "ng-component", inputs: { size: "size", pressed: "pressed", toggle: ["toggle", "toggle", booleanAttribute] }, outputs: { pressedChange: "pressedChange" }, host: { listeners: { "click": "changeToggle()" }, properties: { "class.rds-button-active": "this.pressed", "attr.aria-pressed": "this.attrToggle", "class": "this.buttonClasses", "class.rds-button--with-icon": "this.hasIcon" } }, queries: [{ propertyName: "icons", predicate: RdsIconComponent }], ngImport: i0, template: '', isInline: true }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsButtonBaseComponent, decorators: [{
            type: Component,
            args: [{
                    template: '',
                }]
        }], propDecorators: { size: [{
                type: Input
            }], pressed: [{
                type: HostBinding,
                args: ['class.rds-button-active']
            }, {
                type: Input
            }], attrToggle: [{
                type: HostBinding,
                args: ['attr.aria-pressed']
            }], toggle: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], buttonClasses: [{
                type: HostBinding,
                args: ['class']
            }], hasIcon: [{
                type: HostBinding,
                args: ['class.rds-button--with-icon']
            }], icons: [{
                type: ContentChildren,
                args: [RdsIconComponent]
            }], pressedChange: [{
                type: Output
            }], changeToggle: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL2J1dHRvbi9idXR0b24tYmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsZ0JBQWdCLEVBQ2hCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFtQixZQUFZLEVBQWUsTUFBTSxtQkFBbUIsQ0FBQztBQUMvRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDNUMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRXpELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDOztBQU9oRSxNQUFNLE9BQU8sc0JBQXNCO0lBSG5DO1FBTXFCLGVBQVUsR0FDM0IsTUFBTSxDQUFnQyxVQUFVLENBQUMsQ0FBQztRQUNqQyxpQkFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNwQyxlQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hDLG9CQUFlLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBRW5ELHNDQUFpQyxHQUE4QixFQUFFLENBQUM7UUFDbEUsaUJBQVksR0FBa0IsR0FBRyxDQUFDO1FBRWxDLFVBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzFCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFDdEIsaUJBQVksR0FBRyxLQUFL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TTtnQkFxQlAsWUFBWTtzQkFEWCxZQUFZO3VCQUFDLE9BQU8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBBZnRlclZpZXdJbml0LFxuICBib29sZWFuQXR0cmlidXRlLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRGVzdHJveVJlZixcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBpbmplY3QsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvY3VzYWJsZU9wdGlvbiwgRm9jdXNNb25pdG9yLCBGb2N1c09yaWdpbiB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IFJkc0ljb25Db21wb25lbnQgfSBmcm9tICcuLi9pY29ucyc7XG5pbXBvcnQgeyB0aHJvd0ludmFsaWRTaXplRXJyb3IgfSBmcm9tICcuLi9jb3JlL2Vycm9ycyc7XG5pbXBvcnQgeyBDb250ZW50T2JzZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvb2JzZXJ2ZXJzJztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyB0YWtlVW50aWxEZXN0cm95ZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5cbmV4cG9ydCB0eXBlIFJkc0J1dHRvblNpemUgPSAncycgfCAnbScgfCAnbCc7XG5cbkBDb21wb25lbnQoe1xuICB0ZW1wbGF0ZTogJycsXG59KVxuZXhwb3J0IGNsYXNzIFJkc0J1dHRvbkJhc2VDb21wb25lbnRcbiAgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIEZvY3VzYWJsZU9wdGlvblxue1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZWxlbWVudFJlZiA9XG4gICAgaW5qZWN0PEVsZW1lbnRSZWY8SFRNTEJ1dHRvbkVsZW1lbnQ+PihFbGVtZW50UmVmKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGZvY3VzTW9uaXRvciA9IGluamVjdChGb2N1c01vbml0b3IpO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGNvbnRlbnRPYnNlcnZlciA9IGluamVjdChDb250ZW50T2JzZXJ2ZXIpO1xuXG4gIHByb3RlY3RlZCBidXR0b25Ib3N0QXR0cmlidXRlc1RvQ2xhc3NNYXBwZXI6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgcHJvdGVjdGVkIF9kZWZhdWx0U2l6ZTogUmRzQnV0dG9uU2l6ZSA9ICdtJztcblxuICBwcm90ZWN0ZWQgX3NpemUgPSB0aGlzLl9kZWZhdWx0U2l6ZTtcbiAgcHJvdGVjdGVkIF9oYXNJY29uID0gZmFsc2U7XG4gIHByb3RlY3RlZCBfaGFzRmlyc3RJY29uID0gZmFsc2U7XG4gIHByb3RlY3RlZCBfaGFzTGFzdEljb24gPSBmYWxzZTtcbiAgcHJvdGVjdGVkIF9oYXNPbmx5SWNvbiA9IGZhbHNlO1xuICBwcm90ZWN0ZWQgX3ByZXNzZWQgPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBnZXQgc2l6ZSgpOiBSZHNCdXR0b25TaXplIHtcbiAgICByZXR1cm4gdGhpcy5fc2l6ZTtcbiAgfVxuXG4gIHNldCBzaXplKHNpemU6IFJkc0J1dHRvblNpemUpIHtcbiAgICBpZiAoc2l6ZSAhPT0gJ3MnICYmIHNpemUgIT09ICdtJyAmJiBzaXplICE9PSAnbCcpIHtcbiAgICAgIHRocm93SW52YWxpZFNpemVFcnJvcih0aGlzLCBzaXplKTtcbiAgICB9XG5cbiAgICB0aGlzLl9zaXplID0gc2l6ZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MucmRzLWJ1dHRvbi1hY3RpdmUnKVxuICBASW5wdXQoKVxuICBzZXQgcHJlc3NlZChpc1ByZXNzZWQ6IEJvb2xlYW5JbnB1dCkge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5wcmVzc2VkO1xuICAgIHRoaXMuX3ByZXNzZWQgPSBib29sZWFuQXR0cmlidXRlKGlzUHJlc3NlZCk7XG5cbiAgICBpZiAodGhpcy50b2dnbGUgJiYgdmFsdWUgIT09IHRoaXMuX3ByZXNzZWQpIHtcbiAgICAgIHRoaXMucHJlc3NlZENoYW5nZS5uZXh0KHRoaXMuX3ByZXNzZWQpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBwcmVzc2VkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRvZ2dsZSAmJiB0aGlzLl9wcmVzc2VkO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtcHJlc3NlZCcpXG4gIGdldCBhdHRyVG9nZ2xlKCk6IGJvb2xlYW4gfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50b2dnbGUgPyB0aGlzLnByZXNzZWQgOiBudWxsO1xuICB9XG5cbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG4gIHRvZ2dsZSA9IGZhbHNlO1xuXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgZ2V0IGJ1dHRvbkNsYXNzZXMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNsYXNzZXNNYXBwZWRGcm9tSG9zdEF0dHJpYnV0ZXMgPSBPYmplY3QuZW50cmllcyhcbiAgICAgIHRoaXMuYnV0dG9uSG9zdEF0dHJpYnV0ZXNUb0NsYXNzTWFwcGVyLFxuICAgIClcbiAgICAgIC5maWx0ZXIoKFtob3N0QXR0cmlidXRlXSkgPT4gdGhpcy5ob3N0RWxlbWVudC5oYXNBdHRyaWJ1dGUoaG9zdEF0dHJpYnV0ZSkpXG4gICAgICAubWFwKChbLCBidXR0b25DbGFzc10pID0+IGJ1dHRvbkNsYXNzKTtcblxuICAgIGNvbnN0IGFkZGl0aW9uYWxDbGFzc2VzID0gW107XG5cbiAgICBpZiAodGhpcy5faGFzRmlyc3RJY29uKSB7XG4gICAgICBhZGRpdGlvbmFsQ2xhc3Nlcy5wdXNoKCdyZHMtYnV0dG9uLS13aXRoLWxlZnQtaWNvbicpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9oYXNMYXN0SWNvbikge1xuICAgICAgYWRkaXRpb25hbENsYXNzZXMucHVzaCgncmRzLWJ1dHRvbi0td2l0aC1yaWdodC1pY29uJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2hhc09ubHlJY29uKSB7XG4gICAgICBhZGRpdGlvbmFsQ2xhc3Nlcy5wdXNoKCdyZHMtYnV0dG9uLS13aXRoLW9ubHktaWNvbicpO1xuICAgIH1cblxuICAgIHJldHVybiBbXG4gICAgICAncmRzLWJ1dHRvbicsXG4gICAgICBgcmRzLWJ1dHRvbi0ke3RoaXMuc2l6ZX1gLFxuICAgICAgLi4uY2xhc3Nlc01hcHBlZEZyb21Ib3N0QXR0cmlidXRlcyxcbiAgICAgIC4uLmFkZGl0aW9uYWxDbGFzc2VzLFxuICAgIF07XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnJkcy1idXR0b24tLXdpdGgtaWNvbicpIGdldCBoYXNJY29uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9oYXNJY29uO1xuICB9XG5cbiAgQENvbnRlbnRDaGlsZHJlbihSZHNJY29uQ29tcG9uZW50KSBpY29uczogUXVlcnlMaXN0PFJkc0ljb25Db21wb25lbnQ+O1xuXG4gIEBPdXRwdXQoKVxuICBwcmVzc2VkQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNoZWNrSWNvbnMoKTtcbiAgICB0aGlzLmljb25zLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHRoaXMuY2hlY2tJY29ucygpKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmZvY3VzTW9uaXRvci5tb25pdG9yKHRoaXMuZWxlbWVudFJlZiwgdHJ1ZSk7XG4gICAgdGhpcy5jb250ZW50T2JzZXJ2ZXJcbiAgICAgIC5vYnNlcnZlKHRoaXMuZWxlbWVudFJlZilcbiAgICAgIC5waXBlKHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uQ29udGVudENoYW5nZSgpKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuZWxlbWVudFJlZik7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdjbGljaycpXG4gIGNoYW5nZVRvZ2dsZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy50b2dnbGUgJiYgIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMucHJlc3NlZCA9ICF0aGlzLnByZXNzZWQ7XG4gICAgfVxuICB9XG5cbiAgZm9jdXMob3JpZ2luOiBGb2N1c09yaWdpbiA9ICdwcm9ncmFtJywgb3B0aW9ucz86IEZvY3VzT3B0aW9ucyk6IHZvaWQge1xuICAgIHRoaXMuZm9jdXNNb25pdG9yLmZvY3VzVmlhKHRoaXMuaG9zdEVsZW1lbnQsIG9yaWdpbiwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXQgaG9zdEVsZW1lbnQoKTogSFRNTEJ1dHRvbkVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgfVxuXG4gIHByb3RlY3RlZCBjaGVja0ljb25zKCk6IHZvaWQge1xuICAgIHRoaXMuX2hhc0ljb24gPSB0aGlzLmljb25zLmxlbmd0aCA+IDA7XG5cbiAgICBpZiAodGhpcy5oYXNJY29uKSB7XG4gICAgICBjb25zdCBidG5Db250ZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBjb25zdCBmaXJzdENoaWxkID0gdGhpcy5fZ2V0Q2hpbGQoJ2ZpcnN0Jyk7XG4gICAgICBjb25zdCBsYXN0Q2hpbGQgPSB0aGlzLl9nZXRDaGlsZCgnbGFzdCcpO1xuXG4gICAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLm5vZGVOYW1lKSB7XG4gICAgICAgIHRoaXMuX2hhc0ZpcnN0SWNvbiA9IGZpcnN0Q2hpbGQubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PT0gJ1JEUy1JQ09OJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2hhc0ZpcnN0SWNvbiA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobGFzdENoaWxkICYmIGxhc3RDaGlsZC5ub2RlTmFtZSkge1xuICAgICAgICB0aGlzLl9oYXNMYXN0SWNvbiA9XG4gICAgICAgICAgYnRuQ29udGVudC5sYXN0Q2hpbGQ/Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdSRFMtSUNPTic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9oYXNMYXN0SWNvbiA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkID09PSBsYXN0Q2hpbGQpIHtcbiAgICAgICAgdGhpcy5faGFzT25seUljb24gPSB0cnVlO1xuICAgICAgICB0aGlzLl9oYXNMYXN0SWNvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9oYXNGaXJzdEljb24gPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2hhc09ubHlJY29uID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hhc0xhc3RJY29uID0gZmFsc2U7XG4gICAgICB0aGlzLl9oYXNMYXN0SWNvbiA9IGZhbHNlO1xuICAgICAgdGhpcy5faGFzT25seUljb24gPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2dldEJ1dHRvbkNsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLm5hbWU7XG4gIH1cblxuICBwcm90ZWN0ZWQgb25Db250ZW50Q2hhbmdlKCk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tJY29ucygpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0Q2hpbGQoZmlyc3RPckxhc3Q6ICdmaXJzdCcgfCAnbGFzdCcpOiBDaGlsZE5vZGUgfCBudWxsIHtcbiAgICBsZXQgY3VycmVudENoaWxkID1cbiAgICAgIGZpcnN0T3JMYXN0ID09PSAnZmlyc3QnXG4gICAgICAgID8gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZmlyc3RDaGlsZFxuICAgICAgICA6IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxhc3RDaGlsZDtcblxuICAgIHdoaWxlIChcbiAgICAgICFjdXJyZW50Q2hpbGQgfHxcbiAgICAgIGN1cnJlbnRDaGlsZC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnI0NPTU1FTlQnXG4gICAgKSB7XG4gICAgICBpZiAoIWN1cnJlbnRDaGlsZCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY3VycmVudENoaWxkID1cbiAgICAgICAgZmlyc3RPckxhc3QgPT09ICdmaXJzdCdcbiAgICAgICAgICA/IGN1cnJlbnRDaGlsZC5uZXh0U2libGluZ1xuICAgICAgICAgIDogY3VycmVudENoaWxkLnByZXZpb3VzU2libGluZztcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudENoaWxkO1xuICB9XG59XG4iXX0=