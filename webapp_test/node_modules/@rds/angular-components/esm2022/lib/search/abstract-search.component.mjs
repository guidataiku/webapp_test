import { booleanAttribute, ChangeDetectorRef, DestroyRef, Directive, ElementRef, EventEmitter, HostBinding, inject, Input, Output, ViewChild, } from '@angular/core';
import { BehaviorSubject, EMPTY, noop, of, skip } from 'rxjs';
import { RdsSearchIntl } from './search.intl';
import { FocusMonitor, } from '@angular/cdk/a11y';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i0 from "@angular/core";
export class RdsAbstractSearchComponent {
    constructor() {
        this.destroyRef = inject(DestroyRef);
        this.intl = inject(RdsSearchIntl);
        this.cdr = inject(ChangeDetectorRef);
        this.elementRef = inject(ElementRef);
        this.focusMonitor = inject(FocusMonitor);
        this.disabled = false;
        this.includeButton = false;
        this.autoSearch = false;
        this.size = 'l';
        this._lastEmitted = new BehaviorSubject({
            query: '',
            trigger: 'input',
        });
        this.search = this._lastEmitted.pipe(skip(1));
        this.clear = new EventEmitter();
        this.role = 'search';
        this._onChange = noop;
        this._onTouched = noop;
    }
    get value() {
        return this._value;
    }
    ngOnInit() {
        this.setIntlValues();
        this.setNewValue(this.intl.emptyValue).subscribe();
        this.intl.changes
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => {
            this.setIntlValues();
            this.cdr.markForCheck();
        });
    }
    ngOnChanges(changes) {
        if (changes['placeholder'] ||
            changes['buttonText'] ||
            changes['emptyValue'] ||
            changes['ariaClearLabel'] ||
            changes['ariaInputLabel']) {
            this.setIntlValues();
        }
    }
    ngAfterViewInit() {
        this.focusMonitor
            .monitor(this.elementRef.nativeElement)
            .pipe(takeUntilDestroyed(this.destroyRef))
            .subscribe(() => this._onTouched());
    }
    ngOnDestroy() {
        this.focusMonitor.stopMonitoring(this.elementRef.nativeElement);
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    setDisabledState(isDisabled) {
        if (this.disabled !== isDisabled) {
            this.disabled = isDisabled;
            this.cdr.markForCheck();
        }
    }
    writeValue(value) {
        this.setNewValue(value).subscribe(() => this.emitValue('form'));
    }
    onInput(event) {
        this.setNewValue(event.target.value).subscribe(() => this.emitValue('input', event));
    }
    focus(origin = 'program', options) {
        this.focusMonitor.focusVia(this.elementRef.nativeElement, origin, options);
    }
    isDirtyValue() {
        return this._value !== this.intl.emptyValue;
    }
    resetInput(event) {
        if (!this.disabled && this.isDirtyValue()) {
            this.setNewValue(this.intl.emptyValue).subscribe();
            this.emitValue('reset', event);
            this.clear.emit();
            this.searchInput.nativeElement.focus();
        }
    }
    emitValue(trigger, event) {
        if (this._lastEmitted.getValue().query !== this._value) {
            this._lastEmitted.next({ query: this._value, trigger, event });
            this._onChange(this._value);
        }
    }
    setIntlValues() {
        this.placeholder =
            this.placeholder && this.placeholder !== ''
                ? this.placeholder
                : this.intl.searchInputPlaceholder;
        this.buttonText =
            this.buttonText && this.buttonText !== ''
                ? this.buttonText
                : this.intl.searchButtonText;
        this.emptyValue = this.emptyValue || this.intl.emptyValue;
        this.ariaInputLabel =
            this.ariaInputLabel && this.ariaInputLabel !== ''
                ? this.ariaInputLabel
                : this.intl.ariaInputLabel;
        this.ariaClearLabel =
            this.ariaClearLabel && this.ariaClearLabel !== ''
                ? this.ariaClearLabel
                : this.intl.ariaClearLabel;
    }
    setNewValue(value) {
        if (value !== null &&
            value !== undefined &&
            this._value !== String(value)) {
            this._value = String(value);
            this.cdr.markForCheck();
            if (this.autoSearch) {
                return of(void 0);
            }
        }
        return EMPTY;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAbstractSearchComponent, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "16.1.0", version: "17.3.1", type: RdsAbstractSearchComponent, inputs: { placeholder: "placeholder", buttonText: "buttonText", emptyValue: "emptyValue", ariaClearLabel: "ariaClearLabel", disabled: ["disabled", "disabled", booleanAttribute], includeButton: ["includeButton", "includeButton", booleanAttribute], autoSearch: ["autoSearch", "autoSearch", booleanAttribute], size: "size", ariaInputLabel: "ariaInputLabel" }, outputs: { search: "search", clear: "clear" }, host: { properties: { "attr.role": "this.role", "attr.aria-label": "this.ariaInputLabel" } }, viewQueries: [{ propertyName: "searchInput", first: true, predicate: ["searchInput"], descendants: true }], usesOnChanges: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsAbstractSearchComponent, decorators: [{
            type: Directive
        }], propDecorators: { placeholder: [{
                type: Input
            }], buttonText: [{
                type: Input
            }], emptyValue: [{
                type: Input
            }], ariaClearLabel: [{
                type: Input
            }], disabled: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], includeButton: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], autoSearch: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], size: [{
                type: Input
            }], search: [{
                type: Output
            }], clear: [{
                type: Output
            }], searchInput: [{
                type: ViewChild,
                args: ['searchInput']
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }], ariaInputLabel: [{
                type: Input
            }, {
                type: HostBinding,
                args: ['attr.aria-label']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3Qtc2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1jb21wb25lbnRzL3NyYy9saWIvc2VhcmNoL2Fic3RyYWN0LXNlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxNQUFNLEVBQ04sS0FBSyxFQUlMLE1BQU0sRUFFTixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU5QyxPQUFPLEVBRUwsWUFBWSxHQUdiLE1BQU0sbUJBQW1CLENBQUM7QUFNM0IsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7O0FBR2hFLE1BQU0sT0FBZ0IsMEJBQTBCO0lBRGhEO1FBVXFCLGVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEMsU0FBSSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM3QixRQUFHLEdBQUcsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDaEMsZUFBVSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNoQyxpQkFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQU1mLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFDdEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUczRCxTQUFJLEdBQWtCLEdBQUcsQ0FBQztRQU9QLGlCQUFZ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LENBQUMsQ0FBQztZQUNwQixDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQzs4R0ExS21CLDBCQUEwQjtrR0FBMUIsMEJBQTBCLGlLQW1CMUIsZ0JBQWdCLHFEQUNoQixnQkFBZ0IsNENBQ2hCLGdCQUFnQjs7MkZBckJoQiwwQkFBMEI7a0JBRC9DLFNBQVM7OEJBZ0JDLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ2tDLFFBQVE7c0JBQS9DLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBQ0UsYUFBYTtzQkFBcEQsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFDRSxVQUFVO3NCQUFqRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUd0QyxJQUFJO3NCQURILEtBQUs7Z0JBY04sTUFBTTtzQkFETCxNQUFNO2dCQUlQLEtBQUs7c0JBREosTUFBTTtnQkFHbUIsV0FBVztzQkFBcEMsU0FBUzt1QkFBQyxhQUFhO2dCQUVFLElBQUk7c0JBQTdCLFdBQVc7dUJBQUMsV0FBVztnQkFHeEIsY0FBYztzQkFGYixLQUFLOztzQkFDTCxXQUFXO3VCQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIGJvb2xlYW5BdHRyaWJ1dGUsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBEZXN0cm95UmVmLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIGluamVjdCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgRU1QVFksIG5vb3AsIE9ic2VydmFibGUsIG9mLCBza2lwIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSZHNTZWFyY2hJbnRsIH0gZnJvbSAnLi9zZWFyY2guaW50bCc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7XG4gIEZvY3VzYWJsZU9wdGlvbixcbiAgRm9jdXNNb25pdG9yLFxuICBGb2N1c09wdGlvbnMsXG4gIEZvY3VzT3JpZ2luLFxufSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuICBSZHNTZWFyY2hFdmVudCxcbiAgUmRzU2VhcmNoRXZlbnRUcmlnZ2VyLFxuICBSZHNTZWFyY2hTaXplLFxufSBmcm9tICcuL3NlYXJjaC50eXBlcyc7XG5pbXBvcnQgeyB0YWtlVW50aWxEZXN0cm95ZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFJkc0Fic3RyYWN0U2VhcmNoQ29tcG9uZW50XG4gIGltcGxlbWVudHNcbiAgICBPbkluaXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE9uRGVzdHJveSxcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICAgIEZvY3VzYWJsZU9wdGlvblxue1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGludGwgPSBpbmplY3QoUmRzU2VhcmNoSW50bCk7XG4gIHByb3RlY3RlZCByZWFkb25seSBjZHIgPSBpbmplY3QoQ2hhbmdlRGV0ZWN0b3JSZWYpO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZWxlbWVudFJlZiA9IGluamVjdChFbGVtZW50UmVmKTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGZvY3VzTW9uaXRvciA9IGluamVjdChGb2N1c01vbml0b3IpO1xuXG4gIEBJbnB1dCgpIHBsYWNlaG9sZGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGJ1dHRvblRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgZW1wdHlWYWx1ZTogc3RyaW5nO1xuICBASW5wdXQoKSBhcmlhQ2xlYXJMYWJlbDogc3RyaW5nO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSkgZGlzYWJsZWQgPSBmYWxzZTtcbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGluY2x1ZGVCdXR0b24gPSBmYWxzZTtcbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGF1dG9TZWFyY2ggPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBzaXplOiBSZHNTZWFyY2hTaXplID0gJ2wnO1xuXG4gIGdldCB2YWx1ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBfdmFsdWU6IHN0cmluZztcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IF9sYXN0RW1pdHRlZCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8UmRzU2VhcmNoRXZlbnQ+KHtcbiAgICBxdWVyeTogJycsXG4gICAgdHJpZ2dlcjogJ2lucHV0JyxcbiAgfSk7XG5cbiAgQE91dHB1dCgpXG4gIHNlYXJjaCA9IHRoaXMuX2xhc3RFbWl0dGVkLnBpcGUoc2tpcCgxKSk7XG5cbiAgQE91dHB1dCgpXG4gIGNsZWFyID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3NlYXJjaElucHV0Jykgc2VhcmNoSW5wdXQ6IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD47XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnJvbGUnKSByb2xlID0gJ3NlYXJjaCc7XG4gIEBJbnB1dCgpXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWxhYmVsJylcbiAgYXJpYUlucHV0TGFiZWw6IHN0cmluZztcblxuICBfb25DaGFuZ2U6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkID0gbm9vcDtcbiAgX29uVG91Y2hlZDogKCkgPT4gdm9pZCA9IG5vb3A7XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRJbnRsVmFsdWVzKCk7XG4gICAgdGhpcy5zZXROZXdWYWx1ZSh0aGlzLmludGwuZW1wdHlWYWx1ZSkuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5pbnRsLmNoYW5nZXNcbiAgICAgIC5waXBlKHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLmRlc3Ryb3lSZWYpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0SW50bFZhbHVlcygpO1xuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChcbiAgICAgIGNoYW5nZXNbJ3BsYWNlaG9sZGVyJ10gfHxcbiAgICAgIGNoYW5nZXNbJ2J1dHRvblRleHQnXSB8fFxuICAgICAgY2hhbmdlc1snZW1wdHlWYWx1ZSddIHx8XG4gICAgICBjaGFuZ2VzWydhcmlhQ2xlYXJMYWJlbCddIHx8XG4gICAgICBjaGFuZ2VzWydhcmlhSW5wdXRMYWJlbCddXG4gICAgKSB7XG4gICAgICB0aGlzLnNldEludGxWYWx1ZXMoKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgdGhpcy5mb2N1c01vbml0b3JcbiAgICAgIC5tb25pdG9yKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KVxuICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuX29uVG91Y2hlZCgpKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZm9jdXNNb25pdG9yLnN0b3BNb25pdG9yaW5nKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5fb25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5fb25Ub3VjaGVkID0gZm47XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCAhPT0gaXNEaXNhYmxlZCkge1xuICAgICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnNldE5ld1ZhbHVlKHZhbHVlKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5lbWl0VmFsdWUoJ2Zvcm0nKSk7XG4gIH1cblxuICBvbklucHV0KGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIHRoaXMuc2V0TmV3VmFsdWUoKGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSkuc3Vic2NyaWJlKCgpID0+XG4gICAgICB0aGlzLmVtaXRWYWx1ZSgnaW5wdXQnLCBldmVudCksXG4gICAgKTtcbiAgfVxuXG4gIGZvY3VzKG9yaWdpbjogRm9jdXNPcmlnaW4gPSAncHJvZ3JhbScsIG9wdGlvbnM/OiBGb2N1c09wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLmZvY3VzTW9uaXRvci5mb2N1c1ZpYSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgb3JpZ2luLCBvcHRpb25zKTtcbiAgfVxuXG4gIGlzRGlydHlWYWx1ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWUgIT09IHRoaXMuaW50bC5lbXB0eVZhbHVlO1xuICB9XG5cbiAgcmVzZXRJbnB1dChldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgdGhpcy5pc0RpcnR5VmFsdWUoKSkge1xuICAgICAgdGhpcy5zZXROZXdWYWx1ZSh0aGlzLmludGwuZW1wdHlWYWx1ZSkuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmVtaXRWYWx1ZSgncmVzZXQnLCBldmVudCk7XG4gICAgICB0aGlzLmNsZWFyLmVtaXQoKTtcbiAgICAgIHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIGVtaXRWYWx1ZSh0cmlnZ2VyOiBSZHNTZWFyY2hFdmVudFRyaWdnZXIsIGV2ZW50PzogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fbGFzdEVtaXR0ZWQuZ2V0VmFsdWUoKS5xdWVyeSAhPT0gdGhpcy5fdmFsdWUpIHtcbiAgICAgIHRoaXMuX2xhc3RFbWl0dGVkLm5leHQoeyBxdWVyeTogdGhpcy5fdmFsdWUsIHRyaWdnZXIsIGV2ZW50IH0pO1xuICAgICAgdGhpcy5fb25DaGFuZ2UodGhpcy5fdmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRJbnRsVmFsdWVzKCk6IHZvaWQge1xuICAgIHRoaXMucGxhY2Vob2xkZXIgPVxuICAgICAgdGhpcy5wbGFjZWhvbGRlciAmJiB0aGlzLnBsYWNlaG9sZGVyICE9PSAnJ1xuICAgICAgICA/IHRoaXMucGxhY2Vob2xkZXJcbiAgICAgICAgOiB0aGlzLmludGwuc2VhcmNoSW5wdXRQbGFjZWhvbGRlcjtcbiAgICB0aGlzLmJ1dHRvblRleHQgPVxuICAgICAgdGhpcy5idXR0b25UZXh0ICYmIHRoaXMuYnV0dG9uVGV4dCAhPT0gJydcbiAgICAgICAgPyB0aGlzLmJ1dHRvblRleHRcbiAgICAgICAgOiB0aGlzLmludGwuc2VhcmNoQnV0dG9uVGV4dDtcbiAgICB0aGlzLmVtcHR5VmFsdWUgPSB0aGlzLmVtcHR5VmFsdWUgfHwgdGhpcy5pbnRsLmVtcHR5VmFsdWU7XG4gICAgdGhpcy5hcmlhSW5wdXRMYWJlbCA9XG4gICAgICB0aGlzLmFyaWFJbnB1dExhYmVsICYmIHRoaXMuYXJpYUlucHV0TGFiZWwgIT09ICcnXG4gICAgICAgID8gdGhpcy5hcmlhSW5wdXRMYWJlbFxuICAgICAgICA6IHRoaXMuaW50bC5hcmlhSW5wdXRMYWJlbDtcbiAgICB0aGlzLmFyaWFDbGVhckxhYmVsID1cbiAgICAgIHRoaXMuYXJpYUNsZWFyTGFiZWwgJiYgdGhpcy5hcmlhQ2xlYXJMYWJlbCAhPT0gJydcbiAgICAgICAgPyB0aGlzLmFyaWFDbGVhckxhYmVsXG4gICAgICAgIDogdGhpcy5pbnRsLmFyaWFDbGVhckxhYmVsO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXROZXdWYWx1ZSh2YWx1ZTogc3RyaW5nKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgaWYgKFxuICAgICAgdmFsdWUgIT09IG51bGwgJiZcbiAgICAgIHZhbHVlICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIHRoaXMuX3ZhbHVlICE9PSBTdHJpbmcodmFsdWUpXG4gICAgKSB7XG4gICAgICB0aGlzLl92YWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcblxuICAgICAgaWYgKHRoaXMuYXV0b1NlYXJjaCkge1xuICAgICAgICByZXR1cm4gb2Yodm9pZCAwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gRU1QVFk7XG4gIH1cbn1cbiJdfQ==