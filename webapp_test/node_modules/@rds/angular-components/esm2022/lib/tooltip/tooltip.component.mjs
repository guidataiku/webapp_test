import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, HostBinding, HostListener, inject, ViewChild, ViewEncapsulation, } from '@angular/core';
import { Subject } from 'rxjs';
import { tooltipAnimation } from './tooltip.animations';
import { getFirstFocusableChild } from '../utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../button/icon-button.component";
import * as i3 from "../icons/icon.component";
let rdsTooltipCounter = 0;
export class RdsTooltipComponent {
    constructor() {
        this.cdr = inject(ChangeDetectorRef);
        this.nativeElement = inject(ElementRef).nativeElement;
        this._tooltipArrow = false;
        this._visibility = 'initial';
        // close tooltip on body click
        this._closeOnInteraction = false;
        this._onHide = new Subject();
        this.id = `rdsTooltip-${rdsTooltipCounter++}`;
        this.isModal = false;
    }
    closeOnBodyClick() {
        if (!this.isPopover && this._closeOnInteraction) {
            this.hide();
        }
    }
    get contentIsString() {
        return typeof this._content === 'string';
    }
    get tooltipIconClass() {
        return this._tooltipArrow ? 'rds-tooltip--hide-arrow ' : '';
    }
    ngOnDestroy() {
        this._onHide.complete();
    }
    /**
     * Show tooltip
     * @param delay in ms
     */
    show(delay = 0) {
        // Cancel hide if it is scheduled
        if (this._hideTimeout) {
            clearTimeout(this._hideTimeout);
            this._hideTimeout = null;
        }
        this._closeOnInteraction = !this.isPopover;
        this._showTimeout = setTimeout(() => {
            this._visibility = 'visible';
            this._showTimeout = null;
            // Mark for check so if any parent component has set the
            // ChangeDetectionStrategy to OnPush it will be checked anyway
            this._markForCheck();
        }, delay);
    }
    /**
     * Hide tooltip
     * @param delay in ms
     */
    hide(delay = 0) {
        // Cancel show if it is scheduled
        if (this._showTimeout) {
            clearTimeout(this._showTimeout);
            this._showTimeout = null;
        }
        this._hideTimeout = setTimeout(() => {
            this._visibility = 'hidden';
            this._hideTimeout = null;
            // Mark for check so if any parent component has set the
            // ChangeDetectionStrategy to OnPush it will be checked anyway
            this._markForCheck();
        }, delay);
    }
    getFirstFocusableElement() {
        return getFirstFocusableChild(this.nativeElement);
    }
    getLastFocusableElement() {
        return this.closeButton?.nativeElement ?? null;
    }
    afterHidden() {
        return this._onHide;
    }
    isVisible() {
        return this._visibility === 'visible';
    }
    onCloseButtonClick() {
        this.triggerDirectiveRef?.hide();
    }
    _animationStart() {
        this._closeOnInteraction = false;
    }
    _animationDone(event) {
        const toState = event.toState;
        if (toState === 'hidden' && !this.isVisible()) {
            this._onHide.next();
        }
        if (toState === 'visible' || toState === 'hidden') {
            this._closeOnInteraction = !this.isPopover;
        }
    }
    _markForCheck() {
        this.cdr.markForCheck();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsTooltipComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.1", type: RdsTooltipComponent, selector: "rds-tooltip", host: { listeners: { "body:click": "closeOnBodyClick()" }, properties: { "attr.role": "this.role", "attr.id": "this.id", "attr.aria-modal": "this.isModal" } }, viewQueries: [{ propertyName: "closeButton", first: true, predicate: ["closeButton"], descendants: true, read: ElementRef }], ngImport: i0, template: "<div\n  [ngClass]=\"_tooltipClass\"\n  [className]=\"\n    'rds-tooltip rds-tooltip--' +\n    _position +\n    tooltipIconClass +\n    (isPopover ? ' rds-popover' : '')\n  \"\n  [@state]=\"_visibility\"\n  (@state.start)=\"_animationStart()\"\n  (@state.done)=\"_animationDone($event)\"\n>\n  @if (contentIsString) {\n    {{ _content }}\n  } @else {\n    <ng-container *ngTemplateOutlet=\"$any(_content)\" />\n  }\n  @if (isPopover && showCloseButton) {\n    <button\n      #closeButton\n      class=\"rds-popover-close-button\"\n      rds-icon-button\n      aria-label=\"close\"\n      (click)=\"onCloseButtonClick()\"\n    >\n      <rds-icon namespace=\"filled\" icon=\"close\" />\n    </button>\n  }\n</div>\n", styles: [".rds-tooltip{font-size:12px;font-weight:400;line-height:16px;text-transform:none;letter-spacing:.5px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform-origin:center bottom;border-radius:2px;padding:8px 12px;background:var(--rds-color-tooltip-bg);text-align:center;color:var(--rds-color-high-contrast-reversed)}.rds-tooltip:before{content:\"\";position:absolute;width:0;height:0}.rds-tooltip.rds-tooltip--top-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;left:12px}.rds-tooltip.rds-tooltip--top-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;left:calc(50% - 6px)}.rds-tooltip.rds-tooltip--top-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;right:12px}.rds-tooltip.rds-tooltip--right-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;top:12px}.rds-tooltip.rds-tooltip--right-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;top:calc(50% - 6px)}.rds-tooltip.rds-tooltip--right-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;bottom:12px}.rds-tooltip.rds-tooltip--bottom-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;right:12px}.rds-tooltip.rds-tooltip--bottom-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;left:calc(50% - 6px)}.rds-tooltip.rds-tooltip--bottom-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;left:12px}.rds-tooltip.rds-tooltip--left-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;bottom:12px}.rds-tooltip.rds-tooltip--left-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;top:calc(50% - 6px)}.rds-tooltip.rds-tooltip--left-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;top:12px}.rds-tooltip.rds-tooltip--hide-arrow:before{border:0}.rds-popover{box-shadow:0 0 2px #00000029,0 12px 40px #0000002b;background:var(--rds-color-high-contrast-reversed);padding:24px}.rds-popover .rds-popover-close-button{position:absolute;top:24px;right:24px}.rds-popover .rds-popover-header.rds-popover-with-close-button{margin-right:24px}.rds-popover.rds-tooltip--top-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--top-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--top-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}\n"], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i2.RdsIconButtonComponent, selector: "\n    button[rds-icon-button],\n    button[rdsIconButton],\n    button[rds-icon-warning-button],\n    button[rdsIconWarningButton],\n  ", inputs: ["size"] }, { kind: "component", type: i3.RdsIconComponent, selector: "rds-icon", inputs: ["namespace", "icon"] }], animations: [tooltipAnimation.tooltipState], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.1", ngImport: i0, type: RdsTooltipComponent, decorators: [{
            type: Component,
            args: [{ selector: 'rds-tooltip', encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, animations: [tooltipAnimation.tooltipState], template: "<div\n  [ngClass]=\"_tooltipClass\"\n  [className]=\"\n    'rds-tooltip rds-tooltip--' +\n    _position +\n    tooltipIconClass +\n    (isPopover ? ' rds-popover' : '')\n  \"\n  [@state]=\"_visibility\"\n  (@state.start)=\"_animationStart()\"\n  (@state.done)=\"_animationDone($event)\"\n>\n  @if (contentIsString) {\n    {{ _content }}\n  } @else {\n    <ng-container *ngTemplateOutlet=\"$any(_content)\" />\n  }\n  @if (isPopover && showCloseButton) {\n    <button\n      #closeButton\n      class=\"rds-popover-close-button\"\n      rds-icon-button\n      aria-label=\"close\"\n      (click)=\"onCloseButtonClick()\"\n    >\n      <rds-icon namespace=\"filled\" icon=\"close\" />\n    </button>\n  }\n</div>\n", styles: [".rds-tooltip{font-size:12px;font-weight:400;line-height:16px;text-transform:none;letter-spacing:.5px;font-family:roche-sans;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform-origin:center bottom;border-radius:2px;padding:8px 12px;background:var(--rds-color-tooltip-bg);text-align:center;color:var(--rds-color-high-contrast-reversed)}.rds-tooltip:before{content:\"\";position:absolute;width:0;height:0}.rds-tooltip.rds-tooltip--top-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;left:12px}.rds-tooltip.rds-tooltip--top-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;left:calc(50% - 6px)}.rds-tooltip.rds-tooltip--top-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-tooltip-bg);bottom:-6px;right:12px}.rds-tooltip.rds-tooltip--right-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;top:12px}.rds-tooltip.rds-tooltip--right-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;top:calc(50% - 6px)}.rds-tooltip.rds-tooltip--right-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-tooltip-bg);left:-6px;bottom:12px}.rds-tooltip.rds-tooltip--bottom-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;right:12px}.rds-tooltip.rds-tooltip--bottom-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;left:calc(50% - 6px)}.rds-tooltip.rds-tooltip--bottom-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-tooltip-bg);top:-6px;left:12px}.rds-tooltip.rds-tooltip--left-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;bottom:12px}.rds-tooltip.rds-tooltip--left-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;top:calc(50% - 6px)}.rds-tooltip.rds-tooltip--left-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-tooltip-bg);right:-6px;top:12px}.rds-tooltip.rds-tooltip--hide-arrow:before{border:0}.rds-popover{box-shadow:0 0 2px #00000029,0 12px 40px #0000002b;background:var(--rds-color-high-contrast-reversed);padding:24px}.rds-popover .rds-popover-close-button{position:absolute;top:24px;right:24px}.rds-popover .rds-popover-header.rds-popover-with-close-button{margin-right:24px}.rds-popover.rds-tooltip--top-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--top-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--top-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--right-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-right:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-center:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--bottom-left:before{border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-bottom:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-center:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}.rds-popover.rds-tooltip--left-top:before{border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:8px solid var(--rds-color-high-contrast-reversed)}\n"] }]
        }], propDecorators: { closeButton: [{
                type: ViewChild,
                args: ['closeButton', { read: ElementRef }]
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }], id: [{
                type: HostBinding,
                args: ['attr.id']
            }], isModal: [{
                type: HostBinding,
                args: ['attr.aria-modal']
            }], closeOnBodyClick: [{
                type: HostListener,
                args: ['body:click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3Rvb2x0aXAvdG9vbHRpcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItY29tcG9uZW50cy9zcmMvbGliL3Rvb2x0aXAvdG9vbHRpcC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUdOLFNBQVMsRUFDVCxpQkFBaUIsR0FDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQU0zQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUV4RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxVQUFVLENBQUM7Ozs7O0FBRWxELElBQUksaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO0FBVTFCLE1BQU0sT0FBTyxtQkFBbUI7SUFSaEM7UUFTbUIsUUFBRyxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ2hDLGtCQUFhLEdBQzVCLE1BQU0sQ0FBMEIsVUFBVSxDQUFDLENBQUMsYUFBYSxDQUFDO1FBSzVELGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBTXRCLGdCQUFXLEdBQXlCLFNBQVMsQ0FBQztRQUU5Qyw4QkFBOEI7UUFDdEIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ25CLFlBQU8sR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBYS9DLE9BQUUsR0FBRyxjQUFjLGlCQUFpQixFQUFFLEVBQUUsQ0FBQztRQUd6QyxZQUFPLEdBQUcsS0FBSyxDQUFDO0tBdUdqQjtJQXBHQyxnQkFBZ0I7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QUM7WUFDbEQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUM3QyxDQUFDO0lBQ0gsQ0FBQztJQUVELGFBQWE7UUFDWCxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzFCLENBQUM7OEdBeElVLG1CQUFtQjtrR0FBbkIsbUJBQW1CLDBTQXdCSSxVQUFVLDZCQzFEOUMsMHNCQTZCQSw4b0xER2MsQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUM7OzJGQUVoQyxtQkFBbUI7a0JBUi9CLFNBQVM7K0JBQ0UsYUFBYSxpQkFHUixpQkFBaUIsQ0FBQyxJQUFJLG1CQUNwQix1QkFBdUIsQ0FBQyxNQUFNLGNBQ25DLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDOzhCQTJCM0MsV0FBVztzQkFEVixTQUFTO3VCQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7Z0JBSTlDLElBQUk7c0JBREgsV0FBVzt1QkFBQyxXQUFXO2dCQUl4QixFQUFFO3NCQURELFdBQVc7dUJBQUMsU0FBUztnQkFJdEIsT0FBTztzQkFETixXQUFXO3VCQUFDLGlCQUFpQjtnQkFJOUIsZ0JBQWdCO3NCQURmLFlBQVk7dUJBQUMsWUFBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFuaW1hdGlvbkV2ZW50IH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgaW5qZWN0LFxuICBPbkRlc3Ryb3ksXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIFJkc1Rvb2x0aXBDbGFzcyxcbiAgUmRzVG9vbHRpcFBvc2l0aW9uLFxuICBSZHNUb29sdGlwVmlzaWJpbGl0eSxcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyB0b29sdGlwQW5pbWF0aW9uIH0gZnJvbSAnLi90b29sdGlwLmFuaW1hdGlvbnMnO1xuaW1wb3J0IHsgUmRzVG9vbHRpcERpcmVjdGl2ZSB9IGZyb20gJy4vdG9vbHRpcC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgZ2V0Rmlyc3RGb2N1c2FibGVDaGlsZCB9IGZyb20gJy4uL3V0aWxzJztcblxubGV0IHJkc1Rvb2x0aXBDb3VudGVyID0gMDtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncmRzLXRvb2x0aXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vdG9vbHRpcC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3Rvb2x0aXAuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGFuaW1hdGlvbnM6IFt0b29sdGlwQW5pbWF0aW9uLnRvb2x0aXBTdGF0ZV0sXG59KVxuZXhwb3J0IGNsYXNzIFJkc1Rvb2x0aXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGNkciA9IGluamVjdChDaGFuZ2VEZXRlY3RvclJlZik7XG4gIHByaXZhdGUgcmVhZG9ubHkgbmF0aXZlRWxlbWVudCA9XG4gICAgaW5qZWN0PEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+PihFbGVtZW50UmVmKS5uYXRpdmVFbGVtZW50O1xuXG4gIF9jb250ZW50OiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjx1bmtub3duPjtcblxuICBfdG9vbHRpcENsYXNzOiBSZHNUb29sdGlwQ2xhc3M7XG4gIF90b29sdGlwQXJyb3cgPSBmYWxzZTtcblxuICBfc2hvd1RpbWVvdXQ6IFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+IHwgbnVsbDtcbiAgX2hpZGVUaW1lb3V0OiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PiB8IG51bGw7XG5cbiAgX3Bvc2l0aW9uOiBSZHNUb29sdGlwUG9zaXRpb247XG4gIF92aXNpYmlsaXR5OiBSZHNUb29sdGlwVmlzaWJpbGl0eSA9ICdpbml0aWFsJztcblxuICAvLyBjbG9zZSB0b29sdGlwIG9uIGJvZHkgY2xpY2tcbiAgcHJpdmF0ZSBfY2xvc2VPbkludGVyYWN0aW9uID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgX29uSGlkZSA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgdHJpZ2dlckRpcmVjdGl2ZVJlZj86IFJkc1Rvb2x0aXBEaXJlY3RpdmU7XG4gIGlzUG9wb3ZlcjogYm9vbGVhbjtcbiAgc2hvd0Nsb3NlQnV0dG9uOiBib29sZWFuO1xuXG4gIEBWaWV3Q2hpbGQoJ2Nsb3NlQnV0dG9uJywgeyByZWFkOiBFbGVtZW50UmVmIH0pXG4gIGNsb3NlQnV0dG9uOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PiB8IHVuZGVmaW5lZDtcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIucm9sZScpXG4gIHJvbGU6ICdkaWFsb2cnIHwgbnVsbDtcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBpZCA9IGByZHNUb29sdGlwLSR7cmRzVG9vbHRpcENvdW50ZXIrK31gO1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLW1vZGFsJylcbiAgaXNNb2RhbCA9IGZhbHNlO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ2JvZHk6Y2xpY2snKVxuICBjbG9zZU9uQm9keUNsaWNrKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc1BvcG92ZXIgJiYgdGhpcy5fY2xvc2VPbkludGVyYWN0aW9uKSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgY29udGVudElzU3RyaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0eXBlb2YgdGhpcy5fY29udGVudCA9PT0gJ3N0cmluZyc7XG4gIH1cblxuICBnZXQgdG9vbHRpcEljb25DbGFzcygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl90b29sdGlwQXJyb3cgPyAncmRzLXRvb2x0aXAtLWhpZGUtYXJyb3cgJyA6ICcnO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fb25IaWRlLmNvbXBsZXRlKCk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyB0b29sdGlwXG4gICAqIEBwYXJhbSBkZWxheSBpbiBtc1xuICAgKi9cbiAgc2hvdyhkZWxheSA9IDApOiB2b2lkIHtcbiAgICAvLyBDYW5jZWwgaGlkZSBpZiBpdCBpcyBzY2hlZHVsZWRcbiAgICBpZiAodGhpcy5faGlkZVRpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9oaWRlVGltZW91dCk7XG4gICAgICB0aGlzLl9oaWRlVGltZW91dCA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5fY2xvc2VPbkludGVyYWN0aW9uID0gIXRoaXMuaXNQb3BvdmVyO1xuICAgIHRoaXMuX3Nob3dUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLl92aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuICAgICAgdGhpcy5fc2hvd1RpbWVvdXQgPSBudWxsO1xuXG4gICAgICAvLyBNYXJrIGZvciBjaGVjayBzbyBpZiBhbnkgcGFyZW50IGNvbXBvbmVudCBoYXMgc2V0IHRoZVxuICAgICAgLy8gQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgdG8gT25QdXNoIGl0IHdpbGwgYmUgY2hlY2tlZCBhbnl3YXlcbiAgICAgIHRoaXMuX21hcmtGb3JDaGVjaygpO1xuICAgIH0sIGRlbGF5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIHRvb2x0aXBcbiAgICogQHBhcmFtIGRlbGF5IGluIG1zXG4gICAqL1xuICBoaWRlKGRlbGF5ID0gMCk6IHZvaWQge1xuICAgIC8vIENhbmNlbCBzaG93IGlmIGl0IGlzIHNjaGVkdWxlZFxuICAgIGlmICh0aGlzLl9zaG93VGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Nob3dUaW1lb3V0KTtcbiAgICAgIHRoaXMuX3Nob3dUaW1lb3V0ID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLl9oaWRlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5fdmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICAgICAgdGhpcy5faGlkZVRpbWVvdXQgPSBudWxsO1xuXG4gICAgICAvLyBNYXJrIGZvciBjaGVjayBzbyBpZiBhbnkgcGFyZW50IGNvbXBvbmVudCBoYXMgc2V0IHRoZVxuICAgICAgLy8gQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgdG8gT25QdXNoIGl0IHdpbGwgYmUgY2hlY2tlZCBhbnl3YXlcbiAgICAgIHRoaXMuX21hcmtGb3JDaGVjaygpO1xuICAgIH0sIGRlbGF5KTtcbiAgfVxuXG4gIGdldEZpcnN0Rm9jdXNhYmxlRWxlbWVudCgpOiBIVE1MRWxlbWVudCB8IG51bGwge1xuICAgIHJldHVybiBnZXRGaXJzdEZvY3VzYWJsZUNoaWxkKHRoaXMubmF0aXZlRWxlbWVudCk7XG4gIH1cblxuICBnZXRMYXN0Rm9jdXNhYmxlRWxlbWVudCgpOiBIVE1MRWxlbWVudCB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmNsb3NlQnV0dG9uPy5uYXRpdmVFbGVtZW50ID8/IG51bGw7XG4gIH1cblxuICBhZnRlckhpZGRlbigpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5fb25IaWRlO1xuICB9XG5cbiAgaXNWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl92aXNpYmlsaXR5ID09PSAndmlzaWJsZSc7XG4gIH1cblxuICBvbkNsb3NlQnV0dG9uQ2xpY2soKTogdm9pZCB7XG4gICAgdGhpcy50cmlnZ2VyRGlyZWN0aXZlUmVmPy5oaWRlKCk7XG4gIH1cblxuICBfYW5pbWF0aW9uU3RhcnQoKTogdm9pZCB7XG4gICAgdGhpcy5fY2xvc2VPbkludGVyYWN0aW9uID0gZmFsc2U7XG4gIH1cblxuICBfYW5pbWF0aW9uRG9uZShldmVudDogQW5pbWF0aW9uRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCB0b1N0YXRlID0gZXZlbnQudG9TdGF0ZSBhcyBSZHNUb29sdGlwVmlzaWJpbGl0eTtcblxuICAgIGlmICh0b1N0YXRlID09PSAnaGlkZGVuJyAmJiAhdGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgdGhpcy5fb25IaWRlLm5leHQoKTtcbiAgICB9XG5cbiAgICBpZiAodG9TdGF0ZSA9PT0gJ3Zpc2libGUnIHx8IHRvU3RhdGUgPT09ICdoaWRkZW4nKSB7XG4gICAgICB0aGlzLl9jbG9zZU9uSW50ZXJhY3Rpb24gPSAhdGhpcy5pc1BvcG92ZXI7XG4gICAgfVxuICB9XG5cbiAgX21hcmtGb3JDaGVjaygpOiB2b2lkIHtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxufVxuIiwiPGRpdlxuICBbbmdDbGFzc109XCJfdG9vbHRpcENsYXNzXCJcbiAgW2NsYXNzTmFtZV09XCJcbiAgICAncmRzLXRvb2x0aXAgcmRzLXRvb2x0aXAtLScgK1xuICAgIF9wb3NpdGlvbiArXG4gICAgdG9vbHRpcEljb25DbGFzcyArXG4gICAgKGlzUG9wb3ZlciA/ICcgcmRzLXBvcG92ZXInIDogJycpXG4gIFwiXG4gIFtAc3RhdGVdPVwiX3Zpc2liaWxpdHlcIlxuICAoQHN0YXRlLnN0YXJ0KT1cIl9hbmltYXRpb25TdGFydCgpXCJcbiAgKEBzdGF0ZS5kb25lKT1cIl9hbmltYXRpb25Eb25lKCRldmVudClcIlxuPlxuICBAaWYgKGNvbnRlbnRJc1N0cmluZykge1xuICAgIHt7IF9jb250ZW50IH19XG4gIH0gQGVsc2Uge1xuICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCIkYW55KF9jb250ZW50KVwiIC8+XG4gIH1cbiAgQGlmIChpc1BvcG92ZXIgJiYgc2hvd0Nsb3NlQnV0dG9uKSB7XG4gICAgPGJ1dHRvblxuICAgICAgI2Nsb3NlQnV0dG9uXG4gICAgICBjbGFzcz1cInJkcy1wb3BvdmVyLWNsb3NlLWJ1dHRvblwiXG4gICAgICByZHMtaWNvbi1idXR0b25cbiAgICAgIGFyaWEtbGFiZWw9XCJjbG9zZVwiXG4gICAgICAoY2xpY2spPVwib25DbG9zZUJ1dHRvbkNsaWNrKClcIlxuICAgID5cbiAgICAgIDxyZHMtaWNvbiBuYW1lc3BhY2U9XCJmaWxsZWRcIiBpY29uPVwiY2xvc2VcIiAvPlxuICAgIDwvYnV0dG9uPlxuICB9XG48L2Rpdj5cbiJdfQ==